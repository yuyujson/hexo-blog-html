<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>git免密</title>
    <url>/2021/git-nonpassword/</url>
    <content><![CDATA[<p>&#x4F7F;&#x7528; git credential.helper &#x63D2;&#x4EF6;&#x914D;&#x7F6E; http &#x8BF7;&#x6C42;&#x7528;&#x6237;&#x540D;&#x5BC6;&#x7801;:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global credential.helper store -file=.git_credentails</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&apos;http://&#x7528;&#x6237;&#x540D;:&#x5BC6;&#x7801;@icode.baoshiyun.com&apos;</span> &gt; ~/.git-credentials</span><br></pre></td></tr></table></figure>

<p>&#x914D;&#x7F6E;&#x540E; git &#x8BF7;&#x6C42; <code>github</code> &#x65F6;&#x4F1A;&#x81EA;&#x52A8;&#x4ECE; <code>~/.git-credentials</code>  &#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x8BFB;&#x53D6;, &#x4E0D;&#x9700;&#x8981;&#x518D;&#x6B21;&#x8F93;&#x5165;&#x7528;&#x6237;&#x540D;&#x5BC6;&#x7801;</p>
]]></content>
      <categories>
        <category>util</category>
      </categories>
  </entry>
  <entry>
    <title>dockerFile</title>
    <url>/2020/docker2/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>docker</category>
      </categories>
  </entry>
  <entry>
    <title>docker基础</title>
    <url>/2020/docker1/</url>
    <content><![CDATA[<h1 id="&#x57FA;&#x672C;&#x6982;&#x5FF5;">1. &#x57FA;&#x672C;&#x6982;&#x5FF5;</h1><blockquote>
<p>Docker &#x662F;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x73AF;&#x5883;&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x4F60;&#x7684;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x3001;&#x4EE3;&#x7801;&#x3001;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7B49;&#x4E00;&#x5E76;&#x6253;&#x5305;&#x5230;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5E76;&#x53D1;&#x5E03;&#x548C;&#x5E94;&#x7528;&#x5230;&#x4EFB;&#x610F;&#x5E73;&#x53F0;&#x4E2D;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4F60;&#x5728;&#x672C;&#x5730;&#x7528; Python &#x5F00;&#x53D1;&#x7F51;&#x7AD9;&#x540E;&#x53F0;&#xFF0C;&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5C06; Python3 &#x53CA;&#x5176;&#x4F9D;&#x8D56;&#x5305;&#x3001;Flask &#x53CA;&#x5176;&#x5404;&#x79CD;&#x63D2;&#x4EF6;&#x3001;Mysql&#x3001;Nginx &#x7B49;&#x6253;&#x5305;&#x5230;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x90E8;&#x7F72;&#x5230;&#x4EFB;&#x610F;&#x4F60;&#x60F3;&#x90E8;&#x7F72;&#x5230;&#x7684;&#x73AF;&#x5883;&#x3002;</p>
</blockquote>
<ul>
<li>&#x955C;&#x50CF;&#xFF08;Image&#xFF09;&#xFF1A;&#x7C7B;&#x4F3C;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6709;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x9762;&#x5411; Docker &#x5F15;&#x64CE;&#x7684;&#x53EA;&#x8BFB;&#x6A21;&#x677F;&#x3002;&#x4EFB;&#x4F55;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x90FD;&#x9700;&#x8981;&#x73AF;&#x5883;&#xFF0C;&#x800C;&#x955C;&#x50CF;&#x5C31;&#x662F;&#x7528;&#x6765;&#x63D0;&#x4F9B;&#x8FD9;&#x79CD;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x7684;&#x3002;&#x4F8B;&#x5982;&#x4E00;&#x4E2A; Ubuntu &#x955C;&#x50CF;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5305;&#x542B; Ubuntu &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x73AF;&#x5883;&#x7684;&#x6A21;&#x677F;&#xFF0C;&#x540C;&#x7406;&#x5728;&#x8BE5;&#x955C;&#x50CF;&#x4E0A;&#x88C5;&#x4E0A; Apache &#x8F6F;&#x4EF6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x79F0;&#x4E3A; Apache &#x955C;&#x50CF;&#x3002;</li>
<li>&#x5BB9;&#x5668;&#xFF08;Container&#xFF09;&#xFF1A;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x6C99;&#x76D2;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x770B;&#x4F5C;&#x4E00;&#x4E2A;&#x6781;&#x7B80;&#x7684; Linux &#x7CFB;&#x7EDF;&#x73AF;&#x5883;&#xFF08;&#x5305;&#x62EC; root &#x6743;&#x9650;&#x3001;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#x3001;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x548C;&#x7F51;&#x7EDC;&#x7A7A;&#x95F4;&#x7B49;&#xFF09;&#xFF0C;&#x4EE5;&#x53CA;&#x8FD0;&#x884C;&#x5728;&#x5176;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;Docker &#x5F15;&#x64CE;&#x5229;&#x7528;&#x5BB9;&#x5668;&#x6765;&#x8FD0;&#x884C;&#x3001;&#x9694;&#x79BB;&#x5404;&#x4E2A;&#x5E94;&#x7528;&#x3002;&#x5BB9;&#x5668;&#x662F;&#x955C;&#x50CF;&#x521B;&#x5EFA;&#x7684;&#x5E94;&#x7528;&#x5B9E;&#x4F8B;&#xFF0C;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x3001;&#x542F;&#x52A8;&#x3001;&#x505C;&#x6B62;&#x3001;&#x5220;&#x9664;&#x5BB9;&#x5668;&#xFF0C;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x662F;&#x662F;&#x76F8;&#x4E92;&#x9694;&#x79BB;&#x7684;&#xFF0C;&#x4E92;&#x4E0D;&#x5F71;&#x54CD;&#x3002;&#x6CE8;&#x610F;&#xFF1A;&#x955C;&#x50CF;&#x672C;&#x8EAB;&#x662F;&#x53EA;&#x8BFB;&#x7684;&#xFF0C;&#x5BB9;&#x5668;&#x4ECE;&#x955C;&#x50CF;&#x542F;&#x52A8;&#x65F6;&#xFF0C;Docker &#x5728;&#x955C;&#x50CF;&#x7684;&#x4E0A;&#x5C42;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x53EF;&#x5199;&#x5C42;&#xFF0C;&#x955C;&#x50CF;&#x672C;&#x8EAB;&#x4E0D;&#x53D8;&#x3002;</li>
<li>&#x4ED3;&#x5E93;&#xFF08;Repository&#xFF09;&#xFF1A;&#x7C7B;&#x4F3C;&#x4E8E;&#x4EE3;&#x7801;&#x4ED3;&#x5E93;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#xFF0C;&#x662F; Docker &#x7528;&#x6765;&#x96C6;&#x4E2D;&#x5B58;&#x653E;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x7684;&#x5730;&#x65B9;&#x3002;&#x6CE8;&#x610F;&#x4E0E;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x5668;&#xFF08;Registry&#xFF09;&#x7684;&#x533A;&#x522B;&#xFF1A;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x5668;&#x662F;&#x5B58;&#x653E;&#x4ED3;&#x5E93;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x6709;&#x591A;&#x4E2A;&#x4ED3;&#x5E93;&#xFF1B;&#x800C;&#x4ED3;&#x5E93;&#x662F;&#x5B58;&#x653E;&#x955C;&#x50CF;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x4E00;&#x822C;&#x6BCF;&#x4E2A;&#x4ED3;&#x5E93;&#x5B58;&#x653E;&#x4E00;&#x7C7B;&#x955C;&#x50CF;&#xFF0C;&#x6BCF;&#x4E2A;&#x955C;&#x50CF;&#x5229;&#x7528; tag &#x8FDB;&#x884C;&#x533A;&#x5206;&#xFF0C;&#x6BD4;&#x5982; Ubuntu &#x4ED3;&#x5E93;&#x5B58;&#x653E;&#x6709;&#x591A;&#x4E2A;&#x7248;&#x672C;&#xFF08;12.04&#x3001;14.04 &#x7B49;&#xFF09;&#x7684; Ubuntu &#x955C;&#x50CF;&#x3002;</li>
</ul>
<a id="more"></a>

<h1 id="&#x914D;&#x7F6E;&#x963F;&#x91CC;&#x955C;&#x50CF;&#x6E90;">2. &#x914D;&#x7F6E;&#x963F;&#x91CC;&#x955C;&#x50CF;&#x6E90;</h1><ol>
<li>&#x767B;&#x5F55;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x670D;&#x52A1;&#x63A7;&#x5236;&#x53F0;&#x540E;&#xFF0C;&#x5728;&#x5DE6;&#x4FA7;&#x5BFC;&#x822A;&#x680F;&#x9009;&#x62E9;&#x955C;&#x50CF;&#x5DE5;&#x5177; &gt; &#x955C;&#x50CF;&#x52A0;&#x901F;&#x5668;&#xFF0C;&#x5728;&#x955C;&#x50CF;&#x52A0;&#x901F;&#x5668;&#x9875;&#x9762;&#x5C31;&#x4F1A;&#x663E;&#x793A;&#x4E3A;&#x60A8;&#x72EC;&#x7ACB;&#x5206;&#x914D;&#x7684;&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;&#x3002;</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&#x4F8B;&#x5982;&#xFF1A;</span><br><span class="line">&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;&#xFF1A;<span class="selector-attr">[&#x7CFB;&#x7EDF;&#x5206;&#x914D;&#x524D;&#x7F00;]</span><span class="selector-class">.mirror</span><span class="selector-class">.aliyuncs</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>&#x521B;&#x5EFA;<code>/etc/docker/daemon.json</code>&#x6587;&#x4EF6;, &#x5E76;&#x5199;&#x5165;:</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">{</span><br><span class="line"><span class="attr">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;&quot;</span>]</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>&#x91CD;&#x542F; daocker</li>
</ol>
<p><a href="https://help.aliyun.com/document_detail/60750.html?spm=a2c4g.11186623.6.553.798e242f91hdh4" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a></p>
<h1 id="Docker-&#x5E38;&#x7528;&#x64CD;&#x4F5C;">3. Docker &#x5E38;&#x7528;&#x64CD;&#x4F5C;</h1><p>&#x8F93;&#x5165;<code>docker</code>&#x53EF;&#x4EE5;&#x67E5;&#x770B; Docker &#x7684;&#x547D;&#x4EE4;&#x7528;&#x6CD5;&#xFF0C;&#x8F93;&#x5165;<code>docker COMMAND --help</code>&#x67E5;&#x770B;&#x6307;&#x5B9A;&#x547D;&#x4EE4;&#x8BE6;&#x7EC6;&#x7528;&#x6CD5;&#x3002;</p>
<h2 id="&#x955C;&#x50CF;&#x5E38;&#x7528;&#x64CD;&#x4F5C;">3.1. &#x955C;&#x50CF;&#x5E38;&#x7528;&#x64CD;&#x4F5C;</h2><p>&#x67E5;&#x627E;&#x955C;&#x50CF;&#xFF1A;</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker</span> search &#x5173;&#x952E;&#x8BCD;</span><br><span class="line"><span class="comment">#&#x641C;&#x7D22;docker hub&#x7F51;&#x7AD9;&#x955C;&#x50CF;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;</span></span><br></pre></td></tr></table></figure>

<p>&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF1A;</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">docker pull &#x955C;&#x50CF;&#x540D;:<span class="keyword">TAG</span></span><br><span class="line"><span class="comment"># Tag&#x8868;&#x793A;&#x7248;&#x672C;&#xFF0C;&#x6709;&#x4E9B;&#x955C;&#x50CF;&#x7684;&#x7248;&#x672C;&#x663E;&#x793A;latest&#xFF0C;&#x4E3A;&#x6700;&#x65B0;&#x7248;&#x672C;</span></span><br></pre></td></tr></table></figure>

<p>&#x67E5;&#x770B;&#x955C;&#x50CF;&#xFF1A;</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker</span> images</span><br><span class="line"><span class="comment"># &#x67E5;&#x770B;&#x672C;&#x5730;&#x6240;&#x6709;&#x955C;&#x50CF;</span></span><br></pre></td></tr></table></figure>

<p>&#x5220;&#x9664;&#x955C;&#x50CF;&#xFF1A;</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">docker rmi -f &#x955C;&#x50CF;ID&#x6216;&#x8005;&#x955C;&#x50CF;&#x540D;:TAG</span><br><span class="line"><span class="meta"># &#x5220;&#x9664;&#x6307;&#x5B9A;&#x672C;&#x5730;&#x955C;&#x50CF;</span></span><br><span class="line"><span class="meta"># -f &#x8868;&#x793A;&#x5F3A;&#x5236;&#x5220;&#x9664;</span></span><br></pre></td></tr></table></figure>

<p>&#x83B7;&#x53D6;&#x5143;&#x4FE1;&#x606F;&#xFF1A;</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">docker inspect &#x955C;&#x50CF;ID&#x6216;&#x8005;&#x955C;&#x50CF;&#x540D;:<span class="keyword">TAG</span></span><br><span class="line"><span class="comment"># &#x83B7;&#x53D6;&#x955C;&#x50CF;&#x7684;&#x5143;&#x4FE1;&#x606F;&#xFF0C;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x5BB9;&#x5668;&#x5E38;&#x7528;&#x64CD;&#x4F5C;">3.2. &#x5BB9;&#x5668;&#x5E38;&#x7528;&#x64CD;&#x4F5C;</h2><p>&#x8FD0;&#x884C;&#xFF1A;</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">docker run --name &#x5BB9;&#x5668;&#x540D; -i -t -p &#x4E3B;&#x673A;&#x7AEF;&#x53E3;:&#x5BB9;&#x5668;&#x7AEF;&#x53E3; -d -v &#x4E3B;&#x673A;&#x76EE;&#x5F55;:&#x5BB9;&#x5668;&#x76EE;&#x5F55;:ro &#x955C;&#x50CF;ID&#x6216;&#x955C;&#x50CF;&#x540D;:TAG</span><br><span class="line"><span class="meta"># --name &#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x540D;&#xFF0C;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;&#x4E0D;&#x6307;&#x5B9A;&#x81EA;&#x52A8;&#x547D;&#x540D;</span></span><br><span class="line"><span class="meta"># -i &#x4EE5;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;&#x8FD0;&#x884C;&#x5BB9;&#x5668;</span></span><br><span class="line"><span class="meta"># -t &#x5206;&#x914D;&#x4E00;&#x4E2A;&#x4F2A;&#x7EC8;&#x7AEF;&#xFF0C;&#x5373;&#x547D;&#x4EE4;&#x884C;&#xFF0C;&#x901A;&#x5E38;-it&#x7EC4;&#x5408;&#x6765;&#x4F7F;&#x7528;</span></span><br><span class="line"><span class="meta"># -p &#x6307;&#x5B9A;&#x6620;&#x5C04;&#x7AEF;&#x53E3;&#xFF0C;&#x8BB2;&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x7AEF;&#x53E3;</span></span><br><span class="line"><span class="meta"># -d &#x540E;&#x53F0;&#x8FD0;&#x884C;&#x5BB9;&#x5668;</span></span><br><span class="line"><span class="meta"># -v &#x6307;&#x5B9A;&#x6302;&#x8F7D;&#x4E3B;&#x673A;&#x76EE;&#x5F55;&#x5230;&#x5BB9;&#x5668;&#x76EE;&#x5F55;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;rw&#x8BFB;&#x5199;&#x6A21;&#x5F0F;&#xFF0C;ro&#x8868;&#x793A;&#x53EA;&#x8BFB;</span></span><br></pre></td></tr></table></figure>

<p>&#x5BB9;&#x5668;&#x5217;&#x8868;&#xFF1A;</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">docker ps -a -q</span><br><span class="line"><span class="meta"># docker ps&#x67E5;&#x770B;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;</span></span><br><span class="line"><span class="meta"># -a &#x67E5;&#x770B;&#x6240;&#x6709;&#x5BB9;&#x5668;&#xFF08;&#x8FD0;&#x884C;&#x4E2D;&#x3001;&#x672A;&#x8FD0;&#x884C;&#xFF09;</span></span><br><span class="line"><span class="meta"># -q &#x53EA;&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x7684;ID</span></span><br></pre></td></tr></table></figure>

<p>&#x542F;&#x52A8;&#x5BB9;&#x5668;&#xFF1A;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">docker <span class="keyword">start</span> &#x5BB9;&#x5668;<span class="keyword">ID</span>&#x6216;&#x5BB9;&#x5668;&#x540D;</span><br></pre></td></tr></table></figure>

<p>&#x505C;&#x6B62;&#x5BB9;&#x5668;&#xFF1A;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">docker <span class="keyword">stop</span> &#x5BB9;&#x5668;<span class="keyword">ID</span>&#x6216;&#x5BB9;&#x5668;&#x540D;</span><br></pre></td></tr></table></figure>

<p>&#x5220;&#x9664;&#x5BB9;&#x5668;&#xFF1A;</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker</span> rm -f &#x5BB9;&#x5668;ID&#x6216;&#x5BB9;&#x5668;&#x540D;</span><br><span class="line"><span class="comment"># -f &#x8868;&#x793A;&#x5F3A;&#x5236;&#x5220;&#x9664;</span></span><br></pre></td></tr></table></figure>

<p>&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#xFF1A;</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker</span> logs &#x5BB9;&#x5668;ID&#x6216;&#x5BB9;&#x5668;&#x540D;</span><br></pre></td></tr></table></figure>

<p>&#x8FDB;&#x5165;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF1A;</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">docker exec -it &#x5BB9;&#x5668;ID&#x6216;&#x8005;&#x5BB9;&#x5668;&#x540D; /bin/bash</span><br><span class="line"><span class="meta"># &#x8FDB;&#x5165;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x5E76;&#x4E14;&#x5F00;&#x542F;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;&#x7EC8;&#x7AEF;</span></span><br><span class="line"><span class="meta"># /bin/bash&#x662F;&#x56FA;&#x6709;&#x5199;&#x6CD5;&#xFF0C;&#x4F5C;&#x7528;&#x662F;&#x56E0;&#x4E3A;docker&#x540E;&#x53F0;&#x5FC5;&#x987B;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x5426;&#x5219;&#x5BB9;&#x5668;&#x5C31;&#x4F1A;&#x9000;&#x51FA;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x8868;&#x793A;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x540E;&#x542F;&#x52A8;bash&#x3002;</span></span><br><span class="line"><span class="meta"># &#x4E5F;&#x53EF;&#x4EE5;&#x7528;docker exec&#x5728;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x5BB9;&#x5668;&#x6267;&#x884C;&#x547D;&#x4EE4;</span></span><br></pre></td></tr></table></figure>

<p>&#x62F7;&#x8D1D;&#x6587;&#x4EF6;&#xFF1A;</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">docker <span class="keyword">cp</span> &#x4E3B;&#x673A;&#x6587;&#x4EF6;&#x8DEF;&#x5F84; &#x5BB9;&#x5668;ID&#x6216;&#x5BB9;&#x5668;&#x540D;:&#x5BB9;&#x5668;&#x8DEF;&#x5F84; <span class="meta">#&#x4E3B;&#x673A;&#x4E2D;&#x6587;&#x4EF6;&#x62F7;&#x8D1D;&#x5230;&#x5BB9;&#x5668;&#x4E2D;</span></span><br><span class="line">docker <span class="keyword">cp</span> &#x5BB9;&#x5668;ID&#x6216;&#x5BB9;&#x5668;&#x540D;:&#x5BB9;&#x5668;&#x8DEF;&#x5F84; &#x4E3B;&#x673A;&#x6587;&#x4EF6;&#x8DEF;&#x5F84; <span class="meta">#&#x5BB9;&#x5668;&#x4E2D;&#x6587;&#x4EF6;&#x62F7;&#x8D1D;&#x5230;&#x4E3B;&#x673A;&#x4E2D;</span></span><br></pre></td></tr></table></figure>

<p>&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x5143;&#x4FE1;&#x606F;&#xFF1A;</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">docker <span class="keyword">inspect</span> &#x5BB9;&#x5668;ID&#x6216;&#x5BB9;&#x5668;&#x540D;</span><br></pre></td></tr></table></figure>

<h1 id="docker-&#x5B89;&#x88C5;-tomcat">4. docker &#x5B89;&#x88C5; tomcat</h1><h2 id="&#x67E5;&#x627E;&#x8D44;&#x6E90;">4.1. &#x67E5;&#x627E;&#x8D44;&#x6E90;</h2><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"> <span class="symbol">yuyu@</span>localhost &#xE0B0; ~/.ssh/temp &#xE0B0; docker search tomcat</span><br><span class="line">NAME                          DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">tomcat                        Apache Tomcat <span class="keyword">is</span> an open source implementati&#x2026;   <span class="number">2894</span>      [OK]</span><br><span class="line">tomee                         Apache TomEE <span class="keyword">is</span> an all-Apache Java EE certif&#x2026;   <span class="number">85</span>        [OK]</span><br><span class="line">dordoka/tomcat                Ubuntu <span class="number">14.04</span>, Oracle JDK <span class="number">8</span> <span class="keyword">and</span> Tomcat <span class="number">8</span> base&#x2026;   <span class="number">55</span>                   [OK]</span><br><span class="line">bitnami/tomcat                Bitnami Tomcat Docker Image                     <span class="number">37</span>                   [OK]</span><br><span class="line">kubeguide/tomcat-app          Tomcat image <span class="keyword">for</span> Chapter <span class="number">1</span>                      <span class="number">29</span></span><br><span class="line">consol/tomcat<span class="number">-7.0</span>             Tomcat <span class="number">7.0</span><span class="number">.57</span>, <span class="number">8080</span>, <span class="string">&quot;admin/admin&quot;</span>              <span class="number">17</span>                   [OK]</span><br><span class="line">cloudesire/tomcat             Tomcat server, <span class="number">6</span>/<span class="number">7</span>/<span class="number">8</span>                            <span class="number">15</span>                   [OK]</span><br><span class="line">aallam/tomcat-mysql           Debian, Oracle JDK, Tomcat &amp; MySQL              <span class="number">13</span>                   [OK]</span><br></pre></td></tr></table></figure>

<p><code>docker search tomcat</code> &#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x67E5;&#x627E;&#x5230;&#x955C;&#x50CF;&#x5BF9;&#x5E94;&#x7684;&#x8D44;&#x6E90;, &#x4E0D;&#x8FC7;&#x8BE5;&#x547D;&#x4EE4;&#x4E0D;&#x80FD;&#x663E;&#x793A;&#x955C;&#x50CF;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;, &#x6211;&#x4EEC;&#x4E0B;&#x8F7D;&#x7684;&#x65F6;&#x5019;&#x4E00;&#x822C;&#x4F1A;&#x52A0;&#x4E0A;<code>tag</code> &#x6765;&#x786E;&#x5B9A;&#x7248;&#x672C;&#x4FE1;&#x606F;, &#x8FD9;&#x65F6;&#x9700;&#x8981;&#x5230;&#x5B98;&#x7F51;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;</p>
<p><img src="/2020/docker1/image-20210203171407470.png" alt="image-20210203171407470"><br>&#x67E5;&#x8BE2;&#x5217;&#x8868;&#x4E2D;, &#x955C;&#x50CF;&#x540D;&#x79F0;&#x89C4;&#x5219;&#x4E3A;<code>username/&#x955C;&#x50CF;&#x540D;&#x79F0;,</code>&#x524D;&#x5982;&#x679C;&#x4E0D;&#x5E26;&#x6709;&#x8DEF;&#x5F84;, &#x5219;&#x4EE3;&#x8868;&#x662F; docker &#x5B98;&#x65B9;&#x53D1;&#x5E03;&#x7684;&#x955C;&#x50CF;, &#x4E5F;&#x901A;&#x8FC7;&#x53F3;&#x4E0A;&#x89D2;&#x662F;&#x5426;&#x6807;&#x8BC6;<code>OFFICIAL IMAGE</code>&#x6765;&#x533A;&#x5206;. &#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x955C;&#x50CF;&#x67E5;&#x770B;&#x660E;&#x7EC6;&#x4FE1;&#x606F;,&#x9009;&#x62E9;<code>tags</code></p>
<p><img src="/2020/docker1/image-20210203171500707.png" alt="image-20210203171500707"><br>&#x5982;&#x56FE;&#x7EA2;&#x6846;&#x6807;&#x8BC6;&#x7684;&#x4E3A; tag &#x540D;&#x79F0;, &#x7528;&#x6765;&#x533A;&#x5206;&#x7248;&#x672C;&#x53F7;</p>
<h2 id="&#x4E0B;&#x8F7D;">4.2. &#x4E0B;&#x8F7D;</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">docker</span> <span class="selector-tag">pull</span> <span class="selector-tag">tomcat</span><span class="selector-pseudo">:jdk8</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x67E5;&#x770B;&#x955C;&#x50CF;&#x4FE1;&#x606F;">4.3. &#x67E5;&#x770B;&#x955C;&#x50CF;&#x4FE1;&#x606F;</h2><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">docker image ls</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">tomcat       jdk8      <span class="number">75</span>dbb53610ac   <span class="number">2</span> days ago    <span class="number">534</span>MB</span><br></pre></td></tr></table></figure>

<h2 id="&#x542F;&#x52A8;">4.4. &#x542F;&#x52A8;</h2><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="symbol">yuyu@</span>localhost &#xE0B0; ~ &#xE0B0; docker run --name tomcat1 -p <span class="number">80</span>:<span class="number">8080</span> -d tomcat:jdk8</span><br><span class="line"><span class="number">4</span>a026076de8805b0b3ee890d39474e2438cbfc15ea6a8ac5ebdfbb459cd39437</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>docker run</code> &#x547D;&#x4EE4;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x672C;&#x5730;&#x955C;&#x50CF;, &#x4F1A;&#x5148;&#x53BB;&#x5B98;&#x65B9;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x62C9;&#x53D6;</p>
</blockquote>
<h2 id="tomcat-&#x914D;&#x7F6E;&#x4E3B;&#x9875;">4.5. tomcat &#x914D;&#x7F6E;&#x4E3B;&#x9875;</h2><p>&#x5B98;&#x65B9;&#x4E0B;&#x8F7D;&#x7684; tomcat &#x9ED8;&#x8BA4;&#x662F;&#x6CA1;&#x6709;&#x4E3B;&#x9875;&#x7684;, &#x6211;&#x4EEC;&#x9700;&#x8981;&#x5148;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x4E3B;&#x9875;&#x624D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># &#x8FDB;&#x5165;&#x5BB9;&#x5668;</span></span><br><span class="line">yuyu@localhost &#xE0B0; ~ &#xE0B0; docker <span class="built_in">exec</span> -it tomcat1 /bin/bash</span><br><span class="line">root@4a026076de88:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># ls</span></span><br><span class="line">BUILDING.txt  CONTRIBUTING.md  LICENSE	NOTICE	README.md  RELEASE-NOTES  RUNNING.txt  bin  conf  lib  logs  native-jni-lib  temp  webapps  webapps.dist  work</span><br><span class="line">root@4a026076de88:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@4a026076de88:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/tomcat/webapps</span><br><span class="line">root@4a026076de88:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># mkdir ROOT</span></span><br><span class="line">root@4a026076de88:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># cd ROOT/</span></span><br><span class="line">root@4a026076de88:/usr/<span class="built_in">local</span>/tomcat/webapps/ROOT<span class="comment"># echo &apos;tomcat1&apos; &gt; index.html</span></span><br><span class="line">root@4a026076de88:/usr/<span class="built_in">local</span>/tomcat/webapps/ROOT<span class="comment"># ls</span></span><br><span class="line">index.html</span><br><span class="line"><span class="comment"># &#x9000;&#x51FA;&#x5BB9;&#x5668;</span></span><br><span class="line">root@4a026076de88:/usr/<span class="built_in">local</span>/tomcat/webapps/ROOT<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"> yuyu@localhost &#xE0B0; ~ &#xE0B0;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/docker1/image-20210203171535608.png" alt="image-20210203171535608"></p>
<h2 id="&#x5220;&#x9664;&#x5BB9;&#x5668;&#x53CA;&#x955C;&#x50CF;">4.6. &#x5220;&#x9664;&#x5BB9;&#x5668;&#x53CA;&#x955C;&#x50CF;</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> yuyu@localhost &#xE0B0; ~ &#xE0B0; docker container ls</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND             CREATED          STATUS          PORTS                  NAMES</span><br><span class="line">4a026076de88   tomcat:jdk8   <span class="string">&quot;catalina.sh run&quot;</span>   44 minutes ago   Up 44 minutes   0.0.0.0:80-&gt;8080/tcp   tomcat1</span><br><span class="line"><span class="comment"># &#x505C;&#x6B62;&#x5BB9;&#x5668;</span></span><br><span class="line">yuyu@localhost &#xE0B0; ~ &#xE0B0; docker stop tomcat1</span><br><span class="line">tomcat1</span><br><span class="line"><span class="comment"># &#x5220;&#x9664;&#x5BB9;&#x5668;</span></span><br><span class="line"> yuyu@localhost &#xE0B0; ~ &#xE0B0; docker rm tomcat1</span><br><span class="line">tomcat1</span><br><span class="line"> yuyu@localhost &#xE0B0; ~ &#xE0B0; docker container ls -all</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS                    PORTS                                                                                    NAMES</span><br><span class="line">bbc379d29549   consul    <span class="string">&quot;docker-entrypoint.s&#x2026;&quot;</span>   2 weeks ago   Exited (255) 3 days ago   8300-8302/tcp, 8600/tcp, 8301-8302/udp, 0.0.0.0:8500-&gt;8500/tcp, 0.0.0.0:8600-&gt;8600/udp   consul</span><br><span class="line"> yuyu@localhost &#xE0B0; ~ &#xE0B0;</span><br><span class="line">  yuyu@localhost &#xE0B0; ~ &#xE0B0;</span><br><span class="line"> yuyu@localhost &#xE0B0; ~ &#xE0B0;</span><br><span class="line"> yuyu@localhost &#xE0B0; ~ &#xE0B0;</span><br><span class="line"> yuyu@localhost &#xE0B0; ~ &#xE0B0;</span><br><span class="line"> <span class="comment"># &#x5220;&#x9664;&#x955C;&#x50CF;</span></span><br><span class="line"> yuyu@localhost &#xE0B0; ~ &#xE0B0; docker image ls</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">tomcat       jdk8      75dbb53610ac   2 days ago    534MB</span><br><span class="line">consul       latest    98d273eafda1   3 weeks ago   122MB</span><br><span class="line"> &#x2718; yuyu@localhost &#xE0B0; ~ &#xE0B0; docker rmi 75dbb53610ac</span><br><span class="line">Untagged: tomcat:jdk8</span><br><span class="line">Untagged: tomcat@sha256:ccd52c2878ea3d774909cf6005c43b8ae724b488b260b42284500fd13e55088c</span><br><span class="line">Deleted: sha256:75dbb53610acad26579a308e0916e3def3920306d7cf952a07f8680359e50465</span><br><span class="line">Deleted: sha256:660c1e67bfd7642a24cd20abe4a1a69be042ab762dad75efe02e0b895f4cb66c</span><br><span class="line">Deleted: sha256:6fea099eea51aec8b9db7ad87ddf66d18c3e226558b1c33184f2c8c50befdb3e</span><br><span class="line">Deleted: sha256:97762a6ce17dfc95ba2de1faa62754b0f9fbbec4526f468c290eca9594c62ec0</span><br><span class="line">Deleted: sha256:5dc1d4c8a71d3a9d64d8f1840d7d69a7b468159585bf00021da97d5753bc5b0e</span><br><span class="line">Deleted: sha256:5de3e672d52f7c931f75cb70881f3adc43c03d72ffa26fc7ff36a3364085c848</span><br><span class="line">Deleted: sha256:2d7ffe7660587340691287aa2e8197552e074044a6e8362f7ab8d7f80f919281</span><br><span class="line">Deleted: sha256:f616f88eac9441e18040ff70b49997fc3230502ff33b24852f694eebeb455e21</span><br><span class="line">Deleted: sha256:495fc0ac5b34eaca0b64a2735bd618cf9c117bda4586f9f5a5faaa37a20907b1</span><br><span class="line">Deleted: sha256:64c2fca04b3f5649a8505e6b7f28517ef57105e76f9e4e6a3a2ff82bd8f82eff</span><br><span class="line">Deleted: sha256:f0e10b20de190c7cf4ea7ef410e7229d64facdc5d94514a13aa9b58d36fca647</span><br><span class="line"> yuyu@localhost &#xE0B0; ~ &#xE0B0;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
  </entry>
  <entry>
    <title>maven专场</title>
    <url>/2020/maven-path/</url>
    <content><![CDATA[<h1 id="&#x4F9D;&#x8D56;-dependency">1. &#x4F9D;&#x8D56;-dependency</h1><p>dependency &#x4E2D;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x7684;&#x5143;&#x7D20;&#x5982;&#x4E0B;</p>
<ol>
<li>groupId, artifactId &#x548C; version: &#x4F9D;&#x8D56;&#x7684;&#x57FA;&#x672C;&#x5750;&#x6807;</li>
<li>type: &#x4F9D;&#x8D56;&#x7684;&#x7C7B;&#x578B;, &#x5927;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x4E0B;&#x8BE5;&#x5143;&#x7D20;&#x4E0D;&#x5FC5;&#x58F0;&#x660E;, &#x9ED8;&#x8BA4;&#x503C;&#x4E3A; jar</li>
<li>scope: &#x4F9D;&#x8D56;&#x8303;&#x56F4;</li>
</ol>
]]></content>
      <categories>
        <category>util</category>
      </categories>
  </entry>
  <entry>
    <title>iTerm个性化设置</title>
    <url>/2020/iterm-setting/</url>
    <content><![CDATA[<h1 id="&#x82B1;&#x91CC;&#x80E1;&#x54E8;">1. &#x82B1;&#x91CC;&#x80E1;&#x54E8;</h1><p><img src="/2020/iterm-setting/image-20210203170641508.png" alt="image-20210203170641508"></p>
<a id="more"></a>

<h1 id="&#x7EC8;&#x7AEF;&#x6A21;&#x62DF;&#x5668;">2. &#x7EC8;&#x7AEF;&#x6A21;&#x62DF;&#x5668;</h1><p>&#x9009;&#x7528; <a href="http://ethanschoonover.com/solarized" target="_blank" rel="noopener">solarized</a>&#xFF0C;&#x4E0B;&#x8F7D;&#x89E3;&#x538B;&#xFF0C;&#x7136;&#x540E;&#x6253;&#x5F00; iTerm2 &#x4E0B;&#x7684;&#x504F;&#x597D;&#x8BBE;&#x7F6E; preference &#xFF0C;&#x70B9;&#x5F00; profiles &#x4E0B;&#x7684; colors &#x9009;&#x9879;&#xFF0C;&#x70B9;&#x51FB;&#x53F3;&#x4E0B;&#x89D2;&#x7684; Color Presets &#x9009;&#x9879;&#xFF0C;&#x9009;&#x62E9; import &#xFF0C;&#x5BFC;&#x5165;&#x89E3;&#x538B;&#x5230;&#x7684; solarized &#x6587;&#x4EF6;&#x4E0B;&#x7684; Solarized Dark.itermcolors</p>
<p><img src="/2020/iterm-setting/image-20210203170714227.png" alt="image-20210203170714227"></p>
<h1 id="&#x4E3B;&#x9898;">3. &#x4E3B;&#x9898;</h1><h2 id="zsh">3.1. zsh</h2><p>zsh &#x662F;&#x4E00;&#x6B3E;&#x5F3A;&#x5927;&#x7684;&#x865A;&#x62DF;&#x7EC8;&#x7AEF;&#xFF0C;&#x662F; Oh My Zsh &#x7684;&#x7238;&#x7238;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5148;&#x88C5;&#x5B83;&#x3002;<br>&#x5728;&#x547D;&#x4EE4;&#x884C;&#x8F93;&#x5165;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">zsh --version</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x8F93;&#x5165; zsh &#x7684;&#x5F53;&#x524D;&#x7248;&#x672C;&#x53F7;&#x5C31;&#x8BF4;&#x660E;&#x88C5;&#x597D;&#x4E86;&#xFF0C;&#x4E00;&#x822C; Mac &#x81EA;&#x5E26;&#x6709;&#x7684;<br>&#x5982;&#x679C;&#x6CA1;&#x88C5;&#x5219;&#x9700;&#x8981;&#x8F93;&#x5165;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install zsh zsh-completions</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x662F;&#x7528; Homebrew &#x88C5;&#xFF0C;&#x9700;&#x8981; Mac &#x4E0A;&#x6709; Homebrew&#xFF0C;&#x5B83;&#x7684;&#x7F51;&#x7AD9;&#xFF1A;<a href="https://brew.sh/" target="_blank" rel="noopener">https://brew.sh/</a></p>
<h2 id="Oh-My-Zsh">3.2. Oh My Zsh</h2><p>Oh My Zsh &#x662F;&#x57FA;&#x4E8E; zsh &#x7684;&#x4E00;&#x4E2A;&#x6269;&#x5C55;&#x5DE5;&#x5177;&#x96C6;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4E30;&#x5BCC;&#x7684;&#x6269;&#x5C55;&#x529F;&#x80FD;<br>&#x5B83;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>curl</code>&#x6216;&#x8005;<code>wget</code>&#x6765;&#x5B89;&#x88C5;</p>
<ul>
<li>via curl</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sh -c <span class="string">&quot;<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>via wget</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sh -c <span class="string">&quot;<span class="variable">$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>&#x88C5;&#x597D;&#x4E4B;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6362;&#x5230; agnoster &#x4E3B;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x770B;&#x5230;&#x7684;&#x90A3;&#x5F20;&#x989C;&#x503C;&#x4E3B;&#x9898;&#xFF0C;Oh My Zsh &#x4E00;&#x822C;&#x81EA;&#x5E26;&#x6709;&#x8FD9;&#x4E2A;&#x4E3B;&#x9898;&#x3002;<br>&#x53EF;&#x4EE5;&#x770B;&#x770B;&#x5B83;&#x7684;&#x9ED8;&#x8BA4;&#x4E3B;&#x9898;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ls ~/.oh-my-zsh/themes</span><br></pre></td></tr></table></figure>

<p>&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4E3B;&#x9898;&#x53EA;&#x9700;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x628A;&#x91CC;&#x9762; <code>ZSH_THEME</code> &#x7684;&#x503C;&#x6539;&#x4E3A; <code>ZSH_THEME=&quot;agnoster&quot;</code>&#xFF0C;&#x4FDD;&#x5B58;&#x9000;&#x51FA;<br>&#xFF08;<a href="https://github.com/robbyrussell/oh-my-zsh/wiki/Themes#agnoster" target="_blank" rel="noopener">&#x70B9;&#x51FB;&#x8FD9;&#x91CC;</a>&#x8FD8;&#x6709;&#x5404;&#x79CD;&#x4E3B;&#x9898;&#xFF0C;&#x4EFB;&#x541B;&#x7FFB;&#x724C;~&#xFF09;<br>&#x5E94;&#x7528;&#x914D;&#x7F6E;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chsh -s /bin/zsh</span><br></pre></td></tr></table></figure>

<p>&#x91CD;&#x542F; iTerm2<br>&#x6253;&#x5F00;&#x540E;&#x4F1A;&#x53D1;&#x73B0;, &#x4E71;&#x7801;&#x4E86;&#x2026; &#x522B;&#x6025;&#x7EE7;&#x7EED;&#x4E0B;&#x4E00;&#x6B65;</p>
<h2 id="Powerline">3.3. Powerline</h2><p>Git &#x4E0B;&#x6765;&#x5B89;&#x88C5;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:powerline/fonts.git</span><br><span class="line"><span class="built_in">cd</span> fonts</span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x5230; iterm2 &#x914D;&#x7F6E;&#xFF0C;&#x8BBE;&#x7F6E;&#x5B57;&#x4F53;&#x4E3A;<code>Roboto Mono for Powerline</code>&#xFF1A;</p>
<p><img src="/2020/iterm-setting/image-20210203170754100.png" alt="image-20210203170754100"></p>
<h1 id="&#x81EA;&#x52A8;&#x63D0;&#x793A;&#x4E0E;&#x547D;&#x4EE4;&#x8865;&#x5168;">4. &#x81EA;&#x52A8;&#x63D0;&#x793A;&#x4E0E;&#x547D;&#x4EE4;&#x8865;&#x5168;</h1><p>&#x6BD4; iTerm2 &#x81EA;&#x5E26;&#x7684;&#x66F4;&#x5F3A;&#x5927;&#x7684;&#x547D;&#x4EE4;&#x63D0;&#x793A;&#x4E0E;&#x8865;&#x5168;</p>
<ol>
<li>&#x514B;&#x9686;&#x4ED3;&#x5E93;&#x5230;&#x672C;&#x5730; ~/.oh-my-zsh/custom/plugins &#x8DEF;&#x5F84;&#x4E0B;</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://github.com/zsh-users/zsh-autosuggestions <span class="variable">$ZSH_CUSTOM</span>/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>&#x7528; vim &#x7F16;&#x8F91; .zshrc &#x6587;&#x4EF6;&#xFF0C;&#x627E;&#x5230;&#x63D2;&#x4EF6;&#x8BBE;&#x7F6E;&#x547D;&#x4EE4;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; <code>plugins=(git)</code> &#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x5B83;&#x4FEE;&#x6539;&#x4E3A;<code>plugins=(zsh-autosuggestions git)</code></li>
</ol>
<p>PS&#xFF1A;&#x5F53;&#x4F60;&#x91CD;&#x65B0;&#x6253;&#x5F00;&#x7EC8;&#x7AEF;&#x65F6;&#x53EF;&#x80FD;&#x770B;&#x4E0D;&#x5230;&#x53D8;&#x5316;&#xFF0C;&#x53EF;&#x80FD;&#x4F60;&#x7684;&#x5B57;&#x4F53;&#x989C;&#x8272;&#x592A;&#x6DE1;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x5176;&#x6539;&#x4EAE;&#x4E00;&#x4E9B;&#xFF1A;</p>
<ol>
<li><code>cd ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions</code></li>
<li>&#x7528; vim &#x7F16;&#x8F91; zsh-autosuggestions.zsh &#x6587;&#x4EF6;&#xFF0C;&#x4FEE;&#x6539;<code>ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=&apos;fg=10&apos;</code></li>
</ol>
<h1 id="&#x8BED;&#x6CD5;&#x9AD8;&#x4EAE;&#x6548;&#x679C;">5. &#x8BED;&#x6CD5;&#x9AD8;&#x4EAE;&#x6548;&#x679C;</h1><ol>
<li>&#x4F7F;&#x7528; homebrew &#x5305;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x5B89;&#x88C5; zsh-syntax-highlighting &#x63D2;&#x4EF6;<br><code>brew install zsh-syntax-highlighting</code><br>&#x5982;&#x679C;&#x7535;&#x8111;&#x4E0A;&#x8FD8;&#x6CA1;&#x6709;&#x5B89;&#x88C5; homebrew&#xFF0C;&#x8BF7;&#x5148;&#x5B89;&#x88C5; homebrew</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/bin/ruby -e <span class="string">&quot;<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>&#x914D;&#x7F6E;.zshrc &#x6587;&#x4EF6;&#xFF0C;&#x63D2;&#x5165;&#x4E00;&#x884C;</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> /xxx/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh</span><br><span class="line">&#x6CE8;: /xxx/ &#x4EE3;&#x8868;.zshrc&#x6240;&#x5728;&#x7684;&#x8DEF;&#x5F84;</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>&#x91CD;&#x65B0;&#x6253;&#x5F00; iTerm2 &#x7A97;&#x53E3;&#xFF08;&#x6216;&#x65B0;&#x6253;&#x5F00;&#x4E00;&#x4E2A; iTerm2 &#x7A97;&#x53E3;&#xFF09;&#x5373;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6548;&#x679C;</li>
</ol>
<h1 id="vim-&#x6548;&#x679C;">6. vim &#x6548;&#x679C;</h1><p>Solarized &#x662F;&#x4E2A;&#x5F88;&#x725B;&#x903C;&#x7684;&#x914D;&#x8272;&#x9879;&#x76EE;&#xFF0C;&#x4E3B;&#x6D41; OS&#x3001;IDE&#x3001;Editor &#x90FD;&#x6709;&#x5B83;&#x5F71;&#x5B50;&#x3002;</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># git&#x4E0B;Solarized &#x7684;&#x6E90;&#x7801;</span></span><br><span class="line"><span class="attr">git</span> <span class="string">clone git://github.com/altercation/solarized.git</span></span><br><span class="line"><span class="comment"># &#x8FDB;&#x5165;&#x6587;&#x4EF6;&#x5939;</span></span><br><span class="line"><span class="attr">cd</span> <span class="string">solarized/vim-colors-solarized/colors</span></span><br><span class="line"><span class="comment">#&#x4E0B;&#x9762;&#x53EF;&#x80FD;&#x8981;&#x7BA1;&#x7406;&#x5458;&#x6743;&#x9650;</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">mkdir -p ~/.vim/colors</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">cp solarized.vim ~/.vim/colors/</span></span><br><span class="line"><span class="comment"># &#x521B;&#x5EFA;.vimrc&#x6587;&#x4EF6;</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">vim ~/.vimrc</span></span><br><span class="line"><span class="comment"># &#x628A;&#x4E0B;&#x9762;&#x8FD9;&#x4E09;&#x884C;&#x590D;&#x5236;&#x8FDB;&#x53BB;</span></span><br><span class="line"><span class="attr">syntax</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">set</span> <span class="string">background=dark</span></span><br><span class="line"><span class="attr">colorscheme</span> <span class="string">solarized</span></span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x4FDD;&#x5B58; .vimrc, &#x9000;&#x51FA;</p>
<h1 id="&#x6269;&#x5C55;">7. &#x6269;&#x5C55;</h1><ul>
<li>iTerm2 &#x9ED8;&#x8BA4;&#x4F7F;&#x7528; dash &#x6539;&#x7528; zsh &#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#xFF1A;<code>chsh -s /bin/zsh</code></li>
<li>iTerm2 zsh &#x5207;&#x6362;&#x56DE;&#x539F;&#x6765;&#x7684; dash&#xFF1A;<code>chsh -s /bin/bash</code></li>
<li>&#x5378;&#x8F7D;<code>oh my zsh</code>&#xFF0C;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x8F93;&#x5165;&#xFF1A;<code>uninstall_oh_my_zsh</code></li>
<li>&#x8DEF;&#x5F84;&#x524D;&#x7F00;&#x7684; XX@XX &#x592A;&#x957F;&#xFF0C;&#x7F29;&#x77ED;&#x95EE;&#x9898;&#xFF1A;<br>&#x7F16;&#x8F91;<code>~/.oh-my-zsh/themes/agnoster.zsh-theme</code>&#x4E3B;&#x4F53;&#x6587;&#x4EF6;&#xFF0C;&#x5C06;&#x91CC;&#x9762;&#x7684;<code>build_prompt</code>&#x4E0B;&#x7684;<code>prompt_context</code>&#x5B57;&#x6BB5;&#x5728;&#x524D;&#x9762;&#x52A0;<code>#</code>&#x6CE8;&#x91CA;&#x6389;&#x5373;&#x53EF;</li>
</ul>
<h1 id="&#x8F6C;&#x8F7D;&#x81EA;">8. &#x8F6C;&#x8F7D;&#x81EA;</h1><ol>
<li><a href="https://blog.csdn.net/huihut/article/details/61418136" target="_blank" rel="noopener">&#x6F02;&#x4EAE;&#x7684; Mac &#x7EC8;&#x7AEF;</a></li>
<li><a href="https://www.jianshu.com/p/95f68e035f33" target="_blank" rel="noopener">Mac &#x7EC8;&#x7AEF;&#x914D;&#x7F6E;&#xFF0C;DIY &#x4F60;&#x7684; Terminal</a></li>
</ol>
]]></content>
      <categories>
        <category>util</category>
      </categories>
  </entry>
  <entry>
    <title>语雀写作,自动部署gitpage</title>
    <url>/2020/yuque-hexo/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p>&#x5148;&#x8BF4;&#x4E00;&#x4E0B;&#x6211;&#x4E4B;&#x524D;&#x4ECE;&#x5199;&#x535A;&#x5BA2;&#x5230;&#x53D1;&#x5E03;&#x7684;&#x8FC7;&#x7A0B;</p>
<ol>
<li>&#x8BED;&#x96C0;&#x5199; md &#x6587;&#x6863;&#x662F;&#x771F;&#x7684;&#x723D;, &#x6211;&#x5199;&#x535A;&#x5BA2;&#x4E00;&#x822C;&#x5148;&#x5728;&#x8BED;&#x96C0;&#x5199;, &#x56FE;&#x7247;&#x4E5F;&#x76F4;&#x63A5;&#x590D;&#x5236;&#x81F3;&#x8BED;&#x96C0;</li>
<li>&#x5199;&#x5B8C;&#x540E;&#x518D;&#x4ECE;&#x8BED;&#x96C0;&#x5BFC;&#x51FA;, &#x7136;&#x540E;&#x5C06;&#x56FE;&#x7247;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x4E0B;&#x8F7D;&#x5230;&#x672C;&#x5730;&#x9879;&#x76EE;&#x4E2D;,&#x7136;&#x540E;&#x5728; md &#x6587;&#x6863;&#x4E2D;&#x8FDB;&#x884C;&#x66FF;&#x6362;</li>
<li>&#x4E0A;&#x4F20;&#x81F3; github, &#x5E76;&#x90E8;&#x7F72; gitPage<br>&#x8FC7;&#x7A0B;&#x5341;&#x5206;&#x9EBB;&#x70E6;, &#x7279;&#x522B;&#x662F;&#x5C06;&#x56FE;&#x7247;&#x4FDD;&#x5B58;&#x5230;&#x672C;&#x5730;&#x7279;&#x522B;&#x75DB;&#x82E6;, &#x7136;&#x540E;&#x5C31;&#x60F3;&#x5230;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x5C06;&#x8BED;&#x96C0;&#x6587;&#x7AE0;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x540C;&#x6B65;&#x81F3; hexo,&#x7ECF;&#x8FC7;&#x4E00;&#x756A;&#x5468;&#x6298;&#x7EC8;&#x4E8E;&#x641E;&#x51FA;&#x6765;&#x4E86;, &#x60EC;&#x610F;~</li>
</ol>
</blockquote>
<a id="more"></a>

<h1 id="&#x6D89;&#x53CA;&#x5230;&#x7684;&#x5DE5;&#x5177;">2. &#x6D89;&#x53CA;&#x5230;&#x7684;&#x5DE5;&#x5177;</h1><ol>
<li>hexo</li>
<li>yuque-hexo &#x9879;&#x76EE; <a href="https://github.com/x-cold/yuque-hexo" target="_blank" rel="noopener">https://github.com/x-cold/yuque-hexo</a></li>
<li>github</li>
<li>gitpage</li>
<li>travis-ci (&#x6301;&#x7EED;&#x96C6;&#x6210;&#x670D;&#x52A1;)</li>
<li>&#x8BED;&#x96C0;</li>
</ol>
<h1 id="&#x6B65;&#x9AA4;">3. &#x6B65;&#x9AA4;</h1><ol>
<li>&#x7B2C;&#x4E00;&#x7248;&#x662F;&#x6309;&#x7167; <a href="https://www.yuque.com/u46795/blog/dlloc7#b740fe7a" target="_blank" rel="noopener">hexo &#x535A;&#x5BA2;&#x7EC8;&#x6781;&#x73A9;&#x6CD5;</a> &#x6765;&#x642D;&#x5EFA;&#x7684;, &#x4E0D;&#x8FC7;&#x8EAB;&#x4E3A;&#x6280;&#x672F;&#x5C0F;&#x767D;, &#x641E;&#x4E0D;&#x592A;&#x61C2;&#x91CC;&#x9762;&#x7684;&#x529F;&#x80FD;,&#x5F88;&#x591A;&#x5730;&#x65B9;&#x5199;&#x7684;&#x5F88;&#x6A21;&#x7CCA;</li>
<li>&#x4E0A;&#x9762;&#x90A3;&#x4E2A;&#x5148;&#x770B;&#x770B;, &#x7136;&#x540E;&#x770B;<a href="http://www.daiailing.cn/2020/02/22/yuque/%E4%B8%89%E3%80%81%E8%AF%AD%E9%9B%80%E5%86%99%E4%BD%9C%EF%BC%8C%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8/" target="_blank" rel="noopener">&#x6234;&#x7231;&#x73B2;&#x7684;&#x535A;&#x5BA2;</a> , &#x8FD9;&#x7BC7;&#x5199;&#x7684;&#x7279;&#x522B;&#x8BE6;&#x7EC6;</li>
</ol>
<p><strong>&#x55EF;, &#x7167;&#x7740;&#x4E0A;&#x9762;&#x5F04;&#x5C31;&#x80FD;&#x5F04;&#x51FA;&#x6765;, &#x5C31;&#x4E0D;&#x5199;&#x4E86;, &#x53CD;&#x6B63;&#x662F;&#x524D;&#x7AEF;&#x7684;&#x4E1C;&#x897F; QAQ</strong><br>&#x7528;&#x4E86;&#x4E24;&#x5929;, &#x7ECF;&#x5E38;&#x4F1A;&#x62A5;&#x9519;, GitHub &#x5730;&#x5740;&#x65E0;&#x6CD5;&#x89E3;&#x6790;, &#x653E;&#x5F03;&#x4E86;, &#x6211;&#x5220;&#x9664;&#x4E86;&#x8BED;&#x96C0;&#x8C03;&#x7528;&#x817E;&#x8BAF;&#x4E91;&#x51FD;&#x6570;&#x7684;&#x94FE;&#x63A5;, &#x5E76;&#x628A;<code>.travis.yml</code>&#x6587;&#x4EF6;&#x4E2D;&#x7684;<code>script:</code>&#x4E2D;&#x53C2;&#x6570;&#x4FEE;&#x6539;&#x4E3A;&#x4E86;<code>hexo g</code>, &#x4E0D;&#x518D;&#x81EA;&#x52A8;&#x540C;&#x6B65;&#x8BED;&#x96C0;&#x5185;&#x5BB9;.<br>&#x73B0;&#x5728;&#x7684;&#x6D41;&#x7A0B;&#x662F;:</p>
<ol>
<li>&#x8BED;&#x96C0;&#x5199;&#x535A;&#x5BA2;</li>
<li>&#x5728;&#x672C;&#x5730;&#x8FD0;&#x884C;<code>yuque-hexo sync</code> &#x8FDB;&#x884C;&#x540C;&#x6B65;</li>
<li>&#x63D0;&#x4EA4;&#x4EE3;&#x7801;&#x81F3; github, <code>travis-ci</code>&#x81EA;&#x52A8;&#x90E8;&#x7F72;&#x9875;&#x9762;</li>
</ol>
<h1 id="&#x5934;&#x4FE1;&#x606F;&#x95EE;&#x9898;">4. &#x5934;&#x4FE1;&#x606F;&#x95EE;&#x9898;</h1><p><img src="/2020/yuque-hexo/image-20210203153133098.png" alt="image-20210203153133098"></p>
<p>&#x5F53;&#x7136;&#x4E0B;&#x9762;&#x7684;&#x4E09;&#x4E2A;<code>-</code>&#x56DE;&#x8F66;&#x540E;&#x663E;&#x793A;&#x53D8;&#x4E86;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;<br><img src="/2020/yuque-hexo/image-20210203153206462.png" alt="image-20210203153206462"></p>
]]></content>
      <categories>
        <category>util</category>
      </categories>
  </entry>
  <entry>
    <title>神器:maven脚手架</title>
    <url>/2020/maven-archetype-plugin/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><p>&#x9879;&#x76EE;&#x4E2D;&#x4E3A;&#x4E86;&#x5C06;&#x529F;&#x80FD;&#x8FDB;&#x884C;&#x5F52;&#x7C7B;, &#x901A;&#x5E38;&#x4F1A;&#x5C06;&#x5177;&#x6709;&#x540C;&#x79CD;&#x5C5E;&#x6027;&#x7684;&#x7C7B;&#x653E;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#x4E2D;, &#x8FD9;&#x6837;&#x6BCF;&#x6B21;&#x65B0;&#x5EFA;&#x9879;&#x76EE;&#x65F6;&#x5176;&#x5B9E;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x4F9D;&#x636E;&#x6A21;&#x677F;&#x9879;&#x76EE;&#x4FEE;&#x6539;&#x9879;&#x76EE;&#x540D;&#x7684;&#x91CD;&#x590D;&#x64CD;&#x4F5C;. &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>maven-archetype-plugin</code>&#x63D2;&#x4EF6;&#x6765;&#x4E00;&#x6B21;&#x6027;&#x89E3;&#x51B3;</p>
<h1 id="&#x6574;&#x4F53;&#x6D41;&#x7A0B;">2. &#x6574;&#x4F53;&#x6D41;&#x7A0B;</h1><ol>
<li>&#x4F9D;&#x636E;&#x6A21;&#x677F;&#x9879;&#x76EE;&#x751F;&#x6210;&#x9AA8;&#x67B6;&#x9879;&#x76EE;</li>
<li>&#x5728;&#x9AA8;&#x67B6;&#x4E2D;&#x589E;&#x52A0; maven &#x79C1;&#x670D;&#x5730;&#x5740;&#x5E76;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</li>
<li>&#x5C06;&#x9AA8;&#x67B6;&#x4E0A;&#x4F20;&#x81F3;&#x79C1;&#x670D;</li>
<li>&#x4F9D;&#x636E;&#x79C1;&#x670D;&#x4E2D;&#x9AA8;&#x67B6;&#x642D;&#x5EFA;&#x9879;&#x76EE;</li>
</ol>
<a id="more"></a>

<p><img src="/2020/maven-archetype-plugin/image-20210203152622210.png" alt="image-20210203152622210"></p>
<h1 id="&#x51C6;&#x5907;&#x5DE5;&#x4F5C;">3. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;</h1><ol>
<li>maven &#x7684;<code>setting.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x5DF2;&#x914D;&#x7F6E;&#x4E86;&#x79C1;&#x670D;&#x5730;&#x5740;&#x53CA;&#x7528;&#x6237;&#x540D;&#x5BC6;&#x7801;</li>
<li>&#x51C6;&#x5907;&#x4E00;&#x4E2A;&#x6A21;&#x677F;&#x9879;&#x76EE;&#x5927;&#x81F4;&#x6A21;&#x5757;&#x5982;&#x4E0B;</li>
</ol>
<p><img src="/2020/maven-archetype-plugin/image-20210203152746193.png" alt="image-20210203152746193"></p>
<h1 id="&#x4F9D;&#x636E;&#x6A21;&#x677F;&#x9879;&#x76EE;&#x751F;&#x6210;&#x811A;&#x624B;&#x67B6;">4. &#x4F9D;&#x636E;&#x6A21;&#x677F;&#x9879;&#x76EE;&#x751F;&#x6210;&#x811A;&#x624B;&#x67B6;</h1><h2 id="&#x6A21;&#x677F;&#x9879;&#x76EE;-pom">4.1. &#x6A21;&#x677F;&#x9879;&#x76EE; pom</h2><p>&#x5F15;&#x5165;&#x811A;&#x624B;&#x67B6;&#x63D2;&#x4EF6;</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-archetype-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x751F;&#x6210;&#x811A;&#x624B;&#x67B6;&#x9879;&#x76EE;">4.2. &#x751F;&#x6210;&#x811A;&#x624B;&#x67B6;&#x9879;&#x76EE;</h2><p>&#x63A7;&#x5236;&#x53F0;&#x8FDB;&#x5165;&#x6A21;&#x677F;&#x9879;&#x76EE;&#x6839;&#x8DEF;&#x5F84;, &#x8FD0;&#x884C; <code>mvn archetype:create-from-project</code> &#x751F;&#x6210;&#x811A;&#x624B;&#x67B6;&#x9879;&#x76EE;<br>&#x8FD0;&#x884C;&#x6210;&#x529F;&#x540E;, &#x9AA8;&#x67B6;&#x4F1A;&#x751F;&#x6210;&#x5728; <code>&#x9879;&#x76EE;&#x8DEF;&#x5F84;/target/generated-sources</code> &#x76EE;&#x5F55;&#x4E0B;, &#x540D;&#x79F0;&#x4E3A;  archetype</p>
<h1 id="&#x811A;&#x624B;&#x67B6;&#x9879;&#x76EE;&#x914D;&#x7F6E;">5. &#x811A;&#x624B;&#x67B6;&#x9879;&#x76EE;&#x914D;&#x7F6E;</h1><h2 id="&#x914D;&#x7F6E;&#x79C1;&#x670D;&#x5730;&#x5740;-&#x5FC5;&#x9009;">5.1. &#x914D;&#x7F6E;&#x79C1;&#x670D;&#x5730;&#x5740;(&#x5FC5;&#x9009;)</h2><p>&#x5728;&#x9AA8;&#x67B6;&#x9879;&#x76EE;&#x4E2D;&#x627E;&#x5230;&#x9879;&#x76EE;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x7236; pom ,&#x589E;&#x52A0;&#x79C1;&#x670D;&#x914D;&#x7F6E;<br><code>vi target/generated-sources/archetype/pom.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>&#x79C1;&#x670D;&#x5730;&#x5740;<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>&#x79C1;&#x670D;&#x5730;&#x5740;<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;-&#x53EF;&#x9009;">5.2. &#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;(&#x53EF;&#x9009;)</h2><p>&#x9879;&#x76EE;&#x4E2D;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x6CA1;&#x6709;&#x5728;&#x9879;&#x76EE;&#x6839;&#x8DEF;&#x5F84;&#x4E0B;&#x7684;&#x6587;&#x4EF6;, &#x6BD4;&#x5982; <code>src/main/resources/bootstrap.yml</code>&#x6587;&#x4EF6;, &#x8FD9;&#x79CD;&#x6587;&#x4EF6;&#x9ED8;&#x8BA4;&#x662F;&#x4E0D;&#x505A;&#x66FF;&#x6362;&#x7684;, &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x811A;&#x624B;&#x67B6;&#x9879;&#x76EE;&#x4E2D;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x6587;&#x4EF6;, &#x5E76;&#x5C06;&#x5176;&#x4E2D;&#x5BF9;&#x5E94;&#x5305;&#x540D;&#x66FF;&#x6362;&#x4E3A; <code>${package}</code> ,groupId &#x66FF;&#x6362;&#x4E3A;<code>${groupId}</code> &#x5176;&#x4ED6;&#x66FF;&#x6362;&#x65B9;&#x5F0F;&#x53EF;&#x5728;&#x811A;&#x624B;&#x67B6;&#x5DF2;&#x751F;&#x6210;&#x5185;&#x5BB9;&#x4E2D;&#x67E5;&#x627E;</p>
<p><img src="/2020/maven-archetype-plugin/image-20210203152959804.png" alt="image-20210203152959804"></p>
<p>&#x7136;&#x540E;&#x4FEE;&#x6539;&#x811A;&#x624B;&#x67B6;&#x9879;&#x76EE;&#x8DEF;&#x5F84;&#x4E0B; <code>target/generated-sources/archetype/src/main/resources/META-INF/maven/archetype-metadata.xml</code> &#x914D;&#x7F6E;&#x6587;&#x4EF6;<br>&#x5148;&#x627E;&#x5230;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x6587;&#x4EF6;&#x6240;&#x5728;&#x6A21;&#x5757;,&#x5728;&#x6A21;&#x5757;&#x4E2D;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x914D;&#x7F6E;, &#x5728; fileSet &#x4E2D;&#x6DFB;&#x52A0;<code>filtered=&quot;true&quot;</code>&#x5C5E;&#x6027;,&#x4F7F;&#x5728;&#x751F;&#x6210;&#x4EE3;&#x7801;&#x65F6;&#x66FF;&#x6362;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x4EE3;&#x7801;</p>
<p><img src="/2020/maven-archetype-plugin/image-20210203153038190.png" alt="image-20210203153038190"></p>
<h1 id="&#x672C;&#x5730;&#x6D4B;&#x8BD5;">6. &#x672C;&#x5730;&#x6D4B;&#x8BD5;</h1><ol>
<li>&#x5728;&#x751F;&#x6210;&#x7684;&#x9AA8;&#x67B6;&#x9879;&#x76EE;&#x6839;&#x8DEF;&#x5F84;&#x8FD0;&#x884C;<code>mvn install</code>&#x8FDB;&#x884C;&#x6253;&#x5305;, &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5728;&#x672C;&#x5730;&#x4ED3;&#x5E93;&#x4E2D;&#x751F;&#x6210;&#x4E86;<code>&#x6A21;&#x677F;&#x9879;&#x76EE;&#x540D;-archetype</code> &#x7684;&#x9AA8;&#x67B6;&#x9879;&#x76EE;&#x5305;</li>
<li>&#x5728;&#x5176;&#x4ED6;&#x8DEF;&#x5F84;&#x4E0B;&#x65B0;&#x5EFA;&#x6587;&#x4EF6;&#x5939; temp, &#x6211;&#x662F;&#x5728; target &#x76EE;&#x5F55;&#x4E0B;&#x65B0;&#x5EFA;&#x4E86; temp &#x6587;&#x4EF6;&#x5939;, &#x8FDB;&#x5165; temp &#x6587;&#x4EF6;&#x5939;, &#x8FD0;&#x884C;</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn archetype:generate -DarchetypeArtifactId=ArtifactId -DarchetypeGroupId=GroupId -DarchetypeVersion=&#x7248;&#x672C;&#x53F7; -DarchetypeCatalog=<span class="built_in">local</span></span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x9700;&#x5C06;=&#x540E;&#x6587;&#x5B57;&#x66FF;&#x6362;&#x4E3A;&#x9AA8;&#x67B6;&#x9879;&#x76EE;&#x5B9E;&#x9645;&#x53C2;&#x6570;</p>
<ol start="3">
<li>&#x8FD0;&#x884C;&#x9879;&#x76EE;</li>
</ol>
<h1 id="&#x4E0A;&#x4F20;&#x79C1;&#x670D;">7. &#x4E0A;&#x4F20;&#x79C1;&#x670D;</h1><p><code>mvn deploy</code></p>
<h1 id="&#x4F7F;&#x7528;&#x9AA8;&#x67B6;&#x9879;&#x76EE;&#x751F;&#x6210;&#x4EE3;&#x7801;">8. &#x4F7F;&#x7528;&#x9AA8;&#x67B6;&#x9879;&#x76EE;&#x751F;&#x6210;&#x4EE3;&#x7801;</h1><h2 id="&#x547D;&#x4EE4;&#x884C;&#x65B9;&#x5F0F;">8.1. &#x547D;&#x4EE4;&#x884C;&#x65B9;&#x5F0F;</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn archetype:generate -DarchetypeArtifactId=ArtifactId -DarchetypeGroupId=GroupId -DarchetypeVersion=&#x7248;&#x672C;&#x53F7; -DarchetypeCatalog=remote</span><br></pre></td></tr></table></figure>

<h2 id="idea-&#x65B9;&#x5F0F;">8.2. idea &#x65B9;&#x5F0F;</h2><p><img src="/2020/maven-archetype-plugin/image-20210203152843811.png" alt="image-20210203152843811"></p>
<p><img src="/2020/maven-archetype-plugin/image-20210203152919382.png" alt="image-20210203152919382"></p>
<p>&#x70B9;&#x51FB;&#x4E0B;&#x4E00;&#x6B65;&#x540E;&#x8F93;&#x5165;&#x9700;&#x8981;&#x751F;&#x6210;&#x7684;&#x9879;&#x76EE;&#x540D;&#x7B49;&#x4FE1;&#x606F;&#x6309;&#x7167;&#x6B65;&#x9AA4;&#x8FDB;&#x884C;&#x5373;&#x53EF;<br>idea &#x5BFC;&#x5165; maven &#x811A;&#x624B;&#x67B6;&#x9879;&#x76EE;&#x540E;, &#x5982;&#x679C;&#x60F3;&#x5220;&#x9664;&#x5219;&#x9700;&#x5728;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x4E2D;&#x8FDB;&#x884C;&#x5220;&#x9664;, &#x6587;&#x4EF6;&#x8DEF;&#x5F84;<code>Library/Caches/JetBrains/InteliJIdea2020.2/Maven/Indices/UserArchetypes.xml</code></p>
<h1 id="&#x53C2;&#x8003;&#x6587;&#x6863;">9. &#x53C2;&#x8003;&#x6587;&#x6863;</h1><p><a href="http://maven.apache.org/archetype/maven-archetype-plugin/index.html" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a></p>
]]></content>
      <categories>
        <category>util</category>
      </categories>
  </entry>
  <entry>
    <title>BeanFactory1-DefaultSingletonBeanRegistry</title>
    <url>/2020/BeanFactory1-DefaultSingletonBeanRegistry/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<ul>
<li>&#x7BA1;&#x7406;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;</li>
<li>&#x4FDD;&#x8BC1;&#x6CE8;&#x518C;&#x7684;&#x5BF9;&#x8C61;&#x5355;&#x4F8B;, &#x6545;&#x8BBE;&#x7F6E;&#x4E86;&#x4E09;&#x7EA7;&#x7F13;&#x5B58;</li>
<li>&#x7BA1;&#x7406;signleton&#x72B6;&#x6001;&#x4E2D;&#x9700;&#x8981;&#x6267;&#x884C;&#x9500;&#x6BC1;&#x6D41;&#x7A0B;&#x7684;&#x5BF9;&#x8C61;</li>
<li>&#x7BA1;&#x7406;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;&#x7684;&#x522B;&#x540D;&#x6620;&#x5C04;</li>
</ul>
</blockquote>
<h1 id="&#x7236;&#x7C7B;-SimpleAliasRegistry">2. &#x7236;&#x7C7B;-SimpleAliasRegistry</h1><blockquote>
<p>&#x8D1F;&#x8D23;&#x7BA1;&#x7406;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;&#x522B;&#x540D;&#x7684;&#x6620;&#x5C04;</p>
</blockquote>
<h2 id="aliasMap">2.1. aliasMap</h2><h3 id="&#x6210;&#x5458;&#x53D8;&#x91CF;">2.1.1. &#x6210;&#x5458;&#x53D8;&#x91CF;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// key: alias</span></span><br><span class="line"><span class="comment">// value: beanName</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; aliasMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">16</span>);</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="&#x6CE8;&#x518C;&#x522B;&#x540D;">2.1.2. &#x6CE8;&#x518C;&#x522B;&#x540D;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerAlias</span><span class="params">(String name, String alias)</span> </span>{</span><br><span class="line">  <span class="comment">// &#x6821;&#x9A8C; name &#x3001; alias</span></span><br><span class="line">  Assert.hasText(name, <span class="string">&quot;&apos;name&apos; must not be empty&quot;</span>);</span><br><span class="line">  Assert.hasText(alias, <span class="string">&quot;&apos;alias&apos; must not be empty&quot;</span>);</span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>.aliasMap) {</span><br><span class="line">    <span class="comment">// name == alias &#x5219;&#x53BB;&#x6389;alias</span></span><br><span class="line">    <span class="keyword">if</span> (alias.equals(name)) {</span><br><span class="line">      <span class="keyword">this</span>.aliasMap.remove(alias);</span><br><span class="line">      <span class="keyword">if</span> (logger.isDebugEnabled()) {</span><br><span class="line">        logger.debug(<span class="string">&quot;Alias definition &apos;&quot;</span> + alias + <span class="string">&quot;&apos; ignored since it points to same name&quot;</span>);</span><br><span class="line">      }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// &#x83B7;&#x53D6; alias &#x5DF2;&#x6CE8;&#x518C;&#x7684; beanName</span></span><br><span class="line">      String registeredName = <span class="keyword">this</span>.aliasMap.get(alias);</span><br><span class="line">      <span class="comment">// &#x5DF2;&#x5B58;&#x5728;</span></span><br><span class="line">      <span class="keyword">if</span> (registeredName != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="comment">// &#x76F8;&#x540C;&#xFF0C;&#x5219; return &#xFF0C;&#x65E0;&#x9700;&#x91CD;&#x590D;&#x6CE8;&#x518C;</span></span><br><span class="line">        <span class="keyword">if</span> (registeredName.equals(name)) {</span><br><span class="line">          <span class="comment">// An existing alias - no need to re-register</span></span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// &#x4E0D;&#x5141;&#x8BB8;&#x8986;&#x76D6;&#xFF0C;&#x5219;&#x629B;&#x51FA; IllegalStateException &#x5F02;&#x5E38;</span></span><br><span class="line">        <span class="keyword">if</span> (!allowAliasOverriding()) {</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Cannot define alias &apos;&quot;</span> + alias + <span class="string">&quot;&apos; for name &apos;&quot;</span> +</span><br><span class="line">                                          name + <span class="string">&quot;&apos;: It is already registered for name &apos;&quot;</span> + registeredName + <span class="string">&quot;&apos;.&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) {</span><br><span class="line">          logger.debug(<span class="string">&quot;Overriding alias &apos;&quot;</span> + alias + <span class="string">&quot;&apos; definition for registered name &apos;&quot;</span> +</span><br><span class="line">                       registeredName + <span class="string">&quot;&apos; with new target name &apos;&quot;</span> + name + <span class="string">&quot;&apos;&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="comment">// &#x6821;&#x9A8C;&#xFF0C;&#x662F;&#x5426;&#x5B58;&#x5728;&#x5FAA;&#x73AF;&#x6307;&#x5411;</span></span><br><span class="line">      checkForAliasCircle(name, alias);</span><br><span class="line">      <span class="comment">// &#x6CE8;&#x518C; alias</span></span><br><span class="line">      <span class="keyword">this</span>.aliasMap.put(alias, name);</span><br><span class="line">      <span class="keyword">if</span> (logger.isTraceEnabled()) {</span><br><span class="line">        logger.trace(<span class="string">&quot;Alias definition &apos;&quot;</span> + alias + <span class="string">&quot;&apos; registered for name &apos;&quot;</span> + name + <span class="string">&quot;&apos;&quot;</span>);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="&#x6210;&#x5458;&#x53D8;&#x91CF;-1">3. &#x6210;&#x5458;&#x53D8;&#x91CF;</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * &#x5B58;&#x653E;&#x7684;&#x662F;&#x5355;&#x4F8B; bean &#x7684;&#x6620;&#x5C04;&#x3002;</span></span><br><span class="line"><span class="comment">    * &#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4E3A; bean name --&gt; bean instance</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">256</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Cache of singleton factories: bean name to ObjectFactory.</span></span><br><span class="line"><span class="comment">    * &#x5B58;&#x653E;&#x7684;&#x662F; ObjectFactory&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x521B;&#x5EFA;&#x5355;&#x4F8B; bean &#x7684; factory &#x3002;</span></span><br><span class="line"><span class="comment">    * &#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x662F; bean name --&gt; ObjectFactory</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Cache of early singleton objects: bean name to bean instance.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * &#x5B58;&#x653E;&#x7684;&#x662F;&#x65E9;&#x671F;&#x7684; bean&#xFF0C;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4E5F;&#x662F; bean name --&gt; bean instance&#x3002;</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * &#x5B83;&#x4E0E; {<span class="doctag">@link</span> #singletonFactories} &#x533A;&#x522B;&#x5728;&#x4E8E; earlySingletonObjects &#x4E2D;&#x5B58;&#x653E;&#x7684; bean &#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x5B8C;&#x6574;&#x3002;</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * &#x4ECE; {<span class="doctag">@link</span> #getSingleton(String)} &#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#xFF0C;bean &#x5728;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E2D;&#x5C31;&#x5DF2;&#x7ECF;&#x52A0;&#x5165;&#x5230; earlySingletonObjects &#x4E2D;&#x4E86;&#x3002;</span></span><br><span class="line"><span class="comment">    * &#x6240;&#x4EE5;&#x5F53;&#x5728; bean &#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; getBean() &#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x3002;</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * &#x8FD9;&#x4E2A; Map &#x4E5F;&#x662F;&#x3010;&#x5FAA;&#x73AF;&#x4F9D;&#x8D56;&#x3011;&#x7684;&#x5173;&#x952E;&#x6240;&#x5728;&#x3002;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Set of registered singletons, containing the bean names in registration order.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * &#x5DF2;&#x6CE8;&#x518C;&#x7684;&#x5355;&#x4F8B; Bean &#x540D;&#x79F0;&#x7684;&#x96C6;&#x5408;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; registeredSingletons = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(<span class="number">256</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Names of beans that are currently in creation.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * &#x6B63;&#x5728;&#x521B;&#x5EFA;&#x4E2D;&#x7684;&#x5355;&#x4F8B; Bean &#x7684;&#x540D;&#x5B57;&#x7684;&#x96C6;&#x5408;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; singletonsCurrentlyInCreation =</span><br><span class="line">		Collections.newSetFromMap(<span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">16</span>));</span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>spring源码</category>
      </categories>
      <tags>
        <tag>BeanFactory</tag>
      </tags>
  </entry>
  <entry>
    <title>zookeeper</title>
    <url>/2020/zookeeper/</url>
    <content><![CDATA[<h1 id="&#x662F;&#x4EC0;&#x4E48;">1. &#x662F;&#x4EC0;&#x4E48;</h1><p>zookeeper&#x662F;&#x7531;&#x96C5;&#x864E;&#x521B;&#x5EFA;&#x7684;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x534F;&#x8C03;&#x670D;&#x52A1;, &#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x6570;&#x636E;&#x4E00;&#x81F4;&#x6027;&#x89E3;&#x51B3;&#x65B9;&#x6848;, &#x5206;&#x5E03;&#x5F0F;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x57FA;&#x4E8E;&#x5B83;&#x5B9E;&#x73B0;&#x5165;&#x6570;&#x636E;&#x53D1;&#x5E03;/&#x8BA2;&#x9605;&#x3001;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3001;&#x547D;&#x540D;&#x670D;&#x52A1;&#x3001;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x3001;master&#x9009;&#x4E3E;&#x3001;&#x5206;&#x5E03;&#x5F0F;&#x9501;/&#x5217;&#x961F;&#x7B49;&#x529F;&#x80FD;</p>
<a id="more"></a>

<h1 id="&#x7279;&#x6027;">2. &#x7279;&#x6027;</h1><h2 id="&#x4FDD;&#x8BC1;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x4E00;&#x81F4;&#x6027;">2.1. &#x4FDD;&#x8BC1;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x4E00;&#x81F4;&#x6027;</h2><ol>
<li>&#x987A;&#x5E8F;&#x4E00;&#x81F4;&#x6027;<ol>
<li>&#x4ECE;&#x540C;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77;&#x7684;&#x4E8B;&#x7269;&#x8BF7;&#x6C42;,&#x6700;&#x7EC8;&#x4F1A;&#x4E25;&#x683C;&#x7684;&#x6309;&#x7167;&#x5176;&#x53D1;&#x8D77;&#x987A;&#x5E8F;&#x88AB;&#x5E94;&#x7528;&#x5230;zookeeper&#x4E2D;</li>
</ol>
</li>
<li>&#x539F;&#x5B50;&#x6027;<ol>
<li>zookeeper&#x4E2D;&#x6240;&#x6709;&#x7684;&#x4E8B;&#x7269;&#x8BF7;&#x6C42;&#x5177;&#x6709;&#x539F;&#x5B50;&#x6027;</li>
</ol>
</li>
<li>&#x5355;&#x4E00;&#x89C6;&#x56FE;<ol>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x65E0;&#x8BBA;&#x94FE;&#x63A5;&#x54EA;&#x4E2A;zookeeper&#x670D;&#x52A1;,&#x770B;&#x5230;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;&#x4E00;&#x81F4;&#x7684;</li>
</ol>
</li>
<li>&#x53EF;&#x9760;&#x6027;</li>
<li>&#x5B9E;&#x65F6;&#x6027;<ol>
<li>zookeeper&#x4EC5;&#x4EC5;&#x80FD;&#x5728;&#x4E00;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x5185;&#x5BA2;&#x6237;&#x7AEF;&#x6700;&#x7EC8;&#x4E00;&#x5B9A;&#x80FD;&#x591F;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8BFB;&#x53D6;&#x5230;&#x6700;&#x65B0;&#x7684;&#x6570;&#x636E;</li>
</ol>
</li>
</ol>
<h2 id="&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x96C6;&#x7FA4;">2.2. &#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x96C6;&#x7FA4;</h2><p>&#x4E00;&#x822C;3-5&#x53F0;&#x673A;&#x5668;&#x5C31;&#x53EF;&#x4EE5;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;&#x53EF;&#x7528;zookeeper&#x96C6;&#x7FA4;,&#x6BCF;&#x53F0;&#x673A;&#x5668;&#x90FD;&#x4F1A;&#x7EF4;&#x62A4;&#x5F53;&#x524D;&#x7684;&#x670D;&#x52A1;&#x72B6;&#x6001;, &#x5E76;&#x4E14;&#x6BCF;&#x53F0;&#x673A;&#x5668;&#x4E4B;&#x95F4;&#x90FD;&#x4E92;&#x76F8;&#x4FDD;&#x6301;&#x7740;&#x901A;&#x4FE1;, &#x53EA;&#x8981;&#x96C6;&#x7FA4;&#x4E2D;&#x8D85;&#x8FC7;&#x4E00;&#x822C;&#x7684;&#x673A;&#x5668;&#x80FD;&#x591F;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;, &#x90A3;&#x4E48;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x5C31;&#x80FD;&#x6B63;&#x5E38;&#x5BF9;&#x5916;&#x670D;&#x52A1;</p>
<h2 id="&#x987A;&#x5E8F;&#x8BBF;&#x95EE;">2.3. &#x987A;&#x5E8F;&#x8BBF;&#x95EE;</h2><p>&#x5BF9;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6BCF;&#x4E2A;&#x66F4;&#x65B0;&#x8BF7;&#x6C42;, zookeeper&#x90FD;&#x4F1A;&#x5206;&#x914D;&#x5168;&#x5C40;&#x552F;&#x4E00;&#x7684;&#x9012;&#x589E;&#x7F16;&#x53F7;, &#x8FD9;&#x4E2A;&#x7F16;&#x53F7;&#x53CD;&#x6620;&#x4E86;&#x6240;&#x6709;&#x5B9E;&#x52A1;&#x64CD;&#x4F5C;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;</p>
<h2 id="&#x9AD8;&#x6027;&#x80FD;">2.4. &#x9AD8;&#x6027;&#x80FD;</h2><p>&#x7531;&#x4E8E;zookeeper&#x5C06;&#x5168;&#x91CF;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5728;&#x5185;&#x5B58;&#x4E2D;, &#x5E76;&#x76F4;&#x63A5;&#x670D;&#x52A1;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6240;&#x6709;&#x975E;&#x4E8B;&#x7269;&#x8BF7;&#x6C42;, &#x56E0;&#x6B64;&#x5B83;&#x5C24;&#x5176;&#x9002;&#x7528;&#x4E8E;&#x4EE5;&#x8BFB;&#x64CD;&#x4F5C;&#x4E3A;&#x4E3B;&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;</p>
<h1 id="&#x57FA;&#x672C;&#x6982;&#x5FF5;">3. &#x57FA;&#x672C;&#x6982;&#x5FF5;</h1><p>&#x5728;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E2D;, &#x6784;&#x6210;&#x96C6;&#x7FA4;&#x7684;&#x6BCF;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x89D2;&#x8272;. zookeeper&#x5F15;&#x5165;&#x4E86; <code>leader</code>(&#x9886;&#x5BFC;)&#x3001;<code>follower</code>(&#x8DDF;&#x968F;&#x8005;) &#x548C; <code>observer</code>(&#x89C2;&#x5BDF;&#x8005;)&#x4E09;&#x79CD;&#x89D2;&#x8272;. zookeeper&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x673A;&#x5668;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;leader&#x9009;&#x4E3E;&#x8FC7;&#x7A0B;&#x6765;&#x9009;&#x5B9A;&#x4E00;&#x53F0;leader&#x673A;&#x5668;, leader&#x670D;&#x52A1;&#x5668;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4F9B;&#x8BFB;&#x548C;&#x5199;&#x670D;&#x52A1;. &#x9664;leader&#x5916;, &#x5176;&#x4ED6;&#x673A;&#x5668;&#x4E5F;&#x53EF;&#x4EE5;&#x989D;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4F9B;&#x8BFB;&#x548C;&#x5199;&#x670D;&#x52A1;.&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;:observer&#x673A;&#x5668;&#x4E0D;&#x80FD;&#x53C2;&#x4E0E;leader&#x9009;&#x4E3E;&#x7684;&#x8FC7;&#x7A0B;, &#x4E5F;&#x4E0D;&#x53C2;&#x4E0E;<code>&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x8FC7;&#x534A;&#x5199;&#x6210;&#x529F;</code>&#x7B56;&#x7565;, &#x56E0;&#x6B64;observer&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x5F71;&#x54CD;&#x5199;&#x6027;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x63D0;&#x5347;&#x96C6;&#x7FA4;&#x7684;&#x8BFB;&#x6027;&#x80FD;</p>
<p>&#x6570;&#x636E;&#x8282;&#x70B9;(znode)</p>
<p>zookeeper&#x4E2D;&#x7684;&#x8282;&#x70B9;&#x5206;&#x4E3A;&#x4E24;&#x7C7B;, &#x7B2C;&#x4E00;&#x7C7B;&#x6307;&#x7684;&#x662F;&#x6784;&#x6210;&#x96C6;&#x7FA4;&#x7684;&#x673A;&#x5668;, &#x6211;&#x4EEC;&#x79F0;&#x4E4B;&#x4E3A;&#x673A;&#x5668;&#x8282;&#x70B9;;&#x7B2C;&#x4E8C;&#x7C7B;&#x5219;&#x662F;&#x6307;&#x6570;&#x636E;&#x83AB;O&#x578B;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5355;&#x5143;, &#x6211;&#x4EEC;&#x8BDA;&#x631A;&#x4E3A;&#x6570;&#x636E;&#x8282;&#x70B9;(znode)/ zookeeper&#x5C06;&#x6240;&#x6709;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5728;&#x5185;&#x5B58;&#x4E2D;, &#x6570;&#x636E;&#x6A21;&#x578B;&#x662F;&#x4E00;&#x68F5;&#x6811;(zNode tree), &#x7531;&#x659C;&#x6760;/&#x96BD;&#x661F;&#x5206;&#x9694;&#x7684;&#x8DEF;&#x5F84;&#x5C31;&#x662F;&#x4E00;&#x4E2A;znode.&#x6BCF;&#x4E2A;znode&#x4E0A;&#x90FD;&#x4F1A;&#x4FDD;&#x5B58;&#x81EA;&#x5DF1;&#x7684;&#x6570;&#x636E;&#x5185;&#x5BB9;,&#x540C;&#x4E8B;&#x8FD8;&#x4F1A;&#x4FDD;&#x5B58;&#x4E00;&#x7CFB;&#x5217;&#x5C5E;&#x6027;&#x4FE1;&#x606F;</p>
<p>znode&#x5206;&#x4E3A;&#x6301;&#x4E45;&#x8282;&#x70B9;&#x548C;&#x4E34;&#x65F6;&#x8282;&#x70B9;&#x4E24;&#x7C7B;.</p>
<ol>
<li>&#x6301;&#x4E45;&#x8282;&#x70B9;: &#x4E00;&#x65E6;&#x8FD9;&#x4E2A;znode&#x88AB;&#x521B;&#x5EFA;&#x4E86;, &#x9664;&#x975E;&#x4E3B;&#x52A8;&#x8FDB;&#x884C;znode&#x79FB;&#x9664;&#x64CD;&#x4F5C;, &#x5426;&#x5219;&#x8FD9;&#x4E2A;znode&#x5C06;&#x4F1A;&#x4E00;&#x76F4;&#x4FDD;&#x5B58;&#x5728;zookeeper&#x4E0A;</li>
<li>&#x4E34;&#x65F6;&#x8282;&#x70B9;: &#x58F0;&#x660E;&#x5468;&#x671F;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x4F1A;&#x8BDD;&#x7ED1;&#x5B9A;, &#x4E00;&#x65E6;&#x5BA2;&#x6237;&#x7AEF;&#x4F1A;&#x8BDD;&#x5931;&#x6548;,&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x521B;&#x5EFA;&#x7684;&#x6240;&#x6709;&#x4E34;&#x65F6;&#x8282;&#x70B9;&#x90FD;&#x4F1A;&#x88AB;&#x79FB;&#x9664;.</li>
</ol>
<p>&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5668;(watcher)</p>
<p>watcher&#x662F;zookeeper&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x7279;&#x6027;. zookeeper&#x5141;&#x8BB8;&#x7528;&#x6237;&#x5728;&#x6307;&#x5B9A;&#x8282;&#x70B9;&#x4E0A;&#x6CE8;&#x518C;&#x4E00;&#x4E9B;watcher, &#x5E76;&#x4E14;&#x5728;&#x4E00;&#x4E9B;&#x7279;&#x5B9A;&#x7684;&#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x7684;&#x65F6;&#x5019;,zookeeper&#x670D;&#x52A1;&#x7AEF;&#x4F1A;&#x5C06;&#x65F6;&#x95F4;&#x901A;&#x77E5;&#x5230;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x5BA2;&#x6237;&#x7AEF;</p>
<p>acl</p>
<p>zookeeper&#x91C7;&#x7528;acl(access control lists)&#x7B56;&#x7565;&#x6765;&#x8FDB;&#x884C;&#x6743;&#x9650;&#x63A7;&#x5236;, &#x7C7B;&#x4F3C;&#x4E8E;unix&#x7684;&#x6743;&#x9650;&#x63A7;&#x5236;</p>
]]></content>
  </entry>
  <entry>
    <title>科学上网</title>
    <url>/2020/ke-xue-shang-wang/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p>&#x200B;    &#x6700;&#x65E9;&#x7528;&#x7684;ssr,&#x4F46;&#x662F;&#x53BB;&#x5E74;&#x56FD;&#x5E86;&#x7684;&#x65F6;&#x5019;&#x88AB;&#x5C01;&#x6389;&#x4E86;, &#x7136;&#x540E;&#x679C;&#x65AD;&#x5F03;&#x7528;,&#x6539;&#x7528;v2ray. &#x4F7F;&#x7528;&#x4E86;&#x534A;&#x5E74;&#x591A;&#x4E86;, &#x6CA1;&#x6709;&#x88AB;&#x5C01;&#x7981;&#x7684;&#x60C5;&#x51B5;, &#x6700;&#x8FD1;&#x670D;&#x52A1;&#x5668;&#x5230;&#x56FD;&#x5185;&#x4E22;&#x5305;&#x4E25;&#x91CD;, &#x524D;&#x5929;&#x5C31;&#x53C8;&#x4E70;&#x4E86;&#x4E2A;&#x670D;&#x52A1;&#x5668;, v2ray&#x642D;&#x5EFA;&#x540E;&#x4F7F;&#x7528;bbrPlus&#x52A0;&#x901F;, &#x6548;&#x679C;&#x4E0D;&#x9519;</p>
</blockquote>
<a id="more"></a>

<h1 id="&#x51C6;&#x5907;&#x5DE5;&#x4F5C;">2. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;</h1><ol>
<li>vps <ol>
<li>&#x6211;&#x8FD9;&#x6B21;&#x7528;&#x7684; <a href="https://justhost.ru/?ref=35666" target="_blank" rel="noopener">justhost</a> ,&#x673A;&#x5668;&#x5728;&#x897F;&#x4F2F;&#x5229;&#x4E9A;, &#x652F;&#x6301;&#x652F;&#x4ED8;&#x5B9D;,&#x5E74;&#x4ED8;&#x5927;&#x6982;117&#x5DE6;&#x53F3;</li>
<li>&#x7CFB;&#x7EDF; Centos7</li>
</ol>
</li>
<li>&#x57DF;&#x540D;<ol>
<li>&#x5728;<a href="https://www.namesilo.com/login.php" target="_blank" rel="noopener">namesilo</a> &#x8D2D;&#x4E70;, &#x4FBF;&#x5B9C;&#x7684;0.9$/&#x4E00;&#x5E74;</li>
</ol>
</li>
</ol>
<p>&#x50BB;&#x74DC;&#x5F0F;&#x6559;&#x5B66;&#x53EF;&#x4EE5;&#x770B;&#x8FD9;&#x4E2A;<a href="https://zhuanlan.zhihu.com/p/102511030" target="_blank" rel="noopener">JustHost&#x6CE8;&#x518C;&#x53CA;&#x4F7F;&#x7528;&#x6559;&#x7A0B;</a></p>
<h1 id="&#x5B89;&#x88C5;v2ray">3. &#x5B89;&#x88C5;v2ray</h1><p>&#x53C2;&#x8003;&#x8FD9;&#x4E2A;&#x6587;&#x6863;&#x8FDB;&#x884C;&#x5B89;&#x88C5; <a href="https://www.hijk.pw/v2ray-one-click-script-with-mask/" target="_blank" rel="noopener">v2ray&#x5E26;&#x4F2A;&#x88C5;&#x4E00;&#x952E;&#x811A;&#x672C;</a> &#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x5C31;&#x591F;&#x4E86;</p>
<h1 id="&#x5B89;&#x88C5;&#x52A0;&#x901F;&#x5668;">4. &#x5B89;&#x88C5;&#x52A0;&#x901F;&#x5668;</h1><p>&#x53C2;&#x8003;&#x8FD9;&#x4E2A;&#x6587;&#x6863;&#x8FDB;&#x884C;&#x5B89;&#x88C5; <a href="https://www.hijk.pw/install-bbr-plus-lotserver/" target="_blank" rel="noopener">&#x5B89;&#x88C5;&#x9B54;&#x6539;BBR/BBR Plus/&#x9510;&#x901F;(Lotserver)</a> &#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;</p>
<h1 id="&#x6D4B;&#x901F;">5. &#x6D4B;&#x901F;</h1><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">wget http<span class="variable">s:</span>//raw.githubusercontent.<span class="keyword">com</span>/FunctionClub/ZBench/master/ZBench-CN.<span class="keyword">sh</span> &amp;&amp; bash ZBench-CN.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>



<h1 id="&#x67E5;&#x770B;&#x8DEF;&#x7531;">6. &#x67E5;&#x770B;&#x8DEF;&#x7531;</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget -qO- git.io/besttrace | bash</span><br></pre></td></tr></table></figure>



<h1 id="DNS">7. DNS</h1><p>&#x5B89;&#x88C5;&#x540E;&#x5982;&#x679C;&#x53D1;&#x73B0;ping&#x503C;, &#x901F;&#x5EA6;, &#x8DEF;&#x7531;&#x90FD;&#x6B63;&#x5E38;, &#x770B;&#x89C6;&#x9891;&#x6B63;&#x5E38;, &#x4F46;&#x662F;&#x6253;&#x5F00;&#x7F51;&#x9875;&#x5F88;&#x5361;, &#x8FD9;&#x4E00;&#x822C;&#x662F;&#x670D;&#x52A1;&#x5668;&#x5C1D;&#x8BD5;&#x914D;&#x7F6E;&#x7684;&#x9ED8;&#x8BA4;&#x91CE;&#x9E21;dns&#x5BFC;&#x81F4;&#x7684;,&#x6211;&#x4EEC;&#x5C06;dns&#x5730;&#x5740;&#x4FEE;&#x6539;&#x4E3A;google DNS&#x5373;&#x53EF;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">vim /etc/resolv.conf</span><br><span class="line">&#x5220;&#x9664;&#x4E4B;&#x524D;&#x7684;dns, &#x7136;&#x540E;&#x914D;&#x7F6E;&#x5982;&#x4E0B;</span><br><span class="line">nameserver <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line"></span><br><span class="line">&#x4E0D;&#x751F;&#x6548;&#x7684;&#x8BDD;&#x518D;&#x91CD;&#x542F;NetworkManager</span><br><span class="line">systemctl restart NetworkManager</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>util</category>
      </categories>
  </entry>
  <entry>
    <title>线程池5:ExecutorCompletionService源码</title>
    <url>/2020/executor-completion-service-yuanma/</url>
    <content><![CDATA[<p>&#x8F6C;&#x8F7D;&#x81EA;<a href="https://www.jianshu.com/p/9b85c47a6ff4" target="_blank" rel="noopener">&#x300A;&#x7EBF;&#x7A0B;&#x6C60;&#x7CFB;&#x5217;&#x4E94;&#x300B;-ExecutorCompletionService&#x539F;&#x7406;&#x5206;&#x6790;</a></p>
<blockquote>
<p>ExecutorCompletionService&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x7684;&#x914D;&#x5408;&#x7EBF;&#x7A0B;&#x6C60;&#x4F7F;&#x7528;&#xFF0C;&#x5B83;&#x7684;&#x5185;&#x90E8;&#x5C01;&#x88C5;&#x4E86;&#x7EBF;&#x7A0B;&#x6C60;&#xFF08;&#x7EBF;&#x7A0B;&#x6C60;&#x9700;&#x8981;&#x5728;&#x6784;&#x9020;&#x5BF9;&#x8C61;&#x65F6;&#x4F20;&#x5165;&#xFF09;&#xFF0C;&#x5C06;&#x63D0;&#x4EA4;&#x7684;&#x4EFB;&#x52A1;&#x4EE3;&#x7406;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x6267;&#x884C;&#xFF08;&#x4F46;&#x4EFB;&#x52A1;&#x5DF2;&#x7ECF;&#x4E0D;&#x518D;&#x662F;FutureTask&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x662F;FutureTask&#x7684;&#x5B50;&#x7C7B;QueueingFuture&#xFF0C;QueueingFuture&#x91CD;&#x5199;&#x4E86;done()&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5728;FutureTask&#x7C7B;&#x4E2D;&#x662F;&#x7A7A;&#x5B9E;&#x73B0;&#xFF09;&#xFF0C;&#x56E0;&#x4E3A;&#x63D0;&#x4EA4;&#x7684;&#x4EFB;&#x52A1;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;QueueingFuture&#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x5728;&#x4EFB;&#x52A1;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x4E3B;&#x52A8;&#x5C06;&#x8BE5;&#x4EFB;&#x52A1;&#x653E;&#x5230;ExecutorCompletionService&#x7EF4;&#x62A4;&#x7684;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#x90FD;&#x4F1A;&#x88AB;&#x653E;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x7ED3;&#x679C;&#x65F6;&#xFF0C;&#x53EA;&#x9700;&#x8C03;&#x7528;take()&#x6216;&#x8005;poll()&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x5373;&#x53EF;&#x3002; </p>
</blockquote>
<h1 id="&#x4F7F;&#x7528;&#x793A;&#x4F8B;">1. &#x4F7F;&#x7528;&#x793A;&#x4F8B;</h1><p>&#x4F7F;&#x7528;ExecutorCompletionService&#x9700;&#x8981;&#x4E00;&#x4E0B;&#x51E0;&#x6B65;&#xFF1A; </p>
<ol>
<li>&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6C60;&#x5BF9;&#x8C61;</li>
<li>&#x521B;&#x5EFA;ExecutorCompletionService&#x5BF9;&#x8C61;&#xFF0C;&#x5C06;&#x7EBF;&#x7A0B;&#x6C60;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x3002;</li>
<li>&#x5411;ExecutorCompletionService&#x5BF9;&#x8C61;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#xFF0C;&#x4EFB;&#x52A1;&#x6700;&#x7EC8;&#x8FD8;&#x662F;&#x4F1A;&#x4EE3;&#x7406;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x5BF9;&#x8C61;&#x6267;&#x884C;&#x3002;</li>
<li>&#x6267;&#x884C;take()&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x901A;&#x8FC7;get()&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x3002;</li>
</ol>
<a id="more"></a>

<p>&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.feng.validation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by xinfeng.xu on 2017/10/16.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorCompletionServiceDemo</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> threadCount = Runtime.getRuntime().availableProcessors();</span><br><span class="line">    <span class="keyword">private</span> ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(threadCount, threadCount,</span><br><span class="line">            <span class="number">0</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">10</span>),</span><br><span class="line">            <span class="keyword">new</span> ThreadPoolExecutor.DiscardPolicy());</span><br><span class="line">    <span class="keyword">private</span> ExecutorCompletionService&lt;String&gt; service = <span class="keyword">new</span> ExecutorCompletionService&lt;String&gt;(executor);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt;</span>{</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeTasks</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">//&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++){</span><br><span class="line">            service.submit(<span class="keyword">new</span> Task());</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x83B7;&#x53D6;&#x7ED3;&#x679C;</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) {</span><br><span class="line">            <span class="comment">//&#x83B7;&#x53D6;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x5C06;&#x4F1A;&#x963B;&#x585E;</span></span><br><span class="line">            Future task = service.take();</span><br><span class="line">            <span class="comment">//&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x7ED3;&#x679C;</span></span><br><span class="line">            System.out.println(task.get());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            ExecutorCompletionServiceDemo demo = <span class="keyword">new</span> ExecutorCompletionServiceDemo();</span><br><span class="line">            demo.executeTasks();</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (ExecutionException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<h1 id="CompletionService&#x63A5;&#x53E3;">2. CompletionService&#x63A5;&#x53E3;</h1><p>ExecutorCompletionService&#x5B9E;&#x73B0;&#x4E86;CompletionService&#x63A5;&#x53E3;&#xFF0C;&#x8BE5;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#xFF0C;&#x83B7;&#x53D6;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#x7684;&#x65B9;&#x6CD5; </p>
<ul>
<li>&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x64CD;&#x4F5C;<br>submit() &#x53EF;&#x4EE5;&#x63D0;&#x4EA4;callable&#x5BF9;&#x8C61;&#x548C;runnable&#x5BF9;&#x8C61;</li>
<li>&#x83B7;&#x53D6;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#x64CD;&#x4F5C;<br>take( ) &#x963B;&#x585E;&#x5F0F;&#x83B7;&#x53D6;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;<br>poll( ) &#x975E;&#x963B;&#x585E;&#x5F0F;&#x83B7;&#x53D6;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;<br>poll(timeout) &#x6709;&#x9650;&#x963B;&#x585E;&#x83B7;&#x53D6;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;</li>
</ul>
<h1 id="QueueingFuture&#x7C7B;">3. QueueingFuture&#x7C7B;</h1><p>ExecutorCompletionService&#x7684;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x8BE5;&#x7C7B;&#x5B9E;&#x73B0;&#x4E86;FutureTask&#x7C7B;&#xFF0C;&#x91CD;&#x5199;&#x4E86;done()&#x65B9;&#x6CD5;&#xFF08;&#x8BE5;&#x65B9;&#x6CD5;&#x5728;FutureTask&#x4E2D;&#x662F;&#x7A7A;&#x5B9E;&#x73B0;&#xFF09;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x88AB;&#x8C03;&#x7528;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x56DE;&#x5FC6;&#x4E00;&#x4E0B;FutureTask&#x7684;finishCompletion()&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5728;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x65F6;&#x8C03;&#x7528;&#xFF0C;&#x5524;&#x9192;&#x7B49;&#x5F85;&#x7EBF;&#x7A0B;&#x4E4B;&#x540E;&#x8C03;&#x7528;done()&#x65B9;&#x6CD5;&#xFF0C;FutureTask&#x7684;finishCompletion()&#x65B9;&#x6CD5;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finishCompletion</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// assert state &gt; COMPLETING;</span></span><br><span class="line">    <span class="keyword">for</span> (WaitNode q; (q = waiters) != <span class="keyword">null</span>;) {</span><br><span class="line">        <span class="keyword">if</span> (UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, waitersOffset, q, <span class="keyword">null</span>)) {</span><br><span class="line">            <span class="keyword">for</span> (;;) {</span><br><span class="line">                Thread t = q.thread;</span><br><span class="line">                <span class="keyword">if</span> (t != <span class="keyword">null</span>) {</span><br><span class="line">                    q.thread = <span class="keyword">null</span>;</span><br><span class="line">                    LockSupport.unpark(t);</span><br><span class="line">                }</span><br><span class="line">                WaitNode next = q.next;</span><br><span class="line">                <span class="keyword">if</span> (next == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                q.next = <span class="keyword">null</span>; <span class="comment">// unlink to help gc</span></span><br><span class="line">                q = next;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    done();</span><br><span class="line"></span><br><span class="line">    callable = <span class="keyword">null</span>;        <span class="comment">// to reduce footprint</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>QueueingFuture &#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">QueueingFuture</span> <span class="keyword">extends</span> <span class="title">FutureTask</span>&lt;<span class="title">Void</span>&gt; </span>{</span><br><span class="line">    QueueingFuture(RunnableFuture&lt;V&gt; task) {</span><br><span class="line">        <span class="keyword">super</span>(task, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">this</span>.task = task;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">done</span><span class="params">()</span> </span>{ completionQueue.add(task); }</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Future&lt;V&gt; task;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x6E90;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x5C06;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x5230;completionQueue&#x7684;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x3002; </p>
<h1 id="&#x6210;&#x5458;&#x53D8;&#x91CF;">4. &#x6210;&#x5458;&#x53D8;&#x91CF;</h1><ul>
<li>Executor executor<br>&#x7EBF;&#x7A0B;&#x6C60;&#x5BF9;&#x8C61;&#xFF0C;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x7531;&#x8BE5;&#x5BF9;&#x8C61;&#x6267;&#x884C;</li>
<li>AbstractExecutorService aes<br>&#x8BE5;&#x5BF9;&#x8C61;&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x5C06;runnable&#x6216;&#x8005;callable&#x5BF9;&#x8C61;&#x8F6C;&#x6362;&#x4E3A;FutureRunnable&#x5BF9;&#x8C61;&#x3002;&#x7531;&#x4E8E;&#x4E0D;&#x77E5;&#x9053;Executor&#x5177;&#x4F53;&#x662F;&#x54EA;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#xFF0C;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x662F;AbstractExecutorService&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x5C06;executor&#x5F3A;&#x5236;&#x8F6C;&#x5316;&#x4E3A;AbstractExecutorService&#x7C7B;&#x578B;&#xFF0C;&#x53EA;&#x662F;&#x8868;&#x660E;&#x80FD;&#x591F;&#x76F4;&#x63A5;&#x8C03;&#x7528;newTaskFor()&#x65B9;&#x6CD5;&#x800C;&#x5DF2;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x662F;AbstractExecutorService&#x7C7B;&#x578B;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x76F4;&#x63A5;&#x88C5;&#x6362;&#x4E3A;FutureTask&#x7C7B;&#x578B;&#x3002;<br><strong>&#x8FD9;&#x91CC;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x5168;&#x90FD;&#x8F6C;&#x5316;&#x4E3A;FutrueTask&#x7C7B;&#x578B;&#x7684;&#xFF0C; &#x56E0;&#x4E3A;&#x5B9E;&#x73B0;AbstractExecutorService&#x7684;&#x5B50;&#x7C7B;&#x4E0D;&#x4E00;&#x5B9A;&#x90FD;&#x662F;&#x4F7F;&#x7528;&#x7684;FutureTask&#x7C7B;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#xFF0C;&#x8981;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x3002;</strong></li>
<li>BlockingQueue&lt;Future<v>&gt; completionQueue<br>&#x5B58;&#x653E;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;done()&#x65B9;&#x6CD5;&#x4E2D;&#x6DFB;&#x52A0;</v></li>
</ul>
<h1 id="&#x6784;&#x9020;&#x65B9;&#x6CD5;">5. &#x6784;&#x9020;&#x65B9;&#x6CD5;</h1><p>&#x4E3A;&#x4E09;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#xFF0C;&#x5176;&#x4E2D;executor&#x53C2;&#x6570;&#x662F;&#x9700;&#x8981;&#x4F20;&#x5165;&#x7684;&#x3002;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ExecutorCompletionService</span><span class="params">(Executor executor)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (executor == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.executor = executor;</span><br><span class="line">    <span class="keyword">this</span>.aes = (executor <span class="keyword">instanceof</span> AbstractExecutorService) ?</span><br><span class="line">            (AbstractExecutorService) executor : <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.completionQueue = <span class="keyword">new</span> LinkedBlockingQueue&lt;Future&lt;V&gt;&gt;();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x53EF;&#x4F20;&#x5165;&#x963B;&#x585E;&#x961F;&#x5217;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;&#x6E90;&#x7801;&#x4E0D;&#x518D;&#x8D34;&#x51FA;&#x3002; </p>
<h1 id="&#x8F6C;&#x6362;&#x4EFB;&#x52A1;&#x7C7B;&#x578B;&#x65B9;&#x6CD5;newTaskFor">6. &#x8F6C;&#x6362;&#x4EFB;&#x52A1;&#x7C7B;&#x578B;&#x65B9;&#x6CD5;newTaskFor()</h1><p>&#x8BE5;&#x65B9;&#x6CD5;&#x7C7B;&#x578B;&#x4E3A;protected&#x65B9;&#x6CD5;&#xFF0C;&#x5916;&#x90E8;&#x65B9;&#x6CD5;&#x4E0D;&#x80FD;&#x8C03;&#x7528;&#x3002;<br>&#x5982;&#x679C;&#x63A5;&#x6536;&#x7684;executor&#x662F;AbstractExecutorService&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x90A3;&#x4E48;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5B83;&#x7684;newTaskFor()&#x65B9;&#x6CD5;&#xFF1B;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x6784;&#x9020;&#x4E3A;FutureTask&#x7C7B;&#xFF0C;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> RunnableFuture&lt;V&gt; <span class="title">newTaskFor</span><span class="params">(Callable&lt;V&gt; task)</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (aes == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FutureTask&lt;V&gt;(task);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> aes.newTaskFor(task);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="submit-&#x65B9;&#x6CD5;">7. submit()&#x65B9;&#x6CD5;</h1><p>&#x5148;&#x5C06;&#x63D0;&#x4EA4;&#x7684;&#x4EFB;&#x52A1;callable&#x5BF9;&#x8C61;&#x6216;&#x8005;runnable&#x5BF9;&#x8C61;&#xFF0C;&#x8F6C;&#x6362;&#x4E3A;RunnableFuture&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x5C06;RunnableFuture&#x5BF9;&#x8C61;&#x8F6C;&#x6362;&#x4E3A;QueueingFuture &#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x5C06;&#x8BE5;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;execute()&#x65B9;&#x6CD5;&#x63D0;&#x4EA4;&#x3002;<br><strong>&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x4E3B;&#x8981;&#x4E24;&#x70B9;&#xFF1A;</strong></p>
<ol>
<li>&#x5FC5;&#x987B;&#x63D0;&#x4EA4;QueueingFuture&#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x6709;&#x8BE5;&#x5BF9;&#x8C61;&#x624D;&#x4F1A;&#x5728;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#x653E;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;</li>
<li>&#x5FC5;&#x987B;&#x7531;execute()&#x65B9;&#x6CD5;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#xFF0C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;submit()&#x65B9;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x4F7F;&#x7528;submit()&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#xFF0C;&#x4EFB;&#x52A1;&#x7684;&#x4F1A;&#x88AB;&#x5C01;&#x88C5;&#x6210;FutureTask&#x5BF9;&#x8C61;&#xFF0C;&#x5C31;&#x4E0D;&#x5728;&#x662F;QueueingFuture&#x7C7B;&#x578B;&#x7684;&#x4EFB;&#x52A1;&#x4E86;&#x3002;<br>&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A;&#x53EA;&#x5C55;&#x793A;&#x4E00;&#x4E2A;submit()&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x5176;&#x4ED6;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;&#x7C7B;&#x4F3C;&#xFF1A;<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Future&lt;V&gt; <span class="title">submit</span><span class="params">(Callable&lt;V&gt; task)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (task == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    RunnableFuture&lt;V&gt; f = newTaskFor(task);</span><br><span class="line">    executor.execute(<span class="keyword">new</span> QueueingFuture(f));</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="&#x83B7;&#x53D6;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#x65B9;&#x6CD5;">8. &#x83B7;&#x53D6;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#x65B9;&#x6CD5;</h1><p>&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x5C06;&#x4EFB;&#x52A1;&#x653E;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x83B7;&#x53D6;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x8F6C;&#x6362;&#x4E3A;&#x53BB;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x83B7;&#x53D6;&#x5143;&#x7D20;&#x7684;&#x64CD;&#x4F5C;&#x3002;<br>&#x5176;&#x4E2D;take() poll() poll(timeout)&#x90FD;&#x662F;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x963B;&#x585E;&#x961F;&#x5217;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Future&lt;V&gt; <span class="title">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">    <span class="keyword">return</span> completionQueue.take();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Future&lt;V&gt; <span class="title">poll</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> completionQueue.poll();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Future&lt;V&gt; <span class="title">poll</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">    <span class="keyword">return</span> completionQueue.poll(timeout, unit);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>thread-pool</category>
      </categories>
  </entry>
  <entry>
    <title>线程池4:ThreadPoolExecutor源码</title>
    <url>/2020/thread-pool-executor-yuan-ma/</url>
    <content><![CDATA[<p>&#x8F6C;&#x8F7D;&#x81EA;<a href="https://www.jianshu.com/p/a52f438c16be" target="_blank" rel="noopener">&#x300A;&#x7EBF;&#x7A0B;&#x6C60;&#x7CFB;&#x5217;&#x56DB;&#x300B;-ThreadPoolExecutor&#x7EBF;&#x7A0B;&#x6C60;&#x6E90;&#x7801;&#x5206;&#x6790;</a></p>
<blockquote>
<p>&#x4E0A;&#x4E00;&#x5C0F;&#x8282;&#x4E3B;&#x8981;&#x8BB2;&#x89E3;&#x4E86;ThreadPoolExecutor&#x7684;&#x7236;&#x7C7B;&#x53CA;&#x5176;&#x63A5;&#x53E3;&#x7684;&#x6E90;&#x7801;&#x5206;&#x6790;&#x3002;&#x672C;&#x8282;&#x5C06;&#x5F00;&#x59CB;ThreadPoolExecutor&#x7684;&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4ECE;&#x6E90;&#x7801;&#x7684;&#x89D2;&#x5EA6;&#x5206;&#x6790;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;&#x9996;&#x5148;&#x8BB2;&#x89E3;&#x548C;&#x72B6;&#x6001;&#x76F8;&#x5173;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x548C;&#x51FD;&#x6570;&#xFF0C;&#x63A5;&#x7740;&#x8BB2;&#x89E3;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x7C7B;Worker&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x7136;&#x540E;&#x4ECE;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3001;&#x63D0;&#x4EA4;&#x65B9;&#x6CD5;&#x3001;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x4E24;&#x79CD;&#x5173;&#x95ED;&#x64CD;&#x4F5C;&#x5165;&#x624B;&#x5206;&#x6790;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xFF0C;&#x6700;&#x540E;&#x8BB2;&#x89E3;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#xFF0C;&#x4EE5;&#x53CA;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x65F6;&#x5E94;&#x8BE5;&#x6CE8;&#x610F;&#x7684;&#x4E8B;&#x9879;&#x3002;&#x672C;&#x6587;&#x5185;&#x5BB9;&#x8F83;&#x591A;&#xFF0C;&#x5982;&#x679C;&#x771F;&#x7684;&#x60F3;&#x638C;&#x63E1;&#x8BE5;&#x5185;&#x5BB9;&#xFF0C;&#x8BF7;&#x8010;&#x5FC3;&#x9605;&#x8BFB;&#x3002; </p>
</blockquote>
<h1 id="&#x7EBF;&#x7A0B;&#x6C60;&#x72B6;&#x6001;">1. &#x7EBF;&#x7A0B;&#x6C60;&#x72B6;&#x6001;</h1><ul>
<li>&#x72B6;&#x6001;&#x76F8;&#x5173;&#x6210;&#x5458;&#x53D8;&#x91CF;</li>
</ul>
<p>ctl&#xFF1A;&#x8BE5;&#x53D8;&#x91CF;&#x662F;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x8D2F;&#x7A7F;&#x4E8E;&#x6574;&#x4E2A;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x3002;&#x7C7B;&#x578B;&#x4E3A;AtomicInteger&#x7C7B;&#x578B;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;32&#x4F4D;&#x539F;&#x5B50;int&#x578B;&#x6570;&#x5B57;&#xFF0C;&#x5728;&#x5B9E;&#x73B0;&#x4E2D;&#xFF0C;<strong>&#x5176;&#x9AD8;&#x4E09;&#x4F4D;&#x7528;&#x6765;&#x8868;&#x793A;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x4F4E;29&#x4F4D;&#x7528;&#x6765;&#x8868;&#x793A;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7EBF;&#x7A0B;&#x4E2A;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;ctlOf(RUNNING, 0)&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x72B6;&#x6001;&#x4E3A;running&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2A;&#x6570;&#x4E3A;0</strong><br>count_bits : &#x503C;&#x4E3A;29&#xFF0C; &#x5373;&#x4F4E;count_bits&#x4F4D;&#x8868;&#x793A;&#x7684;&#x6570;&#x503C;&#x5C31;&#x662F;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7EBF;&#x7A0B;&#x7684;&#x4E2A;&#x6570;<br>capacity&#xFF1A;2^29-1 &#x5373;29&#x4F4D;&#x80FD;&#x591F;&#x8868;&#x793A;&#x7684;&#x6700;&#x5927;&#x7684;&#x6570;&#x503C;&#xFF0C;&#x8868;&#x793A;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x80FD;&#x5305;&#x542B;&#x7EBF;&#x7A0B;&#x4E2A;&#x6570;&#x7684;&#x6700;&#x5927;&#x503C; </p>
<p>&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x72B6;&#x6001;&#x4F7F;&#x7528;ctl&#x7684;&#x9AD8;&#x4E09;&#x4F4D;&#x8868;&#x793A;&#xFF1A; </p>
<table>
<thead>
<tr>
<th>&#x72B6;&#x6001;</th>
<th>&#x9AD8;&#x4E09;&#x4F4D;&#x503C;</th>
<th>&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody><tr>
<td>running</td>
<td>100</td>
<td>&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x6570;&#x503C;&#x4E3A;&#x8D1F;&#x6570;</td>
</tr>
<tr>
<td>shutdown</td>
<td>000</td>
<td>&#x5173;&#x95ED;&#x72B6;&#x6001;&#xFF0C;&#x8C03;&#x7528;shutdown()&#x65B9;&#x6CD5;</td>
</tr>
<tr>
<td>stop</td>
<td>001</td>
<td>&#x5173;&#x95ED;&#x72B6;&#x6001;&#xFF0C;&#x8C03;&#x7528;shutdownNow()&#x65B9;&#x6CD5;&#xFF0C;&#x4E0E;shutdown&#x72B6;&#x6001;&#x7A0D;&#x6709;&#x4E0D;&#x540C;</td>
</tr>
<tr>
<td>tidying</td>
<td>010</td>
<td>&#x7EBF;&#x7A0B;&#x6C60;&#x5173;&#x95ED;&#x7684;&#x540E;&#x5904;&#x7406;&#x72B6;&#x6001;</td>
</tr>
<tr>
<td>terminated</td>
<td>011</td>
<td>&#x7EC8;&#x6B62;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x624D;&#x662F;&#x6700;&#x7EC8;&#x5173;&#x95ED;</td>
</tr>
</tbody></table>
<a id="more"></a>

<p><strong>&#x4ECE;&#x4E0A;&#x56FE;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x5904;&#x4E8E;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x5176;ctl&#x503C;&#x4E3A;&#x8D1F;&#x6570;&#xFF0C;&#x5E76;&#x4E14;&#x72B6;&#x6001;&#x4ECE;&#x4E0A;&#x5F80;&#x4E0B;&#xFF0C;&#x6570;&#x503C;&#x662F;&#x4F9D;&#x6B21;&#x53D8;&#x5927;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x6570;&#x503C;&#x7684;&#x5927;&#x5C0F;&#x6765;&#x5224;&#x65AD;&#x7EBF;&#x7A0B;&#x7684;&#x72B6;&#x6001;</strong></p>
<ul>
<li>&#x72B6;&#x6001;&#x8F6C;&#x5316;&#x56FE;&#xFF1A;</li>
</ul>
<p><img src="/2020/thread-pool-executor-yuan-ma/threadpool.png" alt></p>
<ul>
<li>&#x4E0E;&#x72B6;&#x6001;&#x76F8;&#x5173;&#x7684;&#x65B9;&#x6CD5;<br>&#x6B64;&#x7C7B;&#x65B9;&#x6CD5;&#xFF0C;&#x57FA;&#x672C;&#x90FD;&#x662F;&#x6839;&#x636E;ctl&#x4E0E;&#x72B6;&#x6001;&#x503C;&#x6BD4;&#x8F83;&#x5927;&#x5C0F;&#x800C;&#x8BBE;&#x5B9A;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x62EC;</li>
</ul>
<table>
<thead>
<tr>
<th>&#x51FD;&#x6570;</th>
<th>&#x542B;&#x4E49;</th>
<th>&#x5B9E;&#x73B0;</th>
</tr>
</thead>
<tbody><tr>
<td>runStateOf(int c)</td>
<td>&#x6839;&#x636E;ctl&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x72B6;&#x6001;&#xFF0C;&#x5373;&#x53EA;&#x4FDD;&#x7559;&#x9AD8;&#x4E09;&#x4F4D;&#x7684;&#x503C;&#xFF0C;&#x540E;29&#x4F4D;&#x5168;&#x4E3A;0</td>
<td>c &amp; ~capacity</td>
</tr>
<tr>
<td>wokerCountOf(int c)</td>
<td>&#x6839;&#x636E;ctl&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x5373;&#x4F4E;29&#x4F4D;&#x7684;&#x503C;</td>
<td>c &amp; capacity</td>
</tr>
<tr>
<td>ctlOf(int rs, int wc)</td>
<td>&#x6839;&#x636E;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x548C;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x53CD;&#x63A8;&#x51FA;ctl&#x7684;&#x503C;&#xFF0C;&#x9AD8;&#x4E09;&#x4F4D;&#x4E0E;&#x4F4E;29&#x4F4D;&#x62FC;&#x63A5;</td>
<td>rs &#x6216;&#x64CD;&#x4F5C; wc</td>
</tr>
<tr>
<td>runStateLessThan(int c, int s)</td>
<td>&#x5F53;&#x524D;&#x72B6;&#x6001;&#x662F;&#x5426;&#x5C0F;&#x4E8E;s&#x72B6;&#x6001;</td>
<td>c &lt; s</td>
</tr>
<tr>
<td>runStateAtLeast(int c, int s)</td>
<td>&#x5F53;&#x524D;&#x72B6;&#x6001;&#x662F;&#x5426;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;s&#x72B6;&#x6001;</td>
<td>c &gt;= s</td>
</tr>
<tr>
<td>isRunning(int c)</td>
<td>&#x662F;&#x5426;&#x4E3A;&#x8FD0;&#x884C;&#x72B6;&#x6001;</td>
<td>c &lt; shutdown</td>
</tr>
<tr>
<td>compareAndIncrementWorkerCount(int expect)</td>
<td>CAS&#x64CD;&#x4F5C;+1&#xFF0C;&#x64CD;&#x4F5C;&#x4E0D;&#x4E00;&#x5B9A;&#x6210;&#x529F;</td>
<td>ctl.compareAndSet(expect, expect + 1)</td>
</tr>
<tr>
<td>compareAndDecrementWorkerCount(int expect)</td>
<td>CAS&#x64CD;&#x4F5C;-1&#xFF0C;&#x64CD;&#x4F5C;&#x4E0D;&#x4E00;&#x5B9A;&#x6210;&#x529F;</td>
<td>ctl.compareAndSet(expect, expect - 1)</td>
</tr>
<tr>
<td>decrementWorkerCount()</td>
<td>ctl&#x7684;&#x503C;-1&#xFF0C;&#x64CD;&#x4F5C;&#x4E00;&#x5B9A;&#x6210;&#x529F;</td>
<td>&#x5728;&#x6B7B;&#x5FAA;&#x73AF;&#x4E2D;&#x5904;&#x7406;&#xFF0C;&#x76F4;&#x5230;-1&#x64CD;&#x4F5C;&#x6210;&#x529F;</td>
</tr>
<tr>
<td>advanceRunState(int targetState)</td>
<td>&#x66F4;&#x65B0;&#x7EBF;&#x7A0B;&#x6C60;&#x72B6;&#x6001;&#xFF0C;&#x5FC5;&#x987B;&#x4FDD;&#x8BC1;&#x66F4;&#x65B0;&#x6210;&#x529F;</td>
<td>&#x5728;&#x6B7B;&#x5FAA;&#x73AF;&#x4E2D;&#x5904;&#x7406;</td>
</tr>
</tbody></table>
<p>&#x4E0A;&#x8FF0;&#x7684;&#x65B9;&#x6CD5;&#x5728;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5B9E;&#x73B0;&#x4E2D;&#x4F1A;&#x7ECF;&#x5E38;&#x7684;&#x4F7F;&#x7528;&#x5230;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x770B;&#x6E90;&#x7801;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x78B0;&#x5230;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x5230;&#x8BE5;&#x8868;&#x683C;&#x8FDB;&#x884C;&#x67E5;&#x770B; </p>
<h1 id="&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;">2. &#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;</h1><table>
<thead>
<tr>
<th>&#x7C7B;&#x578B;</th>
<th>&#x53D8;&#x91CF;&#x540D;</th>
<th>&#x4F5C;&#x7528;</th>
</tr>
</thead>
<tbody><tr>
<td>BlockingQueue<runnable></runnable></td>
<td>workQueue</td>
<td>&#x963B;&#x585E;&#x961F;&#x5217;&#xFF0C;&#x5F53;&#x7EBF;&#x7A0B;&#x6570;&#x8FBE;&#x5230;&#x89C4;&#x5B9A;&#x7EBF;&#x7A0B;&#x6570;&#x7684;&#x6700;&#x5927;&#x503C;&#x4E14;&#x6CA1;&#x6709;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;&#x4EFB;&#x52A1;&#x4F1A;&#x88AB;&#x6DFB;&#x52A0;&#x8BE5;&#x961F;&#x5217;&#x4E2D;</td>
</tr>
<tr>
<td>ReentrantLock</td>
<td>mainLock</td>
<td>&#x53EF;&#x91CD;&#x5165;&#x9501;&#xFF0C;&#x63A7;&#x5236;&#x5E76;&#x53D1;&#x64CD;&#x4F5C;</td>
</tr>
<tr>
<td>HashSet<worker></worker></td>
<td>workers</td>
<td>&#x5B58;&#x653E;&#x7EBF;&#x7A0B;&#x5BF9;&#x8C61;&#xFF0C;&#x5B9E;&#x73B0;&#x4E3A;HashSet&#xFF0C;&#x4E0D;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x64CD;&#x4F5C;&#x65F6;&#x52A0;&#x9501;</td>
</tr>
<tr>
<td>Condition</td>
<td>termination</td>
<td>mainLock&#x4E0A;&#x7684;&#x7B49;&#x5F85;&#x5BF9;&#x8C61;&#xFF0C;&#x7528;&#x4E8E;&#x963B;&#x585E;&#x548C;&#x5524;&#x9192;&#x8C03;&#x7528;awaitTermination()&#x65B9;&#x6CD5;&#x7684;&#x7EBF;&#x7A0B;</td>
</tr>
<tr>
<td>int</td>
<td>largestPoolSize</td>
<td>&#x8BB0;&#x5F55;&#x7EBF;&#x7A0B;&#x6C60;&#x5DF2;&#x5206;&#x914D;&#x7684;&#x6700;&#x5927;&#x7EBF;&#x7A0B;&#x6570;</td>
</tr>
<tr>
<td>long</td>
<td>completedTaskCount</td>
<td>&#x8BB0;&#x5F55;&#x7EBF;&#x7A0B;&#x6C60;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#x4E2A;&#x6570;</td>
</tr>
<tr>
<td>volatile ThreadFactory</td>
<td>threadFactory</td>
<td>&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x7EBF;&#x7A0B;&#x540D;&#x3001;&#x7EBF;&#x7A0B;&#x7EC4;&#x3001;&#x4F18;&#x5148;&#x7EA7;&#x7B49;&#x5C5E;&#x6027;</td>
</tr>
<tr>
<td>volatile RejectedExecutionHandler</td>
<td>handler</td>
<td>&#x62D2;&#x7EDD;&#x7B56;&#x7565;</td>
</tr>
<tr>
<td>volatile long</td>
<td>keepAliveTime</td>
<td>&#x5141;&#x8BB8;&#x6700;&#x5927;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;</td>
</tr>
<tr>
<td>volatile boolean</td>
<td>allowCoreThreadTimeOut</td>
<td>&#x662F;&#x5426;&#x5141;&#x8BB8;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x8D85;&#x65F6;</td>
</tr>
<tr>
<td>volatile int</td>
<td>corePoolSize</td>
<td>&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6570;</td>
</tr>
<tr>
<td>volatile int</td>
<td>maximumPoolSize</td>
<td>&#x6700;&#x5927;&#x7EBF;&#x7A0B;&#x6570;</td>
</tr>
<tr>
<td>RejectedExecutionHandler</td>
<td>defaultHandler</td>
<td>&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</td>
</tr>
</tbody></table>
<p><strong>&#x6CE8;&#x610F;volatile&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x4F5C;&#x7528;&#x662F;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x53EF;&#x89C1;&#x6027;&#x3002;&#x5BF9;&#x4E8E;&#x6CA1;&#x6709;volatile&#x4FEE;&#x9970;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x73AF;&#x5883;&#x4E0B;&#x64CD;&#x4F5C;&#xFF0C;&#x5FC5;&#x987B;&#x52A0;&#x9501;&#x64CD;&#x4F5C;&#xFF0C;&#x8FDB;&#x800C;&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x53EF;&#x89C1;&#x6027;</strong>&#x3002; </p>
<h1 id="&#x7EBF;&#x7A0B;&#x7C7B;-Worker">3. &#x7EBF;&#x7A0B;&#x7C7B;-Worker</h1><p>Woker&#x7C7B;&#x5177;&#x6709;&#x4E24;&#x91CD;&#x8EAB;&#x4EFD;<br>&#xFF08;1&#xFF09; Runnable&#x5BF9;&#x8C61;<br>Worker&#x5185;&#x90E8;&#x5C01;&#x88C5;&#x4E86;&#x7EBF;&#x7A0B;&#x5BF9;&#x8C61;thread&#x548C;&#x4EFB;&#x52A1;firstTask&#xFF0C;&#x800C;&#x81EA;&#x5DF1;&#x672C;&#x8EAB;&#x53C8;&#x662F;&#x7EBF;&#x7A0B;&#x5BF9;&#x8C61;thread&#x7684;&#x6267;&#x884C;&#x5BF9;&#x8C61;&#x3002;thread&#x6BCF;&#x5904;&#x7406;&#x5B8C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x4E4B;&#x540E;&#xFF0C;&#x4FBF;&#x4F1A;&#x53BB;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x5C31;&#x4F1A;&#x7B49;&#x5F85;&#xFF0C;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x5230;&#x4EFB;&#x52A1;&#x5C31;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;<br>&#xFF08;2&#xFF09;&#x9501;&#x5BF9;&#x8C61;-&#x975E;&#x53EF;&#x91CD;&#x5165;&#x4E92;&#x65A5;&#x9501;<br>Worker&#x7C7B;&#x7EE7;&#x627F;&#x4E86;AbstractQueuedSynchronizer&#x7C7B;&#xFF0C;&#x8BF4;&#x660E;Worker&#x4E5F;&#x5177;&#x6709;&#x9501;&#x7684;&#x7279;&#x6027;&#x3002;&#x540C;&#x4E00;&#x4E2A;&#x65F6;&#x523B;&#xFF0C;&#x53EA;&#x80FD;&#x7531;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;&#x3002;&#x4ECE;&#x5176;&#x5B9E;&#x73B0;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x8BE5;&#x9501;&#x4E0D;&#x652F;&#x6301;&#x91CD;&#x5165;&#x3002; </p>
<ul>
<li>Worker&#x7C7B;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;</li>
</ul>
<table>
<thead>
<tr>
<th>&#x7C7B;&#x578B;</th>
<th>&#x53D8;&#x91CF;&#x540D;</th>
<th>&#x4F5C;&#x7528;</th>
</tr>
</thead>
<tbody><tr>
<td>Thread</td>
<td>thread</td>
<td>&#x7531;threadFactory&#x521B;&#x5EFA;</td>
</tr>
<tr>
<td>Runnable</td>
<td>firstTask</td>
<td>&#x7531;&#x7EBF;&#x7A0B;&#x6C60;&#x4F7F;&#x7528;&#x8005;&#x63D0;&#x4EA4;&#xFF08;submit()&#x6216;&#x8005;execute()&#xFF09;&#x4EFB;&#x52A1;</td>
</tr>
<tr>
<td>volatile long</td>
<td>completedTasks</td>
<td>&#x8BE5;thread&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#x6570;&#xFF0C;&#x7528;&#x4E8E;&#x7EDF;&#x8BA1;</td>
</tr>
</tbody></table>
<ul>
<li>&#x6784;&#x9020;&#x51FD;&#x6570;</li>
</ul>
<p>&#x5728;Worker&#x5BF9;&#x8C61;&#x6784;&#x9020;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x8C03;&#x7528;run()&#x65B9;&#x6CD5;&#xFF08;&#x6B64;&#x5904;&#x7684;run&#x6307;&#x7684;&#x662F;Worker&#x7684;run(),&#x8BE5;&#x65B9;&#x6CD5;&#x7531;&#x7EBF;&#x7A0B;&#x6C60;&#x5728;&#x6DFB;&#x52A0;Worker&#x65F6;&#x542F;&#x52A8;&#x7EBF;&#x7A0B;&#x5BF9;&#x8C61;thread&#x65F6;&#x4E3B;&#x52A8;&#x8C03;&#x7528;&#xFF09;&#x4E4B;&#x524D;&#xFF0C;&#x5176;Worker&#x5BF9;&#x8C61;&#x5904;&#x4E8E;&#x4E0D;&#x53EF;&#x88AB;&#x83B7;&#x53D6;&#x72B6;&#x6001;&#xFF08;&#x5373;&#x9501;&#x7684;state&#x4F4D;-1&#xFF0C; 0&#x8868;&#x793A;&#x53EF;&#x4EE5;&#x88AB;&#x83B7;&#x53D6;&#xFF0C; 1&#x8868;&#x793A;&#x9501;&#x88AB;&#x5360;&#x7528;&#xFF09;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x7981;&#x6B62;&#x4E2D;&#x65AD;&#xFF08;&#x52A0;&#x9501;&#x7684;&#x5730;&#x65B9;&#x7981;&#x6B62;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF0C;&#x53EA;&#x6709;&#x5728;state&#x4E3A;0&#x65F6;&#x624D;&#x4F1A;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF09;&#xFF0C;&#x5176;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A; </p>
<pre><code>Worker(Runnable firstTask) {
    setState(-1); // inhibit interrupts until runWorker
    this.firstTask = firstTask;
   //this&#x4F5C;&#x4E3A;Runnable&#x5BF9;&#x8C61;&#x53C2;&#x6570;&#x4F20;&#x7ED9;&#x7EBF;&#x7A0B;&#x7C7B;&#xFF0C;&#x90A3;&#x4E48;&#x7EBF;&#x7A0B;&#x7C7B;&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x6267;&#x884C;&#x7684;&#x5C31;&#x662F;Worker&#x7684;run()&#x65B9;&#x6CD5;
    this.thread = getThreadFactory().newThread(this);
}</code></pre><p>&#x8BBE;&#x7F6E;&#x9501;&#x7684;&#x72B6;&#x6001;&#x4E3A;-1&#xFF0C;&#x5E76;&#x5BF9;&#x4EFB;&#x52A1;&#x548C;&#x7EBF;&#x7A0B;&#x8D4B;&#x503C;&#x3002; </p>
<ul>
<li>run()&#x65B9;&#x6CD5;</li>
</ul>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x8C03;&#x7528;&#x4E86;runWorker(this);&#x800C;runWorker()&#x65B9;&#x6CD5;&#x5C06;&#x662F;&#x672C;&#x8282;&#x7684;&#x8BA8;&#x8BBA;&#x7684;&#x91CD;&#x70B9;&#x65B9;&#x6CD5;&#x3002;&#x8BF7;&#x8010;&#x5FC3;&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x770B;&#x3002; </p>
<ul>
<li>&#x4E0E;&#x9501;&#x76F8;&#x5173;&#x7684;&#x65B9;&#x6CD5;</li>
</ul>
<p>&#x65B9;&#x6CD5;&#x4F5C;&#x7528;</p>
<table>
<thead>
<tr>
<th>&#x65B9;&#x6CD5;</th>
<th>&#x4F5C;&#x7528;</th>
</tr>
</thead>
<tbody><tr>
<td>isHeldExclusively</td>
<td>&#x9501;&#x662F;&#x5426;&#x5DF2;&#x88AB;&#x5360;&#x6709;</td>
</tr>
<tr>
<td>tryAcquire</td>
<td>&#x5728;&#x8C03;&#x7528;lock()&#x65B9;&#x6CD5;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x95F4;&#x63A5;&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x72B6;&#x6001;&#x4E3A;0&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#xFF0C;&#x5426;&#x5219;&#x963B;&#x585E;&#x7B49;&#x5F85;</td>
</tr>
<tr>
<td>tryRelease</td>
<td>unlock()&#x65F6;&#x95F4;&#x63A5;&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x7531;&#x4E8E;&#x662F;&#x4E92;&#x65A5;&#x9501;&#xFF0C;&#x53EA;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#xFF0C;&#x4FEE;&#x6539;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x65E0;&#x9700;&#x4F7F;&#x7528;CAS&#xFF0C;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x7ADE;&#x4E89;</td>
</tr>
</tbody></table>
<p>&#x4E0A;&#x8FF0;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x5B9E;&#x73B0;AbstractQueuedSynchronizer&#x91CD;&#x5199;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4E0D;&#x63D0;&#x4F9B;&#x7ED9;&#x5916;&#x754C;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#xFF0C;&#x5916;&#x754C;&#x5E94;&#x8BE5;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#x65B9;&#x6CD5;&#xFF1A; </p>
<table>
<thead>
<tr>
<th>&#x65B9;&#x6CD5;</th>
<th>&#x4F5C;&#x7528;</th>
</tr>
</thead>
<tbody><tr>
<td>lock</td>
<td>&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x963B;&#x585E;&#x65B9;&#x6CD5;&#xFF0C;&#x5F53;&#x83B7;&#x53D6;&#x9501;&#x65F6;&#x624D;&#x4F1A;&#x8FD4;&#x56DE;&#x3002;&#x8C03;&#x7528;acquire()&#x65B9;&#x6CD5;&#xFF0C;&#x6B64;&#x5904;&#x5176;&#x53C2;&#x6570;1&#x6CA1;&#x6709;&#x7528;&#x3002;&#x95F4;&#x63A5;&#x8C03;&#x7528;tryAcquire&#x65B9;&#x6CD5;</td>
</tr>
<tr>
<td>tryLock</td>
<td>&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x5426;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x90FD;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</td>
</tr>
<tr>
<td>unLock</td>
<td>&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x8C03;&#x7528;release()&#x65B9;&#x6CD5;&#xFF0C;&#x95F4;&#x63A5;&#x8C03;&#x7528;tryRelease()&#x65B9;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x6240;&#x4EE5;&#x91CA;&#x653E;&#x65F6;&#x4E0D;&#x5B58;&#x5728;&#x7ADE;&#x4E89;&#x5173;&#x7CFB;</td>
</tr>
<tr>
<td>isLocked</td>
<td>&#x5224;&#x65AD;&#x9501;&#x662F;&#x5426;&#x88AB;&#x5360;&#x7528;&#xFF0C;&#x8C03;&#x7528;isHeldExclusively()&#x65B9;&#x6CD5;</td>
</tr>
</tbody></table>
<p>&#x4E0A;&#x8FF0;&#x65B9;&#x6CD5;&#x7C7B;&#x5916;&#x90E8;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x3002; </p>
<ul>
<li>interruptIfStarted()&#x65B9;&#x6CD5;</li>
</ul>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x5728;&#x8C03;&#x7528;shutdownNow()&#x65B9;&#x6CD5;&#x65F6;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x7528;&#x4E8E;&#x7EC8;&#x6B62;&#x7EBF;&#x7A0B;&#x3002;&#x5176;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">void</span> <span class="built_in">int</span>erruptIfStarted() {</span><br><span class="line">    Thread t;</span><br><span class="line">    <span class="keyword">if</span> (getState() &gt;= <span class="number">0</span> &amp;&amp; (t = thread) != <span class="literal">null</span> &amp;&amp; !t.isInterrupted()) {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        t.<span class="built_in">int</span>errupt();</span><br><span class="line">    } <span class="keyword">catch</span> (SecurityException ignore) {</span><br><span class="line">    }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5F53;&#x7EBF;&#x7A0B;&#x5728;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;&#x4E14;&#x7EBF;&#x7A0B;&#x4E0D;&#x4E3A;null&#xFF0C;&#x7EBF;&#x7A0B;&#x6CA1;&#x6709;&#x88AB;&#x4E2D;&#x65AD;&#xFF0C;&#x5219;&#x4E2D;&#x65AD;&#x7EBF;&#x7A0B;&#xFF0C;&#x4F46;&#x662F;&#x8BE5;&#x4E2D;&#x65AD;&#x4E0D;&#x4F1A;&#x7ACB;&#x5373;&#x54CD;&#x5E94;&#xFF0C;&#x56E0;&#x4E3A;work&#x5B9A;&#x4E49;&#x7684;&#x9501;&#x4E3A;&#x4E0D;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x7684;&#x9501;&#xFF0C;&#x5F53;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x91CA;&#x653E;&#x9501;&#x4E4B;&#x540E;&#x624D;&#x4F1A;&#x54CD;&#x5E94;&#x8BE5;&#x4E2D;&#x65AD;&#x3002; </p>
<p><strong>&#x603B;&#x7ED3;&#xFF1A;Worker&#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;getThreadFactory().newThread(this)&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;;this&#x5C31;&#x662F;Worker&#x5BF9;&#x8C61;&#xFF0C;&#x4E00;&#x4E2A;Runnable&#x5BF9;&#x8C61;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x6267;&#x884C;&#x8BE5;&#x7EBF;&#x7A0B;&#x7684;start()&#x65B9;&#x6CD5;&#xFF0C;&#x6267;&#x884C;&#x7684;&#x5C31;&#x662F;Worker&#x7C7B;&#x7684;run()&#x65B9;&#x6CD5;&#x3002;&#x5176;&#x6B21;&#xFF0C;Worker&#x4F5C;&#x4E3A;&#x9501;&#x7684;&#x89D2;&#x8272;&#x6709;&#x4E24;&#x4E2A;&#x4F5C;&#x7528;&#xFF1A;&#x4E00;&#x662F;&#x5728;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;&#x52A0;&#x9501;lock()&#x6765;&#x5C4F;&#x853D;&#x5230;&#x4E2D;&#x65AD;&#x64CD;&#x4F5C;&#xFF0C;&#x53EA;&#x6709;&#x5728;unlock()&#x540E;,&#x4E5F;&#x5C31;&#x662F;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;getTask()&#x65B9;&#x6CD5;&#x91CC;&#xFF0C;&#x624D;&#x4F1A;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x4F5C;&#x7528;&#x662F;&#xFF0C;&#x5728;&#x7EBF;&#x7A0B;&#x6C60;&#x8C03;&#x7528;tryLock()&#x8BD5;&#x56FE;&#x4E2D;&#x65AD;&#x7EBF;&#x7A0B;&#x65F6;&#xFF0C;&#x53EA;&#x8981;&#x6709;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#xFF0C;tryLock()&#x5C31;&#x4F1A;&#x8FD4;&#x56DE;false&#xFF0C;&#x901A;&#x8FC7;tryLock()&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x7A7A;&#x95F2;&#x3002;</strong></p>
<h1 id="&#x7EBF;&#x7A0B;&#x6C60;&#x6784;&#x9020;&#x65B9;&#x6CD5;">4. &#x7EBF;&#x7A0B;&#x6C60;&#x6784;&#x9020;&#x65B9;&#x6CD5;</h1><p>&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6784;&#x9020;&#x90FD;&#x95F4;&#x63A5;&#x8C03;&#x7528;&#x8BE5;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;&#x9700;&#x8981;&#x5408;&#x7406;&#x7684;&#x8BBE;&#x7F6E;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x5185;&#x5BB9;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x5DF2;&#x7ECF;&#x8BB2;&#x8FC7;&#x4E86;&#xFF0C;&#x6B64;&#x5904;&#x4E0D;&#x518D;&#x8BB2;&#x89E3;&#x3002; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">            keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.acc = System.getSecurityManager() == <span class="keyword">null</span> ?</span><br><span class="line">            <span class="keyword">null</span> :</span><br><span class="line">            AccessController.getContext();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="execute-Runnable-command-&#x65B9;&#x6CD5;">5. execute(Runnable command)&#x65B9;&#x6CD5;</h1><ul>
<li>&#x5904;&#x7406;&#x903B;&#x8F91;</li>
</ul>
<ol>
<li>&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E2A;&#x6570; &lt; corePoolSize, &#x5219;&#x65B0;&#x589E;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;(addWorker(command, true))&#x6267;&#x884C;&#x8BE5;&#x4EFB;&#x52A1;&#xFF0C;&#x6210;&#x529F;&#x5219;&#x8FD4;&#x56DE;</li>
<li>&#x5982;&#x679C;&#x6DFB;&#x52A0;&#x5931;&#x8D25;&#xFF0C;&#x5E76;&#x4E14;&#x4E3A;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x8BF4;&#x660E;&#x7EBF;&#x7A0B;&#x4E2A;&#x6570;&#x5DF2;&#x7ECF;&gt;=corePoolSize&#xFF0C;&#x5219;&#x6267;&#x884C;&#x7B2C;4&#x6B65;</li>
<li>&#x5982;&#x679C;&#x6DFB;&#x52A0;&#x5931;&#x8D25;&#xFF0C;&#x5E76;&#x4E14;&#x4E3A;&#x975E;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x5219;&#x6267;&#x884C;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</li>
<li>&#x5982;&#x679C;&#x662F;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x4E14;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&gt;=corePoolSize&#xFF0C;&#x5219;&#x5C06;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;</li>
<li>&#x5982;&#x679C;&#x7B2C;4&#x6B65;&#x6DFB;&#x52A0;&#x963B;&#x585E;&#x961F;&#x5217;&#x5931;&#x8D25;&#xFF0C;&#x8BF4;&#x660E;&#x963B;&#x585E;&#x961F;&#x5217;&#x6EE1;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&lt;maximumPoolSize,&#x5219;&#x65B0;&#x589E;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x8BE5;&#x4EFB;&#x52A1;</li>
<li>&#x5982;&#x679C;&#x7B2C;5&#x6B65;&#x4E2D;&#x65B0;&#x589E;&#x7EBF;&#x7A0B;&#x5931;&#x8D25;&#xFF08;&#x8FD9;&#x91CC;&#x5305;&#x62EC;2,3&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF08;2&#x7684;&#x8BDD;&#x5C31;&#x662F;&gt;=maximumPoolSize&#xFF09;&#xFF09;&#xFF0C;&#x5219;&#x6267;&#x884C;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</li>
</ol>
<p>&#x66F4;&#x52A0;&#x8BE6;&#x7EC6;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x8BF7;&#x53C2;&#x7167;&#x6E90;&#x7801;&#x6CE8;&#x91CA;&#x7406;&#x89E3;&#xFF0C;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (command == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">    <span class="comment">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&lt;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6570;</span></span><br><span class="line">    <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) {</span><br><span class="line">        <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        c = ctl.get();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//&#x4EE3;&#x7801;&#x6267;&#x884C;&#x5230;&#x8FD9;&#xFF0C;&#x5B58;&#x5728;&#x4E24;&#x79CD;&#x60C5;&#x51B5;</span></span><br><span class="line">    <span class="comment">//1. &#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&gt;=&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6570;</span></span><br><span class="line">    <span class="comment">//2. &#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&lt;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x6DFB;&#x52A0;Worker&#x5931;&#x8D25;&#xFF0C;&#x5931;&#x8D25;&#x53C8;&#x6709;&#x5982;&#x4E0B;&#x60C5;&#x51B5;</span></span><br><span class="line">    <span class="comment">//2.1 &#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x72B6;&#x6001;&#x4E3A;stop&#xFF0C;tidying&#xFF0C;terminated</span></span><br><span class="line">    <span class="comment">//2.2 shutdown command&#x4E0D;&#x4E3A;null</span></span><br><span class="line">    <span class="comment">//2.3 shutdown command&#x4E3A;null&#xFF0C; &#x963B;&#x585E;&#x961F;&#x5217;&#x4E5F;&#x4E3A;&#x7A7A;&#xFF08;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x5728;&#x8FD9;&#x91CC;&#xFF09;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x5982;&#x679C;&#x662F;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x8BF4;&#x660E;&#x5C5E;&#x4E8E;1&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#xFF0C;&#x6B64;&#x5904;&#x4F7F;&#x7528;offer()&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) {</span><br><span class="line">        <span class="comment">//&#x5373;&#x4FBF;&#x6DFB;&#x52A0;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x91CD;&#x65B0;&#x9A8C;&#x8BC1;&#x4E00;&#x4E0B;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x72B6;&#x6001;&#x4E3A;&#x975E;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x5219;&#x4E00;&#x5904;&#x8BE5;&#x4EFB;&#x52A1;&#xFF0C;&#x6267;&#x884C;&#x51B3;&#x7EDD;&#x7B56;&#x7565;</span></span><br><span class="line">        <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">        <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">            reject(command);</span><br><span class="line">        <span class="comment">//&#x5982;&#x679C;&#x662F;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x4FDD;&#x8BC1;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x5B58;&#x5728;</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">            addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x5B58;&#x5728;&#x4E24;&#x79CD;&#x60C5;&#x51B5;</span></span><br><span class="line">    <span class="comment">//1. &#x4E0D;&#x662F;&#x8FD0;&#x884C;&#x72B6;&#x6001; &#x4E5F;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x7684;2&#x7684;&#x60C5;&#x51B5;&#xFF08;&#x6DFB;&#x52A0;worker&#x5931;&#x8D25;&#x7684;&#xFF09;&#xFF0C;&#x518D;&#x6B21;&#x8C03;&#x7528;&#x4ECD;&#x7136;&#x4F1A;&#x5931;&#x8D25;</span></span><br><span class="line">    <span class="comment">//2. &#x6DFB;&#x52A0;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#x5931;&#x8D25;&#x7684;&#xFF0C;&#x8BF4;&#x660E;&#x963B;&#x585E;&#x961F;&#x5217;&#x6EE1;</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>))</span><br><span class="line">        <span class="comment">//1&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x80AF;&#x5B9A;&#x4F1A;&#x6267;&#x884C;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</span></span><br><span class="line">        <span class="comment">//2&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x8FBE;&#x5230;&#x7EBF;&#x7A0B;&#x6570;&#x4E0A;&#x9650;&#xFF0C;&#x540C;&#x6837;&#x4F1A;&#x6267;&#x884C;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</span></span><br><span class="line">        reject(command);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x603B;&#x7ED3;&#xFF1A;<strong>&#x5F53;&#x7EBF;&#x7A0B;&#x72B6;&#x6001;&#x4E0D;&#x4E3A;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x65F6;&#xFF08;&#x4E0D;&#x7BA1;&#x662F;shutdown&#x8FD8;&#x662F;stop&#xFF09;&#xFF1A;&#x90FD;&#x4F1A;&#x6267;&#x884C;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#xFF08;&#x8FD9;&#x4E0D;&#x662F;&#x7EDD;&#x5BF9;&#x7684;&#xFF0C;shutdown&#x72B6;&#x6001;&#x4E0B;&#xFF0C;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x7684;&#xFF08;&#x6761;&#x4EF6;&#x4E3A;shutdown&#x72B6;&#x6001;&#x4E0B; command==null &#x4E14; &#x963B;&#x585E;&#x961F;&#x5217;&#x975E;&#x7A7A;&#xFF0C;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x8BE5;&#x6761;&#x4EF6;&#xFF0C;&#x56E0;&#x4E3A;command&#x505A;&#x4E86;&#x975E;&#x7A7A;&#x5224;&#x65AD;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x8BA8;&#x8BBA;&#x5206;&#x652F;&#x903B;&#x8F91;&#xFF0C;&#x4E0D;&#x8981;&#x8003;&#x8651;addWorker(null, false));&#x8FD9;&#x6761;&#x8BED;&#x53E5;&#xFF09;&#xFF0C;&#x4F46;&#x662F;stop&#x72B6;&#x6001;&#x5374;&#x4E0D;&#x53EF;&#x4EE5;&#xFF09;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF1A;&#x6267;&#x884C;shutdown()&#x6216;&#x8005;shutdownNow()&#x540E;&#xFF0C;&#x4E0D;&#x80FD;&#x591F;&#x518D;&#x63D0;&#x4EA4;&#x65B0;&#x4EFB;&#x52A1;</strong></p>
<h1 id="addWorker-Runnable-firstTask-boolean-core-&#x65B9;&#x6CD5;">6. addWorker(Runnable firstTask, boolean core)&#x65B9;&#x6CD5;</h1><p>&#x5728;execute()&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x591A;&#x6B21;&#x8C03;&#x7528;&#x4E86;addWorker()&#x65B9;&#x6CD5;&#xFF0C;addWorker()&#x65B9;&#x6CD5;&#x51B3;&#x5B9A;&#x4E86;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x7684;&#x6761;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x7B26;&#x5408;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x6761;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x5148;&#x4FDD;&#x8BC1;&#x5C06;ctl&#x7684;&#x503C;&#x52A0;1&#xFF0C;&#x7136;&#x540E;&#x4FDD;&#x8BC1;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x542F;&#x52A8;&#x8BE5;&#x7EBF;&#x7A0B;&#x3002; </p>
<p>&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addWorker</span><span class="params">(Runnable firstTask, <span class="keyword">boolean</span> core)</span> </span>{</span><br><span class="line">    <span class="comment">//&#x5728;&#x6B7B;&#x5FAA;&#x73AF;&#x4E2D;&#x4E0D;&#x65AD;&#x5224;&#x65AD;&#x6761;&#x4EF6;&#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;</span></span><br><span class="line">    <span class="comment">//&#x5982;&#x679C;&#x4E0D;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x554A;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;false</span></span><br><span class="line">    <span class="comment">//&#x5982;&#x679C;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#xFF0C;&#x5219;ctl&#x503C;+1</span></span><br><span class="line">    retry:</span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// &#x4E0D;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;&#x4E09;&#x79CD;&#x60C5;&#x51B5;</span></span><br><span class="line">        <span class="comment">// 1. &#x8FD0;&#x884C;&#x72B6;&#x6001;&#x4E3A; stop, tidying, terminated</span></span><br><span class="line">        <span class="comment">// 2. &#x8FD0;&#x884C;&#x72B6;&#x6001;&#x4E3A; shutdown &#x4E14; &#x4EFB;&#x52A1;&#x4E0D;&#x4E3A;&#x7A7A;</span></span><br><span class="line">        <span class="comment">// 3. &#x8FD0;&#x884C;&#x72B6;&#x6001;&#x4E3A; shutdown &#x4EFB;&#x52A1;&#x4E3A;&#x7A7A; &#x4E14; &#x4EFB;&#x52A1;&#x7EBF;&#x7A0B;&#x4E3A;&#x7A7A;&#xFF08;&#x6CA1;&#x4E8B;&#x53EF;&#x505A;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x589E;&#x52A0;&#x7EBF;&#x7A0B;&#xFF09;</span></span><br><span class="line">        <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp;</span><br><span class="line">                ! (rs == SHUTDOWN &amp;&amp;</span><br><span class="line">                        firstTask == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">                        ! workQueue.isEmpty()))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x5230;&#x8FD9;&#xFF0C;&#x5B58;&#x5728;&#x4E24;&#x79CD;&#x60C5;&#x51B5;</span></span><br><span class="line">        <span class="comment">// 1. &#x8FD0;&#x884C;&#x72B6;&#x6001;&#x4E3A;running</span></span><br><span class="line">        <span class="comment">// 2. &#x8FD0;&#x884C;&#x72B6;&#x6001;&#x4E3A;shutdown&#xFF0C; &#x4EFB;&#x52A1;&#x4E3A;null&#xFF0C;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E0D;&#x4E3A;&#x7A7A;</span></span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line">            <span class="comment">//&#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x6570;&#x5DF2;&#x7ECF;&#x8FBE;&#x5230;&#x4E0A;&#x9650;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;false</span></span><br><span class="line">            <span class="keyword">if</span> (wc &gt;= CAPACITY ||</span><br><span class="line">                    wc &gt;= (core ? corePoolSize : maximumPoolSize))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">//&#x7EBF;&#x7A0B;&#x6570;ctl&#x503C;+1&#xFF0C; &#x8BBE;&#x7F6E;&#x5931;&#x8D25;&#x8BF4;&#x660E;&#x7EBF;&#x7A0B;&#x6C60;&#x73AF;&#x5883;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x8BD5;</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class="line">                <span class="keyword">break</span> retry;</span><br><span class="line">            c = ctl.get();  <span class="comment">// Re-read ctl</span></span><br><span class="line">            <span class="keyword">if</span> (runStateOf(c) != rs)</span><br><span class="line">                <span class="keyword">continue</span> retry;</span><br><span class="line">            <span class="comment">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x4EE3;&#x7801;&#x6267;&#x884C;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x8BF4;&#x660E;&#x7EBF;&#x7A0B;&#x6570;&#x5DF2;&#x7ECF;&#x6210;&#x529F;+1&#xFF0C; &#x73B0;&#x5728;&#x8981;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;worker&#xFF0C;&#x5E76;&#x6267;&#x884C;</span></span><br><span class="line">    <span class="comment">//&#x6807;&#x8BB0;worker&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x542F;&#x52A8;</span></span><br><span class="line">    <span class="keyword">boolean</span> workerStarted = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//&#x6807;&#x8BB0;worker&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;</span></span><br><span class="line">    <span class="keyword">boolean</span> workerAdded = <span class="keyword">false</span>;</span><br><span class="line">    Worker w = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">       <span class="comment">//&#x65B0;&#x5EFA;worker&#x5BF9;&#x8C61;</span></span><br><span class="line">        w = <span class="keyword">new</span> Worker(firstTask);</span><br><span class="line">        <span class="keyword">final</span> Thread t = w.thread;</span><br><span class="line">        <span class="keyword">if</span> (t != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x83B7;&#x53D6;&#x5168;&#x5C40;&#x9501;&#xFF0C;&#x56E0;&#x4E3A;&#x5B58;&#x653E;worker&#x7684;&#x5BF9;&#x8C61;workers&#x7684;&#x5B9E;&#x73B0;&#x662F;HashSet&#x7C7B;&#x578B;&#x7684;&#xFF0C;&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#xFF0C;&#x4F7F;&#x7528;&#x65F6;&#x9700;&#x8981;&#x52A0;&#x9501;</span></span><br><span class="line">            <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">            mainLock.lock();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">int</span> rs = runStateOf(ctl.get());</span><br><span class="line">                <span class="comment">//&#x518D;&#x6B21;&#x5224;&#x65AD;&#x7EBF;&#x7A0B;&#x6C60;&#x88C5;&#x586B;</span></span><br><span class="line">                <span class="comment">//1. &#x8FD0;&#x884C;&#x65F6;&#x72B6;</span></span><br><span class="line">                <span class="comment">//2. shutdown &#x4E14; &#x4EFB;&#x52A1;&#x4E3A;&#x7A7A;&#xFF0C;&#x624D;&#x80FD;&#x6267;&#x884C;&#x6DFB;&#x52A0;&#x64CD;&#x4F5C;</span></span><br><span class="line">                <span class="keyword">if</span> (rs &lt; SHUTDOWN ||</span><br><span class="line">                        (rs == SHUTDOWN &amp;&amp; firstTask == <span class="keyword">null</span>)) {</span><br><span class="line">                    <span class="comment">//&#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8FD8;&#x6CA1;&#x6709;&#x6267;&#x884C;start()</span></span><br><span class="line">                    <span class="keyword">if</span> (t.isAlive()) <span class="comment">// precheck that t is startable</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">                    <span class="comment">//&#x6240;&#x6709;&#x7684;&#x4E8B;&#x60C5;&#x90FD;&#x4E3A;&#x4E86;&#x8FD9;&#x4E00;&#x53E5;&#xFF0C;&#x6DFB;&#x52A0;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;</span></span><br><span class="line">                    workers.add(w);</span><br><span class="line">                    <span class="keyword">int</span> s = workers.size();</span><br><span class="line">                    <span class="keyword">if</span> (s &gt; largestPoolSize)</span><br><span class="line">                        largestPoolSize = s;</span><br><span class="line">                    workerAdded = <span class="keyword">true</span>;</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                mainLock.unlock();</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//&#x5982;&#x679C;&#x6DFB;&#x52A0;&#x6210;&#x529F;&#x5219;&#x542F;&#x52A8;&#x8BE5;&#x7EBF;&#x7A0B;&#xFF0C;&#x7EBF;&#x7A0B;&#x542F;&#x52A8;&#x540E;&#x4F1A;&#x6267;&#x884C;runWorker()&#x65B9;&#x6CD5;</span></span><br><span class="line">            <span class="keyword">if</span> (workerAdded) {</span><br><span class="line">                t.start();</span><br><span class="line">                workerStarted = <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="comment">//&#x5982;&#x679C;&#x6CA1;&#x6709;&#x542F;&#x52A8;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x5E94;&#x8BE5;&#x79FB;&#x9664;&#x8BE5;worker</span></span><br><span class="line">        <span class="keyword">if</span> (! workerStarted)</span><br><span class="line">            <span class="comment">//&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x5B58;&#x5728;ctl&#x503C;-1&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4FDD;&#x8BC1;&#x8BA1;&#x6570;&#x548C;&#x7EBF;&#x7A0B;&#x6570;&#x4E00;&#x81F4;</span></span><br><span class="line">            addWorkerFailed(w);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> workerStarted;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="addWorkerFailed-Worker-w-&#x65B9;&#x6CD5;">7. addWorkerFailed(Worker w)&#x65B9;&#x6CD5;</h1><p>&#x5F53;&#x6DFB;&#x52A0;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x5931;&#x8D25;&#x65F6;&#xFF08;&#x5E76;&#x4E0D;&#x662F;addWorker()&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;false&#xFF0C;&#x800C;&#x662F;workerStarted&#x8FD9;&#x4E2A;boolean&#x503C;&#x4E3A;false&#xFF09;&#xFF0C;&#x9700;&#x8981;&#x5220;&#x9664;&#x8BE5;worker&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;ctl&#x7684;&#x503C;-1 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addWorkerFailed</span><span class="params">(Worker w)</span> </span>{</span><br><span class="line">    <span class="comment">//&#x9700;&#x8981;&#x64CD;&#x4F5C;workers&#xFF0C;&#x7C7B;&#x578B;&#x4E3A;&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x7684;HashSet&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x52A0;&#x9501;</span></span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (w != <span class="keyword">null</span>)</span><br><span class="line">            workers.remove(w);</span><br><span class="line">        <span class="comment">//&#x6267;&#x884C;-1&#x64CD;&#x4F5C;&#xFF0C;&#x4FDD;&#x8BC1;-1&#x6210;&#x529F;</span></span><br><span class="line">        decrementWorkerCount();</span><br><span class="line">        <span class="comment">//&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x7EC8;&#x6B62;&#x6389;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x8BA9;&#x7EBF;&#x7A0B;&#x80FD;&#x591F;&#x8DF3;&#x51FA;runWorker()&#x65B9;&#x6CD5;&#x7684;&#x5FAA;&#x73AF;&#xFF0C;&#x800C;&#x6B63;&#x5E38;&#x6267;&#x884C;&#x5B8C;</span></span><br><span class="line">        <span class="comment">//shudown(),shutdownNow()&#x65B9;&#x6CD5;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x5F88;&#x91CD;&#x8981;</span></span><br><span class="line">        tryTerminate();</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="runWorker-Worker-w-&#x65B9;&#x6CD5;">8. runWorker(Worker w)&#x65B9;&#x6CD5;</h1><p>&#x5F53;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x542F;&#x52A8;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x6267;&#x884C;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x5C06;&#x4EFB;&#x52A1;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x52A0;&#x9501;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E0D;&#x88AB;&#x4E2D;&#x65AD;&#x3002;&#x901A;&#x8FC7;&#x4ECE;&#x963B;&#x585E;&#x961F;&#x5217;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x4E0D;&#x65AD;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x5F53;&#x83B7;&#x53D6;&#x7684;&#x4EFB;&#x52A1;&#x4E3A;null&#x65F6;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;&#x9000;&#x51FA;&#xFF0C;&#x9700;&#x8981;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x9000;&#x51FA;&#x540E;&#x7684;&#x540E;&#x5904;&#x7406;&#x903B;&#x8F91;&#x3002; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">runWorker</span><span class="params">(Worker w)</span> </span>{</span><br><span class="line">    <span class="comment">//&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5373;&#x4E3A;worker&#x4E2D;&#x5305;&#x542B;&#x7684;&#x7EBF;&#x7A0B;&#x5BF9;&#x8C61;</span></span><br><span class="line">    Thread wt = Thread.currentThread();</span><br><span class="line">    Runnable task = w.firstTask;</span><br><span class="line">    w.firstTask = <span class="keyword">null</span>;</span><br><span class="line">   <span class="comment">//&#x5C06;worker&#x7684;&#x9501;&#x72B6;&#x6001;&#x7F6E;&#x4E3A;0&#xFF0C;&#x8FD9;&#x6837;&#x9501;&#x53EF;&#x4EE5;&#x88AB;&#x83B7;&#x53D6;</span></span><br><span class="line">    w.unlock(); </span><br><span class="line">    <span class="comment">//&#x7528;&#x6765;&#x8868;&#x793A;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x4E3A;&#x6B63;&#x5E38;&#x9000;&#x51FA;&#xFF0C;true&#xFF1A;&#x975E;&#x6B63;&#x5E38;&#x9000;&#x51FA;&#xFF0C;false&#xFF1A;&#x6B63;&#x5E38;&#x9000;&#x51FA;</span></span><br><span class="line">    <span class="keyword">boolean</span> completedAbruptly = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">//&#x4E0D;&#x65AD;&#x7684;&#x4ECE;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#xFF08;getTask()&#xFF09;&#xFF0C; &#x5982;&#x679C;&#x963B;&#x585E;&#x961F;&#x91CC;&#x4E3A;&#x7A7A;&#xFF0C;getTask()&#x4F1A;&#x963B;&#x585E;</span></span><br><span class="line">        <span class="comment">//getTask&#x65B9;&#x6CD5;&#x5185;&#x6709;&#x8D85;&#x65F6;&#x5224;&#x65AD;&#xFF0C;&#x5982;&#x679C;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x591A;&#x4E86;&#xFF0C;&#x540C;&#x6837;&#x4F1A;&#x901A;&#x8FC7;&#x8D85;&#x65F6;&#x8FD4;&#x56DE;null&#xFF0C;&#x8BA9;&#x8BE5;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x5E76;&#x9000;&#x51FA;</span></span><br><span class="line">        <span class="comment">//&#x9047;&#x5230;&#x4E2D;&#x65AD;&#xFF0C;getTask()&#x4F1A;&#x8FD4;&#x56DE;null</span></span><br><span class="line">        <span class="comment">//getTask&#xFF08;&#xFF09;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;null&#xFF0C;&#x4F1A;&#x6B63;&#x5E38;&#x505C;&#x6B62;&#x8BE5;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;</span></span><br><span class="line">        <span class="keyword">while</span> (task != <span class="keyword">null</span> || (task = getTask()) != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//&#x52A0;&#x9501;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;&#x8BE5;&#x9501;&#xFF08;&#x4E3B;&#x8981;&#x662F;&#x8C03;&#x7528;shutdown()&#x65B9;&#x6CD5;&#x65F6;&#x4F1A;&#x6267;&#x884C;tryLock()&#x65B9;&#x6CD5;&#xFF09;</span></span><br><span class="line">            <span class="comment">//&#x52A0;&#x9501;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5C4F;&#x853D;&#x4E2D;&#x65AD;&#xFF0C;&#x5728;&#x52A0;&#x9501;&#x548C;&#x89E3;&#x9501;&#x4E4B;&#x95F4;&#x662F;&#x4E0D;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x7684;</span></span><br><span class="line">            w.lock();</span><br><span class="line">            <span class="comment">//&#x5982;&#x679C;&#x72B6;&#x6001;&#x4E3A;stop&#xFF0C; tidying&#xFF0C; terminated&#xFF0C;&#x5219;&#x4E2D;&#x65AD;</span></span><br><span class="line">            <span class="comment">//&#x5982;&#x679C;&#x4E3A;running&#xFF0C;shutdown&#x72B6;&#x6001;&#xFF0C;&#x4E14;&#x5B58;&#x5728;&#x4E2D;&#x65AD;&#x7684;&#x8BDD;&#xFF0C;&#x6E05;&#x7A7A;&#x4E2D;&#x65AD;&#x6807;&#x8BB0;</span></span><br><span class="line">            <span class="comment">//Thread.interrupted&#xFF08;&#xFF09;&#x65B9;&#x6CD5;&#x4F1A;&#x6E05;&#x9664;&#x4E2D;&#x65AD;&#x6807;&#x8BB0;</span></span><br><span class="line">            <span class="keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                    (Thread.interrupted() &amp;&amp;</span><br><span class="line">                            runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</span><br><span class="line">                    !wt.isInterrupted())</span><br><span class="line">                <span class="comment">//&#x8BE5;&#x4E2D;&#x65AD;&#x4F1A;&#x5728;getTask()&#x91CC;&#x4F53;&#x73B0;</span></span><br><span class="line">                wt.interrupt();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">//&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x524D;&#x7684;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x7A7A;&#x65B9;&#x6CD5;</span></span><br><span class="line">                beforeExecute(wt, task);</span><br><span class="line">                Throwable thrown = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    task.run();</span><br><span class="line">                } <span class="keyword">catch</span> (RuntimeException x) {</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                } <span class="keyword">catch</span> (Error x) {</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                } <span class="keyword">catch</span> (Throwable x) {</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> <span class="keyword">new</span> Error(x);</span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                     <span class="comment">//&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x7A7A;&#x65B9;&#x6CD5;</span></span><br><span class="line">                    afterExecute(task, thrown);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                task = <span class="keyword">null</span>;</span><br><span class="line">                w.completedTasks++;</span><br><span class="line">                w.unlock();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x4EE3;&#x7801;&#x8D70;&#x5230;&#x8FD9;&#x4EE3;&#x8868;&#x662F;&#x6839;&#x636E;getTask()&#x8FD4;&#x56DE;&#x503C;&#x4E3A;null&#x9000;&#x51FA;&#x7684;&#x5FAA;&#x73AF;</span></span><br><span class="line">        completedAbruptly = <span class="keyword">false</span>;</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="comment">//&#x7EBF;&#x7A0B;&#x9000;&#x51FA;&#xFF0C;&#x6267;&#x884C;&#x540E;&#x5904;&#x7406;&#x64CD;&#x4F5C;&#xFF0C;&#x4ECE;workers&#x4E2D;&#x5220;&#x9664;worker&#xFF0C;ctl&#x503C;-1</span></span><br><span class="line">        processWorkerExit(w, completedAbruptly);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x603B;&#x7ED3;&#xFF1A;&#x4ECE;&#x4E0A;&#x8FF0;&#x6E90;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;shutdown&#x72B6;&#x6001;&#x4E0D;&#x4F1A;&#x4E2D;&#x65AD;&#x7EBF;&#x7A0B;&#xFF0C;stop&#x72B6;&#x6001;&#x4F1A;&#x4E2D;&#x65AD;&#x7EBF;&#x7A0B;&#xFF0C;&#x8BF4;&#x660E;&#xFF1A;shutdown&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x8FD8;&#x4F1A;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;stop&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD9;&#x662F;&#x4E24;&#x4E2A;&#x72B6;&#x6001;&#x7684;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x533A;&#x522B;.</strong></p>
<h1 id="processWorkerExit-Worker-w-boolean-completedAbruptly-&#x65B9;&#x6CD5;">9. processWorkerExit(Worker w, boolean completedAbruptly)&#x65B9;&#x6CD5;</h1><p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x5904;&#x7406;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x7EBF;&#x7A0B;&#x7EC8;&#x6B62;&#x7684;&#x540E;&#x5904;&#x7406;&#x64CD;&#x4F5C;&#xFF0C;&#x5206;&#x4E3A;&#x6B63;&#x5E38;&#x4E2D;&#x65AD;&#x548C;&#x975E;&#x6B63;&#x5E38;&#x4E2D;&#x65AD;&#x4E24;&#x79CD;&#x3002;&#x5BF9;&#x4E8E;&#x975E;&#x6B63;&#x5E38;&#x4E2D;&#x65AD;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x65B0;&#x589E;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x7684;&#x65B9;&#x6CD5;&#x5C06;&#x7EBF;&#x7A0B;&#x8865;&#x56DE;&#x6765;&#xFF0C;&#x5BF9;&#x4E8E;&#x6B63;&#x5E38;&#x4E2D;&#x65AD;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x5728;&#x963B;&#x585E;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x7684;&#x60C5;&#x51B5;&#x6709;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x5B58;&#x5728;&#x3002; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processWorkerExit</span><span class="params">(Worker w, <span class="keyword">boolean</span> completedAbruptly)</span> </span>{</span><br><span class="line">    <span class="comment">//&#x5982;&#x679C;&#x662F;&#x975E;&#x6B63;&#x5E38;&#x554A;&#x4E2D;&#x65AD;&#xFF0C;&#x90A3;&#x4E48;&#x5148;&#x5C06;ctl&#x503C;-1</span></span><br><span class="line">    <span class="keyword">if</span> (completedAbruptly)</span><br><span class="line">        decrementWorkerCount();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x83B7;&#x53D6;&#x5168;&#x5C40;&#x9501;&#xFF0C;&#x4ECE;workers&#x4E2D;&#x5220;&#x9664;worker&#xFF0C;&#x5220;&#x9664;&#x524D;&#x5C06;&#x8BE5;worker&#x7684;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#x6570;&#x6C47;&#x603B;&#x5230;completedTaskCount</span></span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        completedTaskCount += w.completedTasks;</span><br><span class="line">        workers.remove(w);</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//&#x53EA;&#x8981;&#x51CF;&#x5C11;worker&#x7684;&#x5730;&#x65B9;&#x90FD;&#x4F1A;&#x6267;&#x884C;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4F20;&#x64AD;&#x505C;&#x6B62;&#x4FE1;&#x53F7;</span></span><br><span class="line">    tryTerminate();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">    <span class="comment">//&#x5982;&#x679C;&#x72B6;&#x6001;&#x4E3A;running&#xFF0C; shutdown</span></span><br><span class="line">    <span class="keyword">if</span> (runStateLessThan(c, STOP)) {</span><br><span class="line">         <span class="comment">//&#x6B63;&#x5E38;&#x7EC8;&#x6B62;&#xFF0C;&#x90A3;&#x4E48;&#x5224;&#x65AD;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x65B0;&#x589E;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;</span></span><br><span class="line">        <span class="keyword">if</span> (!completedAbruptly) {</span><br><span class="line">            <span class="keyword">int</span> min = allowCoreThreadTimeOut ? <span class="number">0</span> : corePoolSize;</span><br><span class="line">            <span class="keyword">if</span> (min == <span class="number">0</span> &amp;&amp; ! workQueue.isEmpty())</span><br><span class="line">                min = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (workerCountOf(c) &gt;= min)</span><br><span class="line">                <span class="keyword">return</span>; <span class="comment">// replacement not needed</span></span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x5F02;&#x5E38;&#x7EC8;&#x6B62;&#x5BFC;&#x81F4;&#x5C11;&#x4E86;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E94;&#x8BE5;&#x5C06;&#x8BE5;&#x7EBF;&#x7A0B;&#x8865;&#x56DE;&#x6765;</span></span><br><span class="line">        addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x603B;&#x7ED3;&#xFF1A;&#x8BE5;&#x65B9;&#x6CD5;&#x53EA;&#x5728;&#x7EBF;&#x7A0B;&#x610F;&#x5916;&#x7EC8;&#x6B62;&#x65F6;&#xFF0C;ctl&#x503C;-1&#xFF0C;&#x90A3;&#x4E48;&#x7EBF;&#x7A0B;&#x6B63;&#x5E38;&#x7EC8;&#x6B62;&#x5C31;&#x4E0D;-1&#x4E86;&#x5417;&#xFF1F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x627E;&#x4E86;&#x597D;&#x4E45;&#xFF0C;&#x5176;&#x5B9E;&#x5728;runWorker()&#x65B9;&#x6CD5;&#x4E2D;&#x7684;getTask()&#x65B9;&#x6CD5;&#xFF0C;&#x5F53;&#x8BE5;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;null&#x65F6;&#xFF0C;&#x4EE3;&#x8868;&#x7740;&#x8BE5;&#x7EBF;&#x7A0B;&#x6B63;&#x5E38;&#x7EC8;&#x6B62;&#xFF0C;&#x5176;&#x4E2D;&#x9644;&#x52A0;&#x4E86;ctl-1&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x6B63;&#x5E38;&#x7EC8;&#x6B62;&#x7684;&#x7EBF;&#x7A0B;&#x7684;ctl-1&#x7684;&#x64CD;&#x4F5C;&#x662F;&#x5728;getTask()&#x65B9;&#x6CD5;&#x4E2D;&#x6267;&#x884C;&#x7684;</strong></p>
<h1 id="getTask-&#x65B9;&#x6CD5;">10. getTask()&#x65B9;&#x6CD5;</h1><p>&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x4ECE;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x4EFB;&#x52A1;&#x5C31;&#x4F1A;&#x963B;&#x585E;&#xFF0C;keepAliveTime&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x4F53;&#x73B0;&#x3002;&#x963B;&#x585E;&#x53C8;&#x5206;&#x4E3A;&#x4E24;&#x79CD; &#x6709;&#x9650;&#x963B;&#x585E;poll()&#x548C;&#x5B8C;&#x5168;&#x963B;&#x585E;take()&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x90FD;&#x4F1A;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF0C;(<strong>&#x4E2D;&#x65AD;&#x7684;&#x4F5C;&#x7528;&#x4E5F;&#x662F;&#x4ECE;&#x8FD9;&#x91CC;&#x4F53;&#x73B0;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x53EA;&#x6709;&#x5F53;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x72B6;&#x6001;&#x4E3A;stop&#xFF0C; tidying&#xFF0C;terminated&#xFF0C;shutdown&#x5E76;&#x4E14;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;&#x8BE5;&#x4E2D;&#x65AD;&#x624D;&#x6709;&#x6548;</strong>)&#xFF0C;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x540E;&#xFF0C;&#x4F1A;&#x91CD;&#x65B0;&#x6267;&#x884C;getTask()&#x65B9;&#x6CD5;&#x7684;&#x903B;&#x8F91;&#x3002;<strong>&#x5E76;&#x4E0D;&#x662F;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x5C31;&#x4F1A;&#x8FD4;&#x56DE;null&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x7EBF;&#x7A0B;&#x6C60;&#x72B6;&#x6001;&#x4E3A;running&#xFF0C;&#x6267;&#x884C;runWorker()&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x5728;&#x6267;&#x884C;getTask()&#x65B9;&#x6CD5;&#x65F6;&#x5C31;&#x6765;&#x4E86;&#x4E2D;&#x65AD;&#xFF08;&#x8BE5;&#x4E2D;&#x65AD;&#x4FE1;&#x53F7;&#x5E76;&#x6CA1;&#x6709;&#x88AB;runWork()&#x65B9;&#x6CD5;&#x7684;&#x903B;&#x8F91;&#x6E05;&#x9664;&#x6389;&#xFF09;&#xFF0C;&#x90A3;&#x4E48;&#x5C3D;&#x7BA1;getTask()&#x5904;&#x7406;&#x903B;&#x8F91;&#x91CD;&#x8BD5;&#xFF0C;&#x8FD8;&#x662F;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;null&#xFF0C;&#x505A;&#x4E86;&#x53CC;&#x91CD;&#x4FDD;&#x8BC1;&#x3002;</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Runnable <span class="title">getTask</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">//&#x6807;&#x8BB0;&#x662F;&#x5426;&#x8D85;&#x65F6;</span></span><br><span class="line">    <span class="keyword">boolean</span> timedOut = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//&#x8FD4;&#x56DE;&#x7A7A;&#x7684;&#x6761;&#x4EF6;&#xFF0C;&#x5B58;&#x5728;&#x4E24;&#x79CD;</span></span><br><span class="line">        <span class="comment">//1. &#x72B6;&#x6001;&#x4E3A;stop&#xFF0C; tidying&#xFF0C; terminated</span></span><br><span class="line">        <span class="comment">//2. &#x72B6;&#x6001;&#x4E3A;shutdown &#x4E14; &#x961F;&#x5217;&#x4E3A;&#x7A7A;</span></span><br><span class="line">        <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) {</span><br><span class="line">            <span class="comment">//ctl&#x7684;&#x503C;-1&#xFF0C;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x4E00;&#x5B9A;&#x8981;&#x91CD;&#x89C6;&#xFF0C;&#x7ECF;&#x5E38;&#x627E;&#x4E0D;&#x5230;&#x4ED6;</span></span><br><span class="line">            decrementWorkerCount();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">         <span class="comment">//&#x4EE3;&#x7801;&#x6267;&#x884C;&#x5230;&#x8FD9;&#xFF0C;&#x5B58;&#x5728;&#x4E24;&#x79CD;&#x60C5;&#x51B5;</span></span><br><span class="line">         <span class="comment">//1. running</span></span><br><span class="line">         <span class="comment">//2. shutdown &#x963B;&#x585E;&#x961F;&#x5217;&#x975E;&#x7A7A;</span></span><br><span class="line">        <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//&#x5224;&#x65AD;&#x662F;&#x5426;&#x5904;&#x7406;&#x8D85;&#x65F6;</span></span><br><span class="line">        <span class="keyword">boolean</span> timed = allowCoreThreadTimeOut || wc &gt; corePoolSize;</span><br><span class="line">        <span class="comment">//&#x5982;&#x679C;&#x9700;&#x8981;&#x51CF;&#x5C11;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#xFF08;&#x7EBF;&#x7A0B;&#x6570;&gt;maxinumPoolSize,&#x6216;&#x8005;&#x5904;&#x7406;&#x8D85;&#x65F6;&#x5E76;&#x8D85;&#x65F6;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF09;</span></span><br><span class="line">        <span class="comment">//&#x5E76;&#x4E14;&#x5B58;&#x5728;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x51CF;&#x5C11;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;null&#xFF0C;&#x7ED3;&#x675F;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;</span></span><br><span class="line">        <span class="keyword">if</span> ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut))</span><br><span class="line">                &amp;&amp; (wc &gt; <span class="number">1</span> || workQueue.isEmpty())) {</span><br><span class="line">            <span class="keyword">if</span> (compareAndDecrementWorkerCount(c))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F7F;&#x7528;&#x975E;&#x963B;&#x585E;&#x7684;&#x65B9;&#x6CD5;poll()&#xFF0C;&#x5426;&#x5219;&#x4F7F;&#x7528;&#x963B;&#x585E;&#x65B9;&#x6CD5;take()</span></span><br><span class="line">            Runnable r = timed ?</span><br><span class="line">                    workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :</span><br><span class="line">                    workQueue.take();</span><br><span class="line">            <span class="keyword">if</span> (r != <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> r;</span><br><span class="line">            <span class="comment">//&#x5982;&#x679C;&#x8D85;&#x65F6;&#x4E86;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;null&#xFF0C;&#x56E0;&#x4E3A;&#x8981;&#x786E;&#x4FDD;wc &gt; 1 || workQueue.isEmpty()</span></span><br><span class="line">            <span class="comment">//&#x6240;&#x4EE5;&#x53C8;&#x5FAA;&#x73AF;&#x4E86;&#x4E00;&#x6B21;</span></span><br><span class="line">            timedOut = <span class="keyword">true</span>;</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException retry) {</span><br><span class="line">            <span class="comment">//&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF0C;&#x91CD;&#x8BD5;</span></span><br><span class="line">            timedOut = <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="tryTerminate-&#x65B9;&#x6CD5;">11. tryTerminate()&#x65B9;&#x6CD5;</h1><p>&#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x5173;&#x95ED;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5173;&#x952E;&#xFF0C;&#x6D89;&#x53CA;&#x5230;&#x4E86;&#x4E09;&#x79CD;&#x72B6;&#x6001;&#x7684;&#x6539;&#x53D8;<br>&#x5177;&#x4F53;&#x7EC6;&#x8282;&#x8BF7;&#x67E5;&#x770B;&#x6E90;&#x7801;&#x6CE8;&#x91CA;&#xFF0C;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">tryTerminate</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">//&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x770B;&#x5230;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x8FD4;&#x56DE;&#x503C;</span></span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="comment">//&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x6709;3&#x79CD;&#x60C5;&#x51B5;</span></span><br><span class="line">        <span class="comment">// 1. &#x5982;&#x679C;&#x662F;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span></span><br><span class="line">        <span class="comment">// 2. &#x5982;&#x679C;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x4E3A;tidying&#xFF0C; terminated&#xFF08;&#x8FD9;&#x4E24;&#x79CD;&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x8BF4;&#x660E;&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x4E86;&#xFF09;</span></span><br><span class="line">        <span class="comment">// 3. &#x5982;&#x679C;&#x662F;shutdown&#x5E76;&#x4E14;&#x963B;&#x585E;&#x961F;&#x5217;&#x975E;&#x7A7A;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span></span><br><span class="line">        <span class="keyword">if</span> (isRunning(c) ||</span><br><span class="line">                runStateAtLeast(c, TIDYING) ||</span><br><span class="line">                (runStateOf(c) == SHUTDOWN &amp;&amp; ! workQueue.isEmpty()))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//&#x4EE3;&#x7801;&#x6267;&#x884C;&#x5230;&#x8FD9;&#x91CC;&#x65F6;&#xFF0C;&#x53EA;&#x6709;&#x4E24;&#x79CD;&#x60C5;&#x51B5;</span></span><br><span class="line">        <span class="comment">// 1. stop&#x72B6;&#x6001;</span></span><br><span class="line">        <span class="comment">// 2. shutdown&#x72B6;&#x6001;&#xFF0C;&#x4E14;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E3A;&#x7A7A;</span></span><br><span class="line">        <span class="comment">// &#x5982;&#x679C;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x4E0D;&#x4E3A;0&#xFF0C;&#x5219;&#x4E2D;&#x65AD;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;</span></span><br><span class="line">        <span class="keyword">if</span> (workerCountOf(c) != <span class="number">0</span>) { </span><br><span class="line">            <span class="comment">//&#x4E2D;&#x65AD;&#x4E00;&#x4E2A;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;</span></span><br><span class="line">            interruptIdleWorkers(ONLY_ONE);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//&#x4EE3;&#x7801;&#x6267;&#x884C;&#x5230;&#x8FD9;&#xFF0C;&#x8BF4;&#x660E;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x6570;&#x4E3A;0,&#x6B64;&#x5904;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x4E24;&#x79CD;&#x72B6;&#x6001;&#x53D8;&#x5316;</span></span><br><span class="line">        <span class="comment">//1. shutdown--&gt;tidying</span></span><br><span class="line">        <span class="comment">//2. stop---&gt;tidying</span></span><br><span class="line">        <span class="comment">//3. tidying--&gt;terminated &#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x6C60;&#x5173;&#x95ED;&#x7684;&#x540E;&#x5904;&#x7406;&#x64CD;&#x4F5C;&#xFF0C;terminated()&#x7A7A;&#x65B9;&#x6CD5;</span></span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">if</span> (ctl.compareAndSet(c, ctlOf(TIDYING, <span class="number">0</span>))) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    terminated();</span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                    ctl.set(ctlOf(TERMINATED, <span class="number">0</span>));</span><br><span class="line">                    <span class="comment">//&#x5524;&#x9192;&#x7B49;&#x5F85;&#x7EBF;&#x7A0B;&#x6C60;&#x5173;&#x95ED;&#x7684;&#x7EBF;&#x7A0B;&#xFF08;&#x8C03;&#x7528;awaitTermination()&#x65B9;&#x6CD5;&#x7684;&#x7EBF;&#x7A0B;&#xFF09;</span></span><br><span class="line">                    termination.signalAll();</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// else retry on failed CAS</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x603B;&#x7ED3;&#xFF1A;&#x8FD9;&#x91CC;&#x5FC5;&#x987B;&#x8981;&#x660E;&#x767D;&#x4E3A;&#x4EC0;&#x4E48;&#x662F;&#x4E2D;&#x65AD;1&#x4E2A;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x4E2D;&#x65AD;1&#x4E2A;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#xFF0C;&#x5C31;&#x4F1A;&#x6267;&#x884C;processWorkerExit(),&#x800C;&#x8BE5;&#x65B9;&#x6CD5;&#x5185;&#x90E8;&#x53C8;&#x8C03;&#x7528;&#x4E86;tryTerminate()&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5728;&#x6EE1;&#x8DB3;&#x5173;&#x95ED;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6761;&#x4EF6;&#x65F6;&#x4F1A;&#x8FDB;&#x800C;&#x4E2D;&#x65AD;&#x4E00;&#x4E2A;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#xFF0C;&#x8C03;&#x7528;processWorkerExit()&#x65B9;&#x6CD5;&#x3002;&#x56E0;&#x6B64;&#x53EA;&#x8981;&#x6761;&#x4EF6;&#x6EE1;&#x8DB3;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x7EBF;&#x7A0B;&#x90FD;&#x4F1A;&#x88AB;&#x4E2D;&#x65AD;&#x3002;&#x56E0;&#x6B64;&#x8BE5;&#x65B9;&#x6CD5;&#x5177;&#x6709;&#x6269;&#x6563;&#x4E2D;&#x65AD;&#x7EBF;&#x7A0B;&#x7684;&#x4F5C;&#x7528;&#x3002;</strong></p>
<h1 id="interruptIdleWorkers-boolean-onlyOne-&#x65B9;&#x6CD5;">12. interruptIdleWorkers(boolean onlyOne)&#x65B9;&#x6CD5;</h1><p>&#x5982;&#x679C;&#x53C2;&#x6570;&#x4E3A;true&#xFF0C;&#x5219;&#x53EA;&#x4E2D;&#x65AD;&#x4E00;&#x4E2A;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#xFF0C;tryTerminate()&#x65B9;&#x6CD5;&#x4E2D;&#x53EA;&#x4F20;&#x5165;true<br>&#x5982;&#x679C;&#x53C2;&#x6570;&#x4E3A;false&#xFF0C;&#x5219;&#x4E2D;&#x65AD;&#x6240;&#x6709;&#x7684;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">interruptIdleWorkers</span><span class="params">(<span class="keyword">boolean</span> onlyOne)</span> </span>{</span><br><span class="line">    <span class="comment">//&#x83B7;&#x53D6;&#x5168;&#x5C40;&#x9501;&#xFF0C;&#x56E0;&#x4E3A;&#x9700;&#x8981;&#x4FBF;&#x5229;HashSet&#xFF0C;&#x4FDD;&#x8BC1;&#x4E0D;&#x80FD;&#x8BA9;&#x5176;&#x4ED6;&#x7684;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;HashSet&#x7684;&#x503C;</span></span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">for</span> (Worker w : workers) {</span><br><span class="line">            Thread t = w.thread;</span><br><span class="line">            <span class="comment">//tryLock()&#x65B9;&#x6CD5;&#x5224;&#x65AD;&#x8BE5;&#x9501;&#x6709;&#x8BEF;&#x88AB;&#x5360;&#x7528;&#xFF0C;&#x5360;&#x7528;&#x8BF4;&#x660E;&#x5728;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD4;&#x56DE;false</span></span><br><span class="line">            <span class="comment">//&#x672A;&#x5360;&#x7528;&#xFF0C;&#x8868;&#x793A;&#x7A7A;&#x95F2;&#xFF0C;&#x8FD4;&#x56DE;true</span></span><br><span class="line">            <span class="keyword">if</span> (!t.isInterrupted() &amp;&amp; w.tryLock()) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    t.interrupt();</span><br><span class="line">                } <span class="keyword">catch</span> (SecurityException ignore) {</span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                    w.unlock();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//&#x5982;&#x679C;&#x53C2;&#x6570;&#x4E3A;true&#xFF0C;&#x5219;&#x53EA;&#x4E2D;&#x65AD;&#x4E00;&#x4E2A;</span></span><br><span class="line">            <span class="keyword">if</span> (onlyOne)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="shutdown-&#x65B9;&#x6CD5;">13. shutdown()&#x65B9;&#x6CD5;</h1><p>&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5173;&#x95ED;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5C06;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A;shutdown&#xFF0C;&#x5B58;&#x5728;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#x6027;&#x8D28;&#xFF1A; </p>
<ol>
<li>&#x4E0D;&#x80FD;&#x63D0;&#x4EA4;&#x65B0;&#x4EFB;&#x52A1;&#xFF0C; &#x4ECE;excute()&#x65B9;&#x6CD5;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;</li>
<li>&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x5B8C;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x4ECE;runWoker()&#x65B9;&#x6CD5;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;</li>
<li>&#x7EC8;&#x6B62;&#x6240;&#x6709;&#x7684;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;</li>
<li>&#x8FD4;&#x56DE;&#x503C;&#x4E3A;void<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        checkShutdownAccess();</span><br><span class="line">        <span class="comment">//&#x66F4;&#x65B0;&#x7EBF;&#x7A0B;&#x6C60;&#x72B6;&#x6001;</span></span><br><span class="line">        advanceRunState(SHUTDOWN);</span><br><span class="line">        <span class="comment">//&#x4E2D;&#x65AD;&#x6240;&#x6709;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#xFF0C;&#x8C03;&#x7528;interruptIdleWorkers(false)</span></span><br><span class="line">        interruptIdleWorkers();</span><br><span class="line">        <span class="comment">//&#x7A7A;&#x65B9;&#x6CD5;&#xFF0C;ScheduledThreadPoolExecutor&#x4F7F;&#x7528;</span></span><br><span class="line">        onShutdown();</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//&#x53C8;&#x5173;&#x95ED;&#x7EBF;&#x7A0B;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;&#x8BE5;&#x65B9;&#x6CD5;</span></span><br><span class="line">    tryTerminate();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="shutdownNow-&#x65B9;&#x6CD5;">14. shutdownNow()&#x65B9;&#x6CD5;</h1><p>&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5173;&#x95ED;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5C06;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A;stop&#x72B6;&#x6001;&#xFF0C;&#x5B58;&#x5728;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#x6027;&#x8D28;&#xFF1A; </p>
<ol>
<li>&#x4E0D;&#x80FD;&#x63D0;&#x4EA4;&#x65B0;&#x4EFB;&#x52A1;&#xFF0C;&#x4ECE; execute()&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x770B;&#x51FA;</li>
<li>&#x7EBF;&#x7A0B;&#x76F4;&#x63A5;&#x4E2D;&#x65AD;&#xFF0C;&#x4E0D;&#x5728;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x963B;&#x585E;&#x961F;&#x5217;&#x7684;&#x4EFB;&#x52A1;&#x4E0D;&#x5728;&#x6267;&#x884C;&#xFF0C;&#x4ECE;runWorker()&#x548C;interruptWorkers()&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x770B;&#x51FA;</li>
<li>&#x7EC8;&#x6B62;&#x6240;&#x6709;&#x7684;&#x7EBF;&#x7A0B; <strong>&#x4E0D;&#x7BA1;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x5DE5;&#x4F5C;&#xFF0C;&#x90FD;&#x7EC8;&#x6B62;&#xFF0C;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x662F;&#x539F;&#x5B50;&#x6027;&#x7684;&#xFF0C;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x6267;&#x884C;&#x4E00;&#x534A;&#x4EFB;&#x52A1;&#x7684;&#x60C5;&#x51B5;</strong></li>
<li>&#x8FD4;&#x56DE;&#x503C;&#x4E3A;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#x5217;&#x8868;<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Runnable&gt; <span class="title">shutdownNow</span><span class="params">()</span> </span>{</span><br><span class="line">    List&lt;Runnable&gt; tasks;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        checkShutdownAccess();</span><br><span class="line">        <span class="comment">//&#x4FEE;&#x6539;&#x4E3A;stop&#x72B6;&#x6001;</span></span><br><span class="line">        advanceRunState(STOP);</span><br><span class="line">        <span class="comment">//&#x7EC8;&#x6B62;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#xFF0C;&#x8C03;&#x7528;Worker&#x7684;interruptIfStarted()&#x65B9;&#x6CD5;</span></span><br><span class="line">        interruptWorkers();</span><br><span class="line">        <span class="comment">//&#x83B7;&#x53D6;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#x5217;&#x8868;</span></span><br><span class="line">        tasks = drainQueue();</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//&#x8BE5;&#x65B9;&#x6CD5;&#x5FC5;&#x987B;&#x8C03;&#x7528;&#xFF0C;&#x4E0A;&#x9762;&#x867D;&#x7136;&#x662F;&#x7EC8;&#x6B62;&#x6240;&#x6709;&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x5B9A;&#x5168;&#x90E8;&#x90FD;&#x80FD;&#x4E2D;&#x65AD;&#x6389;&#xFF0C;&#x56E0;&#x4E3A;&#x4E2D;&#x65AD;&#x662F;&#x6709;&#x6761;&#x4EF6;&#x7684;</span></span><br><span class="line">    tryTerminate();</span><br><span class="line">    <span class="comment">//&#x8FD4;&#x56DE;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#x5217;&#x8868;</span></span><br><span class="line">    <span class="keyword">return</span> tasks;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="drainQueue-&#x65B9;&#x6CD5;">15. drainQueue()&#x65B9;&#x6CD5;</h1><p>&#x4F7F;&#x7528;&#x963B;&#x585E;&#x961F;&#x5217;&#x7684;drainTo()&#x65B9;&#x6CD5;&#xFF0C;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x5C06;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x5230;list&#x4E2D;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Runnable&gt; <span class="title">drainQueue</span><span class="params">()</span> </span>{</span><br><span class="line">    BlockingQueue&lt;Runnable&gt; q = workQueue;</span><br><span class="line">    ArrayList&lt;Runnable&gt; taskList = <span class="keyword">new</span> ArrayList&lt;Runnable&gt;();</span><br><span class="line">    <span class="comment">//&#x5C06;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x5230;list&#x4E2D;&#xFF0C;&#x91C7;&#x7528;&#x8BE5;&#x65B9;&#x5F0F;&#x6548;&#x7387;&#x9AD8;</span></span><br><span class="line">    q.drainTo(taskList);</span><br><span class="line">    <span class="comment">//&#x5982;&#x679C;&#x961F;&#x5217;&#x4E2D;&#x8FD8;&#x5B58;&#x5728;&#x5143;&#x7D20;&#xFF0C;&#x5219;&#x4E00;&#x4E2A;&#x4E2A;&#x6DFB;&#x52A0;&#x5230;list&#x4E2D;</span></span><br><span class="line">    <span class="keyword">if</span> (!q.isEmpty()) {</span><br><span class="line">        <span class="keyword">for</span> (Runnable r : q.toArray(<span class="keyword">new</span> Runnable[<span class="number">0</span>])) {</span><br><span class="line">            <span class="keyword">if</span> (q.remove(r))</span><br><span class="line">                taskList.add(r);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> taskList;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="awaitTermination-long-timeout-TimeUnit-unit-&#x65B9;&#x6CD5;">16. awaitTermination(long timeout, TimeUnit unit)&#x65B9;&#x6CD5;</h1><p>&#x6700;&#x957F;&#x7B49;&#x5F85;timeout&#x65F6;&#x95F4;&#xFF0C;&#x7B49;&#x5F85;&#x7EBF;&#x7A0B;&#x6C60;&#x5B8C;&#x5168;&#x5173;&#x95ED;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x6CA1;&#x6709;&#x65B0;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5C31;&#x662F;&#x5224;&#x65AD;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x72B6;&#x6001;&#x662F;&#x5426;&#x4E3A;terminated&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x5219;&#x8FD4;&#x56DE;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x5219;&#x7B49;&#x5F85;timeout&#x65F6;&#x95F4;&#x5E76;&#x6DFB;&#x52A0;&#x5230;&#x5168;&#x5C40;&#x9501;&#x7684;Conditon&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x65F6;&#x8FD4;&#x56DE;false&#x3002; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">awaitTermination</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">    <span class="keyword">long</span> nanos = unit.toNanos(timeout);</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="keyword">if</span> (runStateAtLeast(ctl.get(), TERMINATED))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (nanos &lt;= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            nanos = termination.awaitNanos(nanos);</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x62D2;&#x7EDD;&#x7B56;&#x7565;">17. &#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</h1><p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x6E90;&#x7801;&#x8BB2;&#x89E3;&#x4E2D;&#xFF0C;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;&#x7EBF;&#x7A0B;&#x6C60;&#x5728;&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x8C03;&#x7528;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#xFF0C;&#x5408;&#x7406;&#x7684;&#x8BBE;&#x7F6E;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#x5728;&#x9879;&#x76EE;&#x7684;&#x5E94;&#x7528;&#x4E2D;&#x662F;&#x5341;&#x5206;&#x91CD;&#x8981;&#x7684;&#x3002;&#x7EBF;&#x7A0B;&#x6C60;&#x63D0;&#x4F9B;&#x4E86;&#x56DB;&#x79CD;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x7684;&#x4E1A;&#x52A1;&#x9700;&#x6C42;&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#xFF0C;&#x53EA;&#x9700;&#x5B9E;&#x73B0;RejectedExecutionHandler&#x63A5;&#x53E3;&#xFF0C;&#x5728;&#x5B9A;&#x4E49;&#x7EBF;&#x7A0B;&#x6C60;&#x65F6;&#xFF0C;&#x4F20;&#x5165;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x7684;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#x5BF9;&#x8C61;&#x5373;&#x53EF;&#x3002; </p>
<ul>
<li>CallerRunsPolicy<br>&#x4ECE;&#x540D;&#x5B57;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x8BE5;&#x7B56;&#x7565;&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x8005;&#x8FD0;&#x884C;&#x8BE5;&#x4EFB;&#x52A1;&#x3002;&#x90A3;&#x4E48;&#x8C03;&#x7528;&#x8005;&#x662F;&#x8C01;&#xFF1F;&#x90A3;&#x5C31;&#x662F;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x7684;&#x7EBF;&#x7A0B;&#x3002;</li>
</ul>
<p><strong>&#x597D;&#x5904;</strong>&#xFF1A;&#x5C31;&#x662F;&#x7EBF;&#x7A0B;&#x6C60;&#x8D1F;&#x8F7D;&#x8FC7;&#x91CD;&#xFF08;&#x6216;&#x8005;&#x662F;&#x81EA;&#x5DF1;&#x8BBE;&#x7F6E;&#x7684;&#x53C2;&#x6570;&#x6709;&#x95EE;&#x9898;&#xFF09;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x8FD0;&#x884C;&#x4EFB;&#x52A1;&#x53EF;&#x4EE5;&#x5EF6;&#x7F13;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x7684;&#x901F;&#x5EA6;&#xFF0C;&#x4EFB;&#x52A1;&#x4E0D;&#x4F1A;&#x4E22;&#x5931;&#x3002;<br><strong>&#x574F;&#x5904;</strong>&#xFF1A;&#x52A0;&#x5927;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x5904;&#x7406;&#x65F6;&#x95F4;<br>&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (!e.isShutdown()) {</span><br><span class="line">        r.run();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>AbortPolicy<br>&#x8BE5;&#x7B56;&#x7565;&#x662F;<strong>&#x7EBF;&#x7A0B;&#x6C60;&#x9ED8;&#x8BA4;&#x7684;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</strong>&#xFF0C;&#x76F4;&#x63A5;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x8BE5;&#x5F02;&#x5E38;&#x65F6;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7EBF;&#x4E0A;&#x670D;&#x52A1;&#xFF0C;&#x4E00;&#x76F4;&#x629B;&#x5F02;&#x5E38;&#x6015;&#x662F;&#x4E0D;&#x597D;&#x3002;<br>&#x5176;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A;<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>{</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RejectedExecutionException(<span class="string">&quot;Task &quot;</span> + r.toString() +</span><br><span class="line">            <span class="string">&quot; rejected from &quot;</span> +</span><br><span class="line">            e.toString());</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li>
<li>DiscardPolicy<br>&#x8BE5;&#x7B56;&#x7565;&#x5C31;&#x662F;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x505A;&#xFF0C;&#x5047;&#x88C5;&#x4EC0;&#x4E48;&#x4E8B;&#x60C5;&#x90FD;&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x8FC7;&#xFF0C;&#x7F3A;&#x70B9;&#x4E5F;&#x5F88;&#x660E;&#x663E;&#xFF0C;<strong>&#x4F1A;&#x4E22;&#x4EFB;&#x52A1;</strong>&#xFF0C;&#x5BF9;&#x4E8E;&#x4E0D;&#x80FD;&#x4E22;&#x4EFB;&#x52A1;&#x7684;&#x573A;&#x666F;&#x662F;&#x4E0D;&#x80FD;&#x7528;&#x7684;&#xFF0C;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x662F;&#x7A7A;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x8D34;&#x4EE3;&#x7801;&#x4E86;&#x3002;</li>
<li>DiscardOldestPolicy<br>&#x8BE5;&#x7B56;&#x7565;&#x4F1A;&#x5C06;&#x6700;&#x8001;&#x7684;&#x4EFB;&#x52A1;&#x79FB;&#x9664;&#xFF08;&#x963B;&#x585E;&#x961F;&#x5217;&#x7684;&#x5BF9;&#x5934;&#x5143;&#x7D20;&#xFF09;&#xFF0C;&#x91CD;&#x65B0;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x3002;&#x7F3A;&#x70B9;&#x5C31;&#x662F;<strong>&#x4EFB;&#x52A1;&#x8FD8;&#x662F;&#x4F1A;&#x4E22;&#x5931;&#xFF0C;&#x800C;&#x4E14;&#x4EFB;&#x52A1;&#x4E0D;&#x4E00;&#x5B9A;&#x80FD;&#x52A0;&#x5165;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#xFF08;&#x5982;&#x679C;&#x6B64;&#x65F6;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4E5F;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#xFF09;</strong><br>&#x6E90;&#x7801;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (!e.isShutdown()) {</span><br><span class="line">        e.getQueue().poll();</span><br><span class="line">        e.execute(r);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="&#x603B;&#x7ED3;">18. &#x603B;&#x7ED3;</h1><p>&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x65F6;&#xFF0C;&#x4E00;&#x822C;&#x6211;&#x4EEC;&#x4E0D;&#x4F1A;&#x653E;&#x4EFB;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x548C;&#x963B;&#x585E;&#x961F;&#x5217;&#x5360;&#x7528;&#x7684;&#x8D44;&#x6E90;&#x65E0;&#x9650;&#x5236;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x4E00;&#x822C;&#x4F1A;&#x8BBE;&#x5B9A;&#x597D;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x8BBE;&#x7F6E;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x963B;&#x585E;&#x961F;&#x5217;&#xFF0C;&#x7531;&#x4E8E;&#x963B;&#x585E;&#x961F;&#x5217;&#x548C;&#x7EBF;&#x7A0B;&#x7684;&#x8D44;&#x6E90;&#x90FD;&#x5206;&#x914D;&#x4E86;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x8003;&#x8651;&#x4EFB;&#x52A1;&#x7684;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#xFF0C;&#x81F3;&#x4E8E;&#x4F7F;&#x7528;&#x4EC0;&#x4E48;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#xFF0C;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x4E1A;&#x52A1;&#x9700;&#x6C42;&#x9009;&#x62E9;&#x6216;&#x8005;&#x81EA;&#x5B9A;&#x4E49;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#x3002;&#x5BF9;&#x4E8E;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;&#x7684;&#x628A;&#x63E1;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x7ECF;&#x8FC7;&#x538B;&#x6D4B;&#x4E4B;&#x540E;&#x786E;&#x5B9A;&#xFF0C;&#x5177;&#x4F53;&#x4E1A;&#x52A1;&#x60C5;&#x666F;&#x5177;&#x4F53;&#x5206;&#x6790;&#x3002;<br>&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x8981;&#x505A;&#x597D;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x9694;&#x79BB;&#xFF0C;&#x4E0D;&#x8981;&#x8BA9;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6C60;&#x505A;&#x6240;&#x6709;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x907F;&#x514D;&#x4E00;&#x4E2A;&#x529F;&#x80FD;&#x6A21;&#x5757;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x5F71;&#x54CD;&#x5230;&#x5176;&#x4ED6;&#x7684;&#x529F;&#x80FD;&#x3002;&#x8FD8;&#x5E94;&#x8BE5;&#x505A;&#x597D;&#x964D;&#x7EA7;&#x5E94;&#x5BF9;&#x7EBF;&#x7A0B;&#x6C60;&#x5D29;&#x6E83;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x6C60;&#x5D29;&#x6E83;&#xFF0C;&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x53D6;&#x4EE3;&#xFF0C;&#x4FDD;&#x8BC1;&#x7EBF;&#x4E0A;&#x670D;&#x52A1;&#x7A33;&#x5B9A;&#x53EF;&#x7528;&#x3002; </p>
]]></content>
      <categories>
        <category>thread-pool</category>
      </categories>
  </entry>
  <entry>
    <title>线程池3:线程池顶级类及其接口</title>
    <url>/2020/thread-pool-dingjilei-jiekou/</url>
    <content><![CDATA[<p>&#x8F6C;&#x8F7D;&#x81EA;<a href="https://www.jianshu.com/p/7b3e48349d3f" target="_blank" rel="noopener">&#x300A;&#x7EBF;&#x7A0B;&#x6C60;&#x7CFB;&#x5217;&#x4E09;&#x300B;-&#x7EBF;&#x7A0B;&#x6C60;&#x9876;&#x7EA7;&#x7C7B;&#x53CA;&#x5176;&#x63A5;&#x53E3;&#x6E90;&#x7801;&#x5206;&#x6790;</a></p>
<blockquote>
<p>&#x5728;&#x4E86;&#x89E3;ThreadPoolExecutor&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5148;&#x5F04;&#x6E05;&#x695A;&#x5176;&#x7236;&#x7C7B;&#x53CA;&#x5176;&#x7236;&#x63A5;&#x53E3;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x4E86;&#x89E3;&#x8FD9;&#x90E8;&#x5206;&#x77E5;&#x8BC6;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;&#x6267;&#x884C;&#x5668;&#x5B9E;&#x73B0;&#x3002; </p>
</blockquote>
<h1 id="&#x96C6;&#x6210;&#x5173;&#x7CFB;">1. &#x96C6;&#x6210;&#x5173;&#x7CFB;</h1><p>&#x9996;&#x5148;&#x770B;&#x4E00;&#x4E0B;ThreadPoolExecutor&#x7684;&#x96C6;&#x6210;&#x5173;&#x7CFB;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Executor</span> </span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">ExecutorService</span> <span class="keyword">extends</span> <span class="title">Executor</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">abstract</span> <span class="title">class</span> <span class="title">AbstractExecutorService</span> <span class="keyword">implements</span> <span class="title">ExecutorService</span> </span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ThreadPoolExecutor</span> <span class="keyword">extends</span> <span class="title">AbstractExecutorService</span></span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h1 id="Executor&#x63A5;&#x53E3;">2. Executor&#x63A5;&#x53E3;</h1><p>&#x8BE5;&#x63A5;&#x53E3;&#x8868;&#x793A;&#x53EF;&#x6267;&#x884C;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x53EA;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;execute(Runnable) &#x9700;&#x8981;&#x4E00;&#x4E2A;Runnable&#x5BF9;&#x8C61;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span></span>;</span><br></pre></td></tr></table></figure>

<h1 id="ExecutorService&#x63A5;&#x53E3;">3. ExecutorService&#x63A5;&#x53E3;</h1><p>&#x8BE5;&#x63A5;&#x53E3;&#x7EE7;&#x627F;&#x4E86;Executor&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x6DFB;&#x52A0;&#x4E86;&#x6267;&#x884C;&#x5668;&#xFF08;&#x8FD9;&#x91CC;&#x6307;&#x7684;&#x662F;&#x5B9E;&#x73B0;ExecutorService&#x7684;&#x7C7B;&#xFF0C;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x7EBF;&#x7A0B;&#x6C60;&#xFF09;&#x76F8;&#x5173;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x5173;&#x95ED;&#x4EFB;&#x52A1;&#x3001;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x3001;&#x7B49;&#x5F85;&#x6267;&#x884C;&#x5668;&#x5173;&#x95ED;&#x3001;&#x6267;&#x884C;&#x5668;&#x72B6;&#x6001;&#x7684;&#x5224;&#x65AD;&#x7B49;&#x64CD;&#x4F5C;&#x3002; </p>
<ul>
<li>&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x64CD;&#x4F5C;<br>submit()&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x79CD;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x54EA;&#x4E00;&#x79CD;&#x63D0;&#x4EA4;&#x64CD;&#x4F5C;&#xFF0C;&#x90FD;&#x662F;&#x5C06;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x8F6C;&#x6362;&#x4E3A;RunnableFuture&#x5BF9;&#x8C61;</li>
</ul>
<ol>
<li>callable&#x5BF9;&#x8C61; &#x5728;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x5C31;&#x662F;&#x5C01;&#x88C5;&#x4E3A;FutureTask</li>
<li>runnable&#x5BF9;&#x8C61; &#x8C03;&#x7528;RunnableFuture&#x7684;get()&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;null</li>
<li>runnable&#x5BF9;&#x8C61; + &#x6CDB;&#x578B;&#x8FD4;&#x56DE;&#x503C;T &#x8C03;&#x7528;RunnableFuture&#x7684;get()&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;T&#x7684;&#x503C;</li>
</ol>
<p>&#x5176;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Callable&lt;T&gt; task)</span></span>;</span><br><span class="line">Future&lt;?&gt; submit(Runnable task);</span><br><span class="line">&lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Runnable task, T result)</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x6267;&#x884C;&#x5668;&#x7684;&#x5173;&#x95ED;&#x64CD;&#x4F5C;</li>
</ul>
<ol>
<li>shutdown() &#x5173;&#x95ED;&#x64CD;&#x4F5C;</li>
<li>shutdownNow() &#x5173;&#x95ED;&#x64CD;&#x4F5C;&#xFF0C;&#x4E0E;shutdown()&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x4E0D;&#x540C;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x533A;&#x522B;&#x5728;&#x8BB2;&#x89E3;&#x6E90;&#x7801;&#x65F6;&#x8FDB;&#x884C;&#x5206;&#x6790;</li>
<li>awaitTermination() &#x7B49;&#x5F85;&#x6267;&#x884C;&#x5668;&#x5173;&#x95ED;&#xFF0C;&#x7B49;&#x5F85;&#x6700;&#x957F;&#x65F6;&#x95F4;&#x4E3A;&#x53C2;&#x6570;&#x65F6;&#x95F4;</li>
</ol>
<p>&#x5176;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">List&lt;Runnable&gt; <span class="title">shutdownNow</span><span class="params">()</span></span>;  </span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">awaitTermination</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span>  <span class="keyword">throws</span> InterruptedException</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x5224;&#x65AD;&#x6267;&#x884C;&#x5668;&#x72B6;&#x6001;&#x64CD;&#x4F5C;</li>
</ul>
<ol>
<li>isShutdown() &#x5224;&#x65AD;&#x72B6;&#x6001;&#x662F;&#x5426;&#x4E3A;&#x5173;&#x95ED;&#x88C5;&#x586B;</li>
<li>isTerminated() &#x5224;&#x65AD;&#x6267;&#x884C;&#x5668;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5B8C;&#x5168;&#x7EC8;&#x6B62;</li>
</ol>
<p>&#x5176;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isShutdown</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isTerminated</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x6279;&#x91CF;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x64CD;&#x4F5C;<br>&#x4E0E;submit&#x64CD;&#x4F5C;&#x4E0D;&#x540C;&#xFF0C;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x4EFB;&#x52A1;&#x662F;&#x9700;&#x8981;&#x7B49;&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x624D;&#x4F1A;&#x8FD4;&#x56DE;</li>
</ul>
<ol>
<li>invokeAll(Collection) &#x7B49;&#x5F85;&#x63D0;&#x4EA4;&#x7684;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;&#x90FD;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x6700;&#x957F;&#x7B49;&#x5F85;&#x65F6;&#x95F4;</li>
<li>invokeAny(Collection) &#x6267;&#x884C;&#x5B8C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x5C31;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5236;&#x5B9A;&#x6700;&#x957F;&#x7684;&#x7B49;&#x5F85;&#x65F6;&#x95F4;</li>
</ol>
<p>&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x5728;AbstractExecutorService&#x7C7B;&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x4E24;&#x8005;&#x7684;&#x5177;&#x4F53;&#x542B;&#x4E49;&#x5728;&#x8BB2;&#x89E3;&#x6E90;&#x7801;&#x65F6;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x5176;&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) </span><br><span class="line">          <span class="keyword">throws</span> InterruptedException;</span><br><span class="line">&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,  <span class="keyword">long</span> timeout, TimeUnit unit)         </span><br><span class="line">         <span class="keyword">throws</span> InterruptedException;</span><br><span class="line">&lt;T&gt; <span class="function">T <span class="title">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span> </span></span><br><span class="line"><span class="function">         <span class="keyword">throws</span> InterruptedException, ExecutionException</span>;</span><br><span class="line">&lt;T&gt; <span class="function">T <span class="title">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, <span class="keyword">long</span> timeout, TimeUnit unit)</span> </span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;</span><br></pre></td></tr></table></figure>

<h1 id="AbstractExecutorService&#x7C7B;">4. AbstractExecutorService&#x7C7B;</h1><p>&#x8BE5;&#x7C7B;&#x91CD;&#x8981;&#x5B9E;&#x73B0;&#x4E86;ExecutorService&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x516C;&#x7528;&#x65B9;&#x6CD5;&#xFF0C;&#x4F8B;&#x5982;&#x63D0;&#x4EA4;&#x64CD;&#x4F5C;&#x3001;&#x6279;&#x91CF;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x64CD;&#x4F5C;&#xFF0C;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x8BB2;Callable&#x5BF9;&#x8C61;&#x548C;Runnable&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;RunnableFuture&#x7684;&#x64CD;&#x4F5C;&#x3002; </p>
<ul>
<li><p>&#x4EFB;&#x52A1;&#x8F6C;&#x5316;&#x64CD;&#x4F5C;&#xFF0C; &#x65B9;&#x6CD5;&#x4E3A;protected&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x80FD;&#x5B50;&#x7C7B;&#x53EF;&#x4EE5;&#x8C03;&#x7528;<br>&#x90FD;&#x662F;&#x8C03;&#x7528;&#x7684;FutureTask&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;<strong>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x8BE5;&#x7C7B;&#x4E2D;&#x8FD4;&#x56DE;&#x7684;RunnableFuture&#x7C7B;&#x578B;&#x90FD;&#x662F;FutureTask&#x7C7B;&#x578B;</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;T&gt; <span class="function">RunnableFuture&lt;T&gt; <span class="title">newTaskFor</span><span class="params">(Runnable runnable, T value)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FutureTask&lt;T&gt;(runnable, value);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">protected</span> &lt;T&gt; <span class="function">RunnableFuture&lt;T&gt; <span class="title">newTaskFor</span><span class="params">(Callable&lt;T&gt; callable)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FutureTask&lt;T&gt;(callable);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x64CD;&#x4F5C;submit<br>&#x8FD9;&#x91CC;&#x53EA;&#x770B;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x53EF;&#x4EE5;&#xFF0C;&#x601D;&#x60F3;&#x5C31;&#x662F;&#x5C06;Runnable+T&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x6216;&#x8005;Callable&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;FutureTask&#x7C7B;&#x578B;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;execute(Runnable)&#x65B9;&#x6CD5;(<strong>FutureTask&#x7EE7;&#x627F;&#x4E86;Runnable&#x63A5;&#x53E3;&#xFF0C;&#x4E5F;&#x662F;Runnable&#x5BF9;&#x8C61;</strong>)&#xFF0C;&#x8FD4;&#x56DE;FutureTask&#x5BF9;&#x8C61;&#x3002;&#x5176;&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Runnable task, T result)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (task == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    RunnableFuture&lt;T&gt; ftask = newTaskFor(task, result);</span><br><span class="line">    execute(ftask);</span><br><span class="line">    <span class="keyword">return</span> ftask;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x6279;&#x91CF;&#x5904;&#x7406;&#x4EFB;&#x52A1;&#x64CD;&#x4F5C;</p>
</li>
</ul>
<p>&#xFF08;1&#xFF09; invokeAny&#x65B9;&#x6CD5;<br><strong>&#x529F;&#x80FD;</strong>&#xFF1A;&#x63D0;&#x4EA4;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x6B63;&#x5E38;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF08;&#x5F02;&#x5E38;&#x4E0D;&#x7B97;&#x6B63;&#x5E38;&#x5B8C;&#x6210;&#xFF09;&#x5373;&#x53EF;&#x8FD4;&#x56DE;&#xFF08;&#x4F46;&#x662F;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x6B21;&#x6027;&#x5168;&#x90E8;&#x542F;&#x52A8;&#x6267;&#x884C;&#x7684;&#xFF09;<br>&#x963B;&#x585E;&#x65B9;&#x6CD5;invokeAny(Colletion)&#x548C;&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;invokeAny(Colletion, timeout, unit)&#x90FD;&#x8C03;&#x7528;doInvokeAny()&#x65B9;&#x6CD5;<br>&#x5176;&#x6267;&#x884C;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#xFF1A; </p>
<ol>
<li>&#x5148;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;</li>
<li>&#x68C0;&#x67E5;&#x4EFB;&#x52A1;&#x6709;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x5982;&#x679C;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x6B63;&#x5E38;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</li>
<li>&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x5E76;&#x4E14;&#x8FD8;&#x6709;&#x53EF;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x90A3;&#x4E48;&#x518D;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x518D;&#x6B21;&#x68C0;&#x67E5;&#x6709;&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x5FAA;&#x73AF;2&#xFF0C;3&#x6B65;</li>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53EF;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x4E86;&#xFF0C;&#x53EA;&#x80FD;&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#xFF0C;&#x8C03;&#x7528;take()&#x963B;&#x585E;&#x65B9;&#x6CD5;</li>
</ol>
<p>&#x5177;&#x4F53;&#x7684;&#x6D41;&#x7A0B;&#x53C2;&#x8003;&#x6E90;&#x7801;&#xFF0C;&#x6E90;&#x7801;&#x4E2D;&#x6709;&#x8BE6;&#x7EC6;&#x7684;&#x6CE8;&#x91CA;&#xFF0C;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">T <span class="title">doInvokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span></span></span><br><span class="line"><span class="function"><span class="params">                        <span class="keyword">boolean</span> timed, <span class="keyword">long</span> nanos)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException </span>{</span><br><span class="line">    <span class="comment">//&#x68C0;&#x67E5;tasks&#x96C6;&#x5408;&#x53C2;&#x6570;</span></span><br><span class="line">    <span class="keyword">if</span> (tasks == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">int</span> ntasks = tasks.size();</span><br><span class="line">    <span class="keyword">if</span> (ntasks == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="comment">//&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x503C;</span></span><br><span class="line">    List&lt;Future&lt;T&gt;&gt; futures= <span class="keyword">new</span> ArrayList&lt;Future&lt;T&gt;&gt;(ntasks);</span><br><span class="line">    <span class="comment">//&#x5B9A;&#x4E49;ExecutorCompletionService&#xFF0C;&#x8BB2;this&#x4F5C;&#x4E3A;&#x5176;&#x6784;&#x9020;&#x53C2;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x8981;&#x7528;&#x8BE5;&#x6267;&#x884C;&#x5668;&#x6267;&#x884C;&#x4EFB;&#x52A1;</span></span><br><span class="line">    ExecutorCompletionService&lt;T&gt; ecs =</span><br><span class="line">        <span class="keyword">new</span> ExecutorCompletionService&lt;T&gt;(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        ExecutionException ee = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//&#x5224;&#x65AD;&#x8D85;&#x65F6;&#x65F6;&#x95F4;</span></span><br><span class="line">        <span class="keyword">long</span> lastTime = timed ? System.nanoTime() : <span class="number">0</span>;</span><br><span class="line">        Iterator&lt;? extends Callable&lt;T&gt;&gt; it = tasks.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// &#x63D0;&#x4EA4;&#x7B2C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;</span></span><br><span class="line">        futures.add(ecs.submit(it.next()));</span><br><span class="line">        <span class="comment">//&#x8BB0;&#x5F55;&#x4EFB;&#x52A1;&#x6570;</span></span><br><span class="line">        --ntasks;</span><br><span class="line">       <span class="comment">//&#x8BB0;&#x5F55;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x6570;&#x91CF;</span></span><br><span class="line">        <span class="keyword">int</span> active = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="comment">//&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F;poll()&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;&#xFF08;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5B8C;&#x7684;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;null&#xFF09;&#xFF0C;&#x800C;&#x4E0D;&#x662F;take()</span></span><br><span class="line">            Future&lt;T&gt; f = ecs.poll();</span><br><span class="line">            <span class="comment">//&#x8BF4;&#x660E;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;</span></span><br><span class="line">            <span class="keyword">if</span> (f == <span class="keyword">null</span>) {</span><br><span class="line">                <span class="comment">//&#x5982;&#x679C;&#x8FD8;&#x5B58;&#x5728;&#x53EF;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x5C31;&#x6DFB;&#x52A0;&#x4EFB;&#x52A1;&#x6267;&#x884C;</span></span><br><span class="line">                <span class="keyword">if</span> (ntasks &gt; <span class="number">0</span>) {</span><br><span class="line">                    --ntasks;</span><br><span class="line">                    futures.add(ecs.submit(it.next()));</span><br><span class="line">                    ++active;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;&#x90FD;&#x4E0D;&#x662F;&#x6B63;&#x5E38;&#x7ED3;&#x675F;&#x7684;</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (active == <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">//&#x5982;&#x679C;&#x8BBE;&#x5B9A;&#x4E86;&#x8D85;&#x65F6;&#xFF0C;&#x8BA1;&#x7B97;&#x662F;&#x5426;&#x8D85;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x8D85;&#x65F6;&#xFF0C;&#x629B;&#x51FA;&#x8D85;&#x65F6;&#x5F02;&#x5E38;</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (timed) {</span><br><span class="line">                    f = ecs.poll(nanos, TimeUnit.NANOSECONDS);</span><br><span class="line">                    <span class="keyword">if</span> (f == <span class="keyword">null</span>)</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> TimeoutException();</span><br><span class="line">                    <span class="keyword">long</span> now = System.nanoTime();</span><br><span class="line">                    nanos -= now - lastTime;</span><br><span class="line">                    lastTime = now;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x90FD;&#x63D0;&#x4EA4;&#x4E86;&#xFF0C;&#x7B49;&#x5F85;&#x6709;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    f = ecs.take();</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// &#x5B58;&#x5728;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;</span></span><br><span class="line">            <span class="keyword">if</span> (f != <span class="keyword">null</span>) {</span><br><span class="line">                --active;</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="comment">//&#x8FD4;&#x56DE;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x7ED3;&#x679C;</span></span><br><span class="line">                    <span class="keyword">return</span> f.get();</span><br><span class="line">                } <span class="keyword">catch</span> (ExecutionException eex) {</span><br><span class="line">                    ee = eex;</span><br><span class="line">                } <span class="keyword">catch</span> (RuntimeException rex) {</span><br><span class="line">                    ee = <span class="keyword">new</span> ExecutionException(rex);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x6267;&#x884C;&#x5230;&#x8FD9;&#x8BF4;&#x660E;&#xFF0C;&#x6CA1;&#x6709;&#x901A;&#x8FC7;return&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x51FA;&#x73B0;&#x4E86;&#x95EE;&#x9898;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span></span><br><span class="line">        <span class="keyword">if</span> (ee == <span class="keyword">null</span>)</span><br><span class="line">            ee = <span class="keyword">new</span> ExecutionException();</span><br><span class="line">        <span class="keyword">throw</span> ee;</span><br><span class="line"></span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="comment">//&#x53D6;&#x6D88;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;</span></span><br><span class="line">        <span class="keyword">for</span> (Future&lt;T&gt; f : futures)</span><br><span class="line">            f.cancel(<span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x4ECE;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x4EFB;&#x52A1;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x6B21;&#x6027;&#x542F;&#x52A8;&#x7684;&#xFF0C;&#x7136;&#x662F;&#x5148;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#xFF0C;&#x5224;&#x65AD;&#x6709;&#x6CA1;&#x6709;&#x7ED3;&#x675F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7ED3;&#x675F;&#x90A3;&#x4E48;&#x518D;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x7ED3;&#x675F;&#x5219;&#x8FD4;&#x56DE;</strong><br>&#x518D;&#x770B;invokeAny(Collection&lt;? extends Callable<t>&gt; tasks)&#x963B;&#x585E;&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x6E90;&#x7801;&#x5982;&#x4E0B;,&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x8C03;&#x7528;&#x4E86;doInvokeAny()&#x65B9;&#x6CD5;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E0D;&#x8D85;&#x65F6;&#xFF1A; </t></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException, ExecutionException </span>{</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">return</span> doInvokeAny(tasks, <span class="keyword">false</span>, <span class="number">0</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (TimeoutException cannotHappen) {</span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x90A3;&#x4E48;invokeAny(Collection&lt;? extends Callable<t>&gt; tasks, long timeout, TimeUnit unit)&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x662F;&#x7B80;&#x5355;&#x8C03;&#x7528;&#x4E86;doInvokeAny()&#x65B9;&#x6CD5;&#x800C;&#x5DF2;&#xFF0C;&#x5176;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </t></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException </span>{</span><br><span class="line">    <span class="keyword">return</span> doInvokeAny(tasks, <span class="keyword">true</span>, unit.toNanos(timeout));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>(2) invokeAll&#x65B9;&#x6CD5;<br><strong>&#x529F;&#x80FD;</strong>&#xFF1A;&#x6267;&#x884C;&#x5B8C;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;&#x624D;&#x4F1A;&#x8FD4;&#x56DE;<br>&#x5176;&#x6267;&#x884C;&#x903B;&#x8F91;&#xFF1A; </p>
<ol>
<li>&#x6267;&#x884C;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;</li>
<li>&#x7B49;&#x5F85;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;</li>
</ol>
<p>&#x8BE6;&#x7EC6;&#x7684;&#x6CE8;&#x91CA;&#x5728;&#x6E90;&#x7801;&#x4E2D;&#xFF0C;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br><span class="line">    <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="comment">//&#x53C2;&#x6570;&#x68C0;&#x67E5;</span></span><br><span class="line">    <span class="keyword">if</span> (tasks == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    List&lt;Future&lt;T&gt;&gt; futures = <span class="keyword">new</span> ArrayList&lt;Future&lt;T&gt;&gt;(tasks.size());</span><br><span class="line">    <span class="keyword">boolean</span> done = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">         <span class="comment">//&#x4E00;&#x6B21;&#x6027;&#x542F;&#x52A8;&#x5E76;&#x6267;&#x884C;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;</span></span><br><span class="line">        <span class="keyword">for</span> (Callable&lt;T&gt; t : tasks) {</span><br><span class="line">            RunnableFuture&lt;T&gt; f = newTaskFor(t);</span><br><span class="line">            futures.add(f);</span><br><span class="line">            execute(f);</span><br><span class="line">        }</span><br><span class="line">       <span class="comment">//&#x5224;&#x65AD;&#x4EFB;&#x52A1;&#x6709;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x5219;&#x7B49;&#x5F85;</span></span><br><span class="line">        <span class="keyword">for</span> (Future&lt;T&gt; f : futures) {</span><br><span class="line">            <span class="keyword">if</span> (!f.isDone()) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="comment">//get()&#x65B9;&#x6CD5;&#x4E3A;&#x963B;&#x585E;&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x6709;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x624D;&#x4F1A;&#x8FD4;&#x56DE;</span></span><br><span class="line">                    f.get();</span><br><span class="line">                } <span class="keyword">catch</span> (CancellationException ignore) {</span><br><span class="line">                } <span class="keyword">catch</span> (ExecutionException ignore) {</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x8868;&#x660E;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;&#x90FD;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x6267;&#x884C;&#x5B8C;</span></span><br><span class="line">        done = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> futures;</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="comment">//&#x5982;&#x679C;&#x662F;&#x5F02;&#x5E38;&#x7EC8;&#x6B62;&#xFF0C;&#x90A3;&#x4E48;&#x53D6;&#x6D88;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;</span></span><br><span class="line">        <span class="keyword">if</span> (!done)</span><br><span class="line">            <span class="keyword">for</span> (Future&lt;T&gt; f : futures)</span><br><span class="line">                f.cancel(<span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x8BE5;&#x65B9;&#x6CD5;&#x4E0D;&#x540C;&#x4E8E;invokeAny&#xFF0C; &#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x4E00;&#x6B21;&#x6027;&#x542F;&#x52A8;&#x6267;&#x884C;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x7BA1;&#x4EFB;&#x52A1;&#x662F;&#x5426;&#x6267;&#x884C;&#x6210;&#x529F;&#xFF0C;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x5373;&#x53EF;</strong><br>invokeAll(Collection&lt;? extends Callable<t>&gt; task, long timeout, TimeUnit unit)&#x65B9;&#x6CD5;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x6761;&#x4EF6;&#x4E86;&#x5224;&#x65AD;&#x8D85;&#x65F6;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5728;&#x8C03;&#x7528;get&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4E0D;&#x5728;&#x662F;&#x8C03;&#x7528;&#x963B;&#x585E;get()&#xFF0C;&#x800C;&#x662F;&#x8C03;&#x7528;&#x53EF;&#x8D85;&#x65F6;&#x7684;get(timeout)&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </t></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span><br><span class="line">                                         <span class="keyword">long</span> timeout, TimeUnit unit)</span><br><span class="line">        <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="keyword">if</span> (tasks == <span class="keyword">null</span> || unit == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">long</span> nanos = unit.toNanos(timeout);</span><br><span class="line">    List&lt;Future&lt;T&gt;&gt; futures = <span class="keyword">new</span> ArrayList&lt;Future&lt;T&gt;&gt;(tasks.size());</span><br><span class="line">    <span class="keyword">boolean</span> done = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">//&#x5148;&#x5C06;&#x4EFB;&#x52A1;&#x90FD;&#x653E;&#x5230;list&#x4E2D;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;list&#x4E0D;&#x7BA1;&#x8D85;&#x65F6;&#x4E0E;&#x5426;&#x90FD;&#x662F;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x7684;</span></span><br><span class="line">        <span class="comment">//&#x6240;&#x4EE5;&#x5148;&#x628A;&#x4EFB;&#x52A1;&#x90FD;&#x52A0;&#x5230;list&#x4E2D;</span></span><br><span class="line">        <span class="keyword">for</span> (Callable&lt;T&gt; t : tasks)</span><br><span class="line">            futures.add(newTaskFor(t));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> lastTime = System.nanoTime();</span><br><span class="line"></span><br><span class="line">        Iterator&lt;Future&lt;T&gt;&gt; it = futures.iterator();</span><br><span class="line">        <span class="comment">//&#x5728;&#x542F;&#x52A8;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4E5F;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8D85;&#x65F6;</span></span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) {</span><br><span class="line">            execute((Runnable)(it.next()));</span><br><span class="line">            <span class="keyword">long</span> now = System.nanoTime();</span><br><span class="line">            nanos -= now - lastTime;</span><br><span class="line">            lastTime = now;</span><br><span class="line">            <span class="keyword">if</span> (nanos &lt;= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> futures;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Future&lt;T&gt; f : futures) {</span><br><span class="line">            <span class="keyword">if</span> (!f.isDone()) {</span><br><span class="line">                <span class="keyword">if</span> (nanos &lt;= <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">return</span> futures;</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="comment">//&#x6BCF;&#x6B21;&#x90FD;&#x8BA1;&#x7B97;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x8C03;&#x7528;&#x975E;&#x963B;&#x585E;&#x7684;get()&#x65B9;&#x6CD5;</span></span><br><span class="line">                    f.get(nanos, TimeUnit.NANOSECONDS);</span><br><span class="line">                } <span class="keyword">catch</span> (CancellationException ignore) {</span><br><span class="line">                } <span class="keyword">catch</span> (ExecutionException ignore) {</span><br><span class="line">                } <span class="keyword">catch</span> (TimeoutException toe) {</span><br><span class="line">                    <span class="keyword">return</span> futures;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">long</span> now = System.nanoTime();</span><br><span class="line">                nanos -= now - lastTime;</span><br><span class="line">                lastTime = now;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        done = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> futures;</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">if</span> (!done)</span><br><span class="line">            <span class="keyword">for</span> (Future&lt;T&gt; f : futures)</span><br><span class="line">                f.cancel(<span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x81F3;&#x6B64;&#xFF0C;ThreadPoolExecutor&#x5176;&#x7236;&#x7C7B;&#x548C;&#x63A5;&#x53E3;&#x7684;&#x6E90;&#x7801;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x5B8C;&#x4E86;&#xFF0C;&#x800C;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6E90;&#x7801;&#x5206;&#x6790;&#x624D;&#x521A;&#x521A;&#x5F00;&#x59CB;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x8010;&#x5FC3;&#x5B66;&#x4E60;&#x4E0B;&#x53BB;&#x3002; </p>
]]></content>
      <categories>
        <category>thread-pool</category>
      </categories>
  </entry>
  <entry>
    <title>线程池2:ThreadPoolExecutor原理</title>
    <url>/2020/thread-pool-executor-yuan-li/</url>
    <content><![CDATA[<p>&#x8F6C;&#x8F7D;&#x81EA;<a href="https://www.jianshu.com/p/4002212ee4f5" target="_blank" rel="noopener">&#x300A;&#x7EBF;&#x7A0B;&#x6C60;&#x7CFB;&#x5217;&#x4E8C;&#x300B;-ThreadPoolExecutor-&#x7EBF;&#x7A0B;&#x6C60;&#x539F;&#x7406;&#x89E3;&#x6790;</a></p>
<blockquote>
<p>&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x90FD;&#x4F7F;&#x7528;&#x8FC7;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x4E5F;&#x4E86;&#x89E3;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x597D;&#x5904;&#x3002;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x6700;&#x591A;&#x7684;&#x8FD8;&#x662F;&#x4F7F;&#x7528;Executors&#x5DE5;&#x5177;&#x7C7B;&#x521B;&#x5EFA;FixedThreadPool&#x3001;SingleThreadPool&#x4EE5;&#x53CA;CachedThreadPool&#x4E09;&#x79CD;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x4E86;&#x89E3;&#x5176;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xFF0C;&#x5C06;&#x4F1A;&#x78B0;&#x5230;&#x5F88;&#x591A;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4F8B;&#x5982;&#x5185;&#x5B58;&#x88AB;&#x6491;&#x7206;&#xFF0C;cpu&#x88AB;&#x6253;&#x6EE1;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x65E0;&#x6545;&#x4E2D;&#x65AD;&#xFF0C;&#x5173;&#x95ED;&#x7EBF;&#x7A0B;&#x6C60;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;shutdown()&#x8FD8;&#x662F;shutdownNow()&#x7B49;&#x7B49;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5C06;&#x8BB2;&#x89E3;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x662F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x51FA;&#x73B0;&#x4E0A;&#x8FF0;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x4F55;&#x79CD;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5982;&#x4F55;&#x5B9A;&#x4E49;&#x7EBF;&#x7A0B;&#x6C60;&#x7EBF;&#x7A0B;&#x7684;&#x4E2A;&#x6570;&#x7B49;&#x7B49;&#x3002;&#x672C;&#x6587;&#x91C7;&#x7528;JDK8&#x6E90;&#x7801;&#x8FDB;&#x884C;&#x8BB2;&#x89E3;&#xFF0C;&#x4E3B;&#x8981;&#x8BB2;&#x89E3;&#x539F;&#x7406;&#x4E3A;&#x4E3B;&#xFF0C;&#x4E0D;&#x8FC7;&#x591A;&#x7684;&#x6D89;&#x53CA;&#x5230;&#x6E90;&#x7801;&#x3002;  </p>
</blockquote>
<h1 id="&#x7EBF;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;">1. &#x7EBF;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;</h1><p>&#x4E0D;&#x8BB2;&#x4E66;&#x672C;&#x77E5;&#x8BC6;&#xFF0C;&#x53EA;&#x662F;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;new Thread(); new Runnable(); new Callable(); &#xFF08;&#x5C3D;&#x7BA1;&#x4E0D;&#x80FD;new &#x63A5;&#x53E3;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x8BF4;&#x660E;&#x610F;&#x601D;&#xFF0C;&#x4E0D;&#x8981;&#x8F83;&#x771F;&#xFF09;&#xFF0C;&#x8BF7;&#x95EE;&#x8FD9;&#x4EE3;&#x8868;&#x7EBF;&#x7A0B;&#x5417;&#xFF1F; </p>
<p>&#x4E00;&#x5B9A;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x90FD;&#x662F;&#x7C7B;&#xFF0C;java&#x4E2D;&#x7684;&#x7C7B;&#xFF0C;&#x4E0D;&#x662F;&#x7EBF;&#x7A0B;&#xFF0C;&#x5343;&#x4E07;&#x4E0D;&#x8981;&#x770B;&#x5230;thread&#xFF0C; runnable&#xFF0C; callable&#x5C31;&#x8BA4;&#x4E3A;&#x662F;&#x7EBF;&#x7A0B;&#xFF0C;&#x5B83;&#x4EEC;&#x548C;Object&#xFF0C; List&#xFF0C;Map&#x4E00;&#x6837;&#x662F;java&#x8BED;&#x8A00;&#x7684;&#x7C7B;&#x800C;&#x5DF2;&#x3002; &#x6216;&#x8005;&#x53EF;&#x4EE5;&#x8BF4;&#x4ED6;&#x4EEC;&#x662F;&#x4EFB;&#x52A1;&#xFF0C;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x5185;&#x90E8;&#x90FD;&#x6709;&#x7EBF;&#x7A0B;&#x8981;&#x6267;&#x884C;&#x7684;&#x65B9;&#x6CD5;run()&#x6216;&#x8005;call()&#xFF0C;&#x90A3;&#x4EC0;&#x4E48;&#x624D;&#x662F;&#x7EBF;&#x7A0B;&#x5462;&#xFF1F; </p>
<p>new Thread().start(); &#x8C03;&#x7528;&#x4E86;start()&#x65B9;&#x6CD5;&#x624D;&#x4F1A;&#x5728;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5C42;&#x9762;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#x90FD;&#x662F;&#x627F;&#x8F7D;&#x4E86;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x65B9;&#x6CD5;&#x7684;&#x7C7B;&#x800C;&#x5DF2;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x5927;&#x5BB6;&#x4E00;&#x5B9A;&#x8981;&#x5206;&#x6E05;&#x695A;&#x3002; </p>
<a id="more"></a>

<h1 id="&#x591A;&#x7EBF;&#x7A0B;">2. &#x591A;&#x7EBF;&#x7A0B;</h1><p>&#x591A;&#x7EBF;&#x7A0B;&#x4E00;&#x5B9A;&#x6BD4;&#x5355;&#x7EBF;&#x7A0B;&#x5FEB;&#x5417;&#xFF1F;&#x8FD9;&#x4E2A;&#x7B54;&#x6848;&#x662F;&#x5426;&#x5B9A;&#x7684;&#xFF0C;&#x5728;&#x5355;&#x6838;&#x5904;&#x7406;&#x5668;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x52BF;&#x5FC5;&#x4F1A;&#x5F15;&#x8D77;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#xFF0C;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x4F1A;&#x5BF9;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x6267;&#x884C;&#x73AF;&#x5883;&#x8FDB;&#x884C;&#x4FDD;&#x5B58;&#xFF0C;&#x5E76;&#x8FD8;&#x539F;&#x5C06;&#x8981;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x7684;&#x6267;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x5B58;&#x5728;&#x5F00;&#x9500;&#x3002;&#x591A;&#x7EBF;&#x7A0B;&#x4E0E;&#x5355;&#x7EBF;&#x7A0B;&#x76F8;&#x6BD4;&#xFF0C;&#x591A;&#x51FA;&#x4E86;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x5355;&#x6838;&#x5904;&#x7406;&#x5668;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x591A;&#x7EBF;&#x7A0B;&#x5E76;&#x4E0D;&#x4F1A;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002; </p>
<p>&#x73B0;&#x4ECA;&#xFF0C;&#x5904;&#x7406;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x662F;&#x591A;&#x6838;&#x591A;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x56E0;&#x6B64;&#x5408;&#x7406;&#x4F7F;&#x7528;&#x591A;&#x7EBF;&#x7A0B;&#x7F16;&#x7A0B;&#x5C06;&#x53D6;&#x5F88;&#x5927;&#x7684;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x3002;&#x4F46;&#x662F;&#x5F53;&#x7EBF;&#x7A0B;&#x6570;&#x8FC7;&#x591A;&#xFF0C;&#x5F15;&#x8D77;&#x8FC7;&#x591A;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#xFF0C;&#x5F53;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x7684;&#x5F00;&#x9500;&#x5927;&#x4E8E;&#x591A;&#x7EBF;&#x7A0B;&#x5E26;&#x6765;&#x7684;&#x6536;&#x76CA;&#x7684;&#x8BDD;&#xFF0C;&#x6027;&#x80FD;&#x5C06;&#x4F1A;&#x4E0B;&#x964D;&#x3002;&#x6EE5;&#x7528;&#x591A;&#x7EBF;&#x7A0B;&#x5C06;&#x4F1A;&#x662F;&#x4E00;&#x573A;&#x707E;&#x96BE;&#x3002; </p>
<h1 id="&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5F15;&#x5165;">3. &#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5F15;&#x5165;</h1><p>&#x9996;&#x5148;&#x4ECE;&#x7EBF;&#x7A0B;&#x7C7B;Thread&#x8BB2;&#x8D77;&#xFF0C;Thread&#x7C7B;&#x5177;&#x6709;&#x4E24;&#x4E2A;&#x529F;&#x80FD;&#xFF1A; </p>
<ol>
<li>&#x7EF4;&#x62A4;&#x7EBF;&#x7A0B; &#x7EBF;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x3001;&#x4F11;&#x7720;&#x3001;&#x4E2D;&#x65AD;&#x3001;&#x6682;&#x505C;&#x3001;&#x9500;&#x6BC1;</li>
<li>&#x6267;&#x884C;&#x4EFB;&#x52A1; Thread&#x7C7B;&#x53CA;&#x5176;&#x5B50;&#x7C7B;run()&#xFF0C; Runnable&#x5BF9;&#x8C61;&#x7684;run(), Callable&#x5BF9;&#x8C61;&#x7684;call() &#xFF08;&#x66F4;&#x51C6;&#x786E;&#x7684;&#x8BF4;&#x5E94;&#x8BE5;&#x662F;FutureTask&#xFF0C;&#x56E0;&#x4E3A;Callable&#x5BF9;&#x8C61;&#x5E76;&#x4E0D;&#x80FD;&#x4F20;&#x5165;Thread&#x7C7B;&#xFF09;</li>
</ol>
<p>Thread&#x7C7B;&#x5C06;&#x7EBF;&#x7A0B;&#x548C;&#x4EFB;&#x52A1;&#x8026;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x4E00;&#x822C;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4E3A;&#xFF1A;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x4EFB;&#x52A1;&#x5C31;&#x9700;&#x8981;&#x591A;&#x5C11;&#x4E2A;&#x7EBF;&#x7A0B;&#x53BB;&#x6267;&#x884C;&#xFF0C;&#x5E76;&#x53D1;&#x7684;&#x4EFB;&#x52A1;&#x6570;&#x592A;&#x591A;&#xFF0C;&#x5C31;&#x4F1A;&#x5F15;&#x8D77;&#x5927;&#x91CF;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#xFF0C;&#x4EE5;&#x53CA;&#x7EBF;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x9500;&#x6BC1;&#xFF08;&#x7EBF;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#x90FD;&#x8BBE;&#x8BA1;&#x5230;&#x5185;&#x6838;&#x6001;&#x548C;&#x7528;&#x6237;&#x6001;&#x7684;&#x8F6C;&#x6362;&#xFF0C;&#x5F00;&#x9500;&#x4E5F;&#x4E0D;&#x5BB9;&#x5C0F;&#x89D1;&#xFF09;&#x3002; </p>
<p>&#x4E3A;&#x4E86;&#x80FD;&#x5BF9;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x7684;&#x7BA1;&#x7406;&#x548C;&#x590D;&#x7528;&#xFF0C;&#x5F15;&#x5165;&#x4E86;&#x7EBF;&#x7A0B;&#x6C60;&#x3002;&#x7EBF;&#x7A0B;&#x6C60;&#x5BF9;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x7684;&#x7BA1;&#x7406;&#xFF0C;&#x5E76;&#x53EF;&#x4EE5;&#x5F39;&#x6027;&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x5C06;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x548C;&#x7EBF;&#x7A0B;&#x5B8C;&#x5168;&#x5206;&#x79BB;&#xFF0C;&#x4EFB;&#x52A1;&#x5B58;&#x653E;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x7EBF;&#x7A0B;&#x4E0D;&#x65AD;&#x7684;&#x53BB;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x3002;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x7EBF;&#x7A0B;&#x590D;&#x7528;&#x7684;&#x76EE;&#x7684;&#xFF08;&#x8BF4;&#x767D;&#x4E86;&#xFF0C;&#x7EBF;&#x7A0B;&#x5728;&#x6B7B;&#x5FAA;&#x73AF;&#x4E2D;&#x53BB;&#x963B;&#x585E;&#x961F;&#x5217;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x5C31;&#x963B;&#x585E;&#xFF0C;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x5230;&#x5C31;&#x6267;&#x884C;&#xFF0C;&#x5176;run&#xFF08;&#xFF09;&#x65B9;&#x6CD5;&#x4E00;&#x76F4;&#x6267;&#x884C;&#xFF09;&#xFF0C;&#x8FD9;&#x6837;&#x7EBF;&#x7A0B;&#x4E0E;&#x4EFB;&#x52A1;&#x4E2A;&#x6570;&#x6BD4;&#x4E3A;m:n &#x5176;&#x4E2D;m&lt;&lt;&lt;n </p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x7F16;&#x5199;&#x591A;&#x7EBF;&#x7A0B;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x6700;&#x597D;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x3002; </p>
<h1 id="&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x53C2;&#x6570;">4. &#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x53C2;&#x6570;</h1><ul>
<li>corePoolSize</li>
</ul>
<p>&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x5F53;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x65F6;&#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x6570;&#x5C0F;&#x4E8E;corePoolSize&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x8BE5;&#x4EFB;&#x52A1;&#xFF0C;&#x5426;&#x5219;&#xFF0C;&#x5C06;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217; </p>
<ul>
<li>maximumPoolSize</li>
</ul>
<p>&#x6700;&#x5927;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x5F53;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;&#x4EFB;&#x52A1;&#x9700;&#x6DFB;&#x52A0;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E14;&#x963B;&#x585E;&#x961F;&#x5217;&#x6EE1;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x6570;&#x5C0F;&#x4E8E;maximumPoolSize&#xFF0C;&#x5219;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x8BE5;&#x4EFB;&#x52A1;&#xFF0C;&#x5426;&#x5219;&#x6267;&#x884C;&#x62D2;&#x7EDD;&#x7B56;&#x7565; </p>
<p>&#x6CE8;&#xFF1A;&#x5982;&#x679C;&#x963B;&#x585E;&#x961F;&#x5217;&#x91C7;&#x7528;&#x7684;&#x662F;&#x65E0;&#x754C;&#x961F;&#x5217;&#x7684;&#x8BDD;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x65E0;&#x610F;&#x4E49;&#xFF0C;&#x56E0;&#x4E3A;&#x963B;&#x585E;&#x961F;&#x5217;&#x65E0;&#x754C;&#x5C31;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x6EE1; </p>
<ul>
<li>keepAliveTime</li>
</ul>
<p>&#x7EBF;&#x7A0B;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#xFF0C;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#x8D85;&#x8FC7;&#x8BE5;&#x65F6;&#x95F4;&#x5219;&#x9500;&#x6BC1;&#x7EBF;&#x7A0B;&#xFF0C;&#x53EA;&#x5BF9;&#x5927;&#x4E8E;corePoolSize~maximumPoolSize&#x7684;&#x7EBF;&#x7A0B;&#x6709;&#x6548;&#xFF0C;&#x5373;&#x81F3;&#x5C11;&#x4FDD;&#x7559;corePoolSize&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x5373;&#x4FBF;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#x5927;&#x4E8E;keepAliveTime&#x4E5F;&#x4E0D;&#x9500;&#x6BC1;&#x3002;&#xFF08;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x9500;&#x6BC1;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x8FC7;&#x671F;&#xFF09; </p>
<p>&#x6CE8;&#xFF1A;&#x5982;&#x679C;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E3A;&#x65E0;&#x754C;&#xFF0C;&#x5219;maximumPoolSize&#x65E0;&#x610F;&#x4E49;&#xFF0C;&#x90A3;&#x4E48;keepAliveTime&#x4E5F;&#x5C31;&#x65E0;&#x610F;&#x4E49; </p>
<ul>
<li>unit</li>
</ul>
<p>keepAliveTime&#x7684;&#x65F6;&#x95F4;&#x5355;&#x4F4D; </p>
<ul>
<li>workQueue</li>
</ul>
<p>&#x963B;&#x585E;&#x961F;&#x5217;&#xFF0C;&#x5206;&#x4E3A;&#x6709;&#x754C;&#x961F;&#x5217;&#x548C;&#x65E0;&#x754C;&#x961F;&#x5217;&#xFF0C;&#x4E00;&#x822C;&#x4F7F;&#x7528;LinkedBlockingQueue&#x3001;SynchronousQueue&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x4EFB;&#x52A1;&#xFF0C;&#x963B;&#x585E;&#x961F;&#x5217;&#x7684;&#x6CDB;&#x578B;&#x5FC5;&#x987B;&#x662F;Runnable </p>
<ul>
<li>threadFactory</li>
</ul>
<p>&#x7EBF;&#x7A0B;&#x5DE5;&#x5382;&#xFF0C;&#x8D1F;&#x8D23;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#xFF0C;&#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x540D;&#xFF0C;&#x7EBF;&#x7A0B;&#x7EC4;&#xFF0C;&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x662F;&#x5426;&#x4E3A;&#x5B88;&#x62A4;&#x7EBF;&#x7A0B;&#x7B49;&#x4FE1;&#x606F; </p>
<ul>
<li>handler</li>
</ul>
<p>&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#xFF0C;&#x5F53;&#x963B;&#x585E;&#x961F;&#x5217;&#x653E;&#x4E0D;&#x4E0B;&#xFF0C;&#x4E14;&#x7EBF;&#x7A0B;&#x6570;&#x8FBE;&#x5230;&#x6700;&#x5927;&#x503C;maximumPoolSize&#x65F6;&#xFF0C;&#x518D;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#xFF0C;&#x6539;&#x4EFB;&#x52A1;&#x4F1A;&#x88AB;&#x62D2;&#x7EDD;&#x3002;&#x76EE;&#x524D;&#xFF0C;JDK&#x63D0;&#x4F9B;&#x4E86;&#x56DB;&#x79CD;&#x62D2;&#x7EDD;&#x7B56;&#x7565; </p>
<ol>
<li>CallerRunsPolicy &#x8C03;&#x7528;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7B56;&#x7565;&#xFF0C;&#x5F53;&#x524D;&#x6267;&#x884C;&#x7684;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x8BE5;&#x4EFB;&#x52A1;&#xFF0C;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x4EFB;&#x52A1;&#x4E0D;&#x4E22;&#x5931;&#xFF0C;&#x51CF;&#x7F13;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x7684;&#x901F;&#x5EA6;</li>
<li>AbortPolicy &#x76F4;&#x63A5;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x7EBF;&#x7A0B;&#x6C60;&#x629B;&#x5F02;&#x5E38;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x4E0D;&#x53EF;&#x7528;&#xFF0C;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</li>
<li>DiscardPolicy &#x76F4;&#x63A5;&#x4E22;&#x5F03;&#x8BE5;&#x4EFB;&#x52A1;</li>
<li>DiscardOldestPolicy &#x4E22;&#x5F03;&#x6700;&#x8001;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x91CD;&#x8BD5;&#x6DFB;&#x52A0;&#x8BE5;&#x4EFB;&#x52A1;</li>
</ol>
<p>&#x6CE8;&#xFF1A;&#x5982;&#x679C;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E3A;&#x65E0;&#x754C;&#xFF0C;&#x5219;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#x65E0;&#x6548;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x4F1A;&#x5B58;&#x5728;&#x4EFB;&#x52A1;&#x653E;&#x4E0D;&#x4E0B;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#x3002;&#x8BE5;&#x53C2;&#x6570;&#x4E00;&#x5B9A;&#x8981;&#x91CD;&#x89C6; </p>
<h1 id="&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;">5. &#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;</h1><p>&#x6784;&#x9020;&#x7EBF;&#x7A0B;&#x6C60;&#x65E0;&#x975E;&#x5C31;&#x662F;&#x4E3A;&#x4E0A;&#x8282;&#x4E2D;&#x4ECB;&#x7ECD;&#x7684;&#x51E0;&#x4E2A;&#x53C2;&#x6570;&#x8D4B;&#x503C;&#xFF0C;&#x6E90;&#x7801;&#x5982;&#x4E0B; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">              <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">              <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">              TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">              BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">              ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">              RejectedExecutionHandler handler)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4ED6;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x90FD;&#x662F;&#x95F4;&#x63A5;&#x8C03;&#x7528;&#x8BE5;&#x6784;&#x9020;&#x51FD;&#x6570; </p>
<h1 id="&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;">6. &#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;</h1><ol>
<li>&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x4F55;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&lt;corPoolSize&#xFF0C;<strong>&#x4E0D;&#x7BA1;&#x662F;&#x5426;&#x6709;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#x90FD;&#x4F1A;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x6267;&#x884C;</strong></li>
<li>&#x5982;&#x4F55;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&gt;=corPoolSize&#xFF0C;&#x5C06;&#x4EFB;&#x52A1;&#x63D0;&#x4EA4;&#x7ED9;&#x963B;&#x585E;&#x961F;&#x5217;</li>
<li>&#x5982;&#x679C;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E0D;&#x6EE1;&#xFF0C;&#x6DFB;&#x52A0;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#xFF0C;&#x5426;&#x5219;&#x6267;&#x884C;4</li>
<li>&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&lt;maxPoolSize,&#x4E14;&#x4E0D;&#x5B58;&#x5728;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x8BE5;&#x4EFB;&#x52A1;&#xFF0C;&#x5426;&#x5219;&#x6267;&#x884C;5</li>
<li>&#x6267;&#x884C;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</li>
</ol>
<p><strong>&#x7B2C;&#x4E00;&#x6B65;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x5728;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;excutor&#x4F1A;&#x4E0D;&#x4F1A;&#x5224;&#x65AD;&#x6709;&#x65E0;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#xFF0C;&#x7B54;&#x6848;&#x662F;&#x4E0D;&#x4F1A;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x6BCF;&#x6B21;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x90FD;&#x9700;&#x8981;&#x5224;&#x65AD;&#x6709;&#x65E0;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#xFF0C;&#x5C06;&#x4F1A;&#x9020;&#x6210;&#x5F88;&#x5927;&#x7684;&#x5F00;&#x9500;&#xFF0C;excutor&#x7684;&#x505A;&#x6CD5;&#x662F;&#xFF0C;&#x542F;&#x52A8;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;worker&#x5728;&#x7A7A;&#x95F2;&#x65F6;&#x90FD;&#x4F1A;&#x53BB;&#x963B;&#x585E;&#x961F;&#x91CC;&#x963B;&#x585E;&#x7684;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x5219;worker&#x4F1A;&#x963B;&#x585E;&#xFF0C;&#x56E0;&#x4E3A;worker&#x5230;&#x5E95;&#x7A7A;&#x4E0D;&#x7A7A;&#x95F2;worker&#x81EA;&#x5DF1;&#x662F;&#x6700;&#x6E05;&#x695A;&#x7684;&#x3002;</strong></p>
<p>&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B8C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x4ECE;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#xFF0C;&#x5219;&#x963B;&#x585E;&#x7B49;&#x5F85;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4EFB;&#x52A1;&#x5219;&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x6267;&#x884C;&#x3002;&#x4E0E;&#x6B64;&#x540C;&#x65F6;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x6709;&#x4E13;&#x95E8;&#x7684;&#x7EBF;&#x7A0B;&#x575A;&#x6301;&#x7EBF;&#x7A0B;&#x7684;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#xFF08;&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x7684;&#x65F6;&#x95F4;&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x6307;&#x5B9A;&#x65F6;&#x95F4;&#x4E14;&#x7EBF;&#x7A0B;&#x6570;&gt;corePoolSize&#xFF0C;&#x5C31;&#x9500;&#x6BC1;&#x7EBF;&#x7A0B;&#x3002; </p>
<h2 id="Executors&#x63D0;&#x4F9B;&#x7684;&#x4E09;&#x79CD;&#x7EBF;&#x7A0B;&#x6C60;">6.1. Executors&#x63D0;&#x4F9B;&#x7684;&#x4E09;&#x79CD;&#x7EBF;&#x7A0B;&#x6C60;</h2><ul>
<li>FixedThreadPool</li>
</ul>
<p>&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5176;&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">      <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">      <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;&#x6E90;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;corePoolSize&#x548C;maximumPoolSize&#x90FD;&#x4E3A;&#x6307;&#x5B9A;&#x5927;&#x5C0F;&#xFF0C;&#x963B;&#x585E;&#x961F;&#x5217;&#x4F7F;&#x7528;&#x65E0;&#x754C;&#x963B;&#x585E;&#x961F;&#x5217;&#xFF08;&#x770B;&#x5230;&#x65E0;&#x754C;&#x963B;&#x585E;&#x961F;&#x5217;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x60F3;&#x5230;maximumPoolSize&#x3001;keepAliveTime&#x3001;handler&#x90FD;&#x65E0;&#x6548;&#xFF09;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x6709;&#x7528;&#x7684;&#x53C2;&#x6570;&#x53EA;&#x6709;corePoolSize&#x548C;workQueue&#x662F;&#x6709;&#x610F;&#x4E49;&#x7684;&#x3002; </p>
<p>&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;&#xFF1A;&#x5F53;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x7684;&#x8F83;&#x6162;&#xFF0C;&#x4E14;&#x4EFB;&#x52A1;&#x63D0;&#x4EA4;&#x7684;&#x901F;&#x5EA6;&#x8FC7;&#x5FEB;&#x65F6;&#xFF0C;&#x4F1A;&#x6709;&#x5927;&#x91CF;&#x7684;&#x4EFB;&#x52A1;&#x5B58;&#x653E;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x963B;&#x585E;&#x961F;&#x5217;&#x4F1A;&#x8D8A;&#x6765;&#x8D8A;&#x5927;&#xFF0C;&#x5185;&#x5B58;&#x4F1A;&#x88AB;&#x6491;&#x7206;&#xFF0C;&#x4F7F;&#x7528;&#x8BE5;&#x7EBF;&#x7A0B;&#x6C60;&#x65F6;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x8003;&#x8651;&#x6E05;&#x695A;&#x3002; </p>
<p>&#x9664;&#x4E86;&#x8BE5;&#x65B9;&#x6CD5;&#x5916;&#xFF0C;Executors&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;ThreadFactory&#xFF0C;&#x4F46;&#x662F;&#x5374;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x4FEE;&#x6539;&#x963B;&#x585E;&#x961F;&#x5217;&#x7684;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5; </p>
<p>&#x4F7F;&#x7528;&#x573A;&#x666F;&#xFF1A; &#x8D1F;&#x8F7D;&#x8F83;&#x91CD;&#x7684;&#x670D;&#x52A1;&#x5668; </p>
<ul>
<li>SingleThreadPool</li>
</ul>
<p>&#x5F53;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x4E0E;FixedThreadPool&#x76F8;&#x6BD4;&#x5C31;&#x662F;&#x5C06;&#x7EBF;&#x7A0B;&#x6570;&#x6307;&#x5B9A;&#x4E3A;1&#xFF0C;&#x540C;&#x6837;&#x8BE5;&#x7EBF;&#x7A0B;&#x6C60;&#x5B58;&#x5728;FixedThreadPool&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5176;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E0E;FixedThreadPool&#x7C7B;&#x578B;&#xFF0C;Executors&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x6307;&#x5B9A;ThreadFactory&#x7684;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5; </p>
<p>&#x4F7F;&#x7528;&#x573A;&#x666F;&#xFF1A; &#x5355;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x4FDD;&#x8BC1;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x5404;&#x4E2A;&#x4EFB;&#x52A1;&#x7684;&#x573A;&#x666F; </p>
<ul>
<li>CachedThreadPool</li>
</ul>
<p>&#x4F7F;&#x7528;SynchronousQueue&#x963B;&#x585E;&#x961F;&#x5217;&#xFF0C;&#x8BE5;&#x961F;&#x5217;&#x4E0D;&#x4FDD;&#x5B58;&#x5143;&#x7D20;&#xFF0C;&#x6709;&#x4EFB;&#x52A1;&#x63D0;&#x4EA4;&#x5230;&#x963B;&#x585E;&#x961F;&#x5217;&#x65F6;&#xFF0C;&#x4EFB;&#x52A1;&#x5FC5;&#x987B;&#x7ACB;&#x5373;&#x88AB;&#x5904;&#x7406;&#x3002;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x6E90;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;maximumPoolSize&#x7684;&#x503C;&#x4E3A;Integer.MAX_VALUE&#xFF0C;&#x610F;&#x5473;&#x7740;&#x53EA;&#x8981;&#x6709;&#x4EFB;&#x52A1;&#x5230;&#x8FBE;&#xFF0C;&#x4E14;&#x7EBF;&#x7A0B;&#x6C60;&#x5185;&#x6CA1;&#x6709;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#xFF0C;&#x5C31;&#x7ED9;&#x4EFB;&#x52A1;&#x5F00;&#x8F9F;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53BB;&#x6267;&#x884C;&#x3002;&#x7EBF;&#x7A0B;&#x7A7A;&#x95F2;60s&#x5C31;&#x9500;&#x6BC1; </p>
<p>&#x5B58;&#x5728;&#x95EE;&#x9898;&#xFF1A;&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x957F;&#xFF0C;&#x63D0;&#x4EA4;&#x901F;&#x5EA6;&#x5FEB;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x4EA7;&#x751F;&#x5927;&#x91CF;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5F15;&#x8D77;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#xFF0C;&#x5E94;&#x7528;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x5047;&#x6B7B;&#x6216;&#x8005;&#x5D29;&#x6E83;&#x7684;&#x60C5;&#x51B5;&#x3002; </p>
<p>&#x540C;&#x6837;&#xFF0C;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;ThreadFactory&#x7684;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;<br>&#x4F7F;&#x7528;&#x573A;&#x666F;&#xFF1A;&#x9002;&#x7528;&#x4E8E;&#x5927;&#x91CF;&#x77ED;&#x671F;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#xFF0C;&#x6216;&#x8005;&#x8D1F;&#x8F7D;&#x8F83;&#x8F7B;&#x7684;&#x670D;&#x52A1;&#x5668; </p>
<p>&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF1A;Executors&#x63D0;&#x4F9B;&#x7684;&#x4E09;&#x79CD;&#x7EBF;&#x7A0B;&#x6C60;&#x90FD;&#x5404;&#x81EA;&#x6709;&#x4F18;&#x7F3A;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5EFA;&#x8BAE;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x8FD9;&#x4E09;&#x79CD;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x6307;&#x5B9A;&#x81EA;&#x5DF1;&#x7684;corePoolSize&#xFF0C;maximumPoolSize&#xFF0C;keepAliveTime&#xFF0C;&#x963B;&#x585E;&#x961F;&#x5217;workQueue&#xFF0C;ThreadFactory&#xFF0C;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#xFF0C;&#x81EA;&#x5DF1;&#x6307;&#x5B9A;&#x7684;&#x4F18;&#x70B9;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x573A;&#x666F;&#x7075;&#x6D3B;&#x7684;&#x5BF9;&#x5404;&#x4E2A;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002; </p>
<h1 id="&#x7EBF;&#x7A0B;&#x6C60;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;">7. &#x7EBF;&#x7A0B;&#x6C60;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;</h1><ul>
<li>submit()</li>
</ul>
<p>&#x63D0;&#x4EA4;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;Future&#x7C7B;&#x578B;&#xFF08;&#x771F;&#x6B63;&#x7684;&#x7C7B;&#x578B;&#x662F;RunnableFuture&#xFF0C;&#x800C;&#x5B9E;&#x73B0;RunnableFuture&#x63A5;&#x53E3;&#x7684;&#x5728;JDK&#x5B9E;&#x73B0;&#x4E2D;&#x5BF9;&#x5916;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x53EA;&#x6709;FutureTask&#x7C7B; </p>
<p>&#x6709;&#x5173;FutureTask&#x7684;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6211;&#x7684;&#x53E6;&#x5916;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#xFF1A; <a href="https://www.jianshu.com/p/36f8f3b8ee55" target="_blank" rel="noopener">FutureTask&#x539F;&#x7406;&#x8BB2;&#x89E3;&#x4E0E;&#x6E90;&#x7801;&#x5256;&#x6790;</a>&#xFF09; </p>
<ul>
<li>execute()</li>
</ul>
<p>&#x63D0;&#x4EA4;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x4EFB;&#x52A1; </p>
<h2 id="&#x7EBF;&#x7A0B;&#x6C60;&#x5173;&#x95ED;">7.1. &#x7EBF;&#x7A0B;&#x6C60;&#x5173;&#x95ED;</h2><ul>
<li>shutdown()</li>
</ul>
<p>&#x5C06;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A;shutdown&#xFF0C;&#x7981;&#x6B62;&#x5411;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#xFF0C;&#x5E76;&#x6267;&#x884C;&#x5B8C;&#x5DF2;&#x7ECF;&#x63D0;&#x4EA4;&#x7684;&#x4EFB;&#x52A1; </p>
<ul>
<li>shutdonwNow()</li>
</ul>
<p>&#x5C06;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A;stop&#xFF0C; &#x7ACB;&#x5373;&#x7EC8;&#x6B62;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C; &#x4E0D;&#x5904;&#x7406;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD4;&#x56DE;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x7684;&#x5217;&#x8868; </p>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;isTerminated()&#x65B9;&#x6CD5;&#x5224;&#x65AD;&#x7EBF;&#x7A0B;&#x6C60;&#x662F;&#x5426;&#x5B8C;&#x5168;&#x5173;&#x95ED;<br>&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;awaitTermination(long timeout, TimeUnit unit)&#x6700;&#x957F;&#x7B49;&#x5F85;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#x9000;&#x51FA;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x5173;&#x95ED; </p>
<h1 id="&#x5982;&#x4F55;&#x5206;&#x914D;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5927;&#x5C0F;">8. &#x5982;&#x4F55;&#x5206;&#x914D;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5927;&#x5C0F;</h1><p>&#x4E00;&#x822C;&#x6765;&#x8BB2;&#x6CA1;&#x6709;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x7684;&#x591A;&#x7EBF;&#x7A0B;&#x7A0B;&#x5E8F;&#x662F;&#x6700;&#x597D;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x6709;n&#x4E2A;&#x6838;&#xFF0C;&#x90A3;&#x4E48;&#x542F;&#x52A8;n&#x4E2A;&#x7EBF;&#x7A0B;&#x5C31;&#x53EF;&#x4EE5;&#x3002;&#x4F46;&#x662F;&#x7EBF;&#x7A0B;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x76F4;&#x5904;&#x4E8E;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF08;&#x53EF;&#x80FD;&#x5728;&#x7B49;&#x5F85;IO&#x653E;&#x5F03;&#x4E86;cpu&#x8D44;&#x6E90;&#xFF09;&#xFF0C;&#x8FD9;&#x6837;cpu&#x8D44;&#x6E90;&#x5C31;&#x4F1A;&#x6D6A;&#x8D39;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x4EFB;&#x52A1;&#x8BBE;&#x5B9A;&#x4E0D;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x3002; </p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x83B7;&#x53D6;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x83B7;&#x53D6;&#xFF1A; </p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">Runtime</span>.</span></span>get<span class="constructor">Runtime()</span>.available<span class="constructor">Processors()</span>;</span><br></pre></td></tr></table></figure>


<p>&#x6CE8;&#x610F;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;docker&#x5BB9;&#x5668;&#xFF0C;&#x4F7F;&#x7528;&#x8BE5;&#x53C2;&#x6570;&#x83B7;&#x53D6;&#x7684;&#x662F;&#x5B9E;&#x673A;&#x7684;&#x6838;&#x6570;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x5206;&#x914D;&#x7ED9;docker&#x5BB9;&#x5668;&#x7684;&#x6838;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x78B0;&#x5230;&#x9700;&#x8981;&#x4FEE;&#x6539;&#xFF0C; &#x5177;&#x4F53;&#x60C5;&#x51B5;&#x5177;&#x4F53;&#x5206;&#x6790;&#x3002; </p>
<ol>
<li>&#x9488;&#x5BF9;IO&#x5BC6;&#x96C6;&#x578B;&#x4EFB;&#x52A1;&#xFF1A;&#x4E00;&#x822C;&#x5206;&#x914D;2*p&#x4E2A;&#x7EBF;&#x7A0B;&#xFF08;p&#x4EE3;&#x8868;&#x670D;&#x52A1;&#x5668;cpu&#x603B;&#x6838;&#x6570;&#xFF09;</li>
<li>&#x9488;&#x5BF9;cpu&#x5BC6;&#x96C6;&#x578B;&#x4EFB;&#x52A1;&#xFF1A; &#x4E00;&#x822C;&#x5206;&#x914D; p+1&#x4E2A;&#x7EBF;&#x7A0B;</li>
</ol>
<h1 id="&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x76D1;&#x63A7;">9. &#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x76D1;&#x63A7;</h1><p>&#x7EBF;&#x7A0B;&#x6C60;&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;&#x53C2;&#x6570;&#xFF0C;&#x6765;&#x8BB0;&#x5F55;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x5404;&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x4E86;&#x89E3;&#x5373;&#x53EF;&#xFF1A; </p>
<ol>
<li>taskCount &#x7EBF;&#x7A0B;&#x6C60;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x603B;&#x6570;</li>
<li>completedTaskCount &#x5DF2;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#x6570;&#x91CF;</li>
<li>largestPoolSize &#x521B;&#x5EFA;&#x8FC7;&#x6700;&#x5927;&#x7684;&#x7EBF;&#x7A0B;&#x6570;</li>
<li>getPoolSize() &#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;</li>
<li>getActiveCount() &#x6D3B;&#x52A8;&#x7EBF;&#x7A0B;&#x6570;</li>
</ol>
<p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;&#x7EBF;&#x7A0B;&#x6C60;&#x7C7B;&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x5B9E;&#x73B0;&#xFF0C; &#x53EF;&#x4EE5;&#x91CD;&#x5199; beforeExecute(), afterExecute(), terminated()&#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;&#x76D1;&#x63A7; </p>
]]></content>
      <categories>
        <category>thread-pool</category>
      </categories>
  </entry>
  <entry>
    <title>线程池1:FutureTask</title>
    <url>/2020/future-task/</url>
    <content><![CDATA[<p>&#x8F6C;&#x8F7D;&#x81EA;<a href="https://www.jianshu.com/p/36f8f3b8ee55" target="_blank" rel="noopener">&#x300A;&#x7EBF;&#x7A0B;&#x6C60;&#x7CFB;&#x5217;&#x4E00;&#x300B;-FutureTask&#x539F;&#x7406;&#x8BB2;&#x89E3;&#x4E0E;&#x6E90;&#x7801;&#x5256;&#x6790;</a></p>
<blockquote>
<p>FutureTask&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;&#xFF0C;&#x5C06;&#x540C;&#x6B65;&#x64CD;&#x4F5C;&#x6539;&#x4E3A;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x670D;&#x52A1;&#x7684;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x548C;&#x541E;&#x5410;&#x91CF;&#x3002;&#x90A3;&#x4E48;FutureTask&#x5E95;&#x5C42;&#x4F7F;&#x7528;&#x4E86;LockSupport&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#xFF0C;&#x90A3;&#x4E48;FutureTask&#x662F;&#x5982;&#x4F55;&#x83B7;&#x53D6;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;&#xFF0C;&#x53C8;&#x662F;&#x5982;&#x4F55;&#x53D6;&#x6D88;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x3002;&#x672C;&#x8282;&#x5C06;&#x901A;&#x8FC7;&#x5176;&#x6E90;&#x7801;&#x8FDB;&#x884C;&#x539F;&#x7406;&#x7684;&#x5256;&#x6790; </p>
</blockquote>
<h1 id="FutureTask&#x7684;&#x4F7F;&#x7528;">1. FutureTask&#x7684;&#x4F7F;&#x7528;</h1><ol>
<li>&#x914D;&#x5408;&#x7EBF;&#x7A0B;&#x6C60;&#x4F7F;&#x7528;<br>&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x7EBF;&#x7A0B;&#x6C60;&#x63D0;&#x4EA4;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;get&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x3002;<a id="more"></a>

</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//&#x521B;&#x5EFA;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;</span></span><br><span class="line">ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">10</span>, <span class="number">10</span>, <span class="number">0</span>, </span><br><span class="line">    TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">100</span>));</span><br><span class="line"><span class="comment">//&#x83B7;&#x53D6;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x7684;&#x7ED3;&#x679C;&#xFF0C;Task&#x662F;&#x5B9E;&#x73B0;callable&#x7684;&#x7C7B;</span></span><br><span class="line">Future&lt;Integer&gt; future = executor.submit(<span class="keyword">new</span> Task());</span><br><span class="line"><span class="comment">//&#x6B64;&#x5904;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x5176;&#x4ED6;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;</span></span><br><span class="line"><span class="comment">//&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;</span></span><br><span class="line">future.get();</span><br></pre></td></tr></table></figure>
<p>&#x4F5C;&#x4E3A;&#x7EBF;&#x7A0B;&#x7684;&#x6267;&#x884C;&#x5BF9;&#x8C61;<br>&#x7531;&#x4E8E;FutureTask&#x5B9E;&#x73B0;&#x4E86;Runnable&#x63A5;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;FtureTask&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;Thread&#x5BF9;&#x8C61;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x6267;&#x884C;&#x4EFB;&#x52A1;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//&#x521B;&#x5EFA;FutureTask&#x5B9E;&#x4F8B;</span></span><br><span class="line">FutureTask futureTask = <span class="keyword">new</span> FutureTask(<span class="keyword">new</span> Task());</span><br><span class="line"><span class="comment">//&#x6267;&#x884C;FutureTask</span></span><br><span class="line"><span class="keyword">new</span> Thread(futureTask).start();</span><br></pre></td></tr></table></figure>

<h1 id="FutureTask&#x4EFB;&#x52A1;&#x7684;&#x72B6;&#x6001;">2. FutureTask&#x4EFB;&#x52A1;&#x7684;&#x72B6;&#x6001;</h1><p>FutureTask&#x5B58;&#x5728;7&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x5176;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;<br><img src="/2020/future-task/FutureTask.png" alt><br>&#x5176;&#x4E2D;&#xFF1A;&#x56FE;&#x4E2D;&#x7684;&#x5B9E;&#x7EBF;&#x7684;&#x989C;&#x8272;&#x4E0D;&#x540C;&#x4EE3;&#x8868;&#x4E0D;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x548C;&#x4EFB;&#x52A1;&#x7684;&#x53D6;&#x6D88;&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;FutureTask&#x4EFB;&#x52A1;&#x6709;&#x56DB;&#x79CD;&#x7ED3;&#x675F;&#x72B6;&#x6001;normal&#x3001;exceptional&#x3001;cancelled&#x3001;interrupted&#x3002;&#x5F53;&#x6267;&#x884C;get()&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E3A;&#x8FD9;&#x56DB;&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x64CD;&#x4F5C;&#x4F1A;&#x88AB;&#x963B;&#x585E;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x8FD9;&#x56DB;&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x5219;&#x6839;&#x636E;&#x72B6;&#x6001;&#x4E0D;&#x540C;&#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x7ED3;&#x679C;&#x3002; </p>
<ol>
<li>new&#xFF1A; &#x65B0;&#x5EFA;&#x4E00;&#x4E2A;FutureTask&#x5B9E;&#x4F8B;&#x65F6;&#x7684;&#x72B6;&#x6001;</li>
<li>completing&#xFF1A; &#x8BE5;&#x4EFB;&#x52A1;&#xFF08;FutureTask&#x5BF9;&#x8C61;&#x88AB;&#x6267;&#x884C;&#xFF0C;&#x8C03;&#x7528;run()&#x65B9;&#x6CD5;&#xFF09;&#x88AB;&#x6267;&#x884C;&#xFF0C;run()&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x5B8C;&#x4E4B;&#x540E;&#x7684;&#x72B6;&#x6001;</li>
<li>normal&#xFF1A; run()&#x65B9;&#x6CD5;&#xFF0C;&#x6B63;&#x5E38;&#x6267;&#x884C;&#x5B8C;</li>
<li>exceptional&#xFF1A; run()&#x65B9;&#x6CD5;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</li>
<li>cancelled&#xFF1A; &#x8C03;&#x7528;&#x4EFB;&#x52A1;&#x7684;cancel(false)&#x65B9;&#x6CD5;</li>
<li>interrupting&#xFF1A; &#x8C03;&#x7528;&#x4EFB;&#x52A1;&#x7684;cancel(true)&#x65B9;&#x6CD5;&#x7684;&#x4E2D;&#x95F4;&#x72B6;&#x6001;&#xFF0C;&#x540E;&#x7EED;&#x8BB2;&#x89E3;&#x4E0E;interruputed&#x7684;&#x4E0D;&#x540C;</li>
<li>interrupted&#xFF1A; &#x8C03;&#x7528;cacel(true)&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4E2D;&#x65AD;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x7684;&#x7EBF;&#x7A0B;</li>
</ol>
<p>&#x6BCF;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;int&#x503C;&#xFF0C;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NEW          = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COMPLETING   = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NORMAL       = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXCEPTIONAL  = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CANCELLED    = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INTERRUPTING = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INTERRUPTED  = <span class="number">6</span>;</span><br></pre></td></tr></table></figure>


<p>2&#x3001;3&#x3001;4&#x3001;6&#x4E3A;&#x7EC8;&#x6B62;&#x72B6;&#x6001; </p>
<h1 id="FutureTask&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;">3. FutureTask&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;</h1><ul>
<li>callable<br>run()&#x65B9;&#x6CD5;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x662F;&#x6307;&#x6267;&#x884C;&#x7684;&#x662F;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;call()&#x65B9;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;FutureTask&#x4E3B;&#x8981;&#x5C31;&#x662F;&#x7528;&#x6765;&#x63A5;&#x6536;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6784;&#x5EFA;FutureTask&#x5B9E;&#x4F8B;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x4F20;&#x5165;callable&#x5BF9;&#x8C61;</li>
<li>outcome<br>&#x5B58;&#x653E;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x7684;&#xFF0C;&#x7C7B;&#x578B;&#x4E3A;Object&#x7C7B;&#x578B;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x6B63;&#x5E38;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x629B;&#x51FA;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x8D4B;&#x503C;</li>
<li>runner<br>&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#xFF0C;&#x6267;&#x884C;run()&#x65B9;&#x6CD5;&#x65F6;&#x8D4B;&#x503C;&#xFF0C;&#x53EA;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6210;&#x4E3A;runner</li>
<li>waiters<br>&#x8C03;&#x7528;get()&#x65B9;&#x6CD5;&#x963B;&#x585E;&#x7684;&#x7EBF;&#x7A0B;&#x4F1A;&#x88AB;&#x6784;&#x9020;&#x4E3A;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x52A0;&#x5165;&#x5230;&#x94FE;&#x8868;waiters&#x4E2D;&#xFF0C;waiters&#x662F;&#x94FE;&#x8868;&#x7684;&#x5934;&#x7ED3;&#x70B9;&#xFF08;&#x5E76;&#x4E0D;&#x662F;&#x6267;&#x884C;get()&#x65B9;&#x6CD5;&#x7684;&#x7EBF;&#x7A0B;&#x90FD;&#x4F1A;&#x88AB;&#x52A0;&#x5165;&#x5230;&#x8BE5;&#x94FE;&#x8868;&#x4E2D;&#xFF0C;&#x4E0B;&#x9762;&#x4F1A;&#x5177;&#x4F53;&#x8BB2;&#x89E3;&#xFF09;</li>
</ul>
<p>&#x8282;&#x70B9;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">WaitNode</span> </span>{</span><br><span class="line">    <span class="keyword">volatile</span> Thread thread;</span><br><span class="line">    <span class="keyword">volatile</span> WaitNode next;</span><br><span class="line">    WaitNode() { thread = Thread.currentThread(); }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<p>&#x5B58;&#x50A8;&#x4E86;&#x7EBF;&#x7A0B;&#x548C;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4FE1;&#x606F;&#xFF0C;&#x5B58;&#x50A8;&#x7EBF;&#x7A0B;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x77E5;&#x9053;&#x5524;&#x9192;&#x54EA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B; </p>
<p>&#x4ECE;FutureTask&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5F53;&#x5B9E;&#x4F8B;&#x5316;&#x4E00;&#x4E2A;FutureTask&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x4F20;&#x5165;&#x4E00;&#x4E2A;callable&#x5BF9;&#x8C61;&#xFF0C;&#x5373;&#x4FBF;&#x4F20;&#x5165;&#x7684;&#x662F;runnable&#x5BF9;&#x8C61;&#xFF0C;&#x6700;&#x7EC8;&#x4E5F;&#x4F1A;&#x8F6C;&#x53D8;&#x4E3A;callable&#x5BF9;&#x8C61; </p>
<h1 id="FutureTask&#x6784;&#x9020;&#x51FD;&#x6570;">4. FutureTask&#x6784;&#x9020;&#x51FD;&#x6570;</h1><p>&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x63D0;&#x53CA;&#x5B9E;&#x4F8B;&#x5316;FutureTask&#x5BF9;&#x8C61;&#xFF0C;&#x5FC5;&#x987B;&#x4F20;&#x5165;callable&#x5BF9;&#x8C61;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x4F20;&#x5165;runnable&#x5BF9;&#x8C61; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FutureTask</span><span class="params">(Callable&lt;V&gt; callable)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (callable == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.callable = callable;</span><br><span class="line">    <span class="keyword">this</span>.state = NEW;       <span class="comment">// ensure visibility of callable</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8FD9;&#x79CD;&#x7528;&#x7684;&#x8F83;&#x5C11;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FutureTask</span><span class="params">(Runnable runnable, V result)</span> </span>{</span><br><span class="line">    <span class="keyword">this</span>.callable = Executors.callable(runnable, result);</span><br><span class="line">    <span class="keyword">this</span>.state = NEW;       <span class="comment">// ensure visibility of callable</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<p>&#x4ECE;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x6784;&#x9020;&#x51FD;&#x6570;&#x53EA;&#x662F;&#x505A;&#x4E86;&#x4E24;&#x4EF6;&#x4E8B;&#x60C5;&#xFF0C;&#x6DFB;&#x52A0;&#x4EFB;&#x52A1;&#x548C;&#x521D;&#x59CB;&#x5316;&#x72B6;&#x6001; </p>
<h1 id="FutureTask&#x7684;&#x4EFB;&#x52A1;&#x6267;&#x884C;run">5. FutureTask&#x7684;&#x4EFB;&#x52A1;&#x6267;&#x884C;run()</h1><p>&#x7EBF;&#x7A0B;&#x6C60;&#x5728;&#x8C03;&#x7528;submit()&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4F1A;&#x5C06;&#x4EFB;&#x52A1;&#x5C01;&#x88C5;&#x4E3A;&#x4E00;&#x4E2A;FutureTask&#x5BF9;&#x8C61;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x5C31;&#x662F;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x62FF;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;&#x4EE3;&#x7801;&#x4E3E;&#x4F8B;&#xFF1A; </p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//&#x521B;&#x5EFA;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;</span></span><br><span class="line">ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">10</span>, <span class="number">10</span>, <span class="number">0</span>, </span><br><span class="line">    TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">100</span>));</span><br><span class="line"><span class="comment">//&#x83B7;&#x53D6;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x7684;&#x7ED3;&#x679C;&#xFF0C;Task&#x662F;&#x5B9E;&#x73B0;callable&#x7684;&#x7C7B;</span></span><br><span class="line">Future&lt;Integer&gt; <span class="built_in">future</span> = executor.submit(<span class="keyword">new</span> <span class="built_in">Task</span>());</span><br><span class="line"><span class="comment">//&#x6B64;&#x5904;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x5176;&#x4ED6;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;</span></span><br><span class="line"><span class="comment">//&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;</span></span><br><span class="line"><span class="built_in">future</span>.<span class="built_in">get</span>();</span><br></pre></td></tr></table></figure>


<p>&#x5176;&#x4E2D;&#xFF0C; executor.submit(new Task())&#x6267;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#x76F8;&#x5F53;&#x4E8E;&#xFF0C;new FutureTask(new Task());&#x7136;&#x540E;&#x5C06;&#x8BE5;&#x5BF9;&#x8C61;&#x8FD4;&#x56DE;&#x8D4B;&#x503C;&#x7ED9;future&#xFF0C;&#x8FD9;&#x6837;&#x901A;&#x8FC7;FutureTask&#x540C;&#x65F6;&#x7EF4;&#x62A4;&#x4E86;&#x4EFB;&#x52A1;&#x548C;&#x7ED3;&#x679C;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#x3002; </p>
<p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E0B;run()&#x65B9;&#x6CD5;&#x7684;&#x4E3B;&#x4F53;&#x903B;&#x8F91;&#xFF0C;&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">//1. &#x6267;&#x884C;&#x4EFB;&#x52A1;&#x524D;&#x7684;&#x72B6;&#x6001;&#x68C0;&#x67E5;&#x4E0E;&#x8BBE;&#x7F6E;runner&#x7EBF;&#x7A0B;</span></span><br><span class="line">    <span class="keyword">if</span> (state != NEW ||</span><br><span class="line">        !UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, runnerOffset,</span><br><span class="line">                                     <span class="keyword">null</span>, Thread.currentThread()))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">//2. &#x6267;&#x884C;&#x4EFB;&#x52A1;</span></span><br><span class="line">        Callable&lt;V&gt; c = callable;</span><br><span class="line">        <span class="keyword">if</span> (c != <span class="keyword">null</span> &amp;&amp; state == NEW) {</span><br><span class="line">            V result;</span><br><span class="line">            <span class="keyword">boolean</span> ran;</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                result = c.call();</span><br><span class="line">                ran = <span class="keyword">true</span>;</span><br><span class="line">            } <span class="keyword">catch</span> (Throwable ex) {</span><br><span class="line">                result = <span class="keyword">null</span>;</span><br><span class="line">                ran = <span class="keyword">false</span>;</span><br><span class="line">                <span class="comment">//3.&#x5F02;&#x5E38;&#x7ED3;&#x679C;</span></span><br><span class="line">                setException(ex);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (ran)</span><br><span class="line">                <span class="comment">//3. &#x6B63;&#x5E38;&#x6267;&#x884C;&#x7ED3;&#x679C;</span></span><br><span class="line">                set(result);</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        runner = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> s = state;</span><br><span class="line">        <span class="comment">//5. &#x5904;&#x7406;INTERRUPTING&#x72B6;&#x6001;&#xFF0C;&#x5C31;&#x662F;&#x7B49;&#x5F85;&#x4E00;&#x4E0B;</span></span><br><span class="line">        <span class="keyword">if</span> (s &gt;= INTERRUPTING)</span><br><span class="line">            handlePossibleCancellationInterrupt(s);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<p>&#x6B63;&#x5982;&#x4EE3;&#x7801;&#x4E2D;&#x6CE8;&#x91CA;&#x4E00;&#x6837;&#xFF0C;run()&#x4E3B;&#x8981;&#x505A;&#x4E86;5&#x4EF6;&#x4E8B;&#xFF0C;run()&#x65B9;&#x6CD5;&#x4E2D;&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x8F6C;&#x5316;&#x56FE;&#x4E2D;&#x7684;&#x9ED1;&#x8272;&#x5B9E;&#x7EBF;&#x5185;&#x5BB9;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4E00;&#x70B9;&#x70B9;&#x6765;&#x5256;&#x6790;&#x8FD9;5&#x90E8;&#x5206;&#xFF1A; </p>
<p>&#xFF08;1&#xFF09;&#x8FD0;&#x884C;&#x4EFB;&#x52A1;&#x524D;&#x7684;&#x72B6;&#x6001;&#x68C0;&#x67E5; </p>
<ul>
<li>&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x5FC5;&#x987B;&#x4E3A;new<br>&#x5982;&#x679C;&#x4E0D;&#x4E3A;new&#xFF0C;&#x8BF4;&#x660E;&#x4EFB;&#x52A1;&#x5DF2;&#x7ECF;&#x8FD0;&#x884C;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</li>
<li>&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x4E3A;new&#xFF0C;&#x4F7F;&#x7528;CAS&#x64CD;&#x4F5C;&#x8BBE;&#x7F6E;&#x8BE5;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x7ED9;runner&#xFF08;CAS&#x64CD;&#x4F5C;&#x4E3A;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#xFF09;<br>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x8BF4;&#x660E;runner&#x7684;&#x503C;&#x4E0D;&#x4E3A;null&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x5728;&#x6267;&#x884C;&#x8BE5;&#x4EFB;&#x52A1;<br>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x64CD;&#x4F5C;</li>
</ul>
<p>&#xFF08;2&#xFF09;&#x6267;&#x884C;&#x4EFB;&#x52A1; </p>
<ul>
<li>&#x518D;&#x6B21;&#x9A8C;&#x8BC1;&#x4EFB;&#x52A1;&#x72B6;&#x6001;<br>&#x56E0;&#x4E3A;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#xFF0C;&#x5728;&#x6B65;&#x9AA4;1&#x3001;2&#x4E4B;&#x95F4;&#x53EF;&#x80FD;&#x4F1A;&#x53D6;&#x6D88;&#x8BE5;&#x4EFB;&#x52A1;&#xFF0C;&#x6240;&#x4EE5;&#x518D;&#x6B21;&#x5224;&#x65AD;</li>
<li>&#x6267;&#x884C;&#x4EFB;&#x52A1;<br>&#x8C03;&#x7528;callable&#x7684;call()&#x65B9;&#x6CD5;</li>
</ul>
<p>&#xFF08;3&#xFF09;&#x7ED3;&#x679C;&#x5904;&#x7406; </p>
<ul>
<li>&#x6B63;&#x5E38;&#x7ED3;&#x679C;&#x5904;&#x7406;<br>&#x5176;&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(V v)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (UNSAFE.compareAndSwapInt(<span class="keyword">this</span>, stateOffset, NEW, COMPLETING)) {</span><br><span class="line">        outcome = v;</span><br><span class="line">        UNSAFE.putOrderedInt(<span class="keyword">this</span>, stateOffset, NORMAL); <span class="comment">// final state</span></span><br><span class="line">        finishCompletion();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<ol>
<li>&#x4F7F;&#x7528;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x5C06;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A;completing&#xFF0C;&#x8868;&#x793A;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x6CA1;&#x6709;&#x7ED9;outcome&#x8D4B;&#x503C;</li>
<li>&#x7ED9;outcome&#x8D4B;&#x503C;</li>
<li>&#x4F7F;&#x7528;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x4FEE;&#x6539;&#x72B6;&#x6001;&#x4E3A;normal&#xFF0C;&#x8868;&#x793A;&#x6B63;&#x5E38;&#x7ED3;&#x675F;</li>
<li>&#x5B8C;&#x6210;&#x540E;&#x7EED;&#x64CD;&#x4F5C;&#xFF0C;&#x5524;&#x9192;&#x963B;&#x585E;&#x7684;&#x7EBF;&#x7A0B;&#xFF08;&#x8BE5;&#x64CD;&#x4F5C;&#x5728;&#x7B2C;4&#x6B65;&#x8BB2;&#x89E3;&#xFF09;</li>
</ol>
<ul>
<li>&#x5F02;&#x5E38;&#x7ED3;&#x679C;&#x5904;&#x7406;<br>&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setException</span><span class="params">(Throwable t)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (UNSAFE.compareAndSwapInt(<span class="keyword">this</span>, stateOffset, NEW, COMPLETING)) {</span><br><span class="line">        outcome = t;</span><br><span class="line">        UNSAFE.putOrderedInt(<span class="keyword">this</span>, stateOffset, EXCEPTIONAL); <span class="comment">// final state</span></span><br><span class="line">        finishCompletion();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<p>&#x9664;&#x4E86;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x4E0D;&#x540C;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x64CD;&#x4F5C;&#x4E0E;&#x6B63;&#x5E38;&#x7ED3;&#x679C;&#x5904;&#x7406;&#x5B8C;&#x5168;&#x4E00;&#x81F4; </p>
<p>&#xFF08;4&#xFF09; &#x5524;&#x9192;&#x963B;&#x585E;&#x7EBF;&#x7A0B; </p>
<ol>
<li>&#x9996;&#x5148;&#x4F7F;&#x7528;&#x539F;&#x5B50;&#x64CD;&#x4F5C;CAS&#x8BBE;&#x7F6E;waiters&#x4E3A;null</li>
<li>&#x4F9D;&#x6B21;&#x904D;&#x5386;&#x7B49;&#x5F85;&#x94FE;&#x8868;&#x4E0A;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x4F7F;&#x7528;LockSupport&#x7684;unpark()&#x65B9;&#x6CD5;&#x5524;&#x9192;&#x7EBF;&#x7A0B;</li>
<li>callable&#x7F6E;&#x7A7A;</li>
</ol>
<p>&#x5176;&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finishCompletion</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// assert state &gt; COMPLETING;</span></span><br><span class="line">        <span class="keyword">for</span> (WaitNode q; (q = waiters) != <span class="keyword">null</span>;) {</span><br><span class="line">            <span class="keyword">if</span> (UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, waitersOffset, q, <span class="keyword">null</span>)) {</span><br><span class="line">                <span class="keyword">for</span> (;;) {</span><br><span class="line">                    Thread t = q.thread;</span><br><span class="line">                    <span class="keyword">if</span> (t != <span class="keyword">null</span>) {</span><br><span class="line">                        q.thread = <span class="keyword">null</span>;</span><br><span class="line">                        <span class="comment">//&#x5524;&#x9192;&#x6BCF;&#x4E00;&#x4E2A;&#x7B49;&#x5F85;&#x8282;&#x70B9;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;t</span></span><br><span class="line">                        <span class="comment">//t&#x5C31;&#x662F;&#x8C03;&#x7528;get&#x65B9;&#x6CD5;&#x7684;&#x7EBF;&#x7A0B;</span></span><br><span class="line">                        LockSupport.unpark(t);</span><br><span class="line">                    }</span><br><span class="line">                    WaitNode next = q.next;</span><br><span class="line">                    <span class="keyword">if</span> (next == <span class="keyword">null</span>)</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    q.next = <span class="keyword">null</span>; <span class="comment">// unlink to help gc</span></span><br><span class="line">                    q = next;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x7A7A;&#x65B9;&#x6CD5;</span></span><br><span class="line">        done();</span><br><span class="line">        callable = <span class="keyword">null</span>;        <span class="comment">// to reduce footprint</span></span><br><span class="line">    }</span><br></pre></td></tr></table></figure>


<p>&#xFF08;5&#xFF09; &#x7B49;&#x5F85;interrupting&#x72B6;&#x6001;&#x7684;&#x6539;&#x53D8; </p>
<p>run()&#x65B9;&#x6CD5;&#x7684;finally&#x8BED;&#x53E5;&#x5185;&#x5BB9;&#xFF0C;&#x56E0;&#x4E3A;interrupting&#x72B6;&#x6001;&#x4E0D;&#x4E3A;&#x6700;&#x7EC8;&#x72B6;&#x6001;&#xFF0C;&#x7B49;&#x5F85;&#x5176;&#x53D8;&#x4E3A;&#x6700;&#x7EC8;&#x72B6;&#x6001; </p>
<p>&#x4E3B;&#x8981;&#x662F;&#x56E0;&#x4E3A;&#x5728;&#x6B64;&#x65F6;&#xFF0C;&#x8BE5;&#x4EFB;&#x52A1;&#x88AB;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x53D6;&#x6D88;&#xFF0C;&#x8C03;&#x7528;&#x4E86;cancel(true)&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x9700;&#x4E2D;&#x65AD;&#x4E00;&#x4E0B;runner&#x5373;&#x53EF;&#x5C06;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A;interrupted&#xFF0C; &#x5176;&#x64CD;&#x4F5C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handlePossibleCancellationInterrupt</span><span class="params">(<span class="keyword">int</span> s)</span> </span>{</span><br><span class="line">    <span class="comment">// &#x5982;&#x679C;&#x662F;INTERRUPTING&#x72B6;&#x6001;&#xFF0C;&#x5219;&#x8868;&#x660E;&#x5176;&#x4ED6;&#x7684;&#x7EBF;&#x7A0B;&#x5728;&#x53D6;&#x6D88;&#x8BE5;&#x4EFB;&#x52A1;&#xFF0C;&#x8C03;&#x7528;runner&#x7684;interrupt&#x65B9;&#x6CD5;&#x540E;&#xFF0C;&#x4F1A;</span></span><br><span class="line">    <span class="comment">//&#x4FEE;&#x6539;&#x72B6;&#x6001;&#x4E3A;INTERRUPTED&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x91CC;&#x7B49;&#x5F85;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x7B49;&#x5F85;&#x5176;&#x4ED6;&#x7684;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;</span></span><br><span class="line">    <span class="keyword">if</span> (s == INTERRUPTING)</span><br><span class="line">        <span class="keyword">while</span> (state == INTERRUPTING)</span><br><span class="line">            Thread.yield(); <span class="comment">// wait out pending interrupt</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<h1 id="FutureTask&#x7684;get-&#x65B9;&#x6CD5;">6. FutureTask&#x7684;get()&#x65B9;&#x6CD5;</h1><p>FutureTask&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x7684;&#x65B9;&#x6CD5; </p>
<ol>
<li>get() &#x963B;&#x585E;&#x65B9;&#x6CD5;&#xFF0C;&#x4F1A;&#x4E00;&#x76F4;&#x963B;&#x585E;&#x5230;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x624D;&#x4F1A;&#x8FD4;&#x56DE;</li>
<li>get(long timeout, TimeUnit unit) &#x6700;&#x957F;&#x963B;&#x585E;timeout&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5373;&#x4FBF;&#x4EFB;&#x52A1;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x4E5F;&#x4F1A;&#x8FD4;&#x56DE;</li>
</ol>
<p>get()&#x65B9;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4E24;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A; </p>
<ol>
<li>&#x5224;&#x65AD;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E3A;&#x56DB;&#x79CD;&#x7EC8;&#x6B62;&#x72B6;&#x6001;&#xFF0C;&#x5219;&#x6267;&#x884C;awaitDone()&#x65B9;&#x6CD5;</li>
<li>&#x4EFB;&#x52A1;&#x7ED3;&#x675F;&#xFF0C;&#x89E3;&#x6790;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#xFF0C;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</li>
</ol>
<p>&#x5176;&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>{</span><br><span class="line">    <span class="keyword">int</span> s = state;</span><br><span class="line">    <span class="keyword">if</span> (s &lt;= COMPLETING)</span><br><span class="line">        <span class="comment">//&#x5982;&#x679C;&#x7ED3;&#x679C;&#x6CA1;&#x6709;&#x51C6;&#x5907;&#x597D;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x4E00;&#x76F4;&#x963B;&#x585E;</span></span><br><span class="line">        s = awaitDone(<span class="keyword">false</span>, <span class="number">0L</span>);</span><br><span class="line">    <span class="comment">//&#x6267;&#x884C;&#x5230;&#x8FD9;&#xFF0C;&#x8BF4;&#x660E;awaitDone&#x65B9;&#x6CD5;&#x5DF2;&#x7ECF;&#x8FD4;&#x56DE;&#xFF0C; &#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x7ED3;&#x679C;&#x51C6;&#x5907;&#x597D;&#x4E86;</span></span><br><span class="line">    <span class="keyword">return</span> report(s);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x6E90;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x4E3B;&#x8981;&#x7684;&#x64CD;&#x4F5C;&#x5C31;&#x662F;awaitDone()&#x548C;reposrt()&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x8BB2;&#x89E3; </p>
<ul>
<li>awaitDone()<br>&#x4E24;&#x4E2A;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x7ED3;&#x679C;&#x7684;&#x65B9;&#x5F0F;&#xFF08;&#x963B;&#x585E;&#x4E0E;&#x8D85;&#x65F6;&#x963B;&#x585E;&#xFF09;&#x90FD;&#x8C03;&#x7528;&#x4E86;awaitDone()&#x65B9;&#x6CD5;,&#x5176;&#x4E3B;&#x8981;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#xFF0C;&#x5BF9;&#x5E94;&#x6E90;&#x7801;&#x4E00;&#x8D77;&#x770B;&#xFF1A;</li>
</ul>
<ol>
<li>&#x6839;&#x7EDD;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x8BA1;&#x7B97;&#x622A;&#x6B62;&#x65F6;&#x95F4;</li>
<li>&#x5B9A;&#x4E49;&#x7B49;&#x5F85;&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x6784;&#x9020;&#x7B49;&#x5F85;&#x8282;&#x70B9;&#xFF08;&#x662F;&#x6709;&#x6761;&#x4EF6;&#x7684;&#xFF09;&#xFF0C;&#x5219;&#x6784;&#x9020;&#x5E76;&#x8D4B;&#x503C;&#x7ED9;q</li>
<li>queued&#x7528;&#x4E8E;&#x6807;&#x8BB0;&#x8BE5;&#x963B;&#x585E;&#x8282;&#x70B9;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x63D2;&#x5165;&#x5230;&#x4E86;&#x94FE;&#x8868;&#x4E2D;&#xFF0C;&#x9632;&#x6B62;&#x591A;&#x6B21;&#x63D2;&#x5165;</li>
<li>&#x4F7F;&#x7528;&#x6B7B;&#x5FAA;&#x73AF;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#xFF08;&#x4E0D;&#x8FBE;&#x76EE;&#x7684;&#x4E0D;&#x7F62;&#x4F11;&#xFF0C;&#x8FBE;&#x5230;&#x76EE;&#x7684;&#x624D;&#x4F1A;break&#x51FA;&#x5FAA;&#x73AF;&#xFF09;</li>
<li>&#x5224;&#x65AD;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#xFF08;&#x6CE8;&#x610F;&#xFF0C;&#x4E0D;&#x662F;runner&#xFF0C;&#x800C;&#x662F;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#xFF0C;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x7684;&#x7EBF;&#x7A0B;&#xFF09;&#x662F;&#x5426;&#x88AB;&#x4E2D;&#x65AD;&#xFF0C;&#x5982;&#x679C;&#x4E2D;&#x65AD;&#xFF0C;&#x5219;&#x79FB;&#x51FA;&#x8BE5;&#x7EBF;&#x7A0B;&#x7684;&#x963B;&#x585E;&#x8282;&#x70B9;&#xFF08;removeWaiter()&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x963B;&#x585E;&#x8282;&#x70B9;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#xFF09;&#xFF0C;&#x5E76;&#x629B;&#x51FA;&#x4E2D;&#x65AD;&#x5F02;&#x5E38;</li>
<li>&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x5C06;&#x7B49;&#x5F85;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x7F6E;&#x7A7A;&#xFF0C;&#x8FD4;&#x56DE;&#x72B6;&#x6001;</li>
<li>&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x4F46;&#x8FD8;&#x6CA1;&#x6709;&#x7ED9;outcome&#x8D4B;&#x503C;&#xFF0C;&#x5219;&#x653E;&#x5F03;cpu&#x8D44;&#x6E90;&#x7B49;&#x5F85;</li>
<li>&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x8FD8;&#x6CA1;&#x6709;&#x6267;&#x884C;&#xFF08;&#x72B6;&#x6001;&#x4E3A;new&#xFF09;&#xFF0C;&#x6784;&#x9020;&#x7B49;&#x5F85;&#x8282;&#x70B9;</li>
<li>&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x8FD8;&#x6CA1;&#x6709;&#x6267;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x5B58;&#x5728;&#x7B49;&#x5F85;&#x8282;&#x70B9;&#xFF0C;&#x5C06;&#x7B49;&#x5F85;&#x8282;&#x70B9;&#x52A0;&#x5165;&#x5230;&#x7B49;&#x5F85;&#x94FE;&#x8868;waiters&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;CAS&#x64CD;&#x4F5C;&#x91C7;&#x7528;&#x5934;&#x63D2;&#x6CD5;&#x63D2;&#x5165;&#x8282;&#x70B9;</li>
<li>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x8D85;&#x65F6;&#xFF0C;&#x5224;&#x65AD;&#x6709;&#x65E0;&#x8D85;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#xFF0C;&#x5219;&#x963B;&#x585E;&#x8BE5;&#x7EBF;&#x7A0B;&#xFF0C;&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6267;&#x884C;finishCompletion()&#x65B9;&#x6CD5;&#x5524;&#x9192;</li>
<li>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x8D85;&#x65F6;&#xFF0C;&#x5224;&#x65AD;&#x6709;&#x65E0;&#x8D85;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x65F6;&#xFF0C;&#x79FB;&#x51FA;&#x7B49;&#x5F85;&#x8282;&#x70B9;&#xFF0C;&#x8FD4;&#x56DE;&#x72B6;&#x6001;</li>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8D85;&#x65F6;&#xFF0C;&#x8C03;&#x7528;LockSupport&#x7684;parkNanos()&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x8D85;&#x65F6;&#x7B49;&#x5F85;</li>
</ol>
<p>&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">awaitDone</span><span class="params">(<span class="keyword">boolean</span> timed, <span class="keyword">long</span> nanos)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">    <span class="comment">//&#x662F;&#x5426;&#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#xFF0C;&#x8BA1;&#x7B97;&#x622A;&#x6B62;&#x65F6;&#x95F4;</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> deadline = timed ? System.nanoTime() + nanos : <span class="number">0L</span>;</span><br><span class="line">    WaitNode q = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//&#x662F;&#x5426;&#x63D2;&#x5165;waiters&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x7528;&#x6765;&#x4FDD;&#x8BC1;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x53EA;&#x63D2;&#x5165;&#x4E00;&#x6B21;</span></span><br><span class="line">    <span class="keyword">boolean</span> queued = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="comment">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x6267;&#x884C;get&#x65B9;&#x6CD5;&#x7684;&#x7EBF;&#x7A0B;&#x4E2D;&#x65AD;&#x4E86;&#xFF0C;&#x4ECE;waiters&#x4E2D;&#x79FB;&#x51FA;&#x8BE5;&#x7EBF;&#x7A0B;&#x7684;&#x7B49;&#x5F85;&#x8282;&#x70B9;</span></span><br><span class="line">        <span class="keyword">if</span> (Thread.interrupted()) {</span><br><span class="line">            removeWaiter(q);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> s = state;</span><br><span class="line">        <span class="comment">//&#x5982;&#x679C;&#x72B6;&#x6001;&#x4E3A;COMPLETING&#xFF0C;&#x5219;&#x4E3A;&#x5B8C;&#x6210;&#x72B6;&#x6001;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x72B6;&#x6001;&#x5373;&#x53EF;</span></span><br><span class="line">        <span class="keyword">if</span> (s &gt; COMPLETING) {</span><br><span class="line">            <span class="keyword">if</span> (q != <span class="keyword">null</span>)</span><br><span class="line">                q.thread = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x5982;&#x679C;&#x6267;&#x884C;&#x5B8C;&#x4E86;&#xFF0C;&#x6B63;&#x5728;&#x8BBE;&#x7F6E;&#x7ED3;&#x679C;&#xFF0C;&#x5219;&#x653E;&#x5F03;&#x65F6;&#x95F4;&#x7247;&#x8F6E;&#x8BE2;&#x7B49;&#x5F85;</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s == COMPLETING) <span class="comment">// cannot time out yet</span></span><br><span class="line">            Thread.yield();</span><br><span class="line">        <span class="comment">//&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x4E3A;NEW&#xFF0C; &#x6784;&#x9020;&#x7B49;&#x5F85;&#x8282;&#x70B9;</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (q == <span class="keyword">null</span>)</span><br><span class="line">            q = <span class="keyword">new</span> WaitNode();</span><br><span class="line">        <span class="comment">//&#x72B6;&#x6001;&#x4E3A;NEW&#xFF0C; &#x5E76;&#x4E14;&#x8282;&#x70B9;&#x4E0D;&#x4E3A;null&#xFF0C;&#x5E76;&#x4E14;&#x8BE5;&#x8282;&#x70B9;&#x6CA1;&#x6709;&#x52A0;&#x5165;&#x5230;waiter&#x961F;&#x5217;&#x4E2D;</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!queued)</span><br><span class="line">            queued = UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, waitersOffset,</span><br><span class="line">                                                 q.next = waiters, q);</span><br><span class="line">        <span class="comment">//&#x5982;&#x679C;&#x8BBE;&#x5B9A;&#x8D85;&#x65F6;&#xFF0C;&#x5219;&#x8FDB;&#x884C;&#x8D85;&#x65F6;&#x5224;&#x65AD;</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (timed) {</span><br><span class="line">            nanos = deadline - System.nanoTime();</span><br><span class="line">            <span class="keyword">if</span> (nanos &lt;= <span class="number">0L</span>) {</span><br><span class="line">                removeWaiter(q);</span><br><span class="line">                <span class="keyword">return</span> state;</span><br><span class="line">            }</span><br><span class="line">            LockSupport.parkNanos(<span class="keyword">this</span>, nanos);</span><br><span class="line">        }<span class="comment">//&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x5B9A;&#x8D85;&#x65F6;&#xFF0C;&#x5219;&#x963B;&#x585E;&#xFF0C;&#x7B49;&#x5F85;runner&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B8C;&#x4EFB;&#x52A1;&#x4E4B;&#x540E;&#x88AB;&#x5524;&#x9192;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x6E90;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684;&#x8C03;&#x7528;get()&#x65B9;&#x6CD5;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5C31;&#x4F1A;&#x8FDB;&#x5165;&#x963B;&#x585E;&#x94FE;&#x8868;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x8C03;&#x7528;get()&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x4E3A;new&#x7684;&#x7EBF;&#x7A0B;&#x624D;&#x4F1A;&#x52A0;&#x5165;&#x963B;&#x585E;&#x94FE;&#x8868;waiters&#x4E2D;&#xFF0C;&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x5524;&#x9192;&#x3002;&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x4E86;&#xFF0C;&#x8868;&#x660E;&#x7ED3;&#x679C;&#x4F1A;&#x5FEB;&#x5C31;&#x4F1A;&#x51C6;&#x5907;&#x597D;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x81EA;&#x65CB;&#x7B49;&#x5F85;&#x5373;&#x53EF;&#x3002; </p>
<p>&#x5728;&#x4E0A;&#x8FF0;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5B58;&#x5728;removeWaiter()&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x59A8;&#x4E5F;&#x770B;&#x4E00;&#x4E0B;&#xFF1A; </p>
<ol>
<li>&#x5224;&#x65AD;&#x4F20;&#x5165;&#x7684;&#x8282;&#x70B9;&#x662F;&#x5426;&#x4E3A;null&#xFF0C;&#x5982;&#x679C;&#x4E3A;null&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</li>
<li>&#x5982;&#x679C;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x9996;&#x5148;&#x5C06;thread&#x5B57;&#x6BB5;&#x7F6E;null</li>
<li>&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x5220;&#x9664;&#x8BE5;&#x8282;&#x70B9;</li>
</ol>
<p>&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeWaiter</span><span class="params">(WaitNode node)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (node != <span class="keyword">null</span>) {</span><br><span class="line">        node.thread = <span class="keyword">null</span>;</span><br><span class="line">        retry:</span><br><span class="line">        <span class="keyword">for</span> (;;) {          <span class="comment">// restart on removeWaiter race</span></span><br><span class="line">            <span class="keyword">for</span> (WaitNode pred = <span class="keyword">null</span>, q = waiters, s; q != <span class="keyword">null</span>; q = s) {</span><br><span class="line">                s = q.next;</span><br><span class="line">                <span class="keyword">if</span> (q.thread != <span class="keyword">null</span>)</span><br><span class="line">                    pred = q;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (pred != <span class="keyword">null</span>) {</span><br><span class="line">                    pred.next = s;</span><br><span class="line">                    <span class="keyword">if</span> (pred.thread == <span class="keyword">null</span>) <span class="comment">// check for race</span></span><br><span class="line">                        <span class="keyword">continue</span> retry;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, waitersOffset,</span><br><span class="line">                                                      q, s))</span><br><span class="line">                    <span class="keyword">continue</span> retry;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4E0A;&#x5220;&#x9664;&#x903B;&#x8F91;&#x5C31;&#x662F;&#x5BFB;&#x627E;thread&#x5B57;&#x6BB5;&#x4E3A;null&#x7684;&#x8282;&#x70B9;&#x7684;&#x524D;&#x8282;&#x70B9;&#xFF0C;&#x56E0;&#x4E3A;thread&#x8282;&#x70B9;&#x4E3A;null&#x7684;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x8981;&#x5220;&#x9664;&#x7684;&#x8282;&#x70B9;&#x3002;&#x5982;&#x679C;&#x524D;&#x8282;&#x70B9;&#x5B58;&#x5728;&#xFF0C;&#x76F4;&#x63A5;&#x5220;&#x9664;&#x8BE5;&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x524D;&#x8282;&#x70B9;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x8BF4;&#x660E;&#x8BE5;&#x8282;&#x70B9;&#x5728;&#x94FE;&#x5934;&#xFF0C;&#x56E0;&#x4E3A;&#x94FE;&#x8868;&#x7684;&#x63D2;&#x5165;&#x64CD;&#x4F5C;&#x91C7;&#x7528;&#x7684;&#x662F;&#x5934;&#x63D2;&#x6CD5;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x4FEE;&#x6539;&#x5934;&#x7ED3;&#x70B9;&#x4F1A;&#x6709;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;CAS&#x8BBE;&#x7F6E;&#x5934;&#x7ED3;&#x70B9;&#x7684;&#x503C;&#xFF0C;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x5220;&#x9664;&#x8BE5;&#x8282;&#x70B9;&#x7684;&#x76EE;&#x7684;&#x3002;&#x5982;&#x679C;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x6CA1;&#x6709;&#x5220;&#x9664;&#x6210;&#x529F;&#xFF0C;&#x8BF4;&#x660E;&#x94FE;&#x8868;&#x7684;&#x7ED3;&#x6784;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x8BD5;&#x3002; </p>
<ul>
<li>report()&#x65B9;&#x6CD5;<br>&#x6839;&#x636E;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#xFF0C;&#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x5176;&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> V <span class="title">report</span><span class="params">(<span class="keyword">int</span> s)</span> <span class="keyword">throws</span> ExecutionException </span>{</span><br><span class="line">    Object x = outcome;</span><br><span class="line">    <span class="keyword">if</span> (s == NORMAL)</span><br><span class="line">        <span class="keyword">return</span> (V)x;</span><br><span class="line">    <span class="keyword">if</span> (s &gt;= CANCELLED)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CancellationException();</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ExecutionException((Throwable)x);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>&#x6267;&#x884C;&#x5230;report()&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x5230;&#x4E86;&#x7EC8;&#x6B62;&#x72B6;&#x6001; </p>
<ol>
<li>normal&#x4E3A;&#x6B63;&#x5E38;&#x72B6;&#x6001;</li>
<li>&#x5927;&#x4E8E;&#x7B49;&#x4E8E;cancelled&#x4EE3;&#x8868;&#x53D6;&#x6D88;&#x7684;&#x4E24;&#x4E2A;&#x72B6;&#x6001;&#xFF1A;&#x53D6;&#x6D88;&#x548C;&#x4E2D;&#x65AD;</li>
<li>&#x5269;&#x4E0B;&#x7684;&#x72B6;&#x6001;&#x4E3A;&#x5F02;&#x5E38;&#x72B6;&#x6001;</li>
</ol>
<h1 id="FutureTask&#x7684;get-long-timeout-TimeUnit-unit-&#x65B9;&#x6CD5;">7. FutureTask&#x7684;get(long timeout, TimeUnit unit)&#x65B9;&#x6CD5;</h1><p>&#x4E0E;get()&#x65B9;&#x6CD5;&#x5BF9;&#x6BD4;&#xFF0C;&#x9664;&#x4E86;&#x53C2;&#x6570;&#x68C0;&#x67E5;&#x5916;&#xFF0C;&#x5904;&#x7406;&#x4E86;&#x4E00;&#x4E0B;&#x8D85;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x65F6;&#x7ED3;&#x679C;&#x8FD8;&#x6CA1;&#x6709;&#x51C6;&#x5907;&#x597D;&#x5219;&#x629B;&#x51FA;&#x8D85;&#x65F6;&#x5F02;&#x5E38; </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException </span>{</span><br><span class="line">    <span class="keyword">if</span> (unit == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">int</span> s = state;</span><br><span class="line">    <span class="keyword">if</span> (s &lt;= COMPLETING &amp;&amp;</span><br><span class="line">        (s = awaitDone(<span class="keyword">true</span>, unit.toNanos(timeout))) &lt;= COMPLETING)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> TimeoutException();</span><br><span class="line">    <span class="keyword">return</span> report(s);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="FutureTask&#x7684;cancel&#x65B9;&#x6CD5;">8. FutureTask&#x7684;cancel&#x65B9;&#x6CD5;</h1><p>&#x8BE5;&#x65B9;&#x6CD5;&#x5B58;&#x5728;&#x4E00;&#x4E2A;boolean&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#xFF1A; </p>
<ol>
<li>true&#xFF1A;&#x8868;&#x793A;&#x5C06;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A;interrupted&#x7684;&#x7EC8;&#x6B62;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x4E14;&#x8C03;&#x7528;runner&#x7684;interrupt()&#x65B9;&#x6CD5;</li>
<li>false:&#x53EA;&#x5C06;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A;cancelled</li>
</ol>
<p>&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;<br> <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (!(state == NEW &amp;&amp;</span><br><span class="line">          UNSAFE.compareAndSwapInt(<span class="keyword">this</span>, stateOffset, NEW,</span><br><span class="line">              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> {    <span class="comment">// in case call to interrupt throws exception</span></span><br><span class="line">        <span class="keyword">if</span> (mayInterruptIfRunning) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread t = runner;</span><br><span class="line">                <span class="keyword">if</span> (t != <span class="keyword">null</span>)</span><br><span class="line">                    t.interrupt();</span><br><span class="line">            } <span class="keyword">finally</span> { <span class="comment">// final state</span></span><br><span class="line">                UNSAFE.putOrderedInt(<span class="keyword">this</span>, stateOffset, INTERRUPTED);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        finishCompletion();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><br>&#x8BE5;&#x64CD;&#x4F5C;&#x5BF9;&#x5E94;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x56FE;&#x4E2D;&#x7684;&#x7EA2;&#x7EBF;&#x90E8;&#x5206; </p>
<p>&#x53EA;&#x80FD;&#x53D6;&#x6D88;&#x72B6;&#x6001;&#x4E3A;new&#x7684;&#x4EFB;&#x52A1;&#xFF08;&#x6CA1;&#x6709;&#x6267;&#x884C;&#xFF0C;&#x6216;&#x8005;&#x6B63;&#x5728;&#x6267;&#x884C;&#x90FD;&#x53EF;&#x80FD;&#x662F;new&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x4E0D;&#x4E3A;new&#xFF08;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4E86;&#xFF09;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;false,&#x5E76;&#x4E0D;&#x80FD;&#x8BA9;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x7EC8;&#x6B62;&#xFF0C;&#x800C;&#x662F;&#x53EA;&#x80FD;&#x8BA9;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x4E0D;&#x6267;&#x884C;&#x3002; </p>
<p>runner&#x7EBF;&#x7A0B;&#x7684;&#x4E2D;&#x65AD;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x5DE6;&#x53F3;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#xFF0C;&#x56E0;&#x4E3A;&#x4E2D;&#x65AD;&#x64CD;&#x4F5C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#xFF0C;&#x5982;&#x679C;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x4E0D;&#x54CD;&#x5E94;&#x8BE5;&#x4FE1;&#x53F7;&#xFF0C;&#x5219;&#x8BE5;&#x4E2D;&#x65AD;&#x6709;&#x6CA1;&#x6709;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x9664;&#x975E;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x4E2D;&#x5B58;&#x5728;&#x5F71;&#x54CD;&#x4E2D;&#x65AD;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5426;&#x5219;&#xFF0C;&#x5373;&#x4FBF;&#x8C03;&#x7528;&#x4E86;interrupt()&#x65B9;&#x6CD5;&#x4E5F;&#x4E0D;&#x8D77;&#x4EFB;&#x4F55;&#x4F5C;&#x7528; </p>
<h1 id="FutureTask&#x5176;&#x4ED6;&#x65B9;&#x6CD5;">9. FutureTask&#x5176;&#x4ED6;&#x65B9;&#x6CD5;</h1><p>runAndSet()&#x65B9;&#x6CD5;&#xFF0C;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x540E;&#x5C06;&#x4EFB;&#x52A1;&#x7684;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A;new&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x591A;&#x6B21;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1; </p>
]]></content>
      <categories>
        <category>thread-pool</category>
      </categories>
  </entry>
  <entry>
    <title>线程池导读2:浅谈JAVA线程返回值工作原理</title>
    <url>/2020/qian-tan-java-thread-pool-return/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p>&#x8BF7;&#x5148;&#x770B;<a href="https://www.chenguanting.top/2020/&#x6D45;&#x8C08;JAVA&#x7EBF;&#x7A0B;&#x6C60;&#x5DE5;&#x4F5C;&#x539F;&#x7406;">&#x6D45;&#x8C08;JAVA&#x7EBF;&#x7A0B;&#x6C60;&#x5DE5;&#x4F5C;&#x539F;&#x7406;</a>&#x540E;&#x518D;&#x770B;&#x672C;&#x7BC7;&#x5185;&#x5BB9;</p>
</blockquote>
<h1 id="&#x5C0F;Demo">2. &#x5C0F;Demo</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class="line">Future&lt;Demo1&gt; future = executorService.submit(<span class="keyword">new</span> Callable&lt;Demo1&gt;() {</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Demo1 <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Demo1();</span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line"><span class="comment">// &#x4E00;&#x76F4;&#x963B;&#x585E;&#x5230;&#x5B50;&#x7EBF;&#x7A0B;&#x7ED3;&#x675F;&#x62FF;&#x5230;&#x8FD4;&#x56DE;&#x503C;</span></span><br><span class="line">Demo1 demo = future.get();</span><br></pre></td></tr></table></figure>

<p>&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x90FD;&#x770B;&#x8FC7;&#x4E0A;&#x9762;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x6CD5;, &#x5B9E;&#x73B0;&#x4E86;&#x5C06;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x963B;&#x585E;, &#x5E76;&#x4E14;&#x62FF;&#x5230;&#x4E86;&#x8FD4;&#x56DE;&#x503C;. </p>
<a id="more"></a>

<p><strong>&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x5747;&#x4E3A;&#x4F2A;&#x4EE3;&#x7801;,&#x76EE;&#x7684;&#x662F;&#x63D0;&#x4F9B;&#x601D;&#x8DEF;</strong></p>
<h1 id="&#x5206;&#x6790;">3. &#x5206;&#x6790;</h1><ol>
<li>&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x540C;&#x65F6;&#x652F;&#x6301;&#x4E24;&#x79CD;&#x7C7B;&#x578B;<code>Callable</code>&#x548C;<code>Runnable</code><ol>
<li>&#x4E0D;&#x80FD;&#x5F71;&#x54CD;&#x539F;&#x6709;&#x7C7B;&#x578B;, &#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x641E;&#x4E2A;&#x5305;&#x88C5;&#x7C7B;</li>
</ol>
</li>
<li>&#x7ECF;&#x4E0A;&#x7BC7;&#x5206;&#x6790;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x662F;&#x4FDD;&#x5B58;&#x5728;<code>Runnable</code>&#x4E2D;&#x7684;,  &#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5728;&#x8FD9;&#x4E2A;<code>Runnable</code>&#x5916;&#x5C42;&#x641E;&#x4E2A;&#x5305;&#x88C5;&#x7C7B;,&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;<code>status</code>,&#x5C31;&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x6267;&#x884C;&#x5B8C;&#x6210;,&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5B8C;&#x6210;&#x5C31;&#x7B49;&#x5F85;&#x7684;&#x95EE;&#x9898;</li>
<li>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5462;?&#x6CA1;&#x9519;, &#x8FD4;&#x56DE;&#x503C;&#x4E5F;&#x653E;&#x5728;&#x5305;&#x88C5;&#x7C7B;&#x4E2D;, &#x7B49;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B8C;&#x8FD4;&#x56DE;&#x5C31;&#x597D;!</li>
</ol>
<h1 id="&#x5B9E;&#x73B0;">4. &#x5B9E;&#x73B0;</h1><h2 id="&#x5206;&#x6790;1">4.1. &#x5206;&#x6790;1</h2><blockquote>
<p> &#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x6211;&#x4EEC;&#x53EA;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x540C;&#x65F6;&#x652F;&#x6301;&#x4E24;&#x79CD;&#x7C7B;&#x578B;<code>Callable</code>&#x548C;<code>Runnable</code></p>
</blockquote>
<h3 id="&#x81EA;&#x5B9A;&#x4E49;&#x63A5;&#x53E3;">4.1.1. &#x81EA;&#x5B9A;&#x4E49;&#x63A5;&#x53E3;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyCallable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>



<h3 id="&#x5305;&#x88C5;&#x7C7B;">4.1.2. &#x5305;&#x88C5;&#x7C7B;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFutureTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x5BF9;&#x8C61;&#x90FD;&#x5305;&#x5728;&#x8FD9;&#x91CC;&#x9762;</span></span><br><span class="line">    <span class="keyword">private</span> MyCallable callable;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyFutureTask</span><span class="params">(MyCallable callable)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.callable = callable;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyFutureTask</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.callable = <span class="keyword">new</span> InerCallable(runnable);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">		<span class="comment">// &#x4E00;&#x4E2A;&#x5305;&#x88C5;&#x7C7B;</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">InerCallable</span> <span class="keyword">implements</span> <span class="title">MyCallable</span></span>{</span><br><span class="line">        <span class="keyword">private</span> Runnable runnable;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InerCallable</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.runnable = runnable;</span><br><span class="line">        }</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>{</span><br><span class="line">            runnable.run();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        callable.call();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x7EBF;&#x7A0B;&#x6C60;">4.1.3. &#x7EBF;&#x7A0B;&#x6C60;</h3><blockquote>
<p>&#x5728;&#x4E0A;&#x4E00;&#x7BC7;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7EBF;&#x7A0B;&#x6C60;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;<code>submit</code>&#x65B9;&#x6CD5;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadPool</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x4E00;&#x4E2A;&#x963B;&#x585E;&#x5217;&#x961F;</span></span><br><span class="line">    ArrayBlockingQueue&lt;Runnable&gt; que ;</span><br><span class="line">    <span class="comment">// &#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;&#x7EBF;&#x7A0B;,&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x6211;&#x8FD9;&#x91CC;&#x53EA;&#x521D;&#x59CB;&#x5316;&#x8FDB;&#x6765;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;</span></span><br><span class="line">    Thread thread ;</span><br><span class="line">    <span class="comment">// &#x6784;&#x9020;&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyThreadPool</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// &#x521D;&#x59CB;&#x5316;&#x5217;&#x961F;</span></span><br><span class="line">        que = <span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// &#x521D;&#x59CB;&#x5316;&#x7EBF;&#x7A0B;</span></span><br><span class="line">        <span class="keyword">this</span>.thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="comment">// &#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;&#x7EBF;&#x7A0B;&#x4E0D;&#x9500;&#x6BC1;,&#x4E00;&#x81F4;&#x5360;&#x7528;&#x7740;&#x904D;&#x5386;&#x5217;&#x961F;, &#x5217;&#x961F;&#x4E2D;&#x6709;&#x503C;&#x540E;&#x5C31;&#x83B7;&#x53D6;Runnable,&#x5E76;&#x8C03;&#x7528;run()</span></span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>){</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        Runnable runnable = que.take();</span><br><span class="line">                        runnable.run();</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }) ;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x5411;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x52A0;&#x5165;&#x4EFB;&#x52A1;&#x7684;&#x65F6;&#x5019;,&#x76F4;&#x63A5;&#x6254;&#x5230;&#x5217;&#x961F;&#x91CC;, &#x8BA9;&#x521D;&#x59CB;&#x5316;&#x7684;&#x90A3;&#x4E2A;&#x7EBF;&#x7A0B;&#x53BB;&#x626B;&#x63CF;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span></span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            que.put(command);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">submit</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">        MyFutureTask myFutureTask = <span class="keyword">new</span> MyFutureTask(runnable);</span><br><span class="line">        execute(myFutureTask);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">submit</span><span class="params">(MyCallable callable)</span> </span>{</span><br><span class="line">        MyFutureTask myFutureTask = <span class="keyword">new</span> MyFutureTask(callable);</span><br><span class="line">        execute(myFutureTask);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x5206;&#x6790;2">4.2. &#x5206;&#x6790;2</h2><blockquote>
<p> &#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x6211;&#x4EEC;&#x52A0;&#x5165;&#x5224;&#x65AD;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x6267;&#x884C;&#x5B8C;&#x7684;&#x65B9;&#x6CD5;</p>
</blockquote>
<h3 id="&#x5305;&#x88C5;&#x7C7B;-1">4.2.1. &#x5305;&#x88C5;&#x7C7B;</h3><blockquote>
<p>&#x6B64;&#x5904;&#x589E;&#x52A0;&#x4E86;&#x7EBF;&#x7A0B;&#x7684;&#x6267;&#x884C;&#x72B6;&#x6001;, &#x4EE5;&#x53CA;&#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x6CA1;&#x6267;&#x884C;&#x5B8C;&#x5C31;&#x6B7B;&#x5FAA;&#x73AF;&#x7684;&#x65B9;&#x6CD5;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFutureTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x5BF9;&#x8C61;&#x90FD;&#x5305;&#x5728;&#x8FD9;&#x91CC;&#x9762;</span></span><br><span class="line">    <span class="keyword">private</span> MyCallable callable;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 0:&#x672A;&#x6267;&#x884C;/&#x6B63;&#x5728;&#x6267;&#x884C; 1:&#x6267;&#x884C;&#x5B8C;&#x6BD5;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> status;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyFutureTask</span><span class="params">(MyCallable callable)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.callable = callable;</span><br><span class="line">        status = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyFutureTask</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.callable = <span class="keyword">new</span> InerCallable(runnable);</span><br><span class="line">        status = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">InerCallable</span> <span class="keyword">implements</span> <span class="title">MyCallable</span></span>{</span><br><span class="line">        <span class="keyword">private</span> Runnable runnable;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InerCallable</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.runnable = runnable;</span><br><span class="line">        }</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>{</span><br><span class="line">            runnable.run();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        callable.call();</span><br><span class="line">        status = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (status == <span class="number">0</span>){</span><br><span class="line">            <span class="comment">// &#x5982;&#x679C;&#x72B6;&#x6001;&#x4E3A;&#x672A;&#x6267;&#x884C;&#x5C31;&#x5F00;&#x59CB;&#x6B7B;&#x5FAA;&#x73AF;, &#x76F4;&#x5230;&#x72B6;&#x6001;&#x88AB;&#x4FEE;&#x6539;&#x4E3A;&#x6267;&#x884C;&#x5B8C;&#x6BD5;</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>){</span><br><span class="line">                <span class="keyword">if</span> (status==<span class="number">1</span>){</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x7EBF;&#x7A0B;&#x6C60;-1">4.2.2. &#x7EBF;&#x7A0B;&#x6C60;</h3><blockquote>
<p>&#x4E4B;&#x524D;&#x7684;&#x65B9;&#x6CD5;&#x7701;&#x7565;, &#x6B64;&#x5904;&#x4EC5;&#x4EC5;&#x6DFB;&#x52A0;&#x4E86;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadPool</span> </span>{</span><br><span class="line"><span class="comment">// &#x4E4B;&#x524D;&#x7684;&#x65B9;&#x6CD5;&#x7701;&#x7565;, &#x6B64;&#x5904;&#x4EC5;&#x4EC5;&#x6DFB;&#x52A0;&#x4E86;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">invokeAll</span><span class="params">(List&lt;MyCallable&gt; callableList)</span> </span>{</span><br><span class="line">        List&lt;MyFutureTask&gt; taskList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (MyCallable callable : callableList) {</span><br><span class="line">            MyFutureTask myFutureTask = <span class="keyword">new</span> MyFutureTask(callable);</span><br><span class="line">            taskList.add(myFutureTask);</span><br><span class="line">            execute(myFutureTask);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (MyFutureTask myFutureTask : taskList) {</span><br><span class="line">            myFutureTask.get();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x5206;&#x6790;3">4.3. &#x5206;&#x6790;3</h2><blockquote>
<p>&#x8FD4;&#x56DE;&#x503C;&#x4E5F;&#x653E;&#x5728;&#x5305;&#x88C5;&#x7C7B;&#x4E2D;,&#x6B64;&#x5904;&#x9700;&#x8981;&#x7528;&#x5230;&#x6CDB;&#x578B;</p>
</blockquote>
<h3 id="&#x81EA;&#x5B9A;&#x4E49;&#x63A5;&#x53E3;-1">4.3.1. &#x81EA;&#x5B9A;&#x4E49;&#x63A5;&#x53E3;</h3><blockquote>
<p>&#x6B64;&#x5904;&#x4FEE;&#x6539;&#x4E86;&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#x4E3A;&#x6CDB;&#x578B;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyCallable</span>&lt;<span class="title">T</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">call</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x5305;&#x88C5;&#x7C7B;-2">4.3.2. &#x5305;&#x88C5;&#x7C7B;</h3><blockquote>
<ol>
<li>&#x589E;&#x52A0;&#x4E86;&#x6CDB;&#x578B;&#x7684;&#x8FD4;&#x56DE;&#x503C;</li>
<li><code>InerCallable</code>&#x8C03;&#x7528;&#x4F4D;&#x7F6E;&#x4E5F;&#x8FDB;&#x884C;&#x4E86;&#x4FEE;&#x6539;, &#x76F4;&#x63A5;&#x8FD4;&#x56DE;<code>null</code></li>
<li><code>call</code>&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x540E;&#x503C;&#x8D4B;&#x503C;&#x7ED9;&#x5305;&#x88C5;&#x7C7B;&#x4E2D;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;<code>result</code></li>
<li>&#x8C03;&#x7528;<code>get</code>&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x5B8C;&#x540E;&#x4F1A;&#x8FD4;&#x56DE;<code>result</code></li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFutureTask</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x5BF9;&#x8C61;&#x90FD;&#x5305;&#x5728;&#x8FD9;&#x91CC;&#x9762;</span></span><br><span class="line">    <span class="keyword">private</span> MyCallable&lt;T&gt; callable;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 0:&#x672A;&#x6267;&#x884C;/&#x6B63;&#x5728;&#x6267;&#x884C; 1:&#x6267;&#x884C;&#x5B8C;&#x6BD5;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T result;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyFutureTask</span><span class="params">(MyCallable&lt;T&gt; callable)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.callable = callable;</span><br><span class="line">        status = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyFutureTask</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.callable = <span class="keyword">new</span> InerCallable(runnable);</span><br><span class="line">        status = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">InerCallable</span> <span class="keyword">implements</span> <span class="title">MyCallable</span>&lt;<span class="title">T</span>&gt; </span>{</span><br><span class="line">        <span class="keyword">private</span> Runnable runnable;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InerCallable</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.runnable = runnable;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">call</span><span class="params">()</span> </span>{</span><br><span class="line">            runnable.run();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        result = callable.call();</span><br><span class="line">        status = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (status == <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// &#x5982;&#x679C;&#x72B6;&#x6001;&#x4E3A;&#x672A;&#x6267;&#x884C;&#x5C31;&#x5F00;&#x59CB;&#x6B7B;&#x5FAA;&#x73AF;, &#x76F4;&#x5230;&#x72B6;&#x6001;&#x88AB;&#x4FEE;&#x6539;&#x4E3A;&#x6267;&#x884C;&#x5B8C;&#x6BD5;</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                <span class="keyword">if</span> (status == <span class="number">1</span>) {</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>thread-pool</category>
      </categories>
  </entry>
  <entry>
    <title>线程池导读1:浅谈JAVA线程池工作原理</title>
    <url>/2020/qian-tan-java-thread-pool/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p>&#x53EF;&#x4EE5;&#x5148;&#x770B;&#x770B;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;: <a href="https://blog.csdn.net/lihao19920629/article/details/94999059" target="_blank" rel="noopener">JAVA&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x548C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x7684;&#x5173;&#x7CFB;</a>,&#x4ECE;&#x8FD9;&#x91CC;&#x9762;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x5230;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;</p>
<ol>
<li>Thread&#x7C7B;&#x8C03;&#x7528;start&#x65B9;&#x6CD5;&#x4F1A;&#x901A;&#x8FC7;jvm&#x8C03;&#x7528;&#x7CFB;&#x7EDF;&#x5E95;&#x5C42;&#x51FD;&#x6570;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x3002;</li>
<li>&#x521B;&#x5EFA;&#x5B8C;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x540E;, &#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x4F1A;&#x56DE;&#x8C03;&#x6211;&#x4EEC;&#x7684;run&#x65B9;&#x6CD5;</li>
<li>&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x5F88;&#x9EBB;&#x70E6;,&#x5F00;&#x9500;&#x5F88;&#x5927;</li>
</ol>
</blockquote>
<a id="more"></a>

<p><strong>&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x5747;&#x4E3A;&#x4F2A;&#x4EE3;&#x7801;,&#x76EE;&#x7684;&#x662F;&#x63D0;&#x4F9B;&#x601D;&#x8DEF;</strong></p>
<h1 id="&#x5206;&#x6790;">2. &#x5206;&#x6790;</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> List list = <span class="keyword">new</span> ArrayList();</span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">    fun(list);</span><br><span class="line">  }</span><br><span class="line">}).start();</span><br></pre></td></tr></table></figure>

<p> &#x6211;&#x4EEC;&#x7684;run&#x65B9;&#x6CD5;&#x662F;&#x5199;&#x5728;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;<code>Runable</code>&#x63A5;&#x53E3;&#x7684;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;, &#x56E0;&#x4E3A;&#x8BE5;&#x5BF9;&#x8C61;&#x662F;&#x4E00;&#x4E2A;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;, &#x6240;&#x4EE5;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;<code>list</code>&#x7684;&#x5F15;&#x7528;&#x5730;&#x5740;&#x4F1A;&#x88AB;&#x8D4B;&#x503C;&#x5230;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x7684;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x4E2D;, &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x5982;&#x4E0B;:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>{</span><br><span class="line">  List list;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">A</span><span class="params">(List list)</span></span>{</span><br><span class="line">    <span class="keyword">this</span>.list = list;</span><br><span class="line">  }</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>{</span><br><span class="line">    fun(list);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x4F1A;&#x8C03;&#x7528;&#x6211;&#x4EEC;&#x5B9E;&#x4F8B;&#x5316;&#x51FA;&#x6765;&#x7684;&#x7C7B;<code>A</code>&#x7684;<code>run()</code>;&#x6267;&#x884C;&#x5B8C;<code>run()</code>&#x7EBF;&#x7A0B;&#x5173;&#x95ED;;</p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6765;, &#x5E9F;&#x4E86;&#x90A3;&#x4E48;&#x5927;&#x7684;&#x52B2;, &#x6211;&#x4EEC;&#x7684;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x8C03;&#x7528;<code>run()</code>,&#x800C;&#x8BE5;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x65F6;&#x7684;&#x53C2;&#x6570;&#x90FD;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;<code>A</code>&#x4E2D;, &#x90A3;&#x6211;&#x4EEC;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x5C06;<code>A</code>&#x5B58;&#x5230;&#x4E00;&#x4E2A;&#x5217;&#x961F;&#x91CC;,&#x6211;&#x4EEC;&#x65B0;&#x5EFA;&#x51FA;&#x6765;&#x7EBF;&#x7A0B;&#x6C60;&#x540E;&#x4E0D;&#x9500;&#x6BC1;, &#x76F4;&#x63A5;&#x4ECE;&#x5217;&#x961F;&#x4E2D;&#x83B7;&#x53D6;&#x5230;<code>A</code>&#x7136;&#x540E;&#x8C03;&#x7528;<code>A</code>&#x7684;<code>run()</code>&#x65B9;&#x6CD5;&#x5C31;&#x597D;&#x4E86;</p>
<h1 id="&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;">3. &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadPool</span></span>{</span><br><span class="line">  <span class="comment">// &#x4E00;&#x4E2A;&#x963B;&#x585E;&#x5217;&#x961F;</span></span><br><span class="line">  ArrayBlockingQueue&lt;Runnable&gt; que ;</span><br><span class="line">  <span class="comment">// &#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;&#x7EBF;&#x7A0B;,&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x6211;&#x8FD9;&#x91CC;&#x53EA;&#x521D;&#x59CB;&#x5316;&#x8FDB;&#x6765;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;</span></span><br><span class="line">  Thread thread ;</span><br><span class="line">	<span class="comment">// &#x6784;&#x9020;&#x65B9;&#x6CD5;</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ThreadPool</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// &#x521D;&#x59CB;&#x5316;&#x5217;&#x961F;</span></span><br><span class="line">    que = <span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="number">10</span>);</span><br><span class="line">    <span class="comment">// &#x521D;&#x59CB;&#x5316;&#x7EBF;&#x7A0B;</span></span><br><span class="line">    <span class="keyword">this</span>.thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// &#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;&#x7EBF;&#x7A0B;&#x4E0D;&#x9500;&#x6BC1;,&#x4E00;&#x81F4;&#x5360;&#x7528;&#x7740;&#x904D;&#x5386;&#x5217;&#x961F;, &#x5217;&#x961F;&#x4E2D;&#x6709;&#x503C;&#x540E;&#x5C31;&#x83B7;&#x53D6;Runnable,&#x5E76;&#x8C03;&#x7528;run()</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>){</span><br><span class="line">          <span class="keyword">try</span> {</span><br><span class="line">            Runnable runnable = que.take();</span><br><span class="line">            runnable.run();</span><br><span class="line">          } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }) ;</span><br><span class="line">  }</span><br><span class="line">	</span><br><span class="line">  <span class="comment">// &#x5411;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x52A0;&#x5165;&#x4EFB;&#x52A1;&#x7684;&#x65F6;&#x5019;,&#x76F4;&#x63A5;&#x6254;&#x5230;&#x5217;&#x961F;&#x91CC;, &#x8BA9;&#x521D;&#x59CB;&#x5316;&#x7684;&#x90A3;&#x4E2A;&#x7EBF;&#x7A0B;&#x53BB;&#x626B;&#x63CF;</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span></span>{</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      que.put(command);</span><br><span class="line">    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="&#x8C03;&#x7528;">4. &#x8C03;&#x7528;</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">  ThreadPool pool = <span class="keyword">new</span> ThreadPool();</span><br><span class="line"></span><br><span class="line">  List&lt;String&gt; list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">  <span class="keyword">for</span> (String s : list) {</span><br><span class="line">    pool.execute(<span class="keyword">new</span> Runnable() {</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(s);</span><br><span class="line">      }</span><br><span class="line">    });</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="&#x8B66;&#x60D5;">5. &#x8B66;&#x60D5;</h1><p>&#x53C2;&#x6570;&#x4F20;&#x5165;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x540E;,&#x52A0;&#x5165;&#x4FEE;&#x6539;&#x4E86;&#x5305;&#x88C5;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x503C;, &#x800C;<strong>&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x4E2D;&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x5730;&#x5740;&#x503C;</strong>, &#x6240;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x4E5F;&#x662F;&#x65B0;&#x7684;&#x503C;,&#x800C;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7EBF;&#x7A0B;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;, &#x6240;&#x4EE5;&#x8BE5;&#x5305;&#x88C5;&#x5BF9;&#x8C61;&#x5343;&#x4E07;&#x4E0D;&#x8981;&#x4FEE;&#x6539;!</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span></span>{</span><br><span class="line">  <span class="keyword">final</span> List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">  list.add(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">      TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">      list.add(<span class="number">3</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;run&quot;</span> + list);</span><br><span class="line">    }</span><br><span class="line">  }).start();</span><br><span class="line">  TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">  list.add(<span class="number">2</span>);</span><br><span class="line">  System.out.println(<span class="string">&quot;main&quot;</span>+list);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7ED3;&#x679C;&#x5982;&#x4E0B;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">main[<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">run[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>thread-pool</category>
      </categories>
  </entry>
  <entry>
    <title>jdk1.7-ConcurrentHashMap</title>
    <url>/2020/jdk1-7-concurrent-hash-map/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p><code>ConcurrentHashMap</code>&#x662F;&#x4E00;&#x79CD;&#x652F;&#x6301;&#x591A;&#x7EBF;&#x7A0B;&#x7684;<code>hashmap</code>, &#x76F8;&#x5BF9;&#x4E8E;<code>hashTable</code>&#x5B83;&#x4F7F;&#x7528;&#x4E86;&#x5206;&#x6BB5;&#x9501;&#x7684;&#x65B9;&#x5F0F;&#x52A0;&#x9501;, &#x5927;&#x5927;&#x63D0;&#x5347;&#x4E86;&#x5E76;&#x53D1;&#x7684;&#x6027;&#x80FD;</p>
</blockquote>
<h2 id="&#x6570;&#x636E;&#x7ED3;&#x6784;">1.1. &#x6570;&#x636E;&#x7ED3;&#x6784;</h2><p><img src="/2020/jdk1-7-concurrent-hash-map/1.7-currentHashMap.png" alt></p>
<p><code>ConcurrentHashMap</code>&#x4E0E;<code>hashmap</code>&#x6709;&#x6240;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x6700;&#x521D;&#x521D;&#x59CB;&#x5316;&#x7684;&#x6570;&#x7EC4;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E2D;&#x5B58;&#x653E;&#x7684;&#x90FD;&#x662F;n&#x4E2A;&#x6570;&#x7EC4;, &#x8FD9;&#x4E9B;&#x6570;&#x7EC4;&#x4E2D;&#x5B58;&#x653E;&#x7684;&#x624D;&#x662F;&#x6700;&#x7EC8;&#x5B58;&#x653E;&#x6570;&#x636E;&#x7684;&#x94FE;&#x8868;.</p>
<a id="more"></a>

<h2 id="UNSAFE">1.2. UNSAFE</h2><p><code>UNSAFE</code>&#x662F;Java&#x4E2D;&#x4E00;&#x4E2A;&#x5E95;&#x5C42;&#x7C7B;&#xFF0C;&#x5305;&#x542B;&#x4E86;&#x5F88;&#x591A;&#x57FA;&#x7840;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x6570;&#x7EC4;&#x64CD;&#x4F5C;&#x3001;&#x5BF9;&#x8C61;&#x64CD;&#x4F5C;&#x3001;&#x5185;&#x5B58;&#x64CD;&#x4F5C;&#x3001;CAS&#x64CD;&#x4F5C;&#x3001;&#x7EBF;&#x7A0B;(park)&#x64CD;&#x4F5C;&#x3001;&#x6805;&#x680F;&#xFF08;Fence&#xFF09;&#x64CD;&#x4F5C;&#xFF0C;JUC&#x5305;&#x3001;&#x4E00;&#x4E9B;&#x4E09;&#x65B9;&#x6846;&#x67B6;&#x90FD;&#x4F7F;&#x7528;Unsafe&#x7C7B;&#x6765;&#x4FDD;&#x8BC1;&#x5E76;&#x53D1;&#x5B89;&#x5168;&#x3002;</p>
<p><a href="https://www.cnblogs.com/throwable/p/9139947.html" target="_blank" rel="noopener">&#x8F6C;&#x8F7D;&#x81EA;:UNSAFE</a></p>
<h3 id="arrayBaseOffset">1.2.1. arrayBaseOffset</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">arrayBaseOffset</span><span class="params">(Class arrayClass)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x8FD4;&#x56DE;&#x6570;&#x7EC4;&#x7C7B;&#x578B;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x504F;&#x79FB;&#x5730;&#x5740;(&#x57FA;&#x7840;&#x504F;&#x79FB;&#x5730;&#x5740;)&#x3002;&#x5982;&#x679C;<code>arrayIndexScale</code>&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7684;&#x6BD4;&#x4F8B;&#x56E0;&#x5B50;&#x4E0D;&#x4E3A;0&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7ED3;&#x5408;&#x57FA;&#x7840;&#x504F;&#x79FB;&#x5730;&#x5740;&#x548C;&#x6BD4;&#x4F8B;&#x56E0;&#x5B50;&#x8BBF;&#x95EE;&#x6570;&#x7EC4;&#x7684;&#x6240;&#x6709;&#x5143;&#x7D20;&#x3002;Unsafe&#x4E2D;&#x5DF2;&#x7ECF;&#x521D;&#x59CB;&#x5316;&#x4E86;&#x5F88;&#x591A;&#x7C7B;&#x4F3C;&#x7684;&#x5E38;&#x91CF;&#x5982;ARRAY_BOOLEAN_BASE_OFFSET&#x7B49;&#x3002;</p>
</blockquote>
<h3 id="arrayIndexScale">1.2.2. arrayIndexScale</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">arrayIndexScale</span><span class="params">(Class arrayClass)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x8FD4;&#x56DE;&#x6570;&#x7EC4;&#x7C7B;&#x578B;&#x7684;&#x6BD4;&#x4F8B;&#x56E0;&#x5B50;(&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x6570;&#x636E;&#x4E2D;&#x5143;&#x7D20;&#x504F;&#x79FB;&#x5730;&#x5740;&#x7684;&#x589E;&#x91CF;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x7684;&#x5730;&#x5740;&#x662F;&#x8FDE;&#x7EED;&#x7684;)&#x3002;&#x6B64;&#x65B9;&#x6CD5;&#x4E0D;&#x9002;&#x7528;&#x4E8E;&#x6570;&#x7EC4;&#x7C7B;&#x578B;&#x4E3A;&#x201D;narrow&#x201D;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x201D;narrow&#x201D;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x7EC4;&#x7C7B;&#x578B;&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x4F1A;&#x8FD4;&#x56DE;0(&#x8FD9;&#x91CC;narrow&#x5E94;&#x8BE5;&#x662F;&#x72ED;&#x4E49;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x4F46;&#x662F;&#x5177;&#x4F53;&#x6307;&#x54EA;&#x4E9B;&#x7C7B;&#x578B;&#x6682;&#x65F6;&#x4E0D;&#x660E;&#x786E;&#xFF0C;&#x7B14;&#x8005;&#x67E5;&#x4E86;&#x5F88;&#x591A;&#x8D44;&#x6599;&#x4E5F;&#x6CA1;&#x627E;&#x5230;&#x7ED3;&#x679C;)&#x3002;Unsafe&#x4E2D;&#x5DF2;&#x7ECF;&#x521D;&#x59CB;&#x5316;&#x4E86;&#x5F88;&#x591A;&#x7C7B;&#x4F3C;&#x7684;&#x5E38;&#x91CF;&#x5982;ARRAY_BOOLEAN_INDEX_SCALE&#x7B49;&#x3002;</p>
</blockquote>
<h3 id="objectFieldOffset">1.2.3. objectFieldOffset</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">objectFieldOffset</span><span class="params">(Class arrayClass)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x8FD4;&#x56DE;&#x7ED9;&#x5B9A;&#x7684;<strong>&#x975E;&#x9759;&#x6001;&#x5C5E;&#x6027;</strong>&#x5728;&#x5B83;&#x7684;&#x7C7B;&#x7684;&#x5B58;&#x50A8;&#x5206;&#x914D;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;(&#x504F;&#x79FB;&#x5730;&#x5740;)&#x3002;&#x4E0D;&#x8981;&#x5728;&#x8FD9;&#x4E2A;&#x504F;&#x79FB;&#x91CF;&#x4E0A;&#x6267;&#x884C;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x7684;&#x7B97;&#x672F;&#x8FD0;&#x7B97;&#xFF0C;&#x5B83;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x88AB;&#x4F20;&#x9012;&#x7ED9;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x5806;&#x5185;&#x5B58;&#x8BBF;&#x95EE;&#x5668;&#x7684;cookie&#x3002;&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4EC5;&#x4EC5;&#x9488;&#x5BF9;&#x975E;&#x9759;&#x6001;&#x5C5E;&#x6027;&#xFF0C;&#x4F7F;&#x7528;&#x5728;&#x9759;&#x6001;&#x5C5E;&#x6027;&#x4E0A;&#x4F1A;&#x629B;&#x5F02;&#x5E38;&#x3002;</p>
</blockquote>
<h3 id="putObjectVolatile">1.2.4. putObjectVolatile</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* obj: &#x5305;&#x542B;&#x9700;&#x8981;&#x4FEE;&#x6539;field&#x7684;&#x5BF9;&#x8C61;</span></span><br><span class="line"><span class="comment">* offset: obj&#x4E2D;long&#x578B;field&#x7684;&#x504F;&#x79FB;&#x91CF;</span></span><br><span class="line"><span class="comment">* value: field&#x5C06;&#x88AB;&#x8BBE;&#x7F6E;&#x7684;&#x65B0;&#x503C;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">putOrderedObject</span><span class="params">(Object obj, <span class="keyword">long</span> offset, Object value)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x6B64;&#x65B9;&#x6CD5;&#x548C;<code>putObject</code>&#x529F;&#x80FD;&#x7C7B;&#x4F3C;&#xFF0C;&#x4E0D;&#x8FC7;&#x9644;&#x52A0;&#x4E86;&#x2019;volatile&#x2019;&#x52A0;&#x8F7D;&#x8BED;&#x4E49;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BBE;&#x7F6E;&#x503C;&#x7684;&#x65F6;&#x5019;&#x5F3A;&#x5236;(JMM&#x4F1A;&#x4FDD;&#x8BC1;&#x83B7;&#x5F97;&#x9501;&#x5230;&#x91CA;&#x653E;&#x9501;&#x4E4B;&#x95F4;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x66F4;&#x65B0;&#x90FD;&#x4F1A;&#x5728;&#x9501;&#x88AB;&#x91CA;&#x653E;&#x4E4B;&#x540E;)&#x66F4;&#x65B0;&#x5230;&#x4E3B;&#x5B58;&#xFF0C;&#x4ECE;&#x800C;&#x4FDD;&#x8BC1;&#x8FD9;&#x4E9B;&#x53D8;&#x66F4;&#x5BF9;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x662F;&#x53EF;&#x89C1;&#x7684;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x6709;putIntVolatile&#x3001;putDoubleVolatile&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8981;&#x6C42;&#x88AB;&#x4F7F;&#x7528;&#x7684;&#x5C5E;&#x6027;&#x88AB;volatile&#x4FEE;&#x9970;&#xFF0C;&#x5426;&#x5219;&#x529F;&#x80FD;&#x548C;<code>putObject</code>&#x65B9;&#x6CD5;&#x76F8;&#x540C;&#x3002;</p>
</blockquote>
<h3 id="putOrderedObject">1.2.5. putOrderedObject</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* obj: &#x5305;&#x542B;&#x9700;&#x8981;&#x4FEE;&#x6539;field&#x7684;&#x5BF9;&#x8C61;</span></span><br><span class="line"><span class="comment">* offset: obj&#x4E2D;long&#x578B;field&#x7684;&#x504F;&#x79FB;&#x91CF;</span></span><br><span class="line"><span class="comment">* value: field&#x5C06;&#x88AB;&#x8BBE;&#x7F6E;&#x7684;&#x65B0;&#x503C;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">putOrderedObject</span><span class="params">(Object obj, <span class="keyword">long</span> offset, Object value)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x8BBE;&#x7F6E;o&#x5BF9;&#x8C61;&#x4E2D;offset&#x504F;&#x79FB;&#x5730;&#x5740;offset&#x5BF9;&#x5E94;&#x7684;Object&#x578B;field&#x7684;&#x503C;&#x4E3A;&#x6307;&#x5B9A;&#x503C;x&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x5E8F;&#x6216;&#x8005;&#x6709;&#x5EF6;&#x8FDF;&#x7684;putObjectVolatile&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4FDD;&#x8BC1;&#x503C;&#x7684;&#x6539;&#x53D8;&#x88AB;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x7ACB;&#x5373;&#x770B;&#x5230;&#x3002;&#x53EA;&#x6709;&#x5728;field&#x88AB;volatile&#x4FEE;&#x9970;&#x5E76;&#x4E14;&#x671F;&#x671B;&#x88AB;&#x4FEE;&#x6539;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#x624D;&#x4F1A;&#x751F;&#x6548;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x6709;<code>putOrderedInt</code>&#x548C;<code>putOrderedLong</code>&#x3002;</p>
</blockquote>
<h3 id="putIntVolatile">1.2.6. putIntVolatile</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* obj: &#x5305;&#x542B;&#x9700;&#x8981;&#x4FEE;&#x6539;field&#x7684;&#x5BF9;&#x8C61;</span></span><br><span class="line"><span class="comment">* offset: obj&#x4E2D;long&#x578B;field&#x7684;&#x504F;&#x79FB;&#x91CF;</span></span><br><span class="line"><span class="comment">* value: field&#x5C06;&#x88AB;&#x8BBE;&#x7F6E;&#x7684;&#x65B0;&#x503C;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">putIntVolatile</span><span class="params">(Object obj, <span class="keyword">long</span> offset, <span class="keyword">int</span> value)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x8BBE;&#x7F6E;obj&#x5BF9;&#x8C61;&#x4E2D;offset&#x504F;&#x79FB;&#x5730;&#x5740;&#x5BF9;&#x5E94;&#x7684;&#x6574;&#x578B;field&#x7684;&#x503C;&#x4E3A;&#x6307;&#x5B9A;&#x503C;&#x3002;&#x652F;&#x6301;volatile store&#x8BED;&#x4E49;</p>
</blockquote>
<h3 id="getObject">1.2.7. getObject</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* obj: &#x5305;&#x542B;&#x9700;&#x8981;&#x53BB;&#x8BFB;&#x53D6;&#x7684;field&#x7684;&#x5BF9;&#x8C61;</span></span><br><span class="line"><span class="comment">* offset: obj&#x4E2D;long&#x578B;field&#x7684;&#x504F;&#x79FB;&#x91CF;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> Object <span class="title">getObject</span><span class="params">(Object obj, <span class="keyword">long</span> offset)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x901A;&#x8FC7;&#x7ED9;&#x5B9A;&#x7684;Java&#x53D8;&#x91CF;&#x83B7;&#x53D6;&#x5F15;&#x7528;&#x503C;&#x3002;&#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;Java&#x5BF9;&#x8C61;o&#x4E2D;&#xFF0C;&#x83B7;&#x53D6;&#x504F;&#x79FB;&#x5730;&#x5740;&#x4E3A;offset&#x7684;&#x5C5E;&#x6027;&#x7684;&#x503C;&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x7A81;&#x7834;&#x4FEE;&#x9970;&#x7B26;&#x7684;&#x6291;&#x5236;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x65E0;&#x89C6;private&#x3001;protected&#x548C;default&#x4FEE;&#x9970;&#x7B26;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x6709;getInt&#x3001;getDouble&#x7B49;&#x7B49;&#x3002;</p>
</blockquote>
<h3 id="getObjectVolatile">1.2.8. getObjectVolatile</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* obj: &#x5305;&#x542B;&#x9700;&#x8981;&#x53BB;&#x8BFB;&#x53D6;&#x7684;field&#x7684;&#x5BF9;&#x8C61;</span></span><br><span class="line"><span class="comment">* offset: obj&#x4E2D;long&#x578B;field&#x7684;&#x504F;&#x79FB;&#x91CF;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> Object <span class="title">getObjectVolatile</span><span class="params">(Object obj, <span class="keyword">long</span> offset)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x6B64;&#x65B9;&#x6CD5;&#x548C;<code>getObject</code>&#x529F;&#x80FD;&#x7C7B;&#x4F3C;&#xFF0C;&#x4E0D;&#x8FC7;&#x9644;&#x52A0;&#x4E86;<code>volatile</code>&#x52A0;&#x8F7D;&#x8BED;&#x4E49;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5F3A;&#x5236;&#x4ECE;&#x4E3B;&#x5B58;&#x4E2D;&#x83B7;&#x53D6;&#x5C5E;&#x6027;&#x503C;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x6709;getIntVolatile&#x3001;getDoubleVolatile&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8981;&#x6C42;&#x88AB;&#x4F7F;&#x7528;&#x7684;&#x5C5E;&#x6027;&#x88AB;volatile&#x4FEE;&#x9970;&#xFF0C;&#x5426;&#x5219;&#x529F;&#x80FD;&#x548C;<code>getObject</code>&#x65B9;&#x6CD5;&#x76F8;&#x540C;&#x3002;</p>
</blockquote>
<h3 id="compareAndSwapObject">1.2.9. compareAndSwapObject</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> obj &#x5305;&#x542B;&#x8981;&#x4FEE;&#x6539;field&#x7684;&#x5BF9;&#x8C61; </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> offset &lt;code&gt;obj&lt;/code&gt;&#x4E2D;object&#x578B;field&#x7684;&#x504F;&#x79FB;&#x91CF;</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> expect &#x5E0C;&#x671B;field&#x4E2D;&#x5B58;&#x5728;&#x7684;&#x503C;</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> update &#x5982;&#x679C;&#x671F;&#x671B;&#x503C;expect&#x4E0E;field&#x7684;&#x5F53;&#x524D;&#x503C;&#x76F8;&#x540C;&#xFF0C;&#x8BBE;&#x7F6E;filed&#x7684;&#x503C;&#x4E3A;&#x8FD9;&#x4E2A;&#x65B0;&#x503C;</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> true &#x5982;&#x679C;field&#x7684;&#x503C;&#x88AB;&#x66F4;&#x6539;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">compareAndSwapObject</span><span class="params">(Object obj, <span class="keyword">long</span> offset,</span></span></span><br><span class="line"><span class="function"><span class="params">                                            Object expect, Object update)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x9488;&#x5BF9;Object&#x5BF9;&#x8C61;&#x8FDB;&#x884C;CAS&#x64CD;&#x4F5C;&#x3002;&#x5373;&#x662F;&#x5BF9;&#x5E94;Java&#x53D8;&#x91CF;&#x5F15;&#x7528;o&#xFF0C;&#x539F;&#x5B50;&#x6027;&#x5730;&#x66F4;&#x65B0;o&#x4E2D;&#x504F;&#x79FB;&#x5730;&#x5740;&#x4E3A;offset&#x7684;&#x5C5E;&#x6027;&#x7684;&#x503C;&#x4E3A;x&#xFF0C;&#x5F53;&#x4E14;&#x4EC5;&#x7684;&#x504F;&#x79FB;&#x5730;&#x5740;&#x4E3A;offset&#x7684;&#x5C5E;&#x6027;&#x7684;&#x5F53;&#x524D;&#x503C;&#x4E3A;expected&#x624D;&#x4F1A;&#x66F4;&#x65B0;&#x6210;&#x529F;&#x8FD4;&#x56DE;true&#xFF0C;&#x5426;&#x5219;&#x8FD4;&#x56DE;false&#x3002;</p>
<ul>
<li>o&#xFF1A;&#x76EE;&#x6807;Java&#x53D8;&#x91CF;&#x5F15;&#x7528;&#x3002;</li>
<li>offset&#xFF1A;&#x76EE;&#x6807;Java&#x53D8;&#x91CF;&#x4E2D;&#x7684;&#x76EE;&#x6807;&#x5C5E;&#x6027;&#x7684;&#x504F;&#x79FB;&#x5730;&#x5740;&#x3002;</li>
<li>expected&#xFF1A;&#x76EE;&#x6807;Java&#x53D8;&#x91CF;&#x4E2D;&#x7684;&#x76EE;&#x6807;&#x5C5E;&#x6027;&#x7684;&#x671F;&#x671B;&#x7684;&#x5F53;&#x524D;&#x503C;&#x3002;</li>
<li>x&#xFF1A;&#x76EE;&#x6807;Java&#x53D8;&#x91CF;&#x4E2D;&#x7684;&#x76EE;&#x6807;&#x5C5E;&#x6027;&#x7684;&#x76EE;&#x6807;&#x66F4;&#x65B0;&#x503C;&#x3002;</li>
</ul>
<p>&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x6709;<code>compareAndSwapInt</code>&#x548C;<code>compareAndSwapLong</code>&#xFF0C;&#x5728;Jdk8&#x4E2D;&#x57FA;&#x4E8E;CAS&#x6269;&#x5C55;&#x51FA;&#x6765;&#x7684;&#x65B9;&#x6CD5;&#x6709;<code>getAndAddInt</code>&#x3001;<code>getAndAddLong</code>&#x3001;<code>getAndSetInt</code>&#x3001;<code>getAndSetLong</code>&#x3001;<code>getAndSetObject</code>&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x4F5C;&#x7528;&#x90FD;&#x662F;&#xFF1A;&#x901A;&#x8FC7;CAS&#x8BBE;&#x7F6E;&#x65B0;&#x7684;&#x503C;&#xFF0C;&#x8FD4;&#x56DE;&#x65E7;&#x7684;&#x503C;&#x3002;</p>
</blockquote>
<h1 id="static">2. static</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Unsafe mechanics</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> SBASE;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SSHIFT;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> TBASE;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TSHIFT;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> HASHSEED_OFFSET;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> SEGSHIFT_OFFSET;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> SEGMASK_OFFSET;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> SEGMENTS_OFFSET;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> {</span><br><span class="line">  <span class="keyword">int</span> ss, ts;</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class="line">    Class tc = HashEntry[]<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">    Class sc = Segment[]<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">    TBASE = UNSAFE.arrayBaseOffset(tc);</span><br><span class="line">    SBASE = UNSAFE.arrayBaseOffset(sc);</span><br><span class="line">    ts = UNSAFE.arrayIndexScale(tc);</span><br><span class="line">    ss = UNSAFE.arrayIndexScale(sc);</span><br><span class="line">    HASHSEED_OFFSET = UNSAFE.objectFieldOffset(</span><br><span class="line">      ConcurrentHashMap.class.getDeclaredField(&quot;hashSeed&quot;));</span><br><span class="line">    SEGSHIFT_OFFSET = UNSAFE.objectFieldOffset(</span><br><span class="line">      ConcurrentHashMap.class.getDeclaredField(&quot;segmentShift&quot;));</span><br><span class="line">    SEGMASK_OFFSET = UNSAFE.objectFieldOffset(</span><br><span class="line">      ConcurrentHashMap.class.getDeclaredField(&quot;segmentMask&quot;));</span><br><span class="line">    SEGMENTS_OFFSET = UNSAFE.objectFieldOffset(</span><br><span class="line">      ConcurrentHashMap.class.getDeclaredField(&quot;segments&quot;));</span><br><span class="line">  } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Error(e);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span> ((ss &amp; (ss-<span class="number">1</span>)) != <span class="number">0</span> || (ts &amp; (ts-<span class="number">1</span>)) != <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">&quot;data type scale not a power of two&quot;</span>);</span><br><span class="line">  SSHIFT = <span class="number">31</span> - Integer.numberOfLeadingZeros(ss);</span><br><span class="line">  TSHIFT = <span class="number">31</span> - Integer.numberOfLeadingZeros(ts);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x4E00;&#x5806;&#x505A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x4E1C;&#x897F;, &#x8FD9;&#x4E9B;&#x662F;&#x5728;&#x6784;&#x9020;&#x4E4B;&#x524D;&#x8FD0;&#x884C;&#x7684;, &#x6CA1;&#x592A;&#x641E;&#x61C2;, &#x5148;&#x8D34;&#x51FA;&#x6765;</p>
</blockquote>
<h1 id="&#x5185;&#x90E8;&#x7C7B;&#x7ED3;&#x6784;">3. &#x5185;&#x90E8;&#x7C7B;&#x7ED3;&#x6784;</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Segment</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">ReentrantLock</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line">  <span class="comment">// &#x5B9E;&#x9645;&#x5B58;&#x653E;&#x6570;&#x636E;&#x7684;&#x94FE;&#x8868;&#x6570;&#x7EC4;</span></span><br><span class="line">  <span class="keyword">transient</span> <span class="keyword">volatile</span> HashEntry&lt;K,V&gt;[] table;</span><br><span class="line">  <span class="comment">// &#x5143;&#x7D20;&#x7684;&#x4E2A;&#x6570;</span></span><br><span class="line">  <span class="keyword">transient</span> <span class="keyword">int</span> count;</span><br><span class="line">  <span class="comment">// segment&#x5143;&#x7D20;&#x4FEE;&#x6539;&#x6B21;&#x6570;</span></span><br><span class="line">  <span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br><span class="line">  <span class="comment">// &#x6269;&#x5BB9;&#x6307;&#x6807;</span></span><br><span class="line">  <span class="keyword">transient</span> <span class="keyword">int</span> threshold;</span><br><span class="line">  <span class="comment">// &#x8D1F;&#x8F7D;&#x56E0;&#x5B50;</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br><span class="line">  Segment(<span class="keyword">float</span> lf, <span class="keyword">int</span> threshold, HashEntry&lt;K,V&gt;[] tab) {</span><br><span class="line">    <span class="keyword">this</span>.loadFactor = lf;</span><br><span class="line">    <span class="keyword">this</span>.threshold = threshold;</span><br><span class="line">    <span class="keyword">this</span>.table = tab;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HashEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>{</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">  <span class="keyword">final</span> K key;</span><br><span class="line">  <span class="keyword">volatile</span> V value;</span><br><span class="line">  <span class="keyword">volatile</span> HashEntry&lt;K,V&gt; next;</span><br><span class="line"></span><br><span class="line">  HashEntry(<span class="keyword">int</span> hash, K key, V value, HashEntry&lt;K,V&gt; next) {</span><br><span class="line">    <span class="keyword">this</span>.hash = hash;</span><br><span class="line">    <span class="keyword">this</span>.key = key;</span><br><span class="line">    <span class="keyword">this</span>.value = value;</span><br><span class="line">    <span class="keyword">this</span>.next = next;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x8FD9;&#x91CC;&#x5148;&#x7B80;&#x5355;&#x8BF4;&#x660E;&#x57FA;&#x7840;&#x7684;&#x7C7B;&#x7ED3;&#x6784;,&#x6709;&#x4E2A;&#x6982;&#x5FF5;</p>
<p>segment[] -&gt;segment-&gt;HashEntry&lt;K,V&gt;[] table-&gt;HashEntry</p>
</blockquote>
<h1 id="ConcurrentHashMap">4. ConcurrentHashMap</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x9ED8;&#x8BA4;&#x6570;&#x7EC4;&#x957F;&#x5EA6;&#x5927;&#x5C0F;</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">16</span>;</span><br><span class="line"><span class="comment">// &#x8D1F;&#x8F7D;&#x56E0;&#x5B50;</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"><span class="comment">// &#x9ED8;&#x8BA4;&#x7EBF;&#x7A0B;&#x5E76;&#x53D1;&#x5EA6;&#xFF0C;&#x9ED8;&#x8BA4;&#x6700;&#x5927;&#x5141;&#x8BB8;16&#x4E2A;&#x7EBF;&#x7A0B;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#xFF0C;&#x6761;&#x4EF6;&#x662F;&#x8FD9;16&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x5206;&#x522B;&#x5728;16&#x4E2A;segments&#x4E2D;</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CONCURRENCY_LEVEL = <span class="number">16</span>;</span><br><span class="line"><span class="comment">// segment&#x4E2A;&#x6570;&#x9650;&#x5236;</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SEGMENTS = <span class="number">1</span> &lt;&lt; <span class="number">16</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="keyword">this</span>(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR, DEFAULT_CONCURRENCY_LEVEL);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">float</span> loadFactor, <span class="keyword">int</span> concurrencyLevel)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span> (!(loadFactor &gt; <span class="number">0</span>) || initialCapacity &lt; <span class="number">0</span> || concurrencyLevel &lt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">  <span class="comment">// &#x6700;&#x5927;&#x5E76;&#x53D1;&#x6570;&#x9650;&#x5236;</span></span><br><span class="line">  <span class="keyword">if</span> (concurrencyLevel &gt; MAX_SEGMENTS)</span><br><span class="line">    concurrencyLevel = MAX_SEGMENTS;</span><br><span class="line">  <span class="comment">// Find power-of-two sizes best matching arguments</span></span><br><span class="line">  <span class="comment">// &#x627E;&#x5230;&#x4E00;&#x4E2A;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#x4F20;&#x5165;&#x7684;concurrencyLevel&#x7684;&#x6700;&#x5C0F;2^n&#x6570;</span></span><br><span class="line">  <span class="keyword">int</span> sshift = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> ssize = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (ssize &lt; concurrencyLevel) {</span><br><span class="line">    ++sshift;</span><br><span class="line">    ssize &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">this</span>.segmentShift = <span class="number">32</span> - sshift;</span><br><span class="line">  <span class="keyword">this</span>.segmentMask = ssize - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">    initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">  <span class="comment">// &#x8BA1;&#x7B97;&#x6BCF;&#x4E2A;segment&#x4E2D;table&#x7684;&#x5BB9;&#x91CF;, &#x9664;&#x4E4B;&#x540E;&#x662F;&#x7701;&#x7565;&#x5C0F;&#x6570;&#x70B9;&#x7684;, &#x6240;&#x4EE5;&#x518D;&#x52A0;&#x4E00;&#x4F4D;&#x5C31;&#x597D;&#x4E86;</span></span><br><span class="line">  <span class="keyword">int</span> c = initialCapacity / ssize;</span><br><span class="line">  <span class="keyword">if</span> (c * ssize &lt; initialCapacity)</span><br><span class="line">    ++c;</span><br><span class="line">  <span class="keyword">int</span> cap = MIN_SEGMENT_TABLE_CAPACITY;</span><br><span class="line">  <span class="keyword">while</span> (cap &lt; c)</span><br><span class="line">    cap &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// create segments and segments[0]</span></span><br><span class="line">  <span class="comment">// &#x521B;&#x5EFA;segments&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;segment&#x6570;&#x7EC4;,&#x5176;&#x4F59;&#x7684;segment&#x5EF6;&#x8FDF;&#x521D;&#x59CB;&#x5316;</span></span><br><span class="line">  <span class="comment">// &#x6CE8;&#x610F; segment&#x4E2D;&#x653E;&#x7684;&#x662F;HashEntry&#x6570;&#x7EC4;</span></span><br><span class="line">  Segment&lt;K,V&gt; s0 =</span><br><span class="line">    <span class="keyword">new</span> Segment&lt;K,V&gt;(loadFactor, (<span class="keyword">int</span>)(cap * loadFactor),</span><br><span class="line">                     (HashEntry&lt;K,V&gt;[])<span class="keyword">new</span> HashEntry[cap]);</span><br><span class="line">  <span class="comment">// &#x521B;&#x5EFA;segments</span></span><br><span class="line">  Segment&lt;K,V&gt;[] ss = (Segment&lt;K,V&gt;[])<span class="keyword">new</span> Segment[ssize];</span><br><span class="line">  <span class="comment">// ss&#x7684;&#x7B2C;&#x4E00;&#x4E2A;segment&#x8D4B;&#x503C;&#x4E3A;s0</span></span><br><span class="line">  UNSAFE.putOrderedObject(ss, SBASE, s0); <span class="comment">// ordered write of segments[0]</span></span><br><span class="line">  <span class="comment">// &#x8D4B;&#x503C;&#x5230;&#x5BF9;&#x8C61;&#x4E2D;</span></span><br><span class="line">  <span class="keyword">this</span>.segments = ss;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5047;&#x8BBE;&#x4F20;&#x5165;&#x7684; <code>concurrencyLevel = 15</code></p>
<ol>
<li>&#x8BA1;&#x7B97;&#x5916;&#x5C42;&#x6570;&#x7EC4;<code>segments</code>&#x7684;&#x957F;&#x5EA6;:<code>ssize</code><ol>
<li><code>while (ssize &lt; concurrencyLevel)</code> :&#x8BA1;&#x7B97;&#x6BCF;&#x4E2A;segment&#x4E2D;table&#x7684;&#x5BB9;&#x91CF;, &#x56E0;&#x4E3A;&#x9664;&#x4E4B;&#x540E;&#x662F;&#x7701;&#x7565;&#x5C0F;&#x6570;&#x70B9;&#x7684;,&#x6240;&#x4EE5;&#x518D;&#x52A0;1&#x5C31;&#x597D;&#x4E86;.&#x5728;&#x8FDB;&#x884C;&#x5FAA;&#x73AF;&#x540E;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x662F; <code>sshift = 4</code> ,<code>ssize=2^4</code></li>
</ol>
</li>
<li>&#x8BA1;&#x7B97;&#x5185;&#x5C42;&#x6570;&#x7EC4;<code>table</code>&#x7684;&#x957F;&#x5EA6;:<code>cap</code><ol>
<li><code>c = initialCapacity / ssize</code> &#x521D;&#x59CB;&#x5316;&#x6570;&#x7EC4;&#x603B;&#x957F;&#x5EA6;&#x9664;&#x4EE5;&#x5916;&#x4FA7;&#x6570;&#x7EC4;&#x957F;&#x5EA6;=&#x5185;&#x4FA7;&#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;</li>
<li>&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x5185;&#x4FA7;&#x6570;&#x7EC4;&#x957F;&#x5EA6;*&#x5916;&#x4FA7;&#x6570;&#x7EC4;&#x957F;&#x5EA6;&gt;=&#x4F20;&#x5165;&#x7684;&#x6570;&#x7EC4;&#x603B;&#x957F;&#x5EA6;, &#x6240;&#x4EE5;&#x5982;&#x679C;&#x5C0F;&#x4E86;&#x5C31;&#x81EA;&#x52A0;&#x4E00;&#x6B21;</li>
<li><code>while (cap &lt; c)</code> &#x4FDD;&#x8BC1;&#x5185;&#x4FA7;&#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;&#x4E3A;2^n, &#x5E76;&#x4E14;&#x6700;&#x5C0F;&#x4E3A;2</li>
</ol>
</li>
<li>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x521D;&#x59CB;&#x5316;&#x7B2C;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;<code>s0</code>?<ol>
<li>&#x521B;&#x5EFA;&#x5185;&#x4FA7;&#x6570;&#x7EC4;&#x7684;&#x521D;&#x59CB;&#x5316;&#x53C2;&#x6570;&#x90FD;&#x662F;&#x76F8;&#x540C;&#x7684;, &#x521D;&#x59CB;&#x5316;&#x7B2C;&#x4E00;&#x4E2A;&#x540E;, &#x4EE5;&#x540E;&#x6BCF;&#x6B21;&#x521B;&#x5EFA;&#x53EA;&#x9700;&#x8981;&#x76F4;&#x63A5;&#x4ECE;&#x7B2C;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x53D6;&#x503C;&#x5C31;&#x597D;&#x4E86;</li>
</ol>
</li>
</ol>
<h1 id="put">5. put</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>{</span><br><span class="line">  Segment&lt;K,V&gt; s;</span><br><span class="line">  <span class="comment">// key&#x4E0D;&#x53EF;&#x4E3A;null</span></span><br><span class="line">  <span class="keyword">if</span> (value == <span class="keyword">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">  <span class="comment">// &#x6C42;hash</span></span><br><span class="line">  <span class="keyword">int</span> hash = hash(key);</span><br><span class="line">  <span class="keyword">int</span> j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask;</span><br><span class="line">  <span class="comment">// UNSAFE.getObject(segments, (j &lt;&lt; SSHIFT) + SBASE): &#x4F9D;&#x636E;hash&#x83B7;&#x53D6;&#x5230;&#x5BF9;&#x5E94;&#x5206;&#x6BB5;</span></span><br><span class="line">  <span class="keyword">if</span> ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject          <span class="comment">// nonvolatile; recheck</span></span><br><span class="line">       (segments, (j &lt;&lt; SSHIFT) + SBASE)) == <span class="keyword">null</span>) <span class="comment">//  in ensureSegment</span></span><br><span class="line">    <span class="comment">// &#x5982;&#x679C;&#x5206;&#x6BB5;&#x4E3A;null&#x5219;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;</span></span><br><span class="line">    s = ensureSegment(j);</span><br><span class="line">  <span class="keyword">return</span> s.put(key, hash, value, <span class="keyword">false</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="ensureSegment">5.1. ensureSegment</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">&quot;unchecked&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> Segment&lt;K,V&gt; <span class="title">ensureSegment</span><span class="params">(<span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">  <span class="keyword">final</span> Segment&lt;K,V&gt;[] ss = <span class="keyword">this</span>.segments;</span><br><span class="line">  <span class="comment">// &#x83B7;&#x53D6;&#x504F;&#x79FB;&#x91CF;</span></span><br><span class="line">  <span class="keyword">long</span> u = (k &lt;&lt; SSHIFT) + SBASE; <span class="comment">// raw offset</span></span><br><span class="line">  Segment&lt;K,V&gt; seg;</span><br><span class="line">  <span class="comment">// &#x9A8C;&#x8BC1;&#x5F53;&#x524D;segment&#x662F;&#x5426;&#x4E3A;null</span></span><br><span class="line">  <span class="keyword">if</span> ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == <span class="keyword">null</span>) {</span><br><span class="line">    Segment&lt;K,V&gt; proto = ss[<span class="number">0</span>]; <span class="comment">// use segment 0 as prototype</span></span><br><span class="line">    <span class="comment">// &#x83B7;&#x53D6;&#x6570;&#x7EC4;&#x7B2C;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;&#x7684;&#x5185;&#x90E8;&#x6570;&#x7EC4;&#x957F;&#x5EA6;&#x53CA;&#x6269;&#x5BB9;&#x5927;&#x5C0F;&#x7B49;</span></span><br><span class="line">    <span class="keyword">int</span> cap = proto.table.length;</span><br><span class="line">    <span class="keyword">float</span> lf = proto.loadFactor;</span><br><span class="line">    <span class="keyword">int</span> threshold = (<span class="keyword">int</span>)(cap * lf);</span><br><span class="line">    <span class="comment">// &#x521B;&#x5EFA;&#x5185;&#x90E8;&#x6570;&#x7EC4;</span></span><br><span class="line">    HashEntry&lt;K,V&gt;[] tab = (HashEntry&lt;K,V&gt;[])<span class="keyword">new</span> HashEntry[cap];</span><br><span class="line">    <span class="comment">// &#x9A8C;&#x8BC1;&#x5F53;&#x524D;segment&#x662F;&#x5426;&#x4E3A;null</span></span><br><span class="line">    <span class="keyword">if</span> ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u))</span><br><span class="line">        == <span class="keyword">null</span>) { <span class="comment">// recheck</span></span><br><span class="line">      <span class="comment">// &#x521B;&#x5EFA;&#x6570;&#x7EC4;&#x8282;&#x70B9;&#x5BF9;&#x8C61;</span></span><br><span class="line">      Segment&lt;K,V&gt; s = <span class="keyword">new</span> Segment&lt;K,V&gt;(lf, threshold, tab);</span><br><span class="line">      <span class="comment">// &#x9A8C;&#x8BC1;&#x5F53;&#x524D;segment&#x662F;&#x5426;&#x4E3A;null</span></span><br><span class="line">      <span class="keyword">while</span> ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u))</span><br><span class="line">             == <span class="keyword">null</span>) {</span><br><span class="line">       	<span class="comment">// cas&#x8D4B;&#x503C;</span></span><br><span class="line">        <span class="keyword">if</span> (UNSAFE.compareAndSwapObject(ss, u, <span class="keyword">null</span>, seg = s))</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> seg;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="Segment-put">5.2. Segment.put</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">put</span><span class="params">(K key, <span class="keyword">int</span> hash, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span> </span>{</span><br><span class="line">  <span class="comment">// &#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x9501;, &#x83B7;&#x53D6;&#x5230; node=null, &#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x5219;&#x8C03;&#x7528;scanAndLockForPut&#x65B9;&#x6CD5;</span></span><br><span class="line">  HashEntry&lt;K,V&gt; node = tryLock() ? <span class="keyword">null</span> : scanAndLockForPut(key, hash, value);</span><br><span class="line">  <span class="comment">// &#x6CE8;&#x610F;: &#x4E0B;&#x65B9;&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x7684;&#x524D;&#x63D0;&#x662F;&#x83B7;&#x53D6;&#x5230;&#x5F53;&#x524D;segment&#x7684;&#x9501;</span></span><br><span class="line">  <span class="comment">// &#x5F53;&#x524D;key&#x5BF9;&#x5E94;&#x7684;&#x503C;</span></span><br><span class="line">  V oldValue;</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// &#x5185;&#x90E8;&#x6570;&#x7EC4;</span></span><br><span class="line">    HashEntry&lt;K,V&gt;[] tab = table;</span><br><span class="line">    <span class="comment">// &#x5B9A;&#x4F4D;&#x5177;&#x4F53;&#x5728;&#x54EA;&#x4E2A;&#x5185;&#x90E8;&#x6570;&#x7EC4;&#x4E2D;</span></span><br><span class="line">    <span class="keyword">int</span> index = (tab.length - <span class="number">1</span>) &amp; hash;</span><br><span class="line">    HashEntry&lt;K,V&gt; first = entryAt(tab, index);</span><br><span class="line">    <span class="comment">// &#x904D;&#x5386;&#x94FE;&#x8868;</span></span><br><span class="line">    <span class="keyword">for</span> (HashEntry&lt;K,V&gt; e = first;;) {</span><br><span class="line">      <span class="comment">// &#x5982;&#x679C;&#x4E0D;&#x662F;&#x94FE;&#x8868;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x7684;next&#x5C31;&#x4F1A;&#x8D70;&#x8FD9;&#x4E2A;</span></span><br><span class="line">      <span class="keyword">if</span> (e != <span class="keyword">null</span>) {</span><br><span class="line">        K k;</span><br><span class="line">        <span class="keyword">if</span> ((k = e.key) == key ||</span><br><span class="line">            (e.hash == hash &amp;&amp; key.equals(k))) {</span><br><span class="line">          <span class="comment">// &#x5982;&#x679C;&#x76F8;&#x540C;&#x5219;&#x76F4;&#x63A5;&#x8D4B;&#x503C;</span></span><br><span class="line">          oldValue = e.value;</span><br><span class="line">          <span class="comment">// &#x4E3A;putIfAbsent&#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;&#x7684;</span></span><br><span class="line">          <span class="keyword">if</span> (!onlyIfAbsent) {</span><br><span class="line">            e.value = value;</span><br><span class="line">            ++modCount;</span><br><span class="line">          }</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        e = e.next;</span><br><span class="line">      }</span><br><span class="line">      <span class="comment">// &#x5982;&#x679C;&#x662F;&#x94FE;&#x8868;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x7684;next&#x4F1A;&#x8D70;&#x8FD9;&#x4E2A;</span></span><br><span class="line">      <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// &#x53EA;&#x6709;&#x8D70;&#x4E86; scanAndLockForPut &#x903B;&#x8F91;&#x624D;&#x4E0D;&#x4E3A;null, &#x76F4;&#x63A5;&#x8D4B;&#x503C;</span></span><br><span class="line">        <span class="keyword">if</span> (node != <span class="keyword">null</span>)</span><br><span class="line">          <span class="comment">// &#x5934;&#x63D2;&#x6CD5;</span></span><br><span class="line">          node.setNext(first);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="comment">// &#x65B0;&#x5EFA;HashEntry&#x5BF9;&#x8C61;, &#x5934;&#x63D2;&#x6CD5;</span></span><br><span class="line">          node = <span class="keyword">new</span> HashEntry&lt;K,V&gt;(hash, key, value, first);</span><br><span class="line">        <span class="comment">// &#x6CE8;&#x610F;&#x4E0A;&#x65B9;&#x7684;&#x63D2;&#x5165;&#x64CD;&#x4F5C;&#x5E76;&#x6CA1;&#x6709;&#x8D4B;&#x503C;&#x5230;table[i]&#x4E0A;</span></span><br><span class="line">        <span class="comment">// segment&#x5185;n&#x4E2A;&#x94FE;&#x8868;&#x7684;&#x957F;&#x5EA6;+1</span></span><br><span class="line">        <span class="keyword">int</span> c = count + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// &#x5982;&#x679C;c&#x8FBE;&#x5230;&#x6269;&#x5BB9;&#x6807;&#x51C6;&#x5219;&#x8FDB;&#x884C;&#x6269;&#x5BB9;</span></span><br><span class="line">        <span class="keyword">if</span> (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY)</span><br><span class="line">          rehash(node);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="comment">// &#x8D4B;&#x503C;&#x5230;table[i]</span></span><br><span class="line">          setEntryAt(tab, index, node);</span><br><span class="line">        ++modCount;</span><br><span class="line">        count = c;</span><br><span class="line">        oldValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  } <span class="keyword">finally</span> {</span><br><span class="line">    unlock();</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> oldValue;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="scanAndLockForPut">5.2.1. scanAndLockForPut</h3><blockquote>
<p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x9501;, &#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x63D0;&#x524D;&#x628A;hashenty&#x51C6;&#x5907;&#x597D;,&#x5C3D;&#x7BA1;&#x6709;&#x53EF;&#x80FD;&#x4E0D;&#x4F1A;&#x7528;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> HashEntry&lt;K,V&gt; <span class="title">scanAndLockForPut</span><span class="params">(K key, <span class="keyword">int</span> hash, V value)</span> </span>{</span><br><span class="line">  <span class="comment">// &#x4F9D;&#x636E;hash&#x83B7;&#x53D6;&#x9700;&#x8981;&#x63D2;&#x5165;&#x7684;&#x94FE;&#x8868;</span></span><br><span class="line">  HashEntry&lt;K,V&gt; first = entryForHash(<span class="keyword">this</span>, hash);</span><br><span class="line">  HashEntry&lt;K,V&gt; e = first;</span><br><span class="line">  HashEntry&lt;K,V&gt; node = <span class="keyword">null</span>;</span><br><span class="line">  <span class="comment">// &#x7528;&#x4E8E;&#x63A7;&#x5236;&#x6D41;&#x7A0B;&#x7684;&#x4E34;&#x65F6;&#x53D8;&#x91CF;</span></span><br><span class="line">  <span class="keyword">int</span> retries = -<span class="number">1</span>; <span class="comment">// negative while locating node</span></span><br><span class="line">  <span class="comment">// &#x4E0D;&#x65AD;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x9501;</span></span><br><span class="line">  <span class="keyword">while</span> (!tryLock()) {</span><br><span class="line">    <span class="comment">// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x9501;, &#x5219;&#x8D70;&#x4E0B;&#x9762;&#x7684;&#x6D41;&#x7A0B;</span></span><br><span class="line">    HashEntry&lt;K,V&gt; f; <span class="comment">// to recheck first below</span></span><br><span class="line">    <span class="comment">// &#x7B2C;&#x4E00;&#x6B21;&#x8FDB;&#x6765;&#x4F1A;&#x8D70;&#x8FD9;&#x4E2A;,&#x8FD8;&#x6709;&#x4E0B;&#x65B9;&#x76F4;&#x63A5;&#x8D4B;&#x503C;&#x540E;</span></span><br><span class="line">    <span class="keyword">if</span> (retries &lt; <span class="number">0</span>) {</span><br><span class="line">      <span class="keyword">if</span> (e == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) <span class="comment">// speculatively create node</span></span><br><span class="line">          <span class="comment">// &#x5982;&#x679C;&#x90FD;&#x4E3A;&#x7A7A;&#x90A3;&#x4E2A;, &#x5219;&#x521B;&#x5EFA;HashEntry</span></span><br><span class="line">          node = <span class="keyword">new</span> HashEntry&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">        retries = <span class="number">0</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (key.equals(e.key))</span><br><span class="line">        retries = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        e = e.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x5982;&#x679C;&#x5FAA;&#x73AF;&#x6B21;&#x6570;&#x8FC7;&#x591A;, &#x76F4;&#x63A5;&#x4E0A;&#x9501;, &#x76F4;&#x5230;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x6253;&#x65AD;&#x5FAA;&#x73AF;</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (++retries &gt; MAX_SCAN_RETRIES) {</span><br><span class="line">      lock();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x5982;&#x679C;&#x521B;&#x5EFA;node&#x540E;, retries = 0, &#x8FD9;&#x65F6;&#x53D1;&#x73B0;&#x5F53;&#x524D;&#x94FE;&#x8868;&#x5DF2;&#x7ECF;&#x88AB;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;, &#x5219;&#x56DE;&#x6EDA;retries&#x4E3A;&#x51FA;&#x4E8B;&#x72B6;&#x6001;, &#x56DE;&#x6EDA;e</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((retries &amp; <span class="number">1</span>) == <span class="number">0</span> &amp;&amp;</span><br><span class="line">             (f = entryForHash(<span class="keyword">this</span>, hash)) != first) {</span><br><span class="line">      e = first = f; <span class="comment">// re-traverse if entry changed</span></span><br><span class="line">      retries = -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> node;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="rehash">5.2.2. rehash</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rehash</span><span class="params">(HashEntry&lt;K,V&gt; node)</span> </span>{</span><br><span class="line">  <span class="comment">// &#x65E7;&#x7684;&#x94FE;&#x8868;&#x6570;&#x7EC4;</span></span><br><span class="line">  HashEntry&lt;K,V&gt;[] oldTable = table;</span><br><span class="line">  <span class="comment">// &#x65E7;&#x7684;&#x94FE;&#x8868;&#x6570;&#x7EC4;&#x957F;&#x5EA6;</span></span><br><span class="line">  <span class="keyword">int</span> oldCapacity = oldTable.length;</span><br><span class="line">  <span class="comment">// &#x6269;&#x5BB9;&#x4E3A;2&#x500D;</span></span><br><span class="line">  <span class="keyword">int</span> newCapacity = oldCapacity &lt;&lt; <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// &#x65B0;&#x7684;&#x6269;&#x5BB9;&#x9608;&#x503C;</span></span><br><span class="line">  threshold = (<span class="keyword">int</span>)(newCapacity * loadFactor);</span><br><span class="line">  <span class="comment">// &#x521B;&#x5EFA;&#x65B0;&#x7684;&#x94FE;&#x8868;&#x6570;&#x7EC4;</span></span><br><span class="line">  HashEntry&lt;K,V&gt;[] newTable =</span><br><span class="line">    (HashEntry&lt;K,V&gt;[]) <span class="keyword">new</span> HashEntry[newCapacity];</span><br><span class="line">  <span class="keyword">int</span> sizeMask = newCapacity - <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// &#x5FAA;&#x73AF;&#x904D;&#x5386;&#x8001;&#x7684;&#x94FE;&#x8868;&#x6570;&#x7EC4;</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; oldCapacity ; i++) {</span><br><span class="line">    <span class="comment">// &#x83B7;&#x53D6;&#x94FE;&#x8868;</span></span><br><span class="line">    HashEntry&lt;K,V&gt; e = oldTable[i];</span><br><span class="line">    <span class="keyword">if</span> (e != <span class="keyword">null</span>) {</span><br><span class="line">      HashEntry&lt;K,V&gt; next = e.next;</span><br><span class="line">      <span class="keyword">int</span> idx = e.hash &amp; sizeMask;</span><br><span class="line">      <span class="keyword">if</span> (next == <span class="keyword">null</span>)   <span class="comment">//  Single node on list</span></span><br><span class="line">        <span class="comment">// &#x5982;&#x679C;&#x94FE;&#x8868;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5143;&#x7D20;, &#x5219;&#x76F4;&#x63A5;&#x8D4B;&#x503C;</span></span><br><span class="line">        newTable[idx] = e;</span><br><span class="line">      <span class="keyword">else</span> { <span class="comment">// Reuse consecutive sequence at same slot</span></span><br><span class="line">        HashEntry&lt;K,V&gt; lastRun = e;</span><br><span class="line">        <span class="keyword">int</span> lastIdx = idx;</span><br><span class="line">        <span class="comment">// lastRun&#x540E;&#x9762;&#x7684;&#x6240;&#x6709;node&#x7684; idx &#x4E0E; lastRun&#x7684; idx &#x4E00;&#x81F4;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;lastRun&#x53CA;&#x5176;&#x540E;&#x9762;&#x7684;&#x6240;&#x6709;node&#x770B;&#x4F5C;&#x4E00;&#x4E2A;&#x6574;&#x4F53;</span></span><br><span class="line">        <span class="keyword">for</span> (HashEntry&lt;K,V&gt; last = next;</span><br><span class="line">             last != <span class="keyword">null</span>;</span><br><span class="line">             last = last.next) {</span><br><span class="line">          <span class="keyword">int</span> k = last.hash &amp; sizeMask;</span><br><span class="line">          <span class="keyword">if</span> (k != lastIdx) {</span><br><span class="line">            lastIdx = k;</span><br><span class="line">            lastRun = last;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        newTable[lastIdx] = lastRun;</span><br><span class="line">        <span class="comment">// &#x5904;&#x7406;lastRun&#x4E4B;&#x524D;&#x7684;&#x6570;&#x636E;</span></span><br><span class="line">        <span class="keyword">for</span> (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) {</span><br><span class="line">          V v = p.value;</span><br><span class="line">          <span class="keyword">int</span> h = p.hash;</span><br><span class="line">          <span class="keyword">int</span> k = h &amp; sizeMask;</span><br><span class="line">          HashEntry&lt;K,V&gt; n = newTable[k];</span><br><span class="line">          newTable[k] = <span class="keyword">new</span> HashEntry&lt;K,V&gt;(h, p.key, v, n);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">int</span> nodeIndex = node.hash &amp; sizeMask; <span class="comment">// add the new node</span></span><br><span class="line">  node.setNext(newTable[nodeIndex]);</span><br><span class="line">  newTable[nodeIndex] = node;</span><br><span class="line">  table = newTable;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E3A;&#x4EC0;&#x4E48;&#x94FE;&#x8868;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x65F6;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8D4B;&#x503C;&#x5462;?&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5F15;&#x5165;&#x4E00;&#x4E2A;lastRun&#x673A;&#x5236;&#x5462;?&#x6211;&#x4EEC;&#x5047;&#x8BBE;&#x6570;&#x7EC4;&#x6269;&#x5BB9;&#x524D;&#x4E3A;&#x6700;&#x5C0F;&#x503C;2</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> sizeMask = newCapacity - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> idx = e.hash &amp; sizeMask;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>newCapacity</th>
<th>sizeMask</th>
<th>sizeMask&#x7684;&#x4E8C;&#x8FDB;&#x5236;</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>1</td>
<td>0000 0000 0000 0000 0000 0000 0000 0001</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>0000 0000 0000 0000 0000 0000 0000 0011</td>
</tr>
<tr>
<td>8</td>
<td>7</td>
<td>0000 0000 0000 0000 0000 0000 0000 0111</td>
</tr>
<tr>
<td>16</td>
<td>15</td>
<td>0000 0000 0000 0000 0000 0000 0000 1111</td>
</tr>
<tr>
<td>32</td>
<td>31</td>
<td>0000 0000 0000 0000 0000 0000 0001 1111</td>
</tr>
</tbody></table>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;, &#x6BCF;&#x6B21;&#x6269;&#x5BB9;&#x540E;, hash&#x8FDB;&#x884C;&#x8FD0;&#x7B97;&#x65F6;, &#x53EA;&#x5411;&#x505A;&#x79FB;&#x52A8;&#x4E86;&#x4E00;&#x4F4D;,&#x7531;&#x4E8E;<code>e.hash</code>&#x4E0D;&#x53D8;,&#x90A3;&#x4E48;<code>e.hash &amp; sizeMask</code>&#x7684;&#x7ED3;&#x679C;&#x53EA;&#x6539;&#x53D8;&#x4E86;&#x6700;&#x5DE6;&#x4FA7;&#x7684;&#x4E00;&#x4F4D;,&#x6240;&#x4EE5;&#x4E4B;&#x524D;&#x8282;&#x70B9;&#x7684;&#x6570;&#x636E;&#x53EA;&#x4F1A;&#x5B58;&#x5728;&#x5728;&#x4E24;&#x4E2A;&#x4F4D;&#x7F6E;&#x4E2D;</p>
<h1 id="get">6. get</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>{</span><br><span class="line">  Segment&lt;K,V&gt; s; <span class="comment">// manually integrate access methods to reduce overhead</span></span><br><span class="line">  HashEntry&lt;K,V&gt;[] tab;</span><br><span class="line">  <span class="comment">// &#x83B7;&#x53D6;hash&#x503C;</span></span><br><span class="line">  <span class="keyword">int</span> h = hash(key);</span><br><span class="line">  <span class="comment">// &#x83B7;&#x53D6;&#x504F;&#x79FB;&#x91CF;</span></span><br><span class="line">  <span class="keyword">long</span> u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE;</span><br><span class="line">  <span class="comment">// &#x5982;&#x679C;segments[i] != null &amp;&amp; segment[i].table!= null</span></span><br><span class="line">  <span class="keyword">if</span> ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">      (tab = s.table) != <span class="keyword">null</span>) {</span><br><span class="line">    <span class="comment">// &#x4F9D;&#x636E;hash&#x4ECE;table&#x4E2D;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x94FE;&#x8868;&#x904D;&#x5386;</span></span><br><span class="line">    <span class="keyword">for</span> (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile</span><br><span class="line">         (tab, ((<span class="keyword">long</span>)(((tab.length - <span class="number">1</span>) &amp; h)) &lt;&lt; TSHIFT) + TBASE);</span><br><span class="line">         e != <span class="keyword">null</span>; e = e.next) {</span><br><span class="line">      K k;</span><br><span class="line">      <span class="comment">// &#x5982;&#x679C;key&#x76F8;&#x540C;&#x5219;&#x8FD4;&#x56DE;</span></span><br><span class="line">      <span class="keyword">if</span> ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k)))</span><br><span class="line">        <span class="keyword">return</span> e.value;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="&#x603B;&#x7ED3;">7. &#x603B;&#x7ED3;</h1><ol>
<li><code>&#x76F8;&#x5BF9;&#x4E8E;</code>HashMap1.7<code>&#x4F7F;&#x7528;&#x4E86;&#x5206;&#x6BB5;&#x9501;&#x7684;&#x65B9;&#x6CD5;, &#x901A;&#x8FC7;&#x9501;&#x5B9A;</code>segment[i]`&#x6765;&#x63D0;&#x9AD8;&#x6548;&#x7387;</li>
<li>&#x5728;&#x5206;&#x6BB5;&#x5185;&#x589E;&#x52A0;&#x4E86;&#x5185;&#x90E8;&#x5206;&#x6BB5;</li>
<li>&#x6269;&#x5BB9;&#x4E0D;&#x518D;&#x6269;&#x5BB9;&#x5916;&#x90E8;&#x7684;<code>segments</code>,&#x800C;&#x662F;&#x6269;&#x5BB9;&#x5185;&#x90E8;&#x7684;&#x94FE;&#x8868;&#x6570;&#x7EC4;</li>
<li>&#x4E0D;&#x652F;&#x6301;<code>key = null</code></li>
<li>&#x521D;&#x59CB;&#x5316;&#x65F6;&#x540C;&#x65F6;&#x521D;&#x59CB;&#x5316;&#x4E86;<code>segmens[0]</code>,&#x4E3A;&#x5176;&#x4ED6;<code>segments[n]</code>&#x7684;&#x521D;&#x59CB;&#x5316;&#x63D0;&#x9AD8;&#x4E86;&#x6548;&#x7387;</li>
</ol>
]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>jdk</tag>
      </tags>
  </entry>
  <entry>
    <title>jdk1.7-HashMap</title>
    <url>/2020/jdk1-7-hash-map/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p><a href="https://www.oracle.com/java/technologies/javase/javase7-archive-downloads.html#jdk-7u80-oth-JPR" target="_blank" rel="noopener">jdk1.7&#x4E0B;&#x8F7D;&#x94FE;&#x63A5;</a></p>
<p><a href="https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html" target="_blank" rel="noopener">jdk1.8&#x4E0B;&#x8F7D;&#x94FE;&#x63A5;</a></p>
<p>&#x4EE5;&#x4E0A;&#x4E3A;&#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x94FE;&#x63A5;, &#x6CA1;&#x6709;&#x8D26;&#x53F7;&#x7684;&#x540C;&#x5B66;&#x5EFA;&#x8BAE;&#x641C;&#x7D22;oracle&#x8D26;&#x53F7;&#x5171;&#x4EAB;,&#x4F7F;&#x7528;&#x5171;&#x4EAB;&#x8D26;&#x53F7;&#x4E0B;&#x8F7D;.</p>
<p>&#x4EE5;mac&#x4E3A;&#x4F8B;,&#x4E24;&#x4E2A;&#x7248;&#x672C;&#x4E0B;&#x8F7D;&#x5B8C;&#x6210;&#x540E;&#x7EED;&#x6DFB;&#x52A0;&#x81F3;idea</p>
<p>&#x6DFB;&#x52A0;:  file-&gt;project structure-&gt;platorm setting-&gt;sdks-&gt;&#x70B9;&#x51FB;&#x52A0;&#x53F7;</p>
<p>&#x9009;&#x62E9;&#x9879;&#x76EE;&#x4F7F;&#x7528;&#x7684;jdk: file-&gt;project structure-&gt;project setting-&gt;project-&gt;project sdk-&gt;&#x9009;&#x62E9;&#x9700;&#x8981;&#x7684;&#x7248;&#x672C;</p>
</blockquote>
<a id="more"></a>

<h1 id="Entry">2. Entry</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>{</span><br><span class="line">  <span class="keyword">final</span> K key;</span><br><span class="line">  V value;</span><br><span class="line">  Entry&lt;K,V&gt; next;</span><br><span class="line">  <span class="keyword">int</span> hash;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8282;&#x70B9;, &#x5C06;&#x4F20;&#x5165;&#x7684;&#x63A5;&#x70B9;&#x6302;&#x5728;&#x5230;&#x65B0;&#x7684;&#x8282;&#x70B9;&#x4E0B;</span></span><br><span class="line">  Entry(<span class="keyword">int</span> h, K k, V v, Entry&lt;K,V&gt; n) {</span><br><span class="line">    value = v;</span><br><span class="line">    next = n;</span><br><span class="line">    key = k;</span><br><span class="line">    hash = h;</span><br><span class="line">  } </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="newHashMap">3. newHashMap()</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x9ED8;&#x8BA4;&#x7684;&#x521D;&#x59CB;&#x5BB9;&#x91CF;-&#x5FC5;&#x987B;&#x662F;2&#x7684;&#x5E42;&#x3002;</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x9ED8;&#x8BA4;&#x8D1F;&#x8F7D;&#x56E0;&#x5B50;</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x4E00;&#x822C;&#x4E3A; capacity*loadFactory,&#x5982;&#x679C;&#x6570;&#x7EC4;&#x5BB9;&#x91CF;&#x5927;&#x4E8E;threshold&#x5C31;&#x4F1A;&#x6269;&#x5BB9;</span></span><br><span class="line"><span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="keyword">this</span>(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal initial capacity: &quot;</span> +</span><br><span class="line">                                       initialCapacity);</span><br><span class="line">  <span class="comment">// &#x521D;&#x59CB;&#x5BB9;&#x91CF;&#x5927;&#x4E8E;&#x6700;&#x5927;&#x503C;,&#x5219;&#x8BBE;&#x7F6E;&#x4E3A;&#x6700;&#x5927;&#x503C;</span></span><br><span class="line">  <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">    initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">  <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal load factor: &quot;</span> +</span><br><span class="line">                                       loadFactor);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.loadFactor = loadFactor;</span><br><span class="line">  threshold = initialCapacity;</span><br><span class="line">  <span class="comment">// &#x7A7A;&#x7684;, linkedHashMap&#x624D;&#x6709;</span></span><br><span class="line">  init();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="put-K-key-V-value">4. put(K key, V value)</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x653E;&#x7F6E;&#x5143;&#x7D20;&#x7684;&#x6570;&#x7EC4;, &#x5927;&#x5C0F;&#x4E3A;2&#x7684;n&#x6B21;&#x5E42;</span></span><br><span class="line"><span class="keyword">transient</span> Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>{</span><br><span class="line">  <span class="comment">// &#x5982;&#x679C;&#x6570;&#x7EC4;&#x4E3A;&#x7A7A;, &#x90A3;&#x4E48;&#x8FDB;&#x884C;&#x81A8;&#x80C0;</span></span><br><span class="line">  <span class="keyword">if</span> (table == EMPTY_TABLE) {</span><br><span class="line">    <span class="comment">// &#x6B64;&#x65F6; threshold = initialCapacity = 1 &lt;&lt; 4 = 16</span></span><br><span class="line">    inflateTable(threshold);</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// &#x5982;&#x679C;key&#x4E3A;null, &#x8D70;&#x4E00;&#x6BB5;&#x7279;&#x6B8A;&#x903B;&#x8F91;, &#x5C06;&#x5B83;&#x6302;&#x5230;&#x6570;&#x7EC4;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x4E0B;&#x6807;&#x4F4D;&#x7F6E;</span></span><br><span class="line">  <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">    <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">  <span class="comment">// &#x83B7;&#x53D6;hash&#x503C;, &#x8FD9;&#x4E2A;hash&#x503C;&#x548C;hash&#x56E0;&#x5B50;&#x6709;&#x5173;</span></span><br><span class="line">  <span class="keyword">int</span> hash = hash(key);</span><br><span class="line">  <span class="comment">// &#x83B7;&#x53D6;&#x6570;&#x7EC4;&#x4E0B;&#x6807;&#x4F4D;&#x7F6E;</span></span><br><span class="line">  <span class="keyword">int</span> i = indexFor(hash, table.length);</span><br><span class="line">  <span class="comment">// &#x904D;&#x5386;&#x6570;&#x7EC4;&#x67E5;&#x770B;&#x91CC;&#x9762;&#x6709;&#x6CA1;&#x6709;&#x76F8;&#x540C;&#x7684;key, &#x5982;&#x679C;&#x6709;&#x5219;&#x8986;&#x76D6;,&#x5E76;&#x8FD4;&#x56DE;&#x8001;&#x7684;value</span></span><br><span class="line">  <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="keyword">null</span>; e = e.next) {</span><br><span class="line">    Object k;</span><br><span class="line">    <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) {</span><br><span class="line">      V oldValue = e.value;</span><br><span class="line">      e.value = value;</span><br><span class="line">      e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">      <span class="keyword">return</span> oldValue;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">	<span class="comment">// &#x5FEB;&#x901F;&#x5931;&#x8D25;&#x673A;&#x5236;</span></span><br><span class="line">  modCount++;</span><br><span class="line">  <span class="comment">// &#x6DFB;&#x52A0;&#x5165;&#x94FE;&#x8868;</span></span><br><span class="line">  addEntry(hash, key, value, i);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="inflateTable-int-toSize">4.1. inflateTable(int toSize)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x6269;&#x5BB9;&#x6570;&#x7EC4;, &#x4EC5;&#x4EC5;&#x662F;&#x6269;&#x5BB9;&#x6570;&#x7EC4;,&#x5E76;&#x6CA1;&#x6709;&#x8F6C;&#x79FB;&#x5143;&#x7D20;</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inflateTable</span><span class="params">(<span class="keyword">int</span> toSize)</span> </span>{</span><br><span class="line">  <span class="comment">// &#x83B7;&#x53D6;&#x5927;&#x4E8E;&#x7B49;&#x4E8E; toSize &#x7684;&#x6700;&#x5C0F;2&#x7684;n&#x6B21;&#x5E42;</span></span><br><span class="line">  <span class="keyword">int</span> capacity = roundUpToPowerOf2(toSize);</span><br><span class="line">	<span class="comment">// &#x786E;&#x5B9A;&#x4E0B;&#x6B21;&#x6269;&#x5BB9;&#x65F6;&#x6570;&#x7EC4;&#x7684;&#x5927;&#x5C0F;</span></span><br><span class="line">  threshold = (<span class="keyword">int</span>) Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + <span class="number">1</span>);</span><br><span class="line">  <span class="comment">// &#x521D;&#x59CB;&#x5316;&#x6570;&#x7EC4;&#x957F;&#x5EA6;</span></span><br><span class="line">  table = <span class="keyword">new</span> Entry[capacity];</span><br><span class="line">  <span class="comment">// &#x521D;&#x59CB;&#x5316;&#x54C8;&#x5E0C;&#x63A9;&#x7801;&#x503C;</span></span><br><span class="line">  initHashSeedAsNeeded(capacity);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="roundUpToPowerOf">4.1.1. roundUpToPowerOf</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x83B7;&#x53D6;&#x5927;&#x4E8E;&#x7B49;&#x4E8E; toSize &#x7684;&#x6700;&#x5C0F;2&#x7684;n&#x6B21;&#x5E42;</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">roundUpToPowerOf2</span><span class="params">(<span class="keyword">int</span> number)</span> </span>{</span><br><span class="line">  <span class="comment">// assert number &gt;= 0 : &quot;number must be non-negative&quot;;</span></span><br><span class="line">  <span class="comment">// Integer.highestOneBit(i) &#x83B7;&#x53D6;&#x6700;&#x5927;&#x7684;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;i&#x7684; 2&#x7684;n&#x6B21;&#x5E42;</span></span><br><span class="line">  <span class="keyword">return</span> number &gt;= MAXIMUM_CAPACITY</span><br><span class="line">    ? MAXIMUM_CAPACITY</span><br><span class="line">    : (number &gt; <span class="number">1</span>) ? Integer.highestOneBit((number - <span class="number">1</span>) &lt;&lt; <span class="number">1</span>) : <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x5982;&#x679C;<code>number &gt;= &#x6570;&#x7EC4;&#x6700;&#x5927;&#x5BB9;&#x91CF;</code>: &#x8FD4;&#x56DE;<code>&#x6570;&#x7EC4;&#x6700;&#x5927;&#x5BB9;&#x91CF;</code></li>
<li>&#x5982;&#x679C;<code>number &lt;= 1</code>:&#x8FD4;&#x56DE;<code>1</code></li>
<li><code>num - 1 &#x540E;&#x5DE6;&#x79FB;1&#x4F4D;</code> &#x4EE5;&#x8FD9;&#x4E2A;&#x6570;&#x4E3A;&#x53C2;&#x6570;&#x53D6;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x5B83;&#x7684; 2^n</li>
</ol>
<p>&#x8FD9;&#x91CC;&#x7684;&#x903B;&#x8F91;&#x6709;&#x70B9;&#x795E;&#x5947;, &#x628A;<code>number</code>&#x7B80;&#x5355;&#x7684;&#x8FD0;&#x7B97;&#x540E;,&#x8C03;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x8FD4;&#x56DE;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;n&#x7684;2^n&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x8FBE;&#x5230;&#x4E86;&#x76EE;&#x7684;, &#x6211;&#x4EEC;&#x6765;&#x4E00;&#x70B9;&#x4E00;&#x70B9;&#x5206;&#x6790;:</p>
<p>&#x5047;&#x8BBE;: n=16 (2^4)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0000</span> <span class="number">1000</span><span class="comment">//16</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0111</span><span class="comment">//16-1</span></span><br><span class="line"><span class="number">0000</span> <span class="number">1110</span><span class="comment">//&#x5DE6;&#x79FB;&#x4E00;&#x4F4D;</span></span><br><span class="line">&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x8FD9;&#x4E2A;&#x6570;&#x7684;&#x6700;&#x5927;<span class="number">2</span>^n&#x4E3A;</span><br><span class="line"><span class="number">0000</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure>

<p>&#x5047;&#x8BBE;:n=15 (2^4 - 1)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0000</span> <span class="number">0111</span><span class="comment">//15</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0110</span><span class="comment">//15-1</span></span><br><span class="line"><span class="number">0000</span> <span class="number">1100</span><span class="comment">//&#x5DE6;&#x79FB;&#x4E00;&#x4F4D;</span></span><br><span class="line">&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x8FD9;&#x4E2A;&#x6570;&#x7684;&#x6700;&#x5927;<span class="number">2</span>^n&#x4E3A;</span><br><span class="line"><span class="number">0000</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure>

<p>&#x5047;&#x8BBE;:n=9 (2^3 + 1)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0000</span> <span class="number">0101</span><span class="comment">//9</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0100</span><span class="comment">//9-1</span></span><br><span class="line"><span class="number">0000</span> <span class="number">1000</span><span class="comment">//&#x5DE6;&#x79FB;&#x4E00;&#x4F4D;</span></span><br><span class="line">&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x8FD9;&#x4E2A;&#x6570;&#x7684;&#x6700;&#x5927;<span class="number">2</span>^n&#x4E3A;</span><br><span class="line"><span class="number">0000</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure>

<p>&#x4F7F;&#x7528;*&#x6765;&#x4EE3;&#x66FF;</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">0000 </span><span class="number">01</span>**//n</span><br><span class="line"><span class="symbol">0000 </span><span class="number">01</span>**//n-<span class="number">1</span></span><br><span class="line"><span class="symbol">0000 </span><span class="number">1</span>**<span class="number">0</span>//&#x5DE6;&#x79FB;&#x4E00;&#x4F4D;</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x9762;&#x7684;&#x89C4;&#x5F8B;&#x5982;&#x679C;&#x611F;&#x89C9;&#x6BD4;&#x8F83;&#x7A7A;&#x6D1E;,&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x4EE5;&#x6570;&#x5B66;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x8BC1;&#x660E;:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&#x8BBE;&#x6700;&#x521D;&#x4F20;&#x5165;&#x53C2;&#x6570;&#x4E3A;:m, &#x6700;&#x7EC8;&#x83B7;&#x53D6;&#x7684;&#x503C;&#x4E3A;:<span class="number">2</span>^n</span><br><span class="line">  </span><br><span class="line">&#x7531;&#x4E0A;&#x8FF0;&#x6761;&#x4EF6;&#x53EF;&#x77E5;: </span><br><span class="line">  number&#x8303;&#x56F4;&#x4E3A;:</span><br><span class="line">    <span class="number">2</span>^(n-<span class="number">1</span>) &lt; m &lt;= <span class="number">2</span>^n</span><br><span class="line">  &#x6211;&#x4EEC;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x8303;&#x56F4;&#x4E3A;:</span><br><span class="line">    <span class="number">2</span>^n &lt;= f(m) &lt; <span class="number">2</span>^(n+<span class="number">1</span>)</span><br><span class="line">      </span><br><span class="line">&#x89E3;:</span><br><span class="line">&#x56E0;&#x4E3A;</span><br><span class="line">  <span class="number">2</span>^(n-<span class="number">1</span>) &lt; m &lt;= <span class="number">2</span>^n</span><br><span class="line">  &#x4E14;m&#x548C;n&#x90FD;&#x662F;&#x5927;&#x4E8E;<span class="number">1</span>&#x7684;&#x6B63;&#x6574;&#x6570;</span><br><span class="line">&#x6240;&#x4EE5; </span><br><span class="line">	<span class="number">2</span>^(n-<span class="number">1</span>) &lt;= m-<span class="number">1</span> &lt; <span class="number">2</span>^n</span><br><span class="line">&#x5DE6;&#x53F3;&#x516C;&#x5F0F;&#x540C;&#x65F6;&#x4E58;<span class="number">2</span>&#x5F97;</span><br><span class="line">	<span class="number">2</span>^n &lt;= (m-<span class="number">1</span>)*<span class="number">2</span> &lt; <span class="number">2</span>^(n+<span class="number">1</span>)</span><br><span class="line">&#x6240;&#x4EE5;</span><br><span class="line">  f(m) = <span class="number">2</span>(m-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="highestOneBit">4.1.2. highestOneBit</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x8FD4;&#x56DE;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;i&#x7684; 2&#x7684;n&#x6B21;&#x5E42;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">highestOneBit</span><span class="params">(<span class="keyword">int</span> i)</span> </span>{</span><br><span class="line">  <span class="comment">// HD, Figure 3-1</span></span><br><span class="line">  i |= (i &gt;&gt;  <span class="number">1</span>);</span><br><span class="line">  i |= (i &gt;&gt;  <span class="number">2</span>);</span><br><span class="line">  i |= (i &gt;&gt;  <span class="number">4</span>);</span><br><span class="line">  i |= (i &gt;&gt;  <span class="number">8</span>);</span><br><span class="line">  i |= (i &gt;&gt; <span class="number">16</span>);</span><br><span class="line">  <span class="keyword">return</span> i - (i &gt;&gt;&gt; <span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5206;&#x6790;: </p>
<blockquote>
<p>int&#x7C7B;&#x578B;&#x6709;4&#x4E2A;&#x5B57;&#x8282;, &#x6BCF;&#x4E2A;&#x5B57;&#x8282;8&#x4F4D;, &#x5171;&#x8BA1;32&#x4F4D;<strong>&#x4EE5;&#x4E0B;&#x5206;&#x6790;&#x4EC5;&#x4EC5;&#x4EE3;&#x8868;i&#x4E3A;&#x6B63;&#x6570;&#x7684;&#x60C5;&#x51B5;&#x4E0B;</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&#x5047;&#x8BBE;i=<span class="number">1070</span>,</span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0100</span> <span class="number">0010</span> <span class="number">1110</span><span class="comment">// i</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0010</span> <span class="number">0001</span> <span class="number">0111</span><span class="comment">// i &gt;&gt; 1</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0110</span> <span class="number">0011</span> <span class="number">1111</span><span class="comment">// i |= (i &gt;&gt;  1)</span></span><br><span class="line">  </span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0001</span> <span class="number">1000</span> <span class="number">1111</span><span class="comment">// i &gt;&gt; 2</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0111</span> <span class="number">1011</span> <span class="number">1111</span><span class="comment">// i |= (i &gt;&gt;  2)</span></span><br><span class="line">  </span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0111</span> <span class="number">1011</span><span class="comment">// i &gt;&gt;  4</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0111</span> <span class="number">1111</span> <span class="number">1111</span><span class="comment">// i |= (i &gt;&gt;  4)</span></span><br><span class="line">  </span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0111</span><span class="comment">// i &gt;&gt;  8</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0111</span> <span class="number">1111</span> <span class="number">1111</span><span class="comment">// i |= (i &gt;&gt;  8)</span></span><br><span class="line">  </span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span><span class="comment">// i &gt;&gt; 16</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0111</span> <span class="number">1111</span> <span class="number">1111</span><span class="comment">// i |= (i &gt;&gt; 16)</span></span><br><span class="line"></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0011</span> <span class="number">1111</span> <span class="number">1111</span><span class="comment">// i &gt;&gt;&gt; 1</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0100</span> <span class="number">0000</span> <span class="number">0000</span><span class="comment">// i - (i &gt;&gt;&gt; 1)</span></span><br></pre></td></tr></table></figure>

<p>&#x5C06;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x5206;&#x6790;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;, &#x5728;i&#x4E3A;&#x6B63;&#x6570;&#x7684;&#x60C5;&#x51B5;&#x4E0B;, &#x53F3;&#x79FB;&#x6B21;&#x6570;&#x4ECE;2^0&#x5230;2^4,&#x5171;&#x8BA1;&#x53F3;&#x79FB;&#x4E86;32&#x6B21;, &#x6BCF;&#x6B21;&#x90FD;&#x4F7F;&#x7528;&#x4E86;&#x6216;&#x8FD0;&#x7B97;&#x7B26;, &#x6700;&#x540E;&#x5F97;&#x5230;&#x7684;i&#x4E3A;<code>&#x5927;&#x4E8E;i&#x7684;2^(n+1) - 1</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&#x5C06;i&#x7684;&#x503C;&#x518D;&#x6B21;&#x53F3;&#x79FB;&#x540E;&#x5F97;&#x5230;</span><br><span class="line"><span class="number">2</span>^n-<span class="number">1</span></span><br><span class="line">&#x4E24;&#x8005;&#x76F8;&#x51CF;</span><br><span class="line">  (<span class="number">2</span>^(n+<span class="number">1</span>) - <span class="number">1</span>) - (<span class="number">2</span>^n-<span class="number">1</span>)</span><br><span class="line">= <span class="number">2</span>^(n+<span class="number">1</span>) - <span class="number">2</span>^n</span><br><span class="line">= <span class="number">2</span>^n +<span class="number">2</span>^n -<span class="number">2</span>^n</span><br><span class="line">= <span class="number">2</span>^n</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x7EC8;&#x6C42;&#x51FA;&#x7684;&#x503C;&#x6B63;&#x662F;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;i&#x7684;<code>2^n</code></p>
<h2 id="putForNullKey">4.2. putForNullKey</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// key&#x4E3A;null&#x7684;&#x7279;&#x6B8A;&#x903B;&#x8F91;</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> V <span class="title">putForNullKey</span><span class="params">(V value)</span> </span>{</span><br><span class="line">  <span class="comment">// &#x904D;&#x5386;&#x6570;&#x7EC4;&#x7B2C;&#x4E00;&#x4E2A;&#x4E0B;&#x6807;&#x91CC;&#x7684;&#x94FE;&#x8868;, &#x5982;&#x679C;&#x5305;&#x542B;key = null,&#x90A3;&#x4E48;&#x66FF;&#x6362;value,&#x5E76;&#x8FD4;&#x56DE;&#x65E7;&#x7684;value</span></span><br><span class="line">  <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[<span class="number">0</span>]; e != <span class="keyword">null</span>; e = e.next) {</span><br><span class="line">    <span class="keyword">if</span> (e.key == <span class="keyword">null</span>) {</span><br><span class="line">      V oldValue = e.value;</span><br><span class="line">      e.value = value;</span><br><span class="line">      e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">      <span class="keyword">return</span> oldValue;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// &#x4E00;&#x4E2A;&#x5FEB;&#x901F;&#x4E8B;&#x53D8;&#x53C2;&#x6570;</span></span><br><span class="line">  modCount++;</span><br><span class="line">  <span class="comment">// &#x5C06;null&#x503C;&#x6DFB;&#x52A0;&#x5230;&#x94FE;&#x8868;&#x4E2D;, &#x8BE5;&#x65B9;&#x6CD5;&#x7A0D;&#x540E;&#x8BF4;</span></span><br><span class="line">  addEntry(<span class="number">0</span>, <span class="keyword">null</span>, value, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="indexFor">4.3. indexFor</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> h, <span class="keyword">int</span> length)</span> </span>{</span><br><span class="line">  <span class="comment">// assert Integer.bitCount(length) == 1 : &quot;length must be a non-zero power of 2&quot;;</span></span><br><span class="line">  <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>&amp;</code>&#x64CD;&#x4F5C;&#x5FC5;&#x987B;&#x4E24;&#x4E2A;&#x6570;&#x7EC4;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5BF9;&#x5E94;&#x4F4D;&#x7F6E;&#x540C;&#x65F6;&#x4E3A;1&#x624D;&#x4E3A;1,&#x6240;&#x4EE5;&#x8FD4;&#x56DE;&#x503C;&#x5FC5;&#x5B9A;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;length-1</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">1111</span> <span class="number">0100</span> <span class="number">0000</span> <span class="number">0100</span><span class="comment">// a</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0001</span> <span class="number">0101</span><span class="comment">// b</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0100</span><span class="comment">// a&amp;b</span></span><br></pre></td></tr></table></figure>

<h1 id="addEntry">5. addEntry</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x6DFB;&#x52A0;&#x8282;&#x70B9;, &#x8BE5;&#x8282;&#x70B9;&#x4F4D;&#x7F6E;&#x53EF;&#x80FD;&#x4E3A;&#x7A7A;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span> ((size &gt;= threshold) &amp;&amp; (<span class="keyword">null</span> != table[bucketIndex])) {</span><br><span class="line">    <span class="comment">// &#x6570;&#x7EC4;&#x6269;&#x5BB9;&#x5E76;&#x8F6C;&#x79FB;&#x5143;&#x7D20;</span></span><br><span class="line">    resize(<span class="number">2</span> * table.length);</span><br><span class="line">    <span class="comment">// &#x91CD;&#x65B0;&#x83B7;&#x53D6;hash</span></span><br><span class="line">    hash = (<span class="keyword">null</span> != key) ? hash(key) : <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// &#x91CD;&#x65B0;&#x83B7;&#x53D6;&#x4E0B;&#x6807;</span></span><br><span class="line">    bucketIndex = indexFor(hash, table.length);</span><br><span class="line">  }</span><br><span class="line">	<span class="comment">// &#x5C06;&#x6570;&#x636E;&#x63D2;&#x5165;&#x8282;&#x70B9;</span></span><br><span class="line">  createEntry(hash, key, value, bucketIndex);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol>
<li>size &gt;= threshold : &#x8FD9;&#x4E2A;&#x662F;&#x6269;&#x5BB9;&#x6761;&#x4EF6;, &#x6BCF;&#x6B21;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x503C;&#x7684;&#x65F6;&#x5019;, size&#x90FD;&#x4F1A;&#x8FDB;&#x884C;&#x81EA;&#x52A0;&#x64CD;&#x4F5C;, </li>
<li>null != table[bucketIndex]: &#x5F53;&#x524D;&#x8282;&#x70B9;&#x4E3A;&#x7A7A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x76F4;&#x63A5;&#x6DFB;&#x52A0;, &#x53CD;&#x6B63;&#x6CA1;&#x6302;&#x4E1C;&#x897F;,&#x6548;&#x7387;&#x5F88;&#x9AD8;&#x7684;</li>
</ol>
<h2 id="resize">5.1. resize</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>{</span><br><span class="line">  Entry[] oldTable = table;</span><br><span class="line">  <span class="keyword">int</span> oldCapacity = oldTable.length;</span><br><span class="line">  <span class="comment">// &#x5982;&#x679C;&#x6570;&#x7EC4;&#x957F;&#x5EA6;&#x8FBE;&#x5230;&#x6700;&#x5927;&#x503C;, &#x5219;&#x4E0D;&#x6269;&#x5BB9;</span></span><br><span class="line">  <span class="keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) {</span><br><span class="line">    threshold = Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">	<span class="comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6570;&#x7EC4;</span></span><br><span class="line">  Entry[] newTable = <span class="keyword">new</span> Entry[newCapacity];</span><br><span class="line">  <span class="comment">// &#x5C06;&#x4E4B;&#x524D;&#x7684;&#x6570;&#x636E;&#x8F6C;&#x79FB;&#x5230;&#x65B0;&#x6570;&#x7EC4;</span></span><br><span class="line">  transfer(newTable, initHashSeedAsNeeded(newCapacity));</span><br><span class="line">  <span class="comment">// &#x5C06;&#x65B0;&#x6570;&#x7EC4;&#x8D4B;&#x503C;&#x7ED9;&#x6210;&#x5458;&#x53D8;&#x91CF;, &#x5B8C;&#x6210;&#x66FF;&#x6362;</span></span><br><span class="line">  table = newTable;</span><br><span class="line">  <span class="comment">// &#x5237;&#x65B0;&#x4E0B;&#x6B21;&#x6269;&#x5BB9;&#x7684;&#x5927;&#x5C0F;</span></span><br><span class="line">  threshold = (<span class="keyword">int</span>)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + <span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="createEntry">5.2. createEntry</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>{</span><br><span class="line">  Entry&lt;K,V&gt; e = table[bucketIndex];</span><br><span class="line">  <span class="comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8282;&#x70B9;, &#x5C06;&#x539F;&#x6709;&#x8282;&#x70B9;&#x6302;&#x8F7D;&#x5728;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x4E0B;, &#x65B0;&#x7684;&#x8282;&#x70B9;&#x66FF;&#x6362;&#x539F;&#x6709;&#x7684;&#x8282;&#x70B9;</span></span><br><span class="line">  table[bucketIndex] = <span class="keyword">new</span> Entry&lt;&gt;(hash, key, value, e);</span><br><span class="line">  size++;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x8FD9;&#x4F4D;&#x7F6E;&#x8868;&#x8FBE;&#x8D77;&#x6765;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;, &#x7406;&#x89E3;&#x5C31;&#x597D;, &#x5F88;&#x7B80;&#x5355;</p>
</blockquote>
<h3 id="transfer">5.2.1. transfer</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x5C06;&#x4E4B;&#x524D;&#x7684;&#x6570;&#x636E;&#x8F6C;&#x79FB;&#x5230;&#x65B0;&#x6570;&#x7EC4;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Entry[] newTable, <span class="keyword">boolean</span> rehash)</span> </span>{</span><br><span class="line">  <span class="keyword">int</span> newCapacity = newTable.length;</span><br><span class="line">  <span class="comment">// table: &#x65E7;&#x7684;&#x6570;&#x7EC4;</span></span><br><span class="line">  <span class="keyword">for</span> (Entry&lt;K,V&gt; e : table) {</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">null</span> != e) {</span><br><span class="line">      Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">      <span class="comment">// rehash; &#x662F;&#x5426;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;hash</span></span><br><span class="line">      <span class="keyword">if</span> (rehash) {</span><br><span class="line">        e.hash = <span class="keyword">null</span> == e.key ? <span class="number">0</span> : hash(e.key);</span><br><span class="line">      }</span><br><span class="line">      <span class="comment">// &#x8BA1;&#x7B97;&#x5F53;&#x524D;&#x503C;&#x5728;&#x65B0;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;</span></span><br><span class="line">      <span class="keyword">int</span> i = indexFor(e.hash, newCapacity);</span><br><span class="line">      <span class="comment">// &#x5C06;&#x6570;&#x7EC4;&#x8282;&#x70B9;&#x6570;&#x636E;&#x6302;&#x5230;&#x5F53;&#x524D;&#x8282;&#x70B9;</span></span><br><span class="line">      e.next = newTable[i];</span><br><span class="line">      <span class="comment">// &#x8FDB;&#x884C;&#x66FF;&#x6362;</span></span><br><span class="line">      newTable[i] = e;</span><br><span class="line">      <span class="comment">// &#x904D;&#x5386;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;</span></span><br><span class="line">      e = next;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="get">6. get</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">    <span class="comment">// &#x5982;&#x679C;&#x4E3A;null, &#x8D70;&#x4E00;&#x6BB5;&#x7279;&#x6B8A;&#x903B;&#x8F91;,&#x76F4;&#x63A5;&#x4ECE;&#x6570;&#x7EC4;&#x7B2C;&#x4E00;&#x4F4D;&#x53D6;&#x503C;</span></span><br><span class="line">    <span class="keyword">return</span> getForNullKey();</span><br><span class="line">  <span class="comment">// &#x5B9E;&#x9645;&#x83B7;&#x53D6;&#x65B9;&#x6CD5;</span></span><br><span class="line">  Entry&lt;K,V&gt; entry = getEntry(key);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span> == entry ? <span class="keyword">null</span> : entry.getValue();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="getForNullKey">6.1. getForNullKey</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> V <span class="title">getForNullKey</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="comment">// &#x5982;&#x679C;map&#x4E3A;&#x7A7A;, &#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;null</span></span><br><span class="line">  <span class="keyword">if</span> (size == <span class="number">0</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// &#x4ECE;&#x6570;&#x7EC4;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x4E2D;&#x5FAA;&#x73AF;&#x67E5;&#x627E;null&#x503C;</span></span><br><span class="line">  <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[<span class="number">0</span>]; e != <span class="keyword">null</span>; e = e.next) {</span><br><span class="line">    <span class="keyword">if</span> (e.key == <span class="keyword">null</span>)</span><br><span class="line">      <span class="keyword">return</span> e.value;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="getEntry">6.2. getEntry</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title">getEntry</span><span class="params">(Object key)</span> </span>{</span><br><span class="line">  <span class="comment">// &#x5982;&#x679C;map&#x4E3A;&#x7A7A;, &#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;null</span></span><br><span class="line">  <span class="keyword">if</span> (size == <span class="number">0</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  }</span><br><span class="line">	<span class="comment">// &#x83B7;&#x53D6;hash</span></span><br><span class="line">  <span class="keyword">int</span> hash = (key == <span class="keyword">null</span>) ? <span class="number">0</span> : hash(key);</span><br><span class="line">  <span class="comment">// &#x4F9D;&#x636E;hash&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x6570;&#x7EC4;&#x8282;&#x70B9;, &#x904D;&#x5386;</span></span><br><span class="line">  <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];</span><br><span class="line">       e != <span class="keyword">null</span>;</span><br><span class="line">       e = e.next) {</span><br><span class="line">    Object k;</span><br><span class="line">    <span class="comment">// &#x6BD4;&#x8F83;</span></span><br><span class="line">    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">      <span class="keyword">return</span> e;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>jdk</category>
      </categories>
      <tags>
        <tag>jdk</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis实用API</title>
    <url>/2020/redis-shi-yong-api/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p>&#x5B66;&#x4E60;&#x8FC7;&#x7A0B;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x611F;&#x89C9;&#x6BD4;&#x8F83;&#x6709;&#x610F;&#x601D;&#x7684;<code>API</code>&#x505A;&#x4E00;&#x4E2A;&#x6574;&#x7406;</p>
</blockquote>
<h1 id="setNx">2. setNx</h1><blockquote>
<p>&#x5982;&#x679C;&#x6307;&#x5B9A;&#x7684;Key&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x8BBE;&#x5B9A;&#x8BE5;Key&#x6301;&#x6709;&#x6307;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;Value&#xFF0C;&#x6B64;&#x65F6;&#x5176;&#x6548;&#x679C;&#x7B49;&#x4EF7;&#x4E8E;SET&#x547D;&#x4EE4;&#x3002;&#x76F8;&#x53CD;&#xFF0C;&#x5982;&#x679C;&#x8BE5;Key&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#xFF0C;&#x8BE5;&#x547D;&#x4EE4;&#x5C06;&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#x5E76;&#x8FD4;&#x56DE;&#x3002;</p>
</blockquote>
<a id="more"></a>

<p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x8BED;&#x5206;&#x5E03;&#x5F0F;&#x9501;, &#x7528;&#x6CD5;&#x5982;&#x4E0B;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>{</span><br><span class="line">  Boolean flag = <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    flag = redis.setnx(<span class="string">&quot;key&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (flag){</span><br><span class="line">      redis.expire(lockKey, <span class="number">10</span>);</span><br><span class="line">      fun();</span><br><span class="line">    }</span><br><span class="line">  }<span class="keyword">finally</span> {</span><br><span class="line">    <span class="keyword">if</span> (flag){</span><br><span class="line">      redis.del(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x8BBE;&#x7F6E;&#x9501;&#x7684;&#x4F4D;&#x7F6E;&#x548C;&#x9700;&#x8981;&#x6267;&#x884C;&#x7684;&#x65B9;&#x6CD5;&#x8981;&#x5728;<code>try</code>&#x5185;</li>
<li>&#x5728;<code>finally</code>&#x5185;&#x90E8;&#x5224;&#x65AD;&#x52A0;&#x9501;&#x6210;&#x529F;&#x540E;&#x5220;&#x9664;&#x9501;</li>
<li>&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x8D85;&#x65F6;,&#x957F;&#x65F6;&#x95F4;&#x5360;&#x7528;&#x9501;, &#x6211;&#x4EEC;&#x4E00;&#x822C;&#x4F1A;&#x52A0;&#x4E00;&#x4E2A;&#x8FC7;&#x671F;&#x65F6;&#x95F4;</li>
<li>&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x6DFB;&#x52A0;&#x9700;&#x8C28;&#x614E;, &#x5047;&#x8BBE;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x4E86;12s&#x4F1A;&#x51FA;&#x73B0;&#x5982;&#x4E0B;&#x60C5;&#x51B5;<ol>
<li>0s:&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x8FDB;&#x6765;&#x540E;&#x52A0;&#x9501;</li>
<li>10s:&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x9501;&#x8FC7;&#x671F;</li>
<li>10s:&#x7B2C;&#x4E8C;&#x4E2A;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x5230;&#x9501;,&#x5E76;&#x6267;&#x884C;&#x65B9;&#x6CD5;</li>
<li>12s:&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B8C;,&#x8FDB;&#x5165;<code>finally</code>&#x5220;&#x9664;&#x7B2C;&#x4E8C;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x9501;</li>
<li>12s:&#x7B2C;&#x4E09;&#x4E2A;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x5E76;&#x83B7;&#x53D6;&#x9501;</li>
</ol>
</li>
</ol>
<p>&#x89E3;&#x51B3;4&#x7684;&#x60C5;&#x51B5;&#x9664;&#x4E86;&#x6B63;&#x786E;&#x9884;&#x4F30;&#x65F6;&#x95F4;&#x5916;, &#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5C06;<code>value</code>&#x7684;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A;&#x6BCF;&#x4E00;&#x8BF7;&#x6C42;&#x7684;&#x72EC;&#x7ACB;&#x7F16;&#x53F7;,&#x5982;&#x5546;&#x54C1;id&#x7B49;, &#x5728;&#x5220;&#x9664;&#x65F6;&#x5148;&#x6BD4;&#x8F83;<code>value</code>&#x662F;&#x5426;&#x76F8;&#x7B49;&#x518D;&#x5220;&#x9664;. &#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5728;&#x5C11;&#x91CF;&#x9501;&#x8D85;&#x65F6;&#x65F6;&#x4E0D;&#x4F1A;&#x8BEF;&#x5220;&#x9664;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x7684;&#x9501;</p>
<h1 id="incr">3. incr</h1><blockquote>
<p>&#x5C06;&#x6307;&#x5B9A;Key&#x7684;Value&#x539F;&#x5B50;&#x6027;&#x7684;&#x9012;&#x589E;1&#x3002;&#x5982;&#x679C;&#x8BE5;Key&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5176;&#x521D;&#x59CB;&#x503C;&#x4E3A;0&#xFF0C;&#x5728;incr&#x4E4B;&#x540E;&#x5176;&#x503C;&#x4E3A;1&#x3002;&#x5982;&#x679C;Value&#x7684;&#x503C;&#x4E0D;&#x80FD;&#x8F6C;&#x6362;&#x4E3A;&#x6574;&#x578B;&#x503C;&#xFF0C;&#x5982;Hello&#xFF0C;&#x8BE5;&#x64CD;&#x4F5C;&#x5C06;&#x6267;&#x884C;&#x5931;&#x8D25;</p>
<p>&#x5E76;&#x8FD4;&#x56DE;&#x76F8;&#x5E94;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x3002;&#x6CE8;&#x610F;&#xFF1A;&#x8BE5;&#x64CD;&#x4F5C;&#x7684;&#x53D6;&#x503C;&#x8303;&#x56F4;&#x662F;64&#x4F4D;&#x6709;&#x7B26;&#x53F7;&#x6574;&#x578B;&#x3002;</p>
</blockquote>
<p>&#x8FD9;&#x4E2A;&#x4E00;&#x822C;&#x7528;&#x4E8E;<code>id</code>&#x9012;&#x589E;&#x7684;&#x60C5;&#x51B5;, &#x4F46;&#x662F;redis&#x6BD5;&#x7ADF;&#x662F;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x6027;&#x8D28;&#x7684;&#x6570;&#x636E;&#x5E93;, &#x5EFA;&#x8BAE;&#x4EE3;&#x7801;&#x903B;&#x8F91;&#x81EA;&#x589E;</p>
<h1 id="blpop-brpop">4. blpop/brpop</h1><blockquote>
<p>Blpop: &#x79FB;&#x51FA;&#x5E76;&#x83B7;&#x53D6;&#x5217;&#x8868;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF0C; &#x5982;&#x679C;&#x5217;&#x8868;&#x6CA1;&#x6709;&#x5143;&#x7D20;&#x4F1A;&#x963B;&#x585E;&#x5217;&#x8868;&#x76F4;&#x5230;&#x7B49;&#x5F85;&#x8D85;&#x65F6;&#x6216;&#x53D1;&#x73B0;&#x53EF;&#x5F39;&#x51FA;&#x5143;&#x7D20;&#x4E3A;&#x6B62;&#x3002;</p>
<p>Brpop: &#x79FB;&#x51FA;&#x5E76;&#x83B7;&#x53D6;&#x5217;&#x8868;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF0C; &#x5982;&#x679C;&#x5217;&#x8868;&#x6CA1;&#x6709;&#x5143;&#x7D20;&#x4F1A;&#x963B;&#x585E;&#x5217;&#x8868;&#x76F4;&#x5230;&#x7B49;&#x5F85;&#x8D85;&#x65F6;&#x6216;&#x53D1;&#x73B0;&#x53EF;&#x5F39;&#x51FA;&#x5143;&#x7D20;&#x4E3A;&#x6B62;&#x3002;</p>
</blockquote>
<p>&#x4E00;&#x822C;&#x5F53;&#x505A;&#x4E00;&#x4E2A;&#x53D1;&#x5E03;&#x8BA2;&#x9605;&#x7684;&#x6D88;&#x606F;&#x5217;&#x961F;&#x4F7F;&#x7528;</p>
<ol>
<li>&#x6570;&#x636E;&#x91CF;&#x5C0F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;:<code>ArrayBlockingQueue</code>&#x4E0D;&#x9999;&#x5417;?</li>
<li>&#x6570;&#x636E;&#x91CF;&#x5927;&#x7684;&#x60C5;&#x51B5;&#x4E0B;: <code>mq</code>&#x4E0D;&#x9999;&#x5417;?</li>
<li>&#x6570;&#x636E;&#x91CF;&#x4E0D;&#x5C34;&#x4E0D;&#x5C2C;, &#x5E94;&#x7528;&#x8303;&#x56F4;&#x4E0D;&#x7B97;&#x592A;&#x5927;,&#x53C8;&#x6CA1;&#x94B1;: &#x771F;&#x9999;!</li>
</ol>
<h1 id="HyperLogLog">5. HyperLogLog</h1><blockquote>
<p>Redis HyperLogLog &#x662F;&#x7528;&#x6765;&#x505A;&#x57FA;&#x6570;&#x7EDF;&#x8BA1;&#x7684;&#x7B97;&#x6CD5;&#xFF0C;HyperLogLog &#x7684;&#x4F18;&#x70B9;&#x662F;&#xFF0C;&#x5728;&#x8F93;&#x5165;&#x5143;&#x7D20;&#x7684;&#x6570;&#x91CF;&#x6216;&#x8005;&#x4F53;&#x79EF;&#x975E;&#x5E38;&#x975E;&#x5E38;&#x5927;&#x65F6;&#xFF0C;&#x8BA1;&#x7B97;&#x57FA;&#x6570;&#x6240;&#x9700;&#x7684;&#x7A7A;&#x95F4;&#x603B;&#x662F;&#x56FA;&#x5B9A; &#x7684;&#x3001;&#x5E76;&#x4E14;&#x662F;&#x5F88;&#x5C0F;&#x7684;&#x3002;</p>
<p>&#x5728; Redis &#x91CC;&#x9762;&#xFF0C;&#x6BCF;&#x4E2A; HyperLogLog &#x952E;&#x53EA;&#x9700;&#x8981;&#x82B1;&#x8D39; 12 KB &#x5185;&#x5B58;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8BA1;&#x7B97;&#x63A5;&#x8FD1; 2^64 &#x4E2A;&#x4E0D;&#x540C;&#x5143;&#x7D20;&#x7684;&#x57FA; &#x6570;&#x3002;&#x8FD9;&#x548C;&#x8BA1;&#x7B97;&#x57FA;&#x6570;&#x65F6;&#xFF0C;&#x5143;&#x7D20;&#x8D8A;&#x591A;&#x8017;&#x8D39;&#x5185;&#x5B58;&#x5C31;&#x8D8A;&#x591A;&#x7684;&#x96C6;&#x5408;&#x5F62;&#x6210;&#x9C9C;&#x660E;&#x5BF9;&#x6BD4;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x56E0;&#x4E3A; HyperLogLog &#x53EA;&#x4F1A;&#x6839;&#x636E;&#x8F93;&#x5165;&#x5143;&#x7D20;&#x6765;&#x8BA1;&#x7B97;&#x57FA;&#x6570;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x50A8;&#x5B58;&#x8F93;&#x5165;&#x5143;&#x7D20;&#x672C;&#x8EAB;&#xFF0C;&#x6240;&#x4EE5; HyperLogLog &#x4E0D;&#x80FD;&#x50CF;&#x96C6;&#x5408;&#x90A3;&#x6837;&#xFF0C;&#x8FD4;&#x56DE;&#x8F93;&#x5165;&#x7684;&#x5404;&#x4E2A;&#x5143;&#x7D20;&#x3002;</p>
</blockquote>
<p>&#x4E00;&#x822C;&#x7528;&#x4E8E;&#x8BA1;&#x7B97;&#x9875;&#x9762;&#x8BBF;&#x95EE;&#x91CF;, &#x540C;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x65E0;&#x8BBA;&#x8BBF;&#x95EE;&#x591A;&#x5C11;&#x6B21;&#x90FD;&#x8BA1;&#x7B97;&#x4E00;&#x6B21;</p>
<p>&#x5177;&#x4F53;&#x6CA1;&#x6709;&#x592A;&#x641E;&#x61C2;, &#x5982;&#x679C;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x4E0A;&#x8FF0;&#x529F;&#x80FD;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;</p>
<h1 id="bitmaps">6. bitmaps</h1><blockquote>
<p>Redis&#x63D0;&#x4F9B;&#x7684;Bitmaps&#x8FD9;&#x4E2A;&#x201C;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x201D;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5BF9;&#x4F4D;&#x7684;&#x64CD;&#x4F5C;&#x3002;Bitmaps&#x672C;&#x8EAB;&#x4E0D;&#x662F;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x53EF;&#x4EE5;&#x5BF9;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x4F4D;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;</p>
<p>&#x53EF;&#x4EE5;&#x628A;Bitmaps&#x60F3;&#x8C61;&#x6210;&#x4E00;&#x4E2A;&#x4EE5;&#x4F4D;&#x4E3A;&#x5355;&#x4F4D;&#x6570;&#x7EC4;&#xFF0C;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x5355;&#x5143;&#x53EA;&#x80FD;&#x5B58;0&#x6216;&#x8005;1&#xFF0C;&#x6570;&#x7EC4;&#x7684;&#x4E0B;&#x6807;&#x5728;bitmaps&#x4E2D;&#x53EB;&#x505A;&#x504F;&#x79FB;&#x91CF;&#x3002;&#x5355;&#x4E2A;bitmaps&#x7684;&#x6700;&#x5927;&#x957F;&#x5EA6;&#x662F;512MB&#xFF0C;&#x5373;2^32&#x4E2A;&#x6BD4;&#x7279;&#x4F4D;</p>
</blockquote>
<p>&#x4F4D;&#x56FE;, &#x4E00;&#x822C;&#x7528;&#x4E8E;&#x7EDF;&#x8BA1;&#x6BCF;&#x5929;&#x7684;&#x7528;&#x6237;&#x6D3B;&#x8DC3;&#x6570;/&#x7B7E;&#x5230;/&#x70B9;&#x8D5E;&#x7B49;</p>
<p>&#x5728;&#x5C06;id&#x7B49;&#x8BBE;&#x7F6E;&#x8FDB;&#x4F4D;&#x56FE;&#x65F6;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x5148;&#x8FDB;&#x884C;&#x51CF;&#x6700;&#x5C0F;id,&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x628A;&#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;&#x7F29;&#x5C0F;, &#x5426;&#x5219;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x95F4;&#x4F1A;&#x6BD4;&#x8F83;&#x957F;,&#x540C;&#x65F6;&#x9020;&#x6210;&#x8D44;&#x6E90;&#x6D6A;&#x8D39;</p>
<h1 id="Pipeline">7. Pipeline</h1><blockquote>
<p>&#x5927;&#x6279;&#x91CF;&#x6570;&#x636E;&#x5199;&#x5165;<code>redis</code>,&#x540C;&#x65F6;,&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x503C;, &#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>Pipeline</code>&#x52A0;&#x901F;</p>
</blockquote>
<p>&#x7528;&#x4E8E;&#x70ED;&#x70B9;&#x6570;&#x636E;&#x7684;&#x521D;&#x59CB;&#x5316;</p>
<ol>
<li><a href="https://blog.csdn.net/johnf_nash/article/details/87894802" target="_blank" rel="noopener">&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;Redis&#x4E4B;Pipeline&#xFF08;&#x7BA1;&#x9053;&#xFF09;</a></li>
<li><a href="https://blog.csdn.net/w1lgy/article/details/84455579" target="_blank" rel="noopener">Redis&#x7CFB;&#x5217;&#x5341;&#xFF1A;Pipeline&#x8BE6;&#x89E3;</a></li>
</ol>
<h1 id="GEO">8. GEO</h1><blockquote>
<p><strong>GEO</strong>&#x529F;&#x80FD;&#x5728;Redis3.2&#x7248;&#x672C;&#x63D0;&#x4F9B;&#xFF0C;&#x652F;&#x6301;&#x5B58;&#x50A8;&#x5730;&#x7406;&#x4F4D;&#x7F6E;&#x4FE1;&#x606F;&#x7528;&#x6765;&#x5B9E;&#x73B0;&#x8BF8;&#x5982;&#x9644;&#x8FD1;&#x4F4D;&#x7F6E;&#x3001;&#x6447;&#x4E00;&#x6447;&#x8FD9;&#x7C7B;&#x4F9D;&#x8D56;&#x4E8E;&#x5730;&#x7406;&#x4F4D;&#x7F6E;&#x4FE1;&#x606F;&#x7684;&#x529F;&#x80FD;.geo&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4E3A;zset.</p>
</blockquote>
<p>&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x83B7;&#x53D6;&#x9644;&#x8FD1;&#x7684;&#x4EBA;&#x529F;&#x80FD;</p>
<h1 id="RedisBloom">9. RedisBloom</h1><blockquote>
<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;<code>redis4.0</code>&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;&#x7684;&#x63D2;&#x4EF6;</p>
</blockquote>
<p>&#x7528;&#x9014;&#x53CA;&#x4F7F;&#x7528;&#x8BF7;&#x770B;&#x8FD9;&#x7BC7;<a href="https://www.chenguanting.top/2020/&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;">&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;</a></p>
<p>&#x6269;&#x5C55;<a href="https://blog.csdn.net/weixin_34410662/article/details/91434798" target="_blank" rel="noopener">Redis &#x9AD8;&#x7EA7;&#x4E3B;&#x9898;&#x4E4B;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;(BloomFilter)</a></p>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
  </entry>
  <entry>
    <title>Redis缓存三大问题</title>
    <url>/2020/Redis-san-da-wen-ti/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p>&#x4F7F;&#x7528;<code>redis</code>&#x505A;&#x7F13;&#x5B58;&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;:</p>
<ol>
<li>&#x540E;&#x53F0;&#x63A5;&#x53D7;&#x5230;&#x8BF7;&#x6C42;</li>
<li>&#x67E5;&#x8BE2;<code>redis</code>&#x770B;&#x662F;&#x5426;&#x5B58;&#x5728;,&#x5B58;&#x5728;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</li>
<li>&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5E93;,&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x5230;&#x5219;&#x63D2;&#x5165;<code>redis</code>&#x540E;&#x8FD4;&#x56DE;, &#x5426;&#x5219;&#x8FD4;&#x56DE;null</li>
</ol>
<p>&#x4F46;&#x662F;, &#x5728;&#x5927;&#x6570;&#x636E;&#x91CF;&#x8BF7;&#x6C42;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5F80;&#x5F80;&#x5B58;&#x5728;&#x4EE5;&#x4E0B;&#x95EE;&#x9898;</p>
</blockquote>
<a id="more"></a>

<h1 id="&#x7F13;&#x5B58;&#x7A7F;&#x900F;">2. &#x7F13;&#x5B58;&#x7A7F;&#x900F;</h1><blockquote>
<p>&#x67E5;&#x8BE2;&#x4E00;&#x6761;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x6570;&#x636E;</p>
<p>&#x4E3E;&#x4F8B;: &#x9ED1;&#x5BA2;&#x653B;&#x51FB;</p>
<p>&#x9ED1;&#x5BA2;&#x4EE5;&#x4E00;&#x4E2A;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x8BA2;&#x5355;&#x53F7;&#x4E0D;&#x505C;&#x7684;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;, &#x8FD9;&#x4F1A;&#x9020;&#x6210;&#x6211;&#x4EEC;&#x67E5;&#x8BE2;redis&#x540E;&#x67E5;&#x8BE2;&#x4E0D;&#x5230;&#x7ED3;&#x679C;,&#x7136;&#x540E;&#x4E0D;&#x505C;&#x7684;&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5E93;</p>
</blockquote>
<h2 id="&#x89C4;&#x5219;&#x6821;&#x9A8C;">2.1. &#x89C4;&#x5219;&#x6821;&#x9A8C;</h2><p>&#x8BA2;&#x5355;&#x53F7;&#x4E2D;&#x6DFB;&#x52A0;&#x51E0;&#x4F4D;&#x7528;&#x4E8E;&#x6821;&#x9A8C;&#x7684;&#x503C;,&#x5728;&#x8BF7;&#x6C42;&#x8FC7;&#x6765;&#x540E;&#x5148;&#x8FDB;&#x6027;&#x6821;&#x9A8C;, &#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</p>
<blockquote>
<p>&#x6478;&#x5230;&#x89C4;&#x5F8B;&#x540E;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x7834;&#x89E3;</p>
</blockquote>
<h2 id="&#x8BBE;&#x7F6E;&#x8FD4;&#x56DE;&#x7A7A;&#x5BF9;&#x8C61;">2.2. &#x8BBE;&#x7F6E;&#x8FD4;&#x56DE;&#x7A7A;&#x5BF9;&#x8C61;</h2><p>&#x5728;&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5E93;&#x540E;, &#x5982;&#x679C;&#x6570;&#x636E;&#x4E0D;&#x5B58;&#x5728;, &#x5219;&#x63D2;&#x5165;&#x4E00;&#x6761;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x4E3A;2&#x79D2;&#x7684;&#x7A7A;&#x5BF9;&#x8C61;, &#x8FD9;&#x6837;2&#x79D2;&#x5185;&#x8FC7;&#x6765;&#x7684;&#x8BF7;&#x6C42;&#x5C31;&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x67E5;&#x8BE2;</p>
<blockquote>
<ol>
<li>&#x5982;&#x679C;&#x9ED1;&#x5BA2;&#x8FDB;&#x884C;&#x4E86;&#x5E76;&#x53D1;&#x67E5;&#x8BE2;&#x5462;? &#x8FD9;&#x4F1A;&#x9020;&#x6210;&#x540C;&#x4E00;&#x6BEB;&#x79D2;&#x5185;&#x5927;&#x6279;&#x91CF;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5E93;</li>
<li>&#x5982;&#x679C;&#x9ED1;&#x5BA2;&#x6BCF;&#x6B21;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#x5C06;&#x8BA2;&#x5355;&#x53F7;+1 &#x5462;?</li>
</ol>
</blockquote>
<h2 id="&#x8BBE;&#x7F6E;&#x8FD4;&#x56DE;&#x7A7A;&#x5BF9;&#x8C61;-redis&#x9501;">2.3. &#x8BBE;&#x7F6E;&#x8FD4;&#x56DE;&#x7A7A;&#x5BF9;&#x8C61;+redis&#x9501;</h2><ol>
<li>&#x67E5;&#x8BE2;<code>redis</code> &#x5B58;&#x5728;&#x5219;&#x8FD4;&#x56DE;</li>
<li>&#x52A0;&#x9501;, &#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x9501;&#x5219;&#x7B49;&#x5F85;</li>
<li>&#x67E5;&#x8BE2;<code>redis</code> &#x5B58;&#x5728;&#x5219;&#x8FD4;&#x56DE;</li>
<li>&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5E93;<ol>
<li>&#x5B58;&#x5728;&#x5219;&#x52A0;&#x5165;<code>redis</code>&#x5E76;&#x8FD4;&#x56DE;</li>
<li>&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x52A0;&#x5165;&#x7A7A;&#x5BF9;&#x8C61;,&#x65F6;&#x95F4;2s</li>
</ol>
</li>
<li>&#x89E3;&#x9501;</li>
</ol>
<p><strong>&#x8BF4;&#x660E;:</strong></p>
<ol>
<li><strong>&#x903B;&#x8F91;2</strong> &#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>redis</code>&#x9501;, &#x800C;&#x4E0D;&#x662F;&#x58F0;&#x660E;&#x4E00;&#x4E2A;<code>ReentrantLock</code>, <code>ReentrantLock</code>&#x9700;&#x8981;&#x653E;&#x5728;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x4E2D;, &#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x9501;&#x7684;&#x9897;&#x7C92;&#x5EA6;&#x8FC7;&#x5927;, &#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x6B63;&#x5E38;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;</li>
<li><strong>&#x903B;&#x8F91;4.1</strong> &#x4E2D;&#x518D;&#x6B21;&#x67E5;&#x8BE2;&#x4E86;&#x4E00;&#x6B21;redis&#x662F;&#x56E0;&#x4E3A;&#x5F53;&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x9501;&#x540E;, &#x540E;&#x7EED;&#x7EBF;&#x7A0B;&#x5904;&#x4E8E;&#x7B49;&#x5F85;&#x72B6;&#x6001; , &#x5F53;&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x9501;&#x65F6;, &#x6570;&#x636E;&#x5DF2;&#x7ECF;&#x88AB;&#x653E;&#x5728;<code>redis</code>&#x4E2D;&#x4E86;</li>
</ol>
<blockquote>
<p>&#x9ED1;&#x5BA2;&#x6BCF;&#x6B21;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#x5C06;&#x8BA2;&#x5355;&#x53F7;+1 &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4ECD;&#x7136;&#x6CA1;&#x6709;&#x89E3;&#x51B3;</p>
</blockquote>
<h2 id="&#x4F7F;&#x7528;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;">2.4. &#x4F7F;&#x7528;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;</h2><p>&#x89C1;<a href="https://www.chenguanting.top/2020/&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;">&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;</a></p>
<blockquote>
<p>360&#x5EA6;&#x65E0;&#x6B7B;&#x89D2;</p>
</blockquote>
<h1 id="&#x7F13;&#x5B58;&#x51FB;&#x7A7F;">3. &#x7F13;&#x5B58;&#x51FB;&#x7A7F;</h1><blockquote>
<p>&#x4E00;&#x6761;&#x6570;&#x636E;<code>redis</code>&#x4E2D;&#x6CA1;&#x6709;, &#x6570;&#x636E;&#x5E93;&#x4E2D;&#x6709;. &#x5E76;&#x53D1;&#x60C5;&#x51B5;&#x4E0B;&#x77AC;&#x95F4;&#x6240;&#x6709;&#x7684;&#x8BF7;&#x6C42;&#x90FD;&#x53BB;&#x67E5;&#x8BE2;&#x4E86;&#x6570;&#x636E;&#x5E93;</p>
<p>&#x4E3E;&#x4F8B;:</p>
<p>&#x5546;&#x54C1;&#x8BBE;&#x7F6E;&#x4E86;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x4E3A;2&#x79D2;, &#x5728;&#x5931;&#x6548;&#x7684;&#x77AC;&#x95F4;, &#x5927;&#x91CF;&#x8BF7;&#x6C42;&#x8FC7;&#x6765;, &#x67E5;&#x8BE2;<code>redis</code>&#x6CA1;&#x6709;,&#x5168;&#x90E8;&#x67E5;&#x8BE2;&#x4E86;&#x6570;&#x636E;&#x91CF;</p>
</blockquote>
<h2 id="&#x8BBE;&#x7F6E;&#x70ED;&#x70B9;&#x6570;&#x636E;&#x6C38;&#x4E0D;&#x8FC7;&#x671F;">3.1. &#x8BBE;&#x7F6E;&#x70ED;&#x70B9;&#x6570;&#x636E;&#x6C38;&#x4E0D;&#x8FC7;&#x671F;</h2><blockquote>
<p>&#x4F1A;&#x7ED9;redis&#x9020;&#x6210;&#x4E00;&#x5B9A;&#x538B;&#x529B;</p>
</blockquote>
<h2 id="redis&#x9501;">3.2. redis&#x9501;</h2><p>&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x548C;<code>&#x7F13;&#x5B58;&#x7A7F;&#x900F;-&#x8BBE;&#x7F6E;&#x8FD4;&#x56DE;&#x7A7A;&#x5BF9;&#x8C61;+redis&#x9501;</code>&#x5DEE;&#x4E0D;&#x591A;</p>
<blockquote>
<p>&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x8F83;&#x591A;, &#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x95EE;&#x9898;</p>
</blockquote>
<h2 id="&#x67E5;&#x8BE2;&#x65F6;&#x5237;&#x65B0;&#x65F6;&#x95F4;">3.3. &#x67E5;&#x8BE2;&#x65F6;&#x5237;&#x65B0;&#x65F6;&#x95F4;</h2><p>&#x6BCF;&#x6B21;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x65F6;&#x5237;&#x65B0;&#x4E0B;&#x65F6;&#x95F4;, &#x4FDD;&#x8BC1;&#x8BE5;&#x6570;&#x636E;&#x4E3A;&#x70ED;&#x70B9;&#x6570;&#x636E;</p>
<h1 id="&#x7F13;&#x5B58;&#x96EA;&#x5D29;">4. &#x7F13;&#x5B58;&#x96EA;&#x5D29;</h1><blockquote>
<p>&#x6DFB;&#x52A0;&#x7F13;&#x5B58;&#x65F6;&#x8BBE;&#x7F6E;&#x4E86;&#x76F8;&#x540C;&#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#xFF0C;&#x5BFC;&#x81F4;&#x5927;&#x6279;&#x91CF;&#x6570;&#x636E;&#x7F13;&#x5B58;&#x5728;&#x67D0;&#x4E00;&#x65F6;&#x523B;&#x540C;&#x65F6;&#x5931;&#x6548;&#xFF0C;&#x5168;&#x90E8;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x5E93;.&#x9020;&#x6210;&#x6570;&#x636E;&#x5E93;&#x538B;&#x529B;&#x8FC7;&#x5927;&#x96EA;&#x5D29;</p>
</blockquote>
<h2 id="&#x968F;&#x673A;&#x6570;&#x8FC7;&#x671F;&#x65F6;&#x95F4;">4.1. &#x968F;&#x673A;&#x6570;&#x8FC7;&#x671F;&#x65F6;&#x95F4;</h2><p>&#x5728;&#x6DFB;&#x52A0;&#x7F13;&#x5B58;&#x65F6;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#x5185;&#x7684;&#x968F;&#x673A;&#x6570;&#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;</p>
<h2 id="&#x9AD8;&#x53EF;&#x7528;&#x96C6;&#x7FA4;">4.2. &#x9AD8;&#x53EF;&#x7528;&#x96C6;&#x7FA4;</h2><p>&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x4E8B;&#x60C5;&#x4E0D;&#x662F;&#x52A0;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x80FD;&#x89E3;&#x51B3;&#x7684;, &#x5982;&#x679C;&#x4E0D;&#x80FD;,&#x5C31;&#x52A0;&#x4E24;&#x53F0;!</p>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
  </entry>
  <entry>
    <title>Redis持久化</title>
    <url>/2020/redis-chi-jiu-hua/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p>Redis&#x652F;&#x6301;RDB&#x548C;AOF&#x4E24;&#x79CD;&#x6301;&#x4E45;&#x5316;&#x673A;&#x5236;&#xFF0C;&#x6301;&#x4E45;&#x5316;&#x529F;&#x80FD;&#x6709;&#x6548;&#x5730;&#x907F;&#x514D;&#x56E0;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x9020;&#x6210;&#x7684;&#x6570;&#x636E;&#x4E22;&#x5931;&#x95EE;&#x9898;&#xFF0C;&#x5F53;&#x4E0B;&#x6B21;&#x91CD;&#x542F;&#x65F6;&#x5229;&#x7528;&#x4E4B;&#x524D;&#x6301;&#x4E45;&#x5316;&#x7684;&#x6587;&#x4EF6;&#x5373;&#x53EF;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x6062;&#x590D;&#x3002;</p>
</blockquote>
<h1 id="RDB-redis-dataBase">2. RDB(redis dataBase)</h1><p>RDB&#x6301;&#x4E45;&#x5316;&#x662F;&#x628A;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;&#x7684;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x6210;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x751F;&#x6210;&#x5FEB;&#x7167;&#x4FDD;&#x5B58;&#x5230;&#x786C;&#x76D8;; &#x89E6;&#x53D1;RDB&#x6301;&#x4E45;&#x5316;&#x8FC7;&#x7A0B;&#x5206;&#x4E3A;&#x624B;&#x52A8;&#x89E6;&#x53D1;&#x548C;&#x81EA;&#x52A8;&#x89E6;&#x53D1; </p>
<h2 id="&#x89E6;&#x53D1;&#x673A;&#x5236;">2.1. &#x89E6;&#x53D1;&#x673A;&#x5236;</h2><p>&#x624B;&#x52A8;&#x89E6;&#x53D1;&#x5206;&#x522B;&#x5BF9;&#x5E94;save&#x548C;bgsave&#x547D;&#x4EE4; </p>
<ol>
<li><p>save&#x547D;&#x4EE4;: &#x963B;&#x585E;&#x5F53;&#x524D;Redis&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x76F4;&#x5230;RDB&#x8FC7;&#x7A0B;&#x5B8C;&#x6210;&#x4E3A;&#x6B62;&#xFF0C;&#x5BF9;&#x4E8E;&#x5185;&#x5B58; &#x6BD4;&#x8F83;&#x5927;&#x7684;&#x5B9E;&#x4F8B;&#x4F1A;&#x9020;&#x6210;&#x957F;&#x65F6;&#x95F4;&#x963B;&#x585E;&#xFF0C;&#x7EBF;&#x4E0A;&#x73AF;&#x5883;&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528; </p>
</li>
<li><p>bgsave&#x547D;&#x4EE4;: Redis&#x8FDB;&#x7A0B;&#x6267;&#x884C;fork&#x64CD;&#x4F5C;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;RDB&#x6301;&#x4E45;&#x5316;&#x8FC7;&#x7A0B;&#x7531;&#x5B50; &#x8FDB;&#x7A0B;&#x8D1F;&#x8D23;&#xFF0C;&#x5B8C;&#x6210;&#x540E;&#x81EA;&#x52A8;&#x7ED3;&#x675F;&#x3002;&#x963B;&#x585E;&#x53EA;&#x53D1;&#x751F;&#x5728;fork&#x9636;&#x6BB5;&#xFF0C;&#x4E00;&#x822C;&#x65F6;&#x95F4;&#x5F88;&#x77ED; </p>
</li>
</ol>
<a id="more"></a>

<p><img src="/2020/redis-chi-jiu-hua/redis-bgsave.png" alt></p>
<h3 id="&#x81EA;&#x52A8;&#x89E6;&#x53D1;-save">2.1.1. &#x81EA;&#x52A8;&#x89E6;&#x53D1;:save</h3><ol>
<li><p>&#x4F7F;&#x7528;save&#x76F8;&#x5173;&#x914D;&#x7F6E;&#xFF0C;&#x5982;&#x201C;save m n&#x201D;&#x3002;&#x8868;&#x793A;m&#x79D2;&#x5185;&#x6570;&#x636E;&#x96C6;&#x5B58;&#x5728;n&#x6B21;&#x4FEE;&#x6539; &#x65F6;&#xFF0C;&#x81EA;&#x52A8;&#x89E6;&#x53D1;bgsave&#x3002; </p>
</li>
<li><p>&#x5982;&#x679C;&#x4ECE;&#x8282;&#x70B9;&#x6267;&#x884C;&#x5168;&#x91CF;&#x590D;&#x5236;&#x64CD;&#x4F5C;&#xFF0C;&#x4E3B;&#x8282;&#x70B9;&#x81EA;&#x52A8;&#x6267;&#x884C;bgsave&#x751F;&#x6210;RDB&#x6587;&#x4EF6;&#x5E76;&#x53D1;&#x9001;&#x7ED9;&#x4ECE;&#x8282;&#x70B9;&#x3002; </p>
</li>
<li><p>&#x6267;&#x884C;debug reload&#x547D;&#x4EE4;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;Redis&#x65F6;&#xFF0C;&#x4E5F;&#x4F1A;&#x81EA;&#x52A8;&#x89E6;&#x53D1;save&#x64CD;&#x4F5C;&#x3002; </p>
</li>
<li><p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x6267;&#x884C;shutdown&#x547D;&#x4EE4;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5F00;&#x542F;AOF&#x6301;&#x4E45;&#x5316;&#x529F;&#x80FD;&#x5219; &#x81EA;&#x52A8;&#x6267;&#x884C;bgsave&#x3002; </p>
</li>
</ol>
<h3 id="&#x624B;&#x52A8;&#x89E6;&#x53D1;-bgsave">2.1.2. &#x624B;&#x52A8;&#x89E6;&#x53D1;:bgsave</h3><ol>
<li><p>&#x6267;&#x884C;bgsave&#x547D;&#x4EE4;&#xFF0C;Redis&#x7236;&#x8FDB;&#x7A0B;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;&#x5B50;&#x8FDB; &#x7A0B;&#xFF0C;&#x5982;RDB/AOF&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;bgsave&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x3002; </p>
</li>
<li><p>&#x7236;&#x8FDB;&#x7A0B;&#x6267;&#x884C;fork&#x64CD;&#x4F5C;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;fork&#x64CD;&#x4F5C;&#x8FC7;&#x7A0B;&#x4E2D;&#x7236;&#x8FDB;&#x7A0B;&#x4F1A;&#x963B;&#x585E;&#xFF0C;&#x901A; &#x8FC7;info stats&#x547D;&#x4EE4;&#x67E5;&#x770B;latest_fork_usec&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x6700;&#x8FD1;&#x4E00;&#x4E2A;fork&#x64CD;&#x4F5C;&#x7684;&#x8017;&#x65F6;&#xFF0C;&#x5355;&#x4F4D;&#x4E3A;&#x5FAE;&#x79D2; </p>
</li>
<li><p>&#x7236;&#x8FDB;&#x7A0B;fork&#x5B8C;&#x6210;&#x540E;&#xFF0C;bgsave&#x547D;&#x4EE4;&#x8FD4;&#x56DE;&#x201C;Background saving started&#x201D;&#x4FE1;&#x606F;&#x5E76;&#x4E0D;&#x518D;&#x963B;&#x585E;&#x7236;&#x8FDB;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x54CD;&#x5E94;&#x5176;&#x4ED6;&#x547D;&#x4EE4;&#x3002; </p>
</li>
<li><p>&#x5B50;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;RDB&#x6587;&#x4EF6;&#xFF0C;&#x6839;&#x636E;&#x7236;&#x8FDB;&#x7A0B;&#x5185;&#x5B58;&#x751F;&#x6210;&#x4E34;&#x65F6;&#x5FEB;&#x7167;&#x6587;&#x4EF6;&#xFF0C;&#x5B8C;&#x6210;&#x540E; &#x5BF9;&#x539F;&#x6709;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x539F;&#x5B50;&#x66FF;&#x6362;&#x3002;&#x6267;&#x884C;lastsave&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x751F;&#x6210;RDB&#x7684; &#x65F6;&#x95F4;&#xFF0C;&#x5BF9;&#x5E94;info&#x7EDF;&#x8BA1;&#x7684;rdb_last_save_time&#x9009;&#x9879;&#x3002; </p>
</li>
<li><p>&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x4FE1;&#x53F7;&#x7ED9;&#x7236;&#x8FDB;&#x7A0B;&#x8868;&#x793A;&#x5B8C;&#x6210;&#xFF0C;&#x7236;&#x8FDB;&#x7A0B;&#x66F4;&#x65B0;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#xFF0C;&#x5177;&#x4F53;&#x89C1; info Persistence&#x4E0B;&#x7684;rdb_*&#x76F8;&#x5173;&#x9009;&#x9879;&#x3002; </p>
</li>
</ol>
<h2 id="&#x4F18;&#x7F3A;&#x70B9;">2.2. &#x4F18;&#x7F3A;&#x70B9;</h2><p><strong>&#x4F18;&#x70B9;:</strong></p>
<ol>
<li>RDB&#x662F;&#x4E00;&#x4E2A;&#x7D27;&#x51D1;&#x538B;&#x7F29;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#xFF0C;&#x4EE3;&#x8868;Redis&#x5728;&#x67D0;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#x4E0A;&#x7684;&#x6570;&#x636E; &#x5FEB;&#x7167;&#x3002;&#x975E;&#x5E38;&#x9002;&#x7528;&#x4E8E;&#x5907;&#x4EFD;&#xFF0C;&#x5168;&#x91CF;&#x590D;&#x5236;&#x7B49;&#x573A;&#x666F;&#x3002;&#x6BD4;&#x5982;&#x6BCF;&#x5C0F;&#x65F6;&#x6267;&#x884C;bgsave&#x5907;&#x4EFD;&#xFF0C; &#x5E76;&#x628A;RDB&#x6587;&#x4EF6;&#x62F7;&#x8D1D;&#x5230;&#x8FDC;&#x7A0B;&#x673A;&#x5668;&#x6216;&#x8005;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF08;&#x5982;hdfs&#xFF09;&#xFF0C;&#x7528;&#x4E8E;&#x707E;&#x96BE;&#x6062;&#x590D;&#x3002; </li>
<li>Redis&#x52A0;&#x8F7D;RDB&#x6062;&#x590D;&#x6570;&#x636E;&#x8FDC;&#x8FDC;&#x5FEB;&#x4E8E;AOF&#x7684;&#x65B9;&#x5F0F;&#x3002; </li>
</ol>
<p><strong>&#x7F3A;&#x70B9;:</strong>  </p>
<ol>
<li>rdb&#x65B9;&#x5F0F;&#x6570;&#x636E;&#x6CA1;&#x529E;&#x6CD5;&#x505A;&#x5230;&#x5B9E;&#x65F6;&#x6301;&#x4E45;&#x5316;/&#x79D2;&#x7EA7;&#x6301;&#x4E45;&#x5316;&#x3002;&#x56E0;&#x4E3A;bgsave&#x6BCF;&#x6B21;&#x8FD0; &#x884C;&#x90FD;&#x8981;&#x6267;&#x884C;fork&#x64CD;&#x4F5C;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x5C5E;&#x4E8E;&#x91CD;&#x91CF;&#x7EA7;&#x64CD;&#x4F5C;&#xFF0C;&#x9891;&#x7E41;&#x6267;&#x884C;&#x6210;&#x672C;&#x8FC7;&#x9AD8;&#x3002; </li>
<li>RDB&#x6587;&#x4EF6;&#x4F7F;&#x7528;&#x7279;&#x5B9A;&#x4E8C;&#x8FDB;&#x5236;&#x683C;&#x5F0F;&#x4FDD;&#x5B58;&#xFF0C;Redis&#x7248;&#x672C;&#x6F14;&#x8FDB;&#x8FC7;&#x7A0B;&#x4E2D;&#x6709;&#x591A;&#x4E2A;&#x683C;&#x5F0F; &#x7684;RDB&#x7248;&#x672C;&#xFF0C;&#x5B58;&#x5728;&#x8001;&#x7248;&#x672C;Redis&#x670D;&#x52A1;&#x65E0;&#x6CD5;&#x517C;&#x5BB9;&#x65B0;&#x7248;RDB&#x683C;&#x5F0F;&#x7684;&#x95EE;&#x9898;&#x3002; </li>
</ol>
<h1 id="AOF-append-only-file">3. AOF(append-only file)</h1><p>AOF&#x6301;&#x4E45;&#x5316;: &#x4EE5;&#x72EC;&#x7ACB;&#x65E5;&#x5FD7;&#x7684;&#x65B9;&#x5F0F;&#x8BB0;&#x5F55;&#x6BCF;&#x6B21;&#x5199;&#x547D;&#x4EE4;&#xFF0C; &#x91CD;&#x542F;&#x65F6;&#x518D;&#x91CD;&#x65B0;&#x6267;&#x884C;AOF&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x8FBE;&#x5230;&#x6062;&#x590D;&#x6570;&#x636E;&#x7684;&#x76EE;&#x7684;&#x3002;AOF&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528; &#x662F;&#x89E3;&#x51B3;&#x4E86;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x7684;&#x5B9E;&#x65F6;&#x6027;&#xFF0C;&#x76EE;&#x524D;&#x5DF2;&#x7ECF;&#x662F;Redis&#x6301;&#x4E45;&#x5316;&#x7684;&#x4E3B;&#x6D41;&#x65B9;&#x5F0F; </p>
<p><img src="/2020/redis-chi-jiu-hua/redis-aof.png" alt></p>
<h2 id="&#x4F7F;&#x7528;">3.1. &#x4F7F;&#x7528;</h2><ol>
<li>&#x5F00;&#x542F;AOF&#x529F;&#x80FD;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x914D;&#x7F6E;: appendonly yes&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0D;&#x5F00;&#x542F;&#x3002;</li>
<li>AOF&#x6587;&#x4EF6;&#x540D; &#x901A;&#x8FC7;appendfilename&#x914D;&#x7F6E;&#x8BBE;&#x7F6E;&#xFF0C;&#x9ED8;&#x8BA4;&#x6587;&#x4EF6;&#x540D;&#x662F;appendonly.aof</li>
<li>&#x4FDD;&#x5B58;&#x8DEF;&#x5F84;&#x540C; RDB&#x6301;&#x4E45;&#x5316;&#x65B9;&#x5F0F;&#x4E00;&#x81F4;&#xFF0C;&#x901A;&#x8FC7;dir&#x914D;&#x7F6E;&#x6307;&#x5B9A;&#x3002;</li>
<li>AOF&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x64CD;&#x4F5C;: &#x547D;&#x4EE4;&#x5199;&#x5165; &#xFF08;append&#xFF09;&#x3001;&#x6587;&#x4EF6;&#x540C;&#x6B65;&#xFF08;sync&#xFF09;&#x3001;&#x6587;&#x4EF6;&#x91CD;&#x5199;&#xFF08;rewrite&#xFF09;&#x3001;&#x91CD;&#x542F;&#x52A0;&#x8F7D; &#xFF08;load&#xFF09;.</li>
<li>&#x6240;&#x6709;&#x7684;&#x5199;&#x5165;&#x547D;&#x4EE4;&#x4F1A;&#x8FFD;&#x52A0;&#x5230;aof_buf&#xFF08;&#x7F13;&#x51B2;&#x533A;&#xFF09;&#x4E2D;. AOF&#x7F13;&#x51B2;&#x533A;&#x6839;&#x636E;&#x5BF9;&#x5E94;&#x7684;&#x7B56;&#x7565;&#x5411;&#x786C;&#x76D8;&#x505A;&#x540C;&#x6B65;&#x64CD;&#x4F5C;&#x3002; </li>
</ol>
<h2 id="&#x89E6;&#x53D1;&#x673A;&#x5236;&#xFF08;&#x6839;&#x636E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x914D;&#x7F6E;&#x9879;&#xFF09;">3.2. &#x89E6;&#x53D1;&#x673A;&#x5236;&#xFF08;&#x6839;&#x636E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x914D;&#x7F6E;&#x9879;&#xFF09;</h2><ol>
<li>no&#xFF1A;&#x8868;&#x793A;&#x7B49;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#x5230;&#x78C1;&#x76D8;&#xFF08;&#x5FEB;&#xFF0C;&#x6301;&#x4E45;&#x5316;&#x6CA1;&#x4FDD;&#x8BC1;&#xFF09;</li>
<li>always&#xFF1A;&#x540C;&#x6B65;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x6BCF;&#x6B21;&#x53D1;&#x751F;&#x6570;&#x636E;&#x53D8;&#x66F4;&#x65F6;&#xFF0C;&#x7ACB;&#x5373;&#x8BB0;&#x5F55;&#x5230;&#x78C1;&#x76D8;&#xFF08;&#x6162;&#xFF0C;&#x5B89;&#x5168;&#xFF09;</li>
<li>everysec&#xFF1A;&#x8868;&#x793A;&#x6BCF;&#x79D2;&#x540C;&#x6B65;&#x4E00;&#x6B21;&#xFF08;&#x9ED8;&#x8BA4;&#x503C;,&#x5F88;&#x5FEB;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x4F1A;&#x4E22;&#x5931;&#x4E00;&#x79D2;&#x4EE5;&#x5185;&#x7684;&#x6570;&#x636E;&#xFF09;</li>
<li>AOF&#x4E3A;&#x4EC0;&#x4E48;&#x628A;&#x547D;&#x4EE4;&#x8FFD;&#x52A0;&#x5230;aof_buf&#x4E2D;&#xFF1F;Redis&#x4F7F;&#x7528;&#x5355;&#x7EBF;&#x7A0B;&#x54CD;&#x5E94;&#x547D;&#x4EE4;&#xFF0C;&#x5982; &#x679C;&#x6BCF;&#x6B21;&#x5199;AOF&#x6587;&#x4EF6;&#x547D;&#x4EE4;&#x90FD;&#x76F4;&#x63A5;&#x8FFD;&#x52A0;&#x5230;&#x786C;&#x76D8;&#xFF0C;&#x90A3;&#x4E48;&#x6027;&#x80FD;&#x5B8C;&#x5168;&#x53D6;&#x51B3;&#x4E8E;&#x5F53;&#x524D;&#x786C;&#x76D8;&#x8D1F; &#x8F7D;&#x3002;&#x5148;&#x5199;&#x5165;&#x7F13;&#x51B2;&#x533A;aof_buf&#x4E2D;&#xFF0C;&#x8FD8;&#x6709;&#x53E6;&#x4E00;&#x4E2A;&#x597D;&#x5904;&#xFF0C;Redis&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x591A;&#x79CD;&#x7F13;&#x51B2;&#x533A;&#x540C;&#x6B65;&#x786C;&#x76D8;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x5728;&#x6027;&#x80FD;&#x548C;&#x5B89;&#x5168;&#x6027;&#x65B9;&#x9762;&#x505A;&#x51FA;&#x5E73;&#x8861; </li>
</ol>
<h2 id="&#x91CD;&#x5199;">3.3. &#x91CD;&#x5199;</h2><p>&#x968F;&#x7740;AOF&#x6587;&#x4EF6;&#x8D8A;&#x6765;&#x8D8A;&#x5927;&#xFF0C;&#x9700;&#x8981;&#x5B9A;&#x671F;&#x5BF9;AOF&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x91CD;&#x5199;&#xFF0C;&#x8FBE;&#x5230;&#x538B;&#x7F29;&#x7684;&#x76EE;&#x7684;&#x3002; </p>
<p><img src="/2020/redis-chi-jiu-hua/redis-%E9%87%8D%E5%86%99.png" alt></p>
<p>&#x91CD;&#x5199;&#x540E;&#x7684;AOF&#x6587;&#x4EF6;&#x4E3A;&#x4EC0;&#x4E48;&#x53EF;&#x4EE5;&#x53D8;&#x5C0F;&#xFF1F;&#x6709;&#x5982;&#x4E0B;&#x539F;&#x56E0;:  </p>
<ol>
<li><p>&#x8FDB;&#x7A0B;&#x5185;&#x5DF2;&#x7ECF;&#x8D85;&#x65F6;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x518D;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x3002; </p>
</li>
<li><p>&#x65E7;&#x7684;AOF&#x6587;&#x4EF6;&#x542B;&#x6709;&#x65E0;&#x6548;&#x547D;&#x4EE4;&#xFF0C;&#x5982;del key1&#x3001;hdel key2&#x3001;srem keys&#x3001;set a111&#x3001;set a222&#x7B49;&#x3002;&#x91CD;&#x5199;&#x4F7F;&#x7528;&#x8FDB;&#x7A0B;&#x5185;&#x6570;&#x636E;&#x76F4;&#x63A5;&#x751F;&#x6210;&#xFF0C;&#x8FD9;&#x6837;&#x65B0;&#x7684;AOF&#x6587;&#x4EF6;&#x53EA;&#x4FDD;&#x7559;&#x6700;&#x7EC8;&#x6570;&#x636E;&#x7684;&#x5199;&#x5165;&#x547D;&#x4EE4;&#x3002; </p>
</li>
<li><p>&#x591A;&#x6761;&#x5199;&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#xFF0C;&#x5982;: lpush list a&#x3001;lpush list b&#x3001;lpush list c&#x53EF;&#x4EE5;&#x8F6C;&#x5316;&#x4E3A;: lpush list a b c&#x3002;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5355;&#x6761;&#x547D;&#x4EE4;&#x8FC7;&#x5927;&#x9020;&#x6210;&#x5BA2;&#x6237;&#x7AEF;&#x7F13;&#x51B2;&#x533A;&#x6EA2; &#x51FA;&#xFF0C;&#x5BF9;&#x4E8E;list&#x3001;set&#x3001;hash&#x3001;zset&#x7B49;&#x7C7B;&#x578B;&#x64CD;&#x4F5C;&#xFF0C;&#x4EE5;64&#x4E2A;&#x5143;&#x7D20;&#x4E3A;&#x754C;&#x62C6;&#x5206;&#x4E3A;&#x591A;&#x6761;&#x3002; </p>
</li>
</ol>
<p>AOF&#x91CD;&#x5199;&#x964D;&#x4F4E;&#x4E86;&#x6587;&#x4EF6;&#x5360;&#x7528;&#x7A7A;&#x95F4;&#xFF0C;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x76EE;&#x7684;&#x662F;: &#x66F4;&#x5C0F;&#x7684;AOF &#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x5730;&#x88AB;Redis&#x52A0;&#x8F7D; </p>
<p>AOF&#x91CD;&#x5199;&#x8FC7;&#x7A0B;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x89E6;&#x53D1;&#x548C;&#x81EA;&#x52A8;&#x89E6;&#x53D1;:  </p>
<ul>
<li><p>&#x624B;&#x52A8;&#x89E6;&#x53D1;: &#x76F4;&#x63A5;&#x8C03;&#x7528;bgrewriteaof&#x547D;&#x4EE4;&#x3002; </p>
</li>
<li><p>&#x81EA;&#x52A8;&#x89E6;&#x53D1;: &#x6839;&#x636E;auto-aof-rewrite-min-size&#x548C;auto-aof-rewrite-percentage&#x53C2;&#x6570;&#x786E;&#x5B9A;&#x81EA;&#x52A8;&#x89E6;&#x53D1;&#x65F6;&#x673A; </p>
<ul>
<li><p>auto-aof-rewrite-min-size: &#x8868;&#x793A;&#x8FD0;&#x884C;AOF&#x91CD;&#x5199;&#x65F6;&#x6587;&#x4EF6;&#x6700;&#x5C0F;&#x4F53;&#x79EF;&#xFF0C;&#x9ED8;&#x8BA4; &#x4E3A;64MB&#x3002; </p>
</li>
<li><p>auto-aof-rewrite-percentage: &#x4EE3;&#x8868;&#x5F53;&#x524D;AOF&#x6587;&#x4EF6;&#x7A7A;&#x95F4; &#xFF08;aof_current_size&#xFF09;&#x548C;&#x4E0A;&#x4E00;&#x6B21;&#x91CD;&#x5199;&#x540E;AOF&#x6587;&#x4EF6;&#x7A7A;&#x95F4;&#xFF08;aof_base_size&#xFF09;&#x7684;&#x6BD4;&#x503C;&#x3002; </p>
</li>
<li><p>&#x81EA;&#x52A8;&#x89E6;&#x53D1;&#x65F6;&#x673A;=aof_current_size&gt;auto-aof-rewrite-minsize&amp;&amp;&#xFF08;aof_current_size-aof_base_size&#xFF09;/aof_base_size&gt;=auto-aof-rewritepercentage </p>
</li>
<li><p>&#x5176;&#x4E2D;aof_current_size&#x548C;aof_base_size&#x53EF;&#x4EE5;&#x5728;info Persistence&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x4E2D;&#x67E5;&#x770B;&#x3002; </p>
</li>
</ul>
</li>
</ul>
<h2 id="&#x6062;&#x590D;">3.4. &#x6062;&#x590D;</h2><p><img src="/2020/redis-chi-jiu-hua/reids-aof%E6%81%A2%E5%A4%8D.png" alt></p>
<h2 id="&#x4F18;&#x7F3A;&#x70B9;-1">3.5. &#x4F18;&#x7F3A;&#x70B9;</h2><p><strong>&#x4F18;&#x70B9;:</strong></p>
<ol>
<li>redis&#x610F;&#x5916;&#x7EC8;&#x6B62;&#x540E;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x53EA;&#x4E22;&#x5931;1s&#x7684;&#x6570;&#x636E;</li>
<li>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6307;&#x4EE4;, &#x53EF;&#x8BFB;&#x6027;&#x5F3A;</li>
</ol>
<p><strong>&#x7F3A;&#x70B9;:</strong></p>
<ol>
<li>&#x751F;&#x6210;aof&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x8FC7;&#x5927;</li>
<li>&#x6062;&#x590D;&#x65F6;&#x95F4;&#x957F; </li>
</ol>
<h1 id="&#x5F00;&#x542F;&#x6DF7;&#x5408;&#x6301;&#x4E45;&#x5316;">4. &#x5F00;&#x542F;&#x6DF7;&#x5408;&#x6301;&#x4E45;&#x5316;</h1><blockquote>
<p>4.0&#x7248;&#x672C;&#x7684;&#x6DF7;&#x5408;&#x6301;&#x4E45;&#x5316;&#x9ED8;&#x8BA4;&#x5173;&#x95ED;&#x7684;&#xFF0C;&#x901A;&#x8FC7;aof-use-rdb-preamble&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x63A7;&#x5236;&#xFF0C;yes&#x5219;&#x8868;&#x793A;&#x5F00;&#x542F;&#xFF0C;no&#x8868;&#x793A;&#x7981;&#x7528;&#xFF0C;5.0&#x4E4B;&#x540E;&#x9ED8;&#x8BA4;&#x5F00;&#x542F;&#x3002;</p>
</blockquote>
<p>&#x6DF7;&#x5408;&#x6301;&#x4E45;&#x5316;&#x662F;&#x901A;&#x8FC7;bgrewriteaof&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5F53;&#x5F00;&#x542F;&#x6DF7;&#x5408;&#x6301;&#x4E45;&#x5316;&#x65F6;&#xFF0C;fork&#x51FA;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x5148;&#x5C06;&#x5171;&#x4EAB;&#x7684;&#x5185;&#x5B58;&#x526F;&#x672C;&#x5168;&#x91CF;&#x7684;&#x4EE5;RDB&#x65B9;&#x5F0F;&#x5199;&#x5165;aof&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5C06;&#x91CD;&#x5199;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x589E;&#x91CF;&#x547D;&#x4EE4;&#x4EE5;AOF&#x65B9;&#x5F0F;&#x5199;&#x5165;&#x5230;&#x6587;&#x4EF6;&#xFF0C;&#x5199;&#x5165;&#x5B8C;&#x6210;&#x540E;&#x901A;&#x77E5;&#x4E3B;&#x8FDB;&#x7A0B;&#x66F4;&#x65B0;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x5C06;&#x65B0;&#x7684;&#x542B;&#x6709;RDB&#x683C;&#x5F0F;&#x548C;AOF&#x683C;&#x5F0F;&#x7684;AOF&#x6587;&#x4EF6;&#x66FF;&#x6362;&#x65E7;&#x7684;&#x7684;AOF&#x6587;&#x4EF6;&#x3002;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#xFF1A;&#x65B0;&#x7684;AOF&#x6587;&#x4EF6;&#x524D;&#x534A;&#x6BB5;&#x662F;RDB&#x683C;&#x5F0F;&#x7684;&#x5168;&#x91CF;&#x6570;&#x636E;&#x540E;&#x534A;&#x6BB5;&#x662F;AOF&#x683C;&#x5F0F;&#x7684;&#x589E;&#x91CF;&#x6570;&#x636E;&#xFF0C;</p>
<h2 id="&#x4F18;&#x7F3A;&#x70B9;-2">4.1. &#x4F18;&#x7F3A;&#x70B9;</h2><p><strong>&#x4F18;&#x70B9;:</strong> &#x6DF7;&#x5408;&#x6301;&#x4E45;&#x5316;&#x7ED3;&#x5408;&#x4E86;RDB&#x6301;&#x4E45;&#x5316; &#x548C; AOF &#x6301;&#x4E45;&#x5316;&#x7684;&#x4F18;&#x70B9;, &#x7531;&#x4E8E;&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x90FD;&#x662F;RDB&#x683C;&#x5F0F;&#xFF0C;&#x52A0;&#x8F7D;&#x901F;&#x5EA6;&#x5FEB;&#xFF0C;&#x540C;&#x65F6;&#x7ED3;&#x5408;AOF&#xFF0C;&#x589E;&#x91CF;&#x7684;&#x6570;&#x636E;&#x4EE5;AOF&#x65B9;&#x5F0F;&#x4FDD;&#x5B58;&#x4E86;&#xFF0C;&#x6570;&#x636E;&#x66F4;&#x5C11;&#x7684;&#x4E22;&#x5931;&#x3002;</p>
<p><strong>&#x7F3A;&#x70B9;</strong> &#x517C;&#x5BB9;&#x6027;&#x5DEE;&#xFF0C;&#x4E00;&#x65E6;&#x5F00;&#x542F;&#x4E86;&#x6DF7;&#x5408;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x5728;4.0&#x4E4B;&#x524D;&#x7248;&#x672C;&#x90FD;&#x4E0D;&#x8BC6;&#x522B;&#x8BE5;aof&#x6587;&#x4EF6;&#xFF0C;&#x540C;&#x65F6;&#x7531;&#x4E8E;&#x524D;&#x90E8;&#x5206;&#x662F;RDB&#x683C;&#x5F0F;&#xFF0C;&#x9605;&#x8BFB;&#x6027;&#x8F83;&#x5DEE;</p>
<h1 id="&#x6CE8;&#x610F;&#x4E8B;&#x9879;">5. &#x6CE8;&#x610F;&#x4E8B;&#x9879;</h1><p>redis&#x4ECE;rdb&#x6301;&#x4E45;&#x5316;&#x5207;&#x6362;&#x4E3A;aof&#x4F1A;&#x5BFC;&#x81F4;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x5168;&#x90E8;&#x4E22;&#x5931;, &#x9700;&#x8981;&#x5148;&#x5728;redis&#x63A7;&#x5236;&#x53F0;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x5207;&#x6362;&#x4E3A;aof&#x751F;&#x6210;aof&#x6587;&#x4EF6;, &#x7136;&#x540E;&#x9000;&#x51FA;,&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;,&#x518D;&#x91CD;&#x65B0;&#x542F;&#x52A8;</p>
<blockquote>
<p>&#x90E8;&#x5206;&#x6458;&#x6284;&#x81EA;<a href="https://www.jianshu.com/p/d3ba7b8ad964" target="_blank" rel="noopener">Redis&#x6301;&#x4E45;&#x5316;</a></p>
</blockquote>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
  </entry>
  <entry>
    <title>布隆过滤器</title>
    <url>/2020/bloom-filter/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p>&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;&#xFF08;Bloom Filter&#xFF09;&#x662F;1970&#x5E74;&#x7531;&#x5E03;&#x9686;&#x63D0;&#x51FA;&#x7684;&#x3002;&#x5B83;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x957F;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5411;&#x91CF;&#x548C;&#x4E00;&#x7CFB;&#x5217;&#x968F;&#x673A;&#x6620;&#x5C04;&#x51FD;&#x6570;&#x3002;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x68C0;&#x7D22;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x662F;&#x5426;&#x5728;&#x4E00;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x3002;&#x5B83;&#x7684;&#x4F18;&#x70B9;&#x662F;&#x7A7A;&#x95F4;&#x6548;&#x7387;&#x548C;&#x67E5;&#x8BE2;&#x65F6;&#x95F4;&#x90FD;&#x6BD4;&#x4E00;&#x822C;&#x7684;&#x7B97;&#x6CD5;&#x8981;&#x597D;&#x7684;&#x591A;&#xFF0C;&#x7F3A;&#x70B9;&#x662F;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x8BEF;&#x8BC6;&#x522B;&#x7387;&#x548C;&#x5220;&#x9664;&#x56F0;&#x96BE;&#x3002;(&#x6765;&#x6E90;:&#x767E;&#x5EA6;&#x767E;&#x79D1;)</p>
</blockquote>
<h2 id="&#x662F;&#x4EC0;&#x4E48;">1.1. &#x662F;&#x4EC0;&#x4E48;</h2><p>&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x4E00;&#x4E2A;&#x5F88;&#x957F;&#x7684;&#x6570;&#x7EC4;, &#x5C06;&#x5927;&#x6279;&#x91CF;&#x7684;&#x6570;&#x636E;&#x521D;&#x59CB;&#x5316;&#x8FDB;&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#x540E;, &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5728;&#x8FD9;&#x4E00;&#x5927;&#x6279;&#x6570;&#x636E;&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;.<br>&#x5982;&#x679C;&#x5224;&#x65AD;&#x7ED3;&#x679C;&#x4E3A;&#x5B58;&#x5728;, &#x90A3;&#x4E48;&#x6709;&#x53EF;&#x80FD;&#x5B58;&#x5728;, &#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x4E0D;&#x5B58;&#x5728;; &#x5982;&#x679C;&#x5224;&#x65AD;&#x7ED3;&#x679C;&#x4E3A;&#x4E0D;&#x5B58;&#x5728;, &#x90A3;&#x4E48;&#x5B83;&#x80AF;&#x5B9A;&#x4E0D;&#x5B58;&#x5728;</p>
<a id="more"></a>

<h2 id="&#x6709;&#x4EC0;&#x4E48;&#x7528;">1.2. &#x6709;&#x4EC0;&#x4E48;&#x7528;</h2><ol>
<li>&#x89E3;&#x51B3;redis&#x7F13;&#x5B58;&#x7A7F;&#x900F;&#x95EE;&#x9898;<ol>
<li>&#x5148;&#x5C06;&#x6570;&#x636E;&#x521D;&#x59CB;&#x5316;&#x8FDB;&#x8FC7;&#x6EE4;&#x5668;</li>
<li>&#x8BF7;&#x6C42;&#x6765;&#x4E86;&#x5148;&#x7528;&#x8FC7;&#x6EE4;&#x5668;&#x5224;&#x65AD;&#x6709;&#x6CA1;&#x6709;<ul>
<li>&#x6CA1;&#x6709; -&gt; &#x76F4;&#x63A5;&#x8FD4;&#x56DE;</li>
<li>&#x6709; -&gt; &#x4E0B;&#x4E00;&#x6B65;</li>
</ul>
</li>
<li>&#x67E5;&#x8BE2;redis<ul>
<li>&#x6CA1;&#x6709; -&gt; &#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5E93;<ul>
<li>&#x6570;&#x636E;&#x5E93;&#x6709; -&gt; &#x52A0;&#x5165;redis&#x5E76;&#x8FD4;&#x56DE;</li>
<li>&#x6570;&#x636E;&#x5E93;&#x6CA1;&#x6709; -&gt; &#x52A0;&#x5165;redis&#x4E00;&#x4E2A;n&#x79D2;&#x4EE5;&#x5185;&#x7684;&#x968F;&#x673A;&#x65F6;&#x95F4;&#x7684;&#x7A7A;&#x5BF9;&#x8C61;&#x5E76;&#x8FD4;&#x56DE;</li>
</ul>
</li>
<li>&#x6709; -&gt; &#x76F4;&#x63A5;&#x8FD4;&#x56DE;</li>
</ul>
</li>
</ol>
</li>
<li>&#x7F51;&#x9875;url&#x53BB;&#x91CD;</li>
<li>&#x5783;&#x573E;&#x90AE;&#x4EF6;</li>
</ol>
<h1 id="&#x539F;&#x7406;">2. &#x539F;&#x7406;</h1><blockquote>
<p>&#x56FE;&#x7247;&#x4E2D;&#x9EC4;&#x8272;&#x4EE3;&#x8868;1, &#x767D;&#x8272;&#x4EE3;&#x8868;0</p>
</blockquote>
<ol>
<li>&#x9996;&#x5148;&#x521B;&#x5EFA;&#x5982;&#x4E0B;&#x4E00;&#x4E2A;&#x5168;&#x4E3A;0&#x7684;&#x56FA;&#x5B9A;&#x957F;&#x5EA6;&#x7684;&#x6570;&#x7EC4;</li>
</ol>
<p><img src="/2020/bloom-filter/bloom-%E6%9C%80%E5%88%9D.png" alt></p>
<ol start="2">
<li>&#x5411;&#x6570;&#x7EC4;&#x4E2D;&#x63D2;&#x5165;1&#x6761;&#x6570;&#x636E;, &#x63D2;&#x5165;&#x65F6;&#x5148;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;&#x5F97;&#x5230;n&#x4E2A;&#x4E0B;&#x6807;&#x4F4D;&#x7F6E;, &#x7136;&#x540E;&#x5C06;&#x8FD9;&#x4E9B;&#x4F4D;&#x7F6E;&#x7684;&#x503C;&#x4FEE;&#x6539;&#x4E3A;1. &#x5982;&#x56FE;&#x6240;&#x793A;&#x6807;&#x9EC4;&#x7684;&#x4F4D;&#x7F6E;&#x4E3A;&#x8BA1;&#x7B97;&#x51FA;1&#x6240;&#x5728;&#x7684;&#x4E0B;&#x6807;</li>
</ol>
<p><img src="/2020/bloom-filter/bloom-%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE.png" alt></p>
<ol start="3">
<li><p>&#x5C06;&#x6570;&#x636E;&#x5168;&#x90E8;&#x521D;&#x59CB;&#x5316;&#x5165;&#x6570;&#x7EC4;, &#x5982;&#x679C;&#x8BA1;&#x7B97;&#x51FA;&#x7684;&#x4E0B;&#x6807;&#x4F4D;&#x7F6E;&#x5DF2;&#x7ECF;&#x4E3A;1, &#x90A3;&#x4E48;&#x4FDD;&#x6301;1&#x4E0D;&#x53D8;<br><img src="/2020/bloom-filter/bloom-%E5%88%9D%E5%A7%8B%E5%8C%96.png" alt></p>
</li>
<li><p>&#x8FDB;&#x884C;&#x67E5;&#x8BE2;:</p>
<ul>
<li><strong>&#x67E5;&#x8BE2;3<code>&#x5B58;&#x5728;</code>, &#x8BA1;&#x7B97;&#x5F97;&#x51FA;&#x7684;n&#x4E2A;&#x4E0B;&#x6807;&#x4F4D;&#x7F6E;&#x5168;&#x4E3A;1, &#x5219;3&#x53EF;&#x80FD;&#x5B58;&#x5728;</strong><br><img src="/2020/bloom-filter/bloom-%E5%AD%98%E5%9C%A8.png" alt></li>
<li><strong>&#x67E5;&#x8BE2;7<code>&#x4E0D;&#x5B58;&#x5728;</code>, &#x8BA1;&#x7B97;&#x5F97;&#x51FA;&#x7684;n&#x4E2A;&#x4E0B;&#x6807;&#x4F4D;&#x7F6E;&#x5168;&#x4E3A;1, &#x5219;7&#x53EF;&#x80FD;&#x5B58;&#x5728;</strong><br><img src="/2020/bloom-filter/bloom-%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8.png" alt></li>
<li><strong>&#x67E5;&#x8BE2;9<code>&#x4E0D;&#x5B58;&#x5728;</code>, &#x8BA1;&#x7B97;&#x5F97;&#x51FA;&#x7684;n&#x4E2A;&#x4E0B;&#x6807;&#x4F4D;&#x7F6E;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x4E3A;0, &#x5219;9&#x7EDD;&#x5BF9;&#x4E0D;&#x5B58;&#x5728;</strong><br><img src="/2020/bloom-filter/bloom-%E4%B8%8D%E5%AD%98%E5%9C%A8.png" alt></li>
</ul>
</li>
</ol>
<h1 id="&#x601D;&#x8003;">3. &#x601D;&#x8003;</h1><ol>
<li>&#x5F71;&#x54CD;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;&#x67E5;&#x8BE2;&#x5230;&#x4E0D;&#x5B58;&#x5728;&#x6570;&#x636E;&#x5374;&#x53CD;&#x56DE;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x7684;&#x8282;&#x70B9;&#x5728;&#x54EA;&#x4E9B;&#x5730;&#x65B9;&#x5462;?<ul>
<li>&#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;(&#x957F;&#x5EA6;&#x8D8A;&#x957F;&#x8BEF;&#x5DEE;&#x8D8A;&#x5C0F;)</li>
<li>&#x8BA1;&#x7B97;&#x4E0B;&#x6807;&#x7684;hash&#x7B97;&#x6CD5;</li>
</ul>
</li>
<li>&#x4ECE;&#x539F;&#x7406;&#x4E0A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5206;&#x6790;&#x51FA;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x5220;&#x9664;&#x7684;, &#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5B9A;&#x671F;&#x7684;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;&#x6765;&#x66FF;&#x6362;&#x4E4B;&#x524D;&#x7684;</li>
</ol>
<blockquote>
<p>&#x4E0A;&#x56FE;&#x5DE5;&#x5177;&#x5F88;&#x76F4;&#x89C2;. &#x9700;&#x8981;&#x8BF7;&#x81EA;&#x53D6;<br>&#x94FE;&#x63A5;:<a href="https://pan.baidu.com/s/1C3n4cmdUJPolqJ0v0uDifQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1C3n4cmdUJPolqJ0v0uDifQ</a>  &#x5BC6;&#x7801;:1tzq</p>
</blockquote>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
  </entry>
  <entry>
    <title>并发9:Condition源码解析</title>
    <url>/2020/condition-yuan-ma-jie-xi/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p><code>Condition</code> &#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x6709;&#x4E24;&#x4E2A;, &#x672C;&#x7BC7;&#x53EA;&#x4ECB;&#x7ECD; <code>AbstractQueuedSynchronizer</code> &#x4E2D;&#x7684;&#x5B9E;&#x73B0; <code>ConditionObject</code></p>
</blockquote>
<p>&#x901A;&#x8FC7;&#x4E0A;&#x4E00;&#x7BC7;<code>Condition&#x4ECB;&#x7ECD;&#x53CA;&#x4F7F;&#x7528;</code>&#x6211;&#x4EEC;&#x770B;&#x5230;&#x5728;&#x521B;&#x5EFA;<code>Condition</code>&#x5BF9;&#x8C61;&#x65F6;&#x8C03;&#x7528;&#x7684;&#x662F;&#x2019;newCondition()&#x2019;, &#x5E76;&#x4E14; <code>Condition</code>&#x53EA;&#x80FD;&#x5728;<code>lock</code>&#x9501;&#x5185;&#x4F7F;&#x7528;, &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5927;&#x80C6;&#x731C;&#x60F3;: </p>
<ol>
<li><code>Condition</code> &#x548C;<code>AQS</code>&#x76F8;&#x4F3C;, &#x5185;&#x90E8;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x7ED3;&#x6784;</li>
<li>&#x5728;&#x8C03;&#x7528;<code>#await</code>&#x65B9;&#x6CD5;&#x65F6;&#x4F1A;&#x5C06;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4ECE;<code>AQS</code>&#x5217;&#x961F;&#x4E2D;&#x53D6;&#x51FA;, &#x52A0;&#x5165;&#x5230;<code>Condition</code>&#x7684;&#x5217;&#x961F;&#x4E2D;</li>
<li>&#x5728;&#x8C03;&#x7528;<code>#signal</code>&#x65B9;&#x6CD5;&#x65F6;, &#x4F1A;&#x5C06;&#x7EBF;&#x7A0B;&#x4ECE;<code>Condition</code>&#x4E2D;&#x53D6;&#x51FA;&#x7B2C;&#x4E00;&#x4E2A;, &#x52A0;&#x5165;&#x5230;<code>AQS</code>&#x5217;&#x961F;&#x4E2D;</li>
<li>&#x5728;&#x8C03;&#x7528;<code>#signalAll</code>&#x65B9;&#x6CD5;&#x65F6;, &#x4F1A;&#x5C06;&#x7EBF;&#x7A0B;&#x4ECE;<code>Condition</code>&#x4E2D;&#x53D6;&#x51FA;&#x5168;&#x90E8;&#x7EBF;&#x7A0B;, &#x52A0;&#x5165;&#x5230;<code>AQS</code>&#x5217;&#x961F;&#x4E2D;</li>
<li>&#x5728;&#x63D2;&#x5165;<code>AQS</code>&#x5217;&#x961F;&#x524D;&#x53EF;&#x80FD;&#x4F1A;&#x4F9D;&#x636E;&#x516C;&#x5E73;&#x9501;or&#x975E;&#x516C;&#x5E73;&#x9501;&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x7ADE;&#x4E89;&#x9501;&#x540E;&#x63D2;&#x5165; <code>[Doug Lea &#x8BF4;&#x6211;&#x8FD9;&#x6761;&#x731C;&#x9519;&#x4E86;]</code></li>
</ol>
<a id="more"></a>

<h1 id="&#x7C7B;&#x7ED3;&#x6784;">2. &#x7C7B;&#x7ED3;&#x6784;</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Condition</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">signal</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">signalAll</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Lock</span> </span>{</span><br><span class="line">    <span class="function">Condition <span class="title">newCondition</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReentrantLock</span> <span class="keyword">implements</span> <span class="title">Lock</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sync.newCondition();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>{</span><br><span class="line">        <span class="function"><span class="keyword">final</span> ConditionObject <span class="title">newCondition</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ConditionObject();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractQueuedSynchronizer</span></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConditionObject</span> <span class="keyword">implements</span> <span class="title">Condition</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">transient</span> Node firstWaiter;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">transient</span> Node lastWaiter;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ConditionObject</span><span class="params">()</span> </span>{ }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>{</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#x56E0;&#x4E3A;&#x8D85;&#x65F6;&#x6216;&#x8005;&#x4E2D;&#x65AD;&#xFF0C;&#x8282;&#x70B9;&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;&#x53D6;&#x6D88;&#x72B6;&#x6001;&#xFF0C;&#x88AB;&#x53D6;&#x6D88;&#x7684;&#x8282;&#x70B9;&#x65F6;&#x4E0D;&#x4F1A;&#x53C2;&#x4E0E;&#x5230;&#x7ADE;&#x4E89;&#x4E2D;&#x7684;&#xFF0C;&#x4ED6;&#x4F1A;&#x4E00;&#x76F4;&#x4FDD;&#x6301;&#x53D6;&#x6D88;&#x72B6;&#x6001;&#x4E0D;&#x4F1A;&#x8F6C;&#x53D8;&#x4E3A;&#x5176;&#x4ED6;&#x72B6;&#x6001;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CANCELLED =  <span class="number">1</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#x540E;&#x7EE7;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x5904;&#x4E8E;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x5982;&#x679C;&#x91CA;&#x653E;&#x4E86;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6216;&#x8005;&#x88AB;&#x53D6;&#x6D88;&#xFF0C;&#x5C06;&#x4F1A;&#x901A;&#x77E5;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#xFF0C;&#x4F7F;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x5F97;&#x4EE5;&#x8FD0;&#x884C;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIGNAL    = -<span class="number">1</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#x8282;&#x70B9;&#x5728;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x8282;&#x70B9;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x5728;Condition&#x4E0A;&#xFF0C;&#x5F53;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5BF9;Condition&#x8C03;&#x7528;&#x4E86;signal()&#x540E;&#xFF0C;&#x8BE5;&#x8282;&#x70B9;&#x5C06;&#x4F1A;&#x4ECE;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#x8F6C;&#x79FB;&#x5230;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x52A0;&#x5165;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x83B7;&#x53D6;&#x4E2D;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONDITION = -<span class="number">2</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#x8868;&#x793A;&#x4E0B;&#x4E00;&#x6B21;&#x5171;&#x4EAB;&#x5F0F;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x83B7;&#x53D6;&#xFF0C;&#x5C06;&#x4F1A;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x4F20;&#x64AD;&#x4E0B;&#x53BB;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PROPAGATE = -<span class="number">3</span>;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/** &#x7B49;&#x5F85;&#x72B6;&#x6001; */</span></span><br><span class="line">        <span class="keyword">volatile</span> <span class="keyword">int</span> waitStatus;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/** &#x524D;&#x9A71;&#x8282;&#x70B9;&#xFF0C;&#x5F53;&#x8282;&#x70B9;&#x6DFB;&#x52A0;&#x5230;&#x540C;&#x6B65;&#x961F;&#x5217;&#x65F6;&#x88AB;&#x8BBE;&#x7F6E;&#xFF08;&#x5C3E;&#x90E8;&#x6DFB;&#x52A0;&#xFF09; */</span></span><br><span class="line">        <span class="keyword">volatile</span> Node prev;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/** &#x540E;&#x7EE7;&#x8282;&#x70B9; */</span></span><br><span class="line">        <span class="keyword">volatile</span> Node next;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/** &#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x540E;&#x7EED;&#x8282;&#x70B9;&#x3002;&#x5982;&#x679C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x5171;&#x4EAB;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x5B57;&#x6BB5;&#x5C06;&#x662F;&#x4E00;&#x4E2A; SHARED &#x5E38;&#x91CF;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x8282;&#x70B9;&#x7C7B;&#x578B;&#xFF08;&#x72EC;&#x5360;&#x548C;&#x5171;&#x4EAB;&#xFF09;&#x548C;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x540E;&#x7EED;&#x8282;&#x70B9;&#x5171;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5; */</span></span><br><span class="line">        Node nextWaiter;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x4ECE;&#x7C7B;&#x7ED3;&#x6784;&#x4E0A;&#x6765;&#x770B;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x731C;&#x9519;, <code>ConditionObject</code> &#x5185;&#x90E8;&#x6784;&#x6210;&#x7684;&#x4E5F;&#x662F;<code>Node</code>&#x5BF9;&#x8C61;,&#x8BC1;&#x660E;&#x731C;&#x60F3;1 &#x662F;&#x5BF9;&#x7684;!</p>
<blockquote>
<p>&#x6709;&#x4E00;&#x4E2A;&#x5C0F;&#x7EC6;&#x8282;, &#x8FD9;&#x91CC;&#x7684;<code>Node</code>&#x5BF9;&#x8C61;&#x53EA;&#x52A0;&#x4E86;<code>transient</code> &#x53CD;&#x5E8F;&#x5217;&#x5316;, &#x800C;&#x6CA1;&#x6709;&#x52A0;<code>volatile</code>. &#x8FD9;&#x662F;&#x56E0;&#x4E3A;<code>Condition</code>&#x662F;&#x5728;lock&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;, &#x4E5F;&#x5C31;&#x662F;<code>#lock</code>&#x548C;<code>#unLock</code>&#x4E4B;&#x95F4;, &#x5728;&#x8FD9;&#x91CC;&#x8FD0;&#x884C;&#x7684;&#x7A0B;&#x5E8F;&#x56E0;&#x4E3A;&#x52A0;&#x4E86;&#x9501;,&#x6240;&#x4EE5;&#x90FD;&#x662F;&#x5355;&#x7EBF;&#x7A0B;&#x7684;</p>
</blockquote>
<h1 id="&#x6E90;&#x7801;">3. &#x6E90;&#x7801;</h1><h2 id="conditionObject-await">3.1. conditionObject.await()</h2><blockquote>
<p>&#x5C06;&#x6570;&#x636E;&#x6DFB;&#x52A0;&#x81F3;<code>Condition</code>&#x7B49;&#x5F85;&#x5217;&#x961F;&#x4E2D;,&#x5E76;&#x91CA;&#x653E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;,&#x5F53;&#x7EBF;&#x7A0B;&#x88AB;&#x5524;&#x9192;&#x540E;&#x4ECE;<code>&#x203B;</code>&#x4F4D;&#x7F6E;&#x5F00;&#x59CB;&#x62A2;&#x5360;&#x9501;&#x7EE7;&#x7EED;&#x5411;&#x4E0B;&#x6267;&#x884C;</p>
</blockquote>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">ConditionObject</span> <span class="symbol">implements</span> <span class="symbol">Condition</span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="built_in">void</span> await() throws InterruptedException {</span><br><span class="line">        <span class="keyword">if</span> (Thread.<span class="built_in">int</span>errupted())</span><br><span class="line">            throw new InterruptedException();</span><br><span class="line">        <span class="comment">// 1. &#x52A0;&#x5165; Condition &#x5217;&#x961F;, &#x5E76;&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;node&#x5BF9;&#x8C61;</span></span><br><span class="line">        Node node = addConditionWaiter();</span><br><span class="line">        <span class="comment">// 2. &#x91CA;&#x653E;&#x9501;&#x5E76;&#x5C06;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x4ECE;AQS&#x5217;&#x961F;&#x4E2D;&#x79FB;&#x51FA;,&#x5E76;&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x91CD;&#x5165;&#x6B21;&#x6570;state</span></span><br><span class="line">        <span class="built_in">int</span> savedState = fullyRelease(node);</span><br><span class="line">        <span class="built_in">int</span> <span class="built_in">int</span>erruptMode = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 3. &#x5FAA;&#x73AF;&#x5224;&#x65AD;&#x6B64;node&#x662F;&#x5426;&#x5728;AQS&#x5217;&#x961F;&#x4E2D;, &#x5982;&#x679C;&#x4E0D;&#x5728;&#x5219;park</span></span><br><span class="line">        <span class="keyword">while</span> (!isOnSyncQueue(node)) {</span><br><span class="line">            LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">            <span class="comment">// &#x7EBF;&#x7A0B;&#x4E2D;&#x65AD;&#x76F8;&#x5173;,&#x7565;&#x8FC7;</span></span><br><span class="line">            <span class="keyword">if</span> ((<span class="built_in">int</span>erruptMode = checkInterruptWhileWaiting(node)) != <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// &#x203B; &#x5230;&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;&#x8BF4;&#x660E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x88AB;unpark&#x4E86;</span></span><br><span class="line">        <span class="comment">// acquireQueued &#x81EA;&#x65CB;&#x83B7;&#x53D6;&#x9501;&#x5E76;&#x8FD4;&#x56DE;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x4E2D;&#x65AD;(AQS&#x6709;&#x8BB2;&#x8FC7;)</span></span><br><span class="line">        <span class="keyword">if</span> (acquireQueued(node, savedState) &amp;&amp; <span class="built_in">int</span>erruptMode != THROW_IE)</span><br><span class="line">            <span class="built_in">int</span>erruptMode = REINTERRUPT;</span><br><span class="line">        <span class="comment">// &#x79FB;&#x9664;&#x88AB;&#x53D6;&#x6D88;&#x7684;&#x8282;&#x70B9;</span></span><br><span class="line">        <span class="keyword">if</span> (node.nextWaiter != <span class="literal">null</span>) <span class="comment">// clean up if cancelled</span></span><br><span class="line">            unlinkCancelledWaiters();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">int</span>erruptMode != <span class="number">0</span>)</span><br><span class="line">            <span class="comment">// &#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x88AB;&#x4E2D;&#x65AD;&#xFF0C;&#x5219;&#x6839;&#x636E;&#x4E4B;&#x524D;&#x83B7;&#x53D6;&#x7684;interruptMode&#x7684;&#x503C;&#x6765;&#x5224;&#x65AD;&#x662F;&#x7EE7;&#x7EED;&#x4E2D;&#x65AD;&#x8FD8;&#x662F;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span></span><br><span class="line">            reportInterruptAfterWait(<span class="built_in">int</span>erruptMode);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="addConditionWaiter">3.1.1. addConditionWaiter()</h3><blockquote>
<p>&#x52A0;&#x5165; <code>Condition</code> &#x5217;&#x961F;, &#x5E76;&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;node&#x5BF9;&#x8C61;, <strong>&#x6CE8;&#x610F;: &#x5728;<code>Condition</code>&#x4E0D;&#x4E3A;&#x7A7A;&#x65F6;&#x6DFB;&#x52A0;&#x7684;&#x662F;<code>nextWaiter</code>&#x5B57;&#x6BB5;, &#x800C;<code>AQS</code>&#x4F7F;&#x7528;&#x7684;&#x662F;<code>pre</code>&#x548C;<code>next</code></strong></p>
</blockquote>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">class ConditionObject implements Condition{</span><br><span class="line">    private <span class="keyword">Node</span> <span class="title">addConditionWaiter</span>() {</span><br><span class="line">        // Condition &#x5217;&#x961F;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8282;&#x70B9;</span><br><span class="line">        <span class="keyword">Node</span> <span class="title">t</span> = lastWaiter;</span><br><span class="line">        // &#x5982;&#x679C;Condition &#x5217;&#x961F;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x88AB;&#x53D6;&#x6D88;&#x5219;&#x904D;&#x5386;&#x5220;&#x9664;&#x53D6;&#x6D88;&#x7684;&#x8282;&#x70B9;</span><br><span class="line">        if (t != null &amp;&amp; t.waitStatus != <span class="keyword">Node</span>.<span class="title">CONDITION</span>) {</span><br><span class="line">            unlinkCancelledWaiters();</span><br><span class="line">            t = lastWaiter;</span><br><span class="line">        }</span><br><span class="line">        // &#x5C06;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6784;&#x9020;&#x51FA;&#x4E00;&#x4E2A;<span class="keyword">node</span> <span class="title">, &#x7B49;&#x5F85;&#x6807;&#x8BC6;&#x4E3A; -2</span> (&#x7B49;&#x5F85;)</span><br><span class="line">        <span class="keyword">Node</span> <span class="title">node</span> = new <span class="keyword">Node</span><span class="title">(Thread</span>.currentThread(), <span class="keyword">Node</span>.<span class="title">CONDITION</span>);</span><br><span class="line">        // &#x5217;&#x961F;&#x4E3A;&#x7A7A;&#x5219;&#x76F4;&#x63A5;&#x8D4B;&#x503C;</span><br><span class="line">        if (t == null)</span><br><span class="line">            firstWaiter = <span class="keyword">node</span><span class="title">;</span></span><br><span class="line"><span class="title">        else</span></span><br><span class="line">            t.nextWaiter = <span class="keyword">node</span><span class="title">;</span></span><br><span class="line"><span class="title">        lastWaiter</span> = <span class="keyword">node</span><span class="title">;</span></span><br><span class="line"><span class="title">        // &#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;node</span></span><br><span class="line">        return <span class="keyword">node</span><span class="title">;</span></span><br><span class="line"><span class="title">    }</span></span><br><span class="line"><span class="title">}</span></span><br></pre></td></tr></table></figure>

<h3 id="fullyRelease-node">3.1.2. fullyRelease(node)</h3><blockquote>
<p>&#x91CA;&#x653E;&#x9501;,&#x5E76;&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x91CD;&#x5165;&#x6B21;&#x6570;&#x7684;status</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConditionObject</span> <span class="keyword">implements</span> <span class="title">Condition</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">fullyRelease</span><span class="params">(Node node)</span> </span>{</span><br><span class="line">        <span class="comment">// &#x89E3;&#x9501;&#x662F;&#x5426;&#x6210;&#x529F;&#x7684;&#x6807;&#x8BC6;</span></span><br><span class="line">        <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// 2.1 &#x8FD9;&#x91CC;&#x662F;AQS&#x7684;&#x91CD;&#x5165;&#x6B21;&#x6570;&#x7684;&#x6807;&#x8BC6;</span></span><br><span class="line">            <span class="keyword">int</span> savedState = getState();</span><br><span class="line">            <span class="comment">// &#x89E3;&#x9501;,AQS&#x65B9;&#x6CD5;, &#x524D;&#x9762;&#x8BB2;&#x8FC7;</span></span><br><span class="line">            <span class="keyword">if</span> (release(savedState)) {</span><br><span class="line">                failed = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">return</span> savedState;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">if</span> (failed)</span><br><span class="line">                <span class="comment">// &#x5982;&#x679C;&#x89E3;&#x9501;&#x5931;&#x8D25;&#x4E86;, &#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x72B6;&#x6001;&#x4E3A; 1</span></span><br><span class="line">                node.waitStatus = Node.CANCELLED;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="getState">3.1.2.1. getState()</h4><blockquote>
<p>&#x8FD9;&#x91CC;&#x662F;AQS&#x7684;&#x91CD;&#x5165;&#x6B21;&#x6570;&#x7684;&#x6807;&#x8BC6;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractQueuedSynchronizer</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getState</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="isOnSyncQueue-node">3.1.3. isOnSyncQueue(node)</h3><blockquote>
<p>&#x5224;&#x65AD;&#x8BE5;node&#x662F;&#x5426;&#x5728;AQS&#x5217;&#x961F;&#x4E2D;</p>
</blockquote>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">abstract class AbstractQueuedSynchronizer{</span><br><span class="line">    final boolean isOnSyncQueue(<span class="keyword">Node</span> <span class="title">node</span>) {</span><br><span class="line">        // <span class="number">1</span>. <span class="keyword">node</span>.<span class="title">waitStatus</span> == <span class="keyword">Node</span>.<span class="title">CONDITION</span></span><br><span class="line">        // <span class="number">2</span>. <span class="keyword">node</span>.<span class="title">prev</span> == null</span><br><span class="line">        if (<span class="keyword">node</span>.<span class="title">waitStatus</span> == <span class="keyword">Node</span>.<span class="title">CONDITION</span> || <span class="keyword">node</span>.<span class="title">prev</span> == null)</span><br><span class="line">            return <span class="literal">false</span>;</span><br><span class="line">        // <span class="number">3</span>. <span class="keyword">node</span>.<span class="title">next</span> != null</span><br><span class="line">        if (<span class="keyword">node</span>.<span class="title">next</span> != null) // If has successor, it must be on queue</span><br><span class="line">            return <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">         /*</span><br><span class="line">         * <span class="keyword">node</span>.<span class="title">prev</span> can be non-null, but not yet on queue because</span><br><span class="line">         * the CAS to place it on queue can fail. So we have to</span><br><span class="line">         * traverse from tail to make sure it actually made it.  It</span><br><span class="line">         * will always be near the tail <span class="keyword">in</span> calls to this method, <span class="keyword">and</span></span><br><span class="line">         * unless the CAS failed (which is unlikely), it will be</span><br><span class="line">         * there, so we hardly ever traverse much.</span><br><span class="line">         */</span><br><span class="line">         // &#x904D;&#x5386; AQS &#x5217;&#x961F;, &#x786E;&#x5B9A;&#x662F;&#x5426;&#x5728;&#x5217;&#x961F;&#x4E2D; </span><br><span class="line">        return findNodeFromTail(<span class="keyword">node</span><span class="title">);</span></span><br><span class="line"><span class="title">    }</span></span><br><span class="line"><span class="title">}</span></span><br></pre></td></tr></table></figure>
<ol>
<li>&#x8282;&#x70B9;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x4E3A;&#x7B49;&#x5F85;,&#x90A3;&#x5B83;&#x4E00;&#x5B9A;&#x5728;<code>Condition</code>&#x5217;&#x961F;&#x4E2D;</li>
<li>&#x4F7F;&#x7528;&#x5230;<code>pre</code>&#x5B57;&#x6BB5;&#x7684;&#x53EA;&#x6709;<code>AQS</code>,<code>AQS</code>&#x9664;&#x4E86;&#x4EE3;&#x8868;&#x5F53;&#x524D;&#x83B7;&#x53D6;&#x9501;&#x7EBF;&#x7A0B;&#x7684;&#x5934;&#x7ED3;&#x70B9;,&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x7684;<code>pre</code>&#x5B57;&#x6BB5;&#x90FD;&#x662F;&#x6709;&#x503C;&#x7684;, &#x800C;<code>AQS</code>&#x7684;&#x9996;&#x4E2A;&#x5E76;&#x4E0D;&#x5C5E;&#x4E8E;&#x6392;&#x961F;&#x7684;&#x8282;&#x70B9;; &#x6240;&#x4EE5;&#x5B83;&#x5728;<code>Condition</code>&#x5217;&#x961F;&#x4E2D;</li>
<li>&#x4F7F;&#x7528;&#x5230;<code>next</code>&#x5B57;&#x6BB5;&#x7684;&#x53EA;&#x6709;<code>AQS</code>, <code>next != null</code>&#x8BF4;&#x660E;&#x5728;<code>AQS</code>&#x5217;&#x961F;&#x4E2D;</li>
</ol>
<h4 id="findNodeFromTail-Node-node">3.1.3.1. findNodeFromTail(Node node)</h4><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Returns <span class="literal">true</span> if <span class="keyword">node</span> <span class="title">is</span> on sync queue by searching backwards from tail.</span><br><span class="line"> * &#x5982;&#x679C;&#x8282;&#x70B9;&#x5728;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E0A;&#xFF0C;&#x5219;&#x901A;&#x8FC7;&#x4ECE;&#x5C3E;&#x90E8;&#x5411;&#x540E;&#x641C;&#x7D22;&#x8FD4;&#x56DE;<span class="literal">true</span></span><br><span class="line"> * Called only when needed by isOnSyncQueue.</span><br><span class="line"> * &#x4EC5;&#x4F9B;isOnSyncQueue&#x65B9;&#x6CD5;&#x8C03;&#x7528;</span><br><span class="line"> * @return <span class="literal">true</span> if present</span><br><span class="line"> */</span><br><span class="line">private boolean findNodeFromTail(<span class="keyword">Node</span> <span class="title">node</span>) {</span><br><span class="line">    <span class="keyword">Node</span> <span class="title">t</span> = tail;</span><br><span class="line">    for (;;) {</span><br><span class="line">        if (t == <span class="keyword">node</span><span class="title">)</span></span><br><span class="line"><span class="title">            return</span> <span class="literal">true</span>;</span><br><span class="line">        if (t == null)</span><br><span class="line">            return <span class="literal">false</span>;</span><br><span class="line">        t = t.prev;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5728;&#x5C06;<code>node</code>&#x8FFD;&#x52A0;&#x5230;<code>AQS&#x5217;&#x961F;&#x5C3E;&#x7AEF;&#x65F6;, &#x662F;&#x5148;</code>node.prev = tail<code>,&#x7136;&#x540E;&#x8FDB;&#x884C;cas&#x64CD;&#x4F5C;&#x5C06;</code>node`&#x8282;&#x70B9;&#x8FFD;&#x52A0;&#x5165;&#x5217;&#x961F;&#x7684;.&#x5728;&#x8FD0;&#x884C;&#x6B64;&#x5904;&#x4EE3;&#x7801;&#x65F6;&#x53EF;&#x80FD;&#x5728;cas&#x81EA;&#x65CB;&#x4E2D;. &#x6240;&#x4EE5;&#x9700;&#x8981;&#x4ECE;&#x5C3E;&#x90E8;&#x8FDB;&#x884C;&#x904D;&#x5386;</p>
<blockquote>
<p>&#x6E90;&#x7801;&#x6CE8;&#x91CA;&#x4E0A;&#x5199;&#x9053;: node.prev&#x662F;&#x975E;&#x7A7A;&#x7684;&#xFF0C;&#x4F46;&#x8FD8;&#x6CA1;&#x653E;&#x5728;&#x961F;&#x5217;&#x4E0A;&#xFF0C;&#x56E0;&#x4E3A;&#x5C06;&#x5B83;&#x653E;&#x5728;&#x961F;&#x5217;&#x4E0A;&#x7684;cas&#x53EF;&#x80FD;&#x4F1A;&#x5931;&#x8D25;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x4ECE;&#x5C3E;&#x90E8;&#x5F00;&#x59CB;&#x904D;&#x5386;&#x4EE5;&#x786E;&#x4FDD;&#x5B83;&#x786E;&#x5B9E;&#x6210;&#x529F;&#x4E86;&#x3002;&#x5728;&#x5BF9;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x4E2D;&#xFF0C;&#x5B83;&#x603B;&#x662F;&#x5728;&#x5C3E;&#x90E8;&#x9644;&#x8FD1;&#xFF0C;&#x9664;&#x975E;CAS&#x5931;&#x8D25;(&#x8FD9;&#x662F;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x7684;)&#xFF0C;&#x5426;&#x5219;&#x5B83;&#x5C06;&#x5728;&#x90A3;&#x91CC;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x51E0;&#x4E4E;&#x4E0D;&#x4F1A;&#x904D;&#x5386;&#x592A;&#x591A;&#x3002;(&#x8F6F;&#x4EF6;&#x7FFB;&#x8BD1;&#x7684;,&#x7406;&#x89E3;&#x5C31;&#x597D;)</p>
</blockquote>
<h2 id="conditionObject-signal">3.2. conditionObject.signal()</h2><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="function"><span class="keyword">void</span> <span class="title">signal</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// &#x5224;&#x65AD;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x83B7;&#x53D6;&#x9501;,&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5C31;&#x629B;&#x51FA;&#x5F02;&#x5E38;(&#x65B9;&#x6CD5;&#x5F88;&#x7B80;&#x5355;,&#x4E0D;&#x8D34;&#x4E86;)</span></span><br><span class="line">    <span class="keyword">if</span> (!isHeldExclusively())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">    <span class="comment">// Condition &#x4E2D;&#x9996;&#x4E2A;&#x7B49;&#x5F85;&#x7684;&#x8282;&#x70B9;</span></span><br><span class="line">    Node first = firstWaiter;</span><br><span class="line">    <span class="keyword">if</span> (first != <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">// &#x5B9E;&#x9645;&#x5524;&#x9192;&#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line">        doSignal(first);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="doSignal-first">3.2.1. doSignal(first)</h3><figure class="highlight q"><table><tr><td class="code"><pre><span class="line">private void doSignal(Node <span class="built_in">first</span>) {</span><br><span class="line">    <span class="keyword">do</span> {</span><br><span class="line">        <span class="comment">// &#x5148;&#x628A;firstWaiter&#x7684;&#x7ED9;&#x6539;&#x4E3A;&#x4E0B;&#x4E00;&#x4E2A;&#x7B49;&#x5F85;&#x7684;,&#x5982;&#x679C;&#x4E0B;&#x4E00;&#x4E2A;&#x4E3A;null,&#x90A3;&#x4E48;&#x628A;lastWaiter&#x4E5F;&#x6539;&#x4E3A;null</span></span><br><span class="line">        if ( (firstWaiter = <span class="built_in">first</span>.nextWaiter) == <span class="built_in">null</span>)</span><br><span class="line">            lastWaiter = <span class="built_in">null</span>;</span><br><span class="line">        <span class="comment">// 1. &#x5C06;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x7684;node&#x5355;&#x72EC;&#x62CE;&#x51FA;&#x6765;</span></span><br><span class="line">        <span class="built_in">first</span>.nextWaiter = <span class="built_in">null</span>;</span><br><span class="line">        <span class="comment">// &#x5FAA;&#x73AF;&#x904D;&#x5386;&#x6574;&#x4E2A;Condition&#x5217;&#x961F;</span></span><br><span class="line">        <span class="comment">// 2. transferForSignal(first) &#x8F6C;&#x79FB;&#x8282;&#x70B9;&#x5230;AQS&#x5217;&#x961F;,&#x6210;&#x529F;true,&#x5931;&#x8D25;false</span></span><br><span class="line">    } <span class="keyword">while</span> (!transferForSignal(<span class="built_in">first</span>) &amp;&amp;</span><br><span class="line">             (<span class="built_in">first</span> = firstWaiter) != <span class="built_in">null</span>);</span><br><span class="line">            </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x6CE8;&#x610F;&#x4E0A;&#x65B9;&#x5DF2;&#x7ECF;&#x5C06; firstWaiter &#x7684;&#x503C;&#x7ED9;&#x4FEE;&#x6539;&#x4E86;, &#x6240;&#x4EE5;first&#x548C;firstWaiter&#x6307;&#x5411;&#x7684;&#x4F4D;&#x7F6E;&#x662F;&#x4E0D;&#x540C;&#x7684;, &#x4FEE;&#x6539;first&#x7684;&#x65F6;&#x5019;firstWaiter&#x4E0D;&#x4F1A;&#x6539;&#x53D8;</li>
<li><code>#transferForSignal</code><ul>
<li>&#x5982;&#x679C;&#x6210;&#x529F;&#x4E86;, while&#x7684;&#x6761;&#x4EF6;&#x4E3A;<code>false &amp;&amp; ? = false</code> ;&#x6253;&#x65AD;&#x5FAA;&#x73AF;</li>
<li>&#x5982;&#x679C;&#x5931;&#x8D25;&#x4E86;, while&#x7684;&#x6761;&#x4EF6;&#x4E3A;<code>true&amp;&amp; ?</code><ul>
<li><code>Condition</code> &#x8FD8;&#x6709;&#x7B49;&#x5F85;&#x6570;&#x636E;,<code>true&amp;&amp; true</code>; &#x6267;&#x884C;&#x4E0B;&#x4E00;&#x4E2A;&#x7B49;&#x5F85;&#x6570;&#x636E;</li>
<li><code>Condition</code> &#x6CA1;&#x6709;&#x7B49;&#x5F85;&#x6570;&#x636E;,<code>true&amp;&amp; false</code>; &#x6253;&#x65AD;&#x5FAA;&#x73AF;</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="transferForSignal-first">3.2.1.1. transferForSignal(first)</h4><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">abstract class AbstractQueuedSynchronizer{</span><br><span class="line">    final boolean transferForSignal(<span class="keyword">Node</span> <span class="title">node</span>) {</span><br><span class="line">        /*</span><br><span class="line">         * If cannot change waitStatus, the <span class="keyword">node</span> <span class="title">has</span> been cancelled.</span><br><span class="line">         */</span><br><span class="line">         // <span class="number">1</span>. cas&#x5C06;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x6539;&#x4E3A;<span class="number">0</span>, &#x5982;&#x679C;&#x4FEE;&#x6539;&#x5931;&#x8D25;&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;&#x8282;&#x70B9;&#x88AB;&#x53D6;&#x6D88;&#x4E86;,&#x8FD4;&#x56DE;<span class="literal">false</span></span><br><span class="line">        if (!compareAndSetWaitStatus(<span class="keyword">node</span><span class="title">, Node</span>.CONDITION, <span class="number">0</span>))</span><br><span class="line">            return <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">        /*</span><br><span class="line">         * Splice onto queue <span class="keyword">and</span> try to set waitStatus of predecessor to</span><br><span class="line">         * indicate that thread is (probably) waiting. If cancelled <span class="keyword">or</span></span><br><span class="line">         * attempt to set waitStatus fails, wake up to resync (<span class="keyword">in</span> which</span><br><span class="line">         * case the waitStatus can be transiently <span class="keyword">and</span> harmlessly wrong).</span><br><span class="line">         */</span><br><span class="line">         // &#x63D2;&#x5165;AQS&#x5217;&#x961F;,&#x5E76;&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x5728;AQS&#x4E2D;&#x7684;&#x524D;&#x7F6E;&#x8282;&#x70B9;</span><br><span class="line">        <span class="keyword">Node</span> <span class="title">p</span> = enq(<span class="keyword">node</span><span class="title">);</span></span><br><span class="line"><span class="title">        int</span> ws = p.waitStatus;</span><br><span class="line">        // ws &gt; <span class="number">0</span> &#x524D;&#x7F6E;&#x8282;&#x70B9;&#x88AB;&#x53D6;&#x6D88;</span><br><span class="line">        // <span class="number">2</span>. compareAndSetWaitStatus(p, ws, <span class="keyword">Node</span>.<span class="title">SIGNAL</span>) cas&#x524D;&#x7F6E;&#x8282;&#x70B9;&#x4ECE;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x6539;&#x4E3A;&#x7B49;&#x5F85;</span><br><span class="line">        if (ws &gt; <span class="number">0</span> || !compareAndSetWaitStatus(p, ws, <span class="keyword">Node</span>.<span class="title">SIGNAL</span>))</span><br><span class="line">            LockSupport.unpark(<span class="keyword">node</span>.<span class="title">thread</span>);</span><br><span class="line">        return <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ol>
<li><code>Condition</code> &#x4E2D;&#x7684;waitstatus&#x6709;&#x4E24;&#x79CD;&#x72B6;&#x6001;, &#x7B49;&#x5F85;or&#x53D6;&#x6D88;<ul>
<li>&#x7B49;&#x5F85;:&#x4FEE;&#x6539;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x4E3A;0&#x540E;&#x7EE7;&#x7EED;&#x6267;&#x884C;</li>
<li>&#x53D6;&#x6D88;:<code>doSignal(first)</code>&#x65B9;&#x6CD5;&#x5728;&#x8C03;&#x7528;&#x524D;&#x5DF2;&#x7ECF;&#x628A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x5220;&#x9664;&#x4E86;,&#x8FD4;&#x56DE;false&#x540E;while&#x5FAA;&#x73AF;&#x4F1A;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x4E0B;&#x53BB;,&#x8FD9;&#x65F6;&#x53D6;&#x6D88;&#x7684;&#x8282;&#x70B9;&#x5DF2;&#x7ECF;&#x4E0D;&#x5728;<code>Condition</code>&#x5217;&#x961F;&#x4E2D;&#x4E86;</li>
</ul>
</li>
<li>&#x5982;&#x679C;&#x8FD9;&#x65F6;&#x524D;&#x7F6E;&#x8282;&#x70B9;&#x53D6;&#x6D88;&#x4E86;, &#x5C31;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x540E;&#x9762;&#x7684;cas&#x64CD;&#x4F5C;</li>
</ol>
<h2 id="conditionObject-signalAll">3.3. conditionObject.signalAll()</h2><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="function"><span class="keyword">void</span> <span class="title">signalAll</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (!isHeldExclusively())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">    Node first = firstWaiter;</span><br><span class="line">    <span class="keyword">if</span> (first != <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">// &#x8FD9;&#x91CC;&#x548C;signal()&#x4E0D;&#x540C;, &#x5176;&#x4ED6;&#x4E00;&#x81F4;</span></span><br><span class="line">        doSignalAll(first);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="doSignalAll-Node-first">3.3.1. doSignalAll(Node first)</h3><figure class="highlight q"><table><tr><td class="code"><pre><span class="line">private void doSignalAll(Node <span class="built_in">first</span>) {</span><br><span class="line">    lastWaiter = firstWaiter = <span class="built_in">null</span>;</span><br><span class="line">    <span class="keyword">do</span> {</span><br><span class="line">        Node <span class="built_in">next</span> = <span class="built_in">first</span>.nextWaiter;</span><br><span class="line">        <span class="built_in">first</span>.nextWaiter = <span class="built_in">null</span>;</span><br><span class="line">        transferForSignal(<span class="built_in">first</span>);</span><br><span class="line">        <span class="built_in">first</span> = <span class="built_in">next</span>;</span><br><span class="line">    } <span class="keyword">while</span> (<span class="built_in">first</span> != <span class="built_in">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x76F4;&#x63A5;&#x5FAA;&#x73AF;, <code>Condition</code>&#x4E2D;&#x6570;&#x636E;&#x5168;&#x90E8;&#x8F6C;&#x79FB;&#x5230;<code>AQS</code>&#x5217;&#x961F;&#x4E2D;</p>
<h1 id="&#x603B;&#x7ED3;">4. &#x603B;&#x7ED3;</h1><ol>
<li><code>AQS</code>&#x7684;&#x5217;&#x961F;&#x662F;&#x53CC;&#x5411;&#x94FE;&#x8868;,&#x5E76;&#x4E14;&#x7B2C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;<code>thread</code>&#x4E3A;<code>null</code>&#x4E3A;&#x4EE3;&#x8868;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;;&#x800C;<code>Condition</code>&#x7684;&#x5217;&#x961F;&#x662F;&#x5355;&#x5411;&#x7684;&#x4E00;&#x4E2A;&#x94FE;&#x8868;,</li>
<li><code>Condition</code>&#x63A5;&#x53E3;&#x7684;<code>#await</code>,<code>#signal</code>,<code>#signalAll</code>&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x5FC5;&#x987B;&#x5728;<code>lock</code>&#x5185;&#x6267;&#x884C;</li>
<li><code>Condition</code>&#x4E2D;&#x7684;&#x5217;&#x961F;&#x88AB;&#x5524;&#x9192;&#x540E;&#x662F;&#x6709;&#x5E8F;&#x7684;&#x52A0;&#x5165;&#x5230;<code>AQS</code>&#x5217;&#x961F;&#x4E2D;&#x7684;</li>
<li>&#x4E00;&#x4E2A;<code>lock</code>&#x53EF;&#x4EE5;&#x7EF4;&#x62A4;&#x591A;&#x4E2A;<code>Condition</code>&#x5217;&#x961F;, &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BA9;&#x6307;&#x5B9A;&#x5217;&#x961F;&#x505C;&#x6B62;&#x6216;&#x8FD0;&#x884C;</li>
</ol>
]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
  </entry>
  <entry>
    <title>并发8:Condition介绍及使用</title>
    <url>/2020/condition-jie-shao-use/</url>
    <content><![CDATA[<h1 id="&#x524D;&#x8A00;">1. &#x524D;&#x8A00;</h1><blockquote>
<p>&#x3000;Condition&#x662F;&#x7528;&#x6765;&#x66FF;&#x4EE3;&#x4F20;&#x7EDF;&#x7684;Object&#x7684;wait()&#x3001;notify()&#x7684;&#xFF0C;&#x76F8;&#x6BD4;&#x4F7F;&#x7528;Object&#x7684;wait()&#x3001;notify()&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x95F4;&#x534F;&#x4F5C;&#x66F4;&#x52A0;&#x5B89;&#x5168;&#x548C;&#x9AD8;&#x6548;</p>
</blockquote>
<h1 id="&#x4ECB;&#x7ECD;">2. &#x4ECB;&#x7ECD;</h1><ol>
<li>&#x751F;&#x6210;&#x4E00;&#x4E2A;Condition&#x7684;&#x4EE3;&#x7801;&#x662F;lock.newCondition() </li>
<li>&#x8C03;&#x7528;Condition&#x7684;await()&#x548C;signal()&#x65B9;&#x6CD5;&#xFF0C;&#x90FD;&#x5FC5;&#x987B;&#x5728;lock&#x4E4B;&#x5185;&#xFF0C;&#x5C31;&#x662F;&#x8BF4;&#x5FC5;&#x987B;&#x5728;lock.lock()&#x548C;lock.unlock&#x4E4B;&#x95F4;&#x624D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;</li>
<li>Condition&#x4E2D;&#x7684;await()&#x5BF9;&#x5E94;Object&#x7684;wait()</li>
<li>Condition&#x4E2D;&#x7684;signal()&#x5BF9;&#x5E94;Object&#x7684;notify()</li>
<li>Condition&#x4E2D;&#x7684;signalAll()&#x5BF9;&#x5E94;Object&#x7684;notifyAll()</li>
</ol>
<a id="more"></a>

<h1 id="&#x7B80;&#x5355;&#x7684;&#x4F7F;&#x7528;">3. &#x7B80;&#x5355;&#x7684;&#x4F7F;&#x7528;</h1><h2 id="Object-wait">3.1. Object.wait()</h2><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ConditionDemo1</span> {</span></span><br><span class="line"></span><br><span class="line">   Object lock = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    public static <span class="literal">void</span> main(String[] args) {</span><br><span class="line">        ConditionDemo1 demo = <span class="keyword">new</span> ConditionDemo1();</span><br><span class="line">        <span class="keyword">new</span> Thread<span class="function"><span class="params">(() -&gt; demo.test1())</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        <span class="title">new</span> <span class="title">Thread</span><span class="params">(() -&gt; demo.test2())</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">void</span> <span class="title">test1</span><span class="params">()</span> {</span></span><br><span class="line"><span class="function">        <span class="title">synchronized</span> <span class="params">(lock)</span>{</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;1&#x53F7;  &#x4E0A;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">            <span class="title">try</span> {</span></span><br><span class="line"><span class="function">                <span class="title">lock</span>.<span class="title">wait</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            } <span class="title">catch</span> <span class="params">(InterruptedException e)</span> {</span></span><br><span class="line"><span class="function">                <span class="title">e</span>.<span class="title">printStackTrace</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            }</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;1&#x53F7;  &#x6536;&#x5230;&#x4FE1;&#x53F7;&#x4E0D;&#x7B49;&#x4E86;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">        }</span></span><br><span class="line"><span class="function">        <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;1&#x53F7;  &#x5B8C;&#x5168;&#x91CA;&#x653E;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    <span class="title">void</span> <span class="title">test2</span><span class="params">()</span> {</span></span><br><span class="line"><span class="function">        <span class="title">synchronized</span> <span class="params">(lock)</span>{</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;2&#x53F7;  &#x4E0A;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">            <span class="title">lock</span>.<span class="title">notifyAll</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;2&#x53F7;  &#x53EB;&#x9192;1&#x53F7;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">        }</span></span><br><span class="line"><span class="function">        <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;2&#x53F7;  &#x5B8C;&#x5168;&#x91CA;&#x653E;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">}</span></span><br></pre></td></tr></table></figure>
<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x5982;&#x4E0B;</p>
<ul>
<li>1&#x53F7;  &#x4E0A;&#x9501;</li>
<li>2&#x53F7;  &#x4E0A;&#x9501;</li>
<li>2&#x53F7;  &#x53EB;&#x9192;1&#x53F7;</li>
<li>2&#x53F7;  &#x5B8C;&#x5168;&#x91CA;&#x653E;&#x9501;</li>
<li>1&#x53F7;  &#x6536;&#x5230;&#x4FE1;&#x53F7;&#x4E0D;&#x7B49;&#x4E86;</li>
<li>1&#x53F7;  &#x5B8C;&#x5168;&#x91CA;&#x653E;&#x9501;</li>
</ul>
<h2 id="lock-newCondition">3.2. lock.newCondition()</h2><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ConditionDemo2</span> {</span></span><br><span class="line"></span><br><span class="line">    ReentrantLock lock;</span><br><span class="line">    Condition condition;</span><br><span class="line"></span><br><span class="line">    ConditionDemo2() {</span><br><span class="line">        lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">        condition = lock.newCondition();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static <span class="literal">void</span> main(String[] args) {</span><br><span class="line">        ConditionDemo2 demo = <span class="keyword">new</span> ConditionDemo2();</span><br><span class="line">        <span class="keyword">new</span> Thread<span class="function"><span class="params">(() -&gt; demo.test1())</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        <span class="title">new</span> <span class="title">Thread</span><span class="params">(() -&gt; demo.test2())</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">void</span> <span class="title">test1</span><span class="params">()</span> {</span></span><br><span class="line"><span class="function">        <span class="title">try</span> {</span></span><br><span class="line"><span class="function">            <span class="title">lock</span>.<span class="title">lock</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;1&#x53F7;  &#x4E0A;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">            <span class="title">try</span> {</span></span><br><span class="line"><span class="function">                <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;1&#x53F7;  &#x7B49;&#x5F85;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">                <span class="title">condition</span>.<span class="title">await</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            } <span class="title">catch</span> <span class="params">(InterruptedException e)</span> {</span></span><br><span class="line"><span class="function">                <span class="title">e</span>.<span class="title">printStackTrace</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            }</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;1&#x53F7;  &#x6536;&#x5230;&#x4FE1;&#x53F7;&#x4E0D;&#x7B49;&#x4E86;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">        } <span class="title">catch</span> <span class="params">(Exception e)</span> {</span></span><br><span class="line"><span class="function">            <span class="title">e</span>.<span class="title">printStackTrace</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        } <span class="title">finally</span> {</span></span><br><span class="line"><span class="function">            <span class="title">lock</span>.<span class="title">unlock</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;1&#x53F7;  &#x91CA;&#x653E;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">        }</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">void</span> <span class="title">test2</span><span class="params">()</span> {</span></span><br><span class="line"><span class="function">        <span class="title">try</span> {</span></span><br><span class="line"><span class="function">            <span class="title">lock</span>.<span class="title">lock</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;2&#x53F7;  &#x4E0A;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">            <span class="title">condition</span>.<span class="title">signalAll</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;2&#x53F7;  &#x53EB;&#x9192;1&#x53F7;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">        } <span class="title">catch</span> <span class="params">(Exception e)</span> {</span></span><br><span class="line"><span class="function">            <span class="title">e</span>.<span class="title">printStackTrace</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        } <span class="title">finally</span> {</span></span><br><span class="line"><span class="function">            <span class="title">lock</span>.<span class="title">unlock</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">&quot;2&#x53F7;  &#x91CA;&#x653E;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">        }</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">}</span></span><br></pre></td></tr></table></figure>
<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x5982;&#x4E0B;</p>
<ul>
<li>1&#x53F7;  &#x4E0A;&#x9501;</li>
<li>1&#x53F7;  &#x7B49;&#x5F85;</li>
<li>2&#x53F7;  &#x4E0A;&#x9501;</li>
<li>2&#x53F7;  &#x53EB;&#x9192;1&#x53F7;</li>
<li>2&#x53F7;  &#x5B8C;&#x5168;&#x91CA;&#x653E;&#x9501;</li>
<li>1&#x53F7;  &#x6536;&#x5230;&#x4FE1;&#x53F7;&#x4E0D;&#x7B49;&#x4E86;</li>
<li>1&#x53F7;  &#x91CA;&#x653E;&#x9501;</li>
</ul>
<h1 id="&#x751F;&#x4EA7;&#x6D88;&#x8D39;&#x6A21;&#x5F0F;">4. &#x751F;&#x4EA7;&#x6D88;&#x8D39;&#x6A21;&#x5F0F;</h1><h2 id="Object-wait-1">4.1. Object.wait()</h2><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#x751F;&#x4EA7;&#x6D88;&#x8D39; &#x5217;&#x961F;&#x6700;&#x5927;10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ConditionDemo3</span> {</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    volatile LinkedList&lt;Integer&gt; <span class="keyword">list</span> = <span class="keyword">new</span> LinkedList();</span><br><span class="line">    static final int MAX_SIZE = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    Object lock = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    public static <span class="literal">void</span> main(String[] args) {</span><br><span class="line">        ConditionDemo3 demo = <span class="keyword">new</span> ConditionDemo3();</span><br><span class="line">        <span class="keyword">new</span> Thread<span class="function"><span class="params">(() -&gt; demo.test1(), <span class="string">&quot;c1&quot;</span>)</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        <span class="title">new</span> <span class="title">Thread</span><span class="params">(() -&gt; demo.test1(), <span class="string">&quot;c2&quot;</span>)</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        <span class="title">new</span> <span class="title">Thread</span><span class="params">(() -&gt; demo.test2(), <span class="string">&quot;p1&quot;</span>)</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        <span class="title">new</span> <span class="title">Thread</span><span class="params">(() -&gt; demo.test2(), <span class="string">&quot;p2&quot;</span>)</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">void</span> <span class="title">test1</span><span class="params">()</span> {</span></span><br><span class="line"><span class="function">        <span class="title">String</span> <span class="title">name</span> = <span class="title">Thread</span>.<span class="title">currentThread</span><span class="params">()</span>.<span class="title">getName</span><span class="params">()</span> + &quot;:&quot;;</span></span><br><span class="line"><span class="function">        <span class="title">synchronized</span> <span class="params">(lock)</span> {</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;&#x4E0A;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">            <span class="title">for</span> <span class="params">(int i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span> {</span></span><br><span class="line"><span class="function">                <span class="title">while</span> <span class="params">(<span class="keyword">list</span>.size() == MAX_SIZE)</span> {</span></span><br><span class="line"><span class="function">                    <span class="title">try</span> {</span></span><br><span class="line"><span class="function">                        <span class="title">lock</span>.<span class="title">wait</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">                    } <span class="title">catch</span> <span class="params">(InterruptedException e)</span> {</span></span><br><span class="line"><span class="function">                        <span class="title">e</span>.<span class="title">printStackTrace</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">                    }</span></span><br><span class="line"><span class="function">                    <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;&#x7B49;&#x5F85;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">                }</span></span><br><span class="line"><span class="function">                <span class="title">list</span>.<span class="title">add</span><span class="params">(i)</span>;</span></span><br><span class="line"><span class="function">                <span class="title">lock</span>.<span class="title">notifyAll</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            }</span></span><br><span class="line"><span class="function">        }</span></span><br><span class="line"><span class="function">        <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;&#x91CA;&#x653E;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">void</span> <span class="title">test2</span><span class="params">()</span> {</span></span><br><span class="line"><span class="function">        <span class="title">String</span> <span class="title">name</span> = <span class="title">Thread</span>.<span class="title">currentThread</span><span class="params">()</span>.<span class="title">getName</span><span class="params">()</span> + &quot;:&quot;;</span></span><br><span class="line"><span class="function">        <span class="title">synchronized</span> <span class="params">(lock)</span> {</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;&#x4E0A;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">            <span class="title">while</span> <span class="params">(<span class="literal">true</span>)</span> {</span></span><br><span class="line"><span class="function">                <span class="title">while</span> <span class="params">(<span class="keyword">list</span>.isEmpty())</span> {</span></span><br><span class="line"><span class="function">                    <span class="title">try</span> {</span></span><br><span class="line"><span class="function">                        <span class="title">lock</span>.<span class="title">wait</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">                    } <span class="title">catch</span> <span class="params">(InterruptedException e)</span> {</span></span><br><span class="line"><span class="function">                        <span class="title">e</span>.<span class="title">printStackTrace</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">                    }</span></span><br><span class="line"><span class="function">                    <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;list&#x4E3A;&#x7A7A;-&#x7B49;&#x5F85;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">                }</span></span><br><span class="line"><span class="function">                <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;&#x6D88;&#x8D39;&quot;</span> + <span class="keyword">list</span>.removeFirst() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;list&#x5BB9;&#x91CF;&#x4E3A;:&quot;</span> + (<span class="keyword">list</span>.size() + <span class="number">1</span>))</span>;</span></span><br><span class="line"><span class="function">                <span class="title">lock</span>.<span class="title">notifyAll</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            }</span></span><br><span class="line"><span class="function">        }</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">}</span></span><br></pre></td></tr></table></figure>
<h2 id="lock-newCondition-1">4.2. lock.newCondition()</h2><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">package com.luban.self;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#x751F;&#x4EA7;&#x6D88;&#x8D39; &#x5217;&#x961F;&#x6700;&#x5927;10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ConditionDemo4</span> {</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    volatile LinkedList&lt;Integer&gt; <span class="keyword">list</span> = <span class="keyword">new</span> LinkedList();</span><br><span class="line">    static final int MAX_SIZE = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    ReentrantLock lock;</span><br><span class="line">    Condition product;</span><br><span class="line">    Condition customer;</span><br><span class="line"></span><br><span class="line">    ConditionDemo4() {</span><br><span class="line">        lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">        product = lock.newCondition();</span><br><span class="line">        customer = lock.newCondition();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static <span class="literal">void</span> main(String[] args) {</span><br><span class="line">        ConditionDemo4 demo = <span class="keyword">new</span> ConditionDemo4();</span><br><span class="line">        <span class="keyword">new</span> Thread<span class="function"><span class="params">(() -&gt; demo.test1(), <span class="string">&quot;c1&quot;</span>)</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        <span class="title">new</span> <span class="title">Thread</span><span class="params">(() -&gt; demo.test1(), <span class="string">&quot;c2&quot;</span>)</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        <span class="title">new</span> <span class="title">Thread</span><span class="params">(() -&gt; demo.test2(), <span class="string">&quot;p1&quot;</span>)</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        <span class="title">new</span> <span class="title">Thread</span><span class="params">(() -&gt; demo.test2(), <span class="string">&quot;p2&quot;</span>)</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">void</span> <span class="title">test1</span><span class="params">()</span> {</span></span><br><span class="line"><span class="function">        <span class="title">String</span> <span class="title">name</span> = <span class="title">Thread</span>.<span class="title">currentThread</span><span class="params">()</span>.<span class="title">getName</span><span class="params">()</span> + &quot;:&quot;;</span></span><br><span class="line"><span class="function">        <span class="title">try</span> {</span></span><br><span class="line"><span class="function">            <span class="title">lock</span>.<span class="title">lock</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;&#x4E0A;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">            <span class="title">for</span> <span class="params">(int i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span> {</span></span><br><span class="line"><span class="function">                <span class="title">while</span> <span class="params">(<span class="keyword">list</span>.size() == MAX_SIZE)</span> {</span></span><br><span class="line"><span class="function">                    <span class="title">try</span> {</span></span><br><span class="line"><span class="function">                        <span class="title">product</span>.<span class="title">await</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">                    } <span class="title">catch</span> <span class="params">(InterruptedException e)</span> {</span></span><br><span class="line"><span class="function">                        <span class="title">e</span>.<span class="title">printStackTrace</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">                    }</span></span><br><span class="line"><span class="function">                    <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;&#x7B49;&#x5F85;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">                }</span></span><br><span class="line"><span class="function">                <span class="title">list</span>.<span class="title">add</span><span class="params">(i)</span>;</span></span><br><span class="line"><span class="function">                <span class="title">customer</span>.<span class="title">signalAll</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            }</span></span><br><span class="line"><span class="function">        } <span class="title">catch</span> <span class="params">(Exception e)</span> {</span></span><br><span class="line"><span class="function">            <span class="title">e</span>.<span class="title">printStackTrace</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        } <span class="title">finally</span> {</span></span><br><span class="line"><span class="function">            <span class="title">lock</span>.<span class="title">unlock</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;&#x91CA;&#x653E;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">        }</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">void</span> <span class="title">test2</span><span class="params">()</span> {</span></span><br><span class="line"><span class="function">        <span class="title">String</span> <span class="title">name</span> = <span class="title">Thread</span>.<span class="title">currentThread</span><span class="params">()</span>.<span class="title">getName</span><span class="params">()</span> + &quot;:&quot;;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">try</span> {</span></span><br><span class="line"><span class="function">            <span class="title">lock</span>.<span class="title">lock</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;&#x4E0A;&#x9501;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">            <span class="title">while</span> <span class="params">(<span class="literal">true</span>)</span> {</span></span><br><span class="line"><span class="function">                <span class="title">while</span> <span class="params">(<span class="keyword">list</span>.isEmpty())</span> {</span></span><br><span class="line"><span class="function">                    <span class="title">try</span> {</span></span><br><span class="line"><span class="function">                        <span class="title">customer</span>.<span class="title">await</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">                    } <span class="title">catch</span> <span class="params">(InterruptedException e)</span> {</span></span><br><span class="line"><span class="function">                        <span class="title">e</span>.<span class="title">printStackTrace</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">                    }</span></span><br><span class="line"><span class="function">                    <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;list&#x4E3A;&#x7A7A;-&#x7B49;&#x5F85;&quot;</span>)</span>;</span></span><br><span class="line"><span class="function">                }</span></span><br><span class="line"><span class="function">                <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(name + <span class="string">&quot;&#x6D88;&#x8D39;&quot;</span> + <span class="keyword">list</span>.removeFirst() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;list&#x5BB9;&#x91CF;&#x4E3A;:&quot;</span> + (<span class="keyword">list</span>.size() + <span class="number">1</span>))</span>;</span></span><br><span class="line"><span class="function">                <span class="title">product</span>.<span class="title">signalAll</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">            }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        } <span class="title">catch</span> <span class="params">(Exception e)</span> {</span></span><br><span class="line"><span class="function">            <span class="title">e</span>.<span class="title">printStackTrace</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        } <span class="title">finally</span> {</span></span><br><span class="line"><span class="function">            <span class="title">lock</span>.<span class="title">unlock</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">        }</span></span><br><span class="line"><span class="function">    }</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">}</span></span><br></pre></td></tr></table></figure>
<h1 id="&#x603B;&#x7ED3;">5. &#x603B;&#x7ED3;</h1><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4F7F;&#x7528;<code>#newCondition</code>&#x65B9;&#x6CD5;&#x65F6;&#x53EF;&#x4EE5;&#x660E;&#x786E;&#x7684;&#x6307;&#x5B9A;&#x5177;&#x4F53;&#x5C06;&#x90A3;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x9501;&#x53D6;&#x6D88;&#x7B49;&#x5F85;, &#x5728;&#x7EBF;&#x7A0B;&#x591A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x4EE5;&#x8D77;&#x5230;&#x5F88;&#x5927;&#x7684;&#x4F18;&#x5316;</p>
]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
  </entry>
  <entry>
    <title>并发7:ReentrantLock</title>
    <url>/2020/ReentrantLock/</url>
    <content><![CDATA[<blockquote>
<p><code>ReentrantLock</code> &#x4F9D;&#x8D56; AQS &#x5B9E;&#x73B0;&#xFF0C;&#x8BF7;&#x5148;&#x7406;&#x89E3;AQS</p>
</blockquote>
<h1 id="&#x4ECB;&#x7ECD;">1. &#x4ECB;&#x7ECD;</h1><h2 id="&#x5C0F;-DEMO">1.1. &#x5C0F; DEMO</h2><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">ReentrantLock <span class="keyword">lock</span> = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">lock</span>.<span class="keyword">lock</span>();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        doSomething();</span><br><span class="line">    } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">lock</span>.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5982;&#x4E0A;&#x4E3A;<code>ReentrantLock</code>&#x7684;&#x7B80;&#x5355;&#x4F7F;&#x7528;, &#x7EBF;&#x7A0B;&#x8FDB;&#x6765;&#x65F6;&#x8FDB;&#x884C;&#x52A0;&#x9501;, &#x8FD0;&#x884C;&#x65B9;&#x6CD5;, &#x89E3;&#x9501;, &#x5341;&#x5206;&#x7B80;&#x6D01;</p>
<a id="more"></a>

<h2 id="&#x731C;&#x60F3;">1.2. &#x731C;&#x60F3;</h2><h3 id="&#x521D;&#x6B65;&#x65B9;&#x6848;">1.2.1. &#x521D;&#x6B65;&#x65B9;&#x6848;</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">volatile <span class="built_in">int</span> status=<span class="number">0</span>;<span class="comment">//&#x6807;&#x8BC6;---&#x662F;&#x5426;&#x6709;&#x7EBF;&#x7A0B;&#x5728;&#x540C;&#x6B65;&#x5757;-----&#x662F;&#x5426;&#x6709;&#x7EBF;&#x7A0B;&#x4E0A;&#x9501;&#x6210;&#x529F;</span></span><br><span class="line"><span class="built_in">void</span> lock(){</span><br><span class="line">	<span class="keyword">while</span>(!compareAndSet(<span class="number">0</span>,<span class="number">1</span>)){</span><br><span class="line">	    sleep(<span class="number">10</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">//lock</span></span><br><span class="line">}</span><br><span class="line"><span class="built_in">void</span> unlock(){</span><br><span class="line">	status=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="built_in">bool</span>ean compareAndSet(<span class="built_in">int</span> except,<span class="built_in">int</span> newValue){</span><br><span class="line">	<span class="comment">//cas&#x64CD;&#x4F5C;,&#x4FEE;&#x6539;status&#x6210;&#x529F;&#x5219;&#x8FD4;&#x56DE;true</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x7F3A;&#x70B9;: </p>
<ol>
<li>&#x7761;&#x7720;&#x591A;&#x4E45;&#x5408;&#x9002;?</li>
<li>&#x5982;&#x679C;&#x5E76;&#x53D1;&#x9AD8;, &#x6BCF;&#x4E00;&#x4E2A;&#x90FD;&#x7761;&#x7720;&#x540E;&#x505A;&#x6BD4;&#x5BF9;,&#x5F88;&#x5360;&#x7528; CPU</li>
<li>&#x4E0D;&#x80FD;&#x5B9E;&#x73B0;&#x516C;&#x5E73;&#x9501;</li>
</ol>
<h3 id="&#x5B8C;&#x7F8E;&#x65B9;&#x6848;">1.2.2. &#x5B8C;&#x7F8E;&#x65B9;&#x6848;</h3><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">volatile <span class="built_in">int</span> status=<span class="number">0</span>;<span class="comment">//&#x6807;&#x8BC6;---&#x662F;&#x5426;&#x6709;&#x7EBF;&#x7A0B;&#x5728;&#x540C;&#x6B65;&#x5757;-----&#x662F;&#x5426;&#x6709;&#x7EBF;&#x7A0B;&#x4E0A;&#x9501;&#x6210;&#x529F;</span></span><br><span class="line">void lock<span class="literal">()</span>{</span><br><span class="line">	<span class="keyword">while</span>(!compare<span class="constructor">AndSet(0,1)</span>){</span><br><span class="line">	    <span class="comment">// &#x5C06;&#x8BE5;&#x7EBF;&#x7A0B;&#x52A0;&#x5165;&#x7B49;&#x5F85;&#x5217;&#x961F;</span></span><br><span class="line">	    add<span class="constructor">AQS(Thread.<span class="params">currentThread</span>()</span>);</span><br><span class="line">	    <span class="comment">// &#x5C06;&#x8BE5;&#x7EBF;&#x7A0B;&#x7761;&#x7720;&#x8BA9;&#x51FA;CPU</span></span><br><span class="line">	    park<span class="literal">()</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">//lock</span></span><br><span class="line">}</span><br><span class="line">void unlock<span class="literal">()</span>{</span><br><span class="line">	status=<span class="number">0</span>;</span><br><span class="line">	<span class="comment">// &#x89E3;&#x9501;&#x65F6;&#x4ECE;&#x5217;&#x961F;&#x4E2D;&#x53D6;&#x51FA;&#x4E00;&#x4E2A;, &#x7136;&#x540E;&#x8BA9;&#x5176;&#x8FD0;&#x884C;</span></span><br><span class="line">	Thread t = take<span class="constructor">AQS()</span>;</span><br><span class="line">	un<span class="constructor">Park(<span class="params">t</span>)</span>;</span><br><span class="line">}</span><br><span class="line">boolean compare<span class="constructor">AndSet(<span class="params">int</span> <span class="params">except</span>,<span class="params">int</span> <span class="params">newValue</span>)</span>{</span><br><span class="line">	<span class="comment">//cas&#x64CD;&#x4F5C;,&#x4FEE;&#x6539;status&#x6210;&#x529F;&#x5219;&#x8FD4;&#x56DE;true</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x6765;&#x4E86;, &#x5982;&#x679C;&#x5C06;&#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#x4E0E;&#x8FD0;&#x884C;&#x5462;? <code>LockSupport</code>&#x7C7B;&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;</p>
<h3 id="LockSupport">1.2.3. LockSupport</h3><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LockSupport</span> {</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LockSupport</span>(<span class="params"></span>)</span> {}</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">park</span>(<span class="params"></span>)</span> {</span><br><span class="line">        UNSAFE.park(<span class="literal">false</span>, <span class="number">0L</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">unpark</span>(<span class="params">Thread thread</span>)</span> {</span><br><span class="line">        <span class="keyword">if</span> (thread != <span class="literal">null</span>)</span><br><span class="line">            UNSAFE.unpark(thread);</span><br><span class="line">    } </span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x7C7B;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x76F4;&#x63A5;&#x8C03;&#x7528; <code>UNSAFE</code> &#x7C7B;&#x7684;&#x65B9;&#x6CD5;, &#x90FD;&#x662F; <code>native</code> &#x65B9;&#x6CD5;; &#x8C03;&#x7528;&#x7684;&#x662F;c&#x6216;c++&#x51FD;&#x6570;. &#x6211;&#x4EEC;&#x7406;&#x89E3;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x5C31;&#x597D;</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x8BA9;&#x51FA;CPU</span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">LockSupport</span>.</span></span>park<span class="literal">()</span>;</span><br><span class="line"><span class="comment">// &#x6307;&#x5B9A;&#x7EBF;&#x7A0B;t&#x8FD0;&#x884C;</span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">LockSupport</span>.</span></span>un<span class="constructor">Park(<span class="params">t</span>)</span>;</span><br></pre></td></tr></table></figure>

<h1 id="&#x5E95;&#x5C42;&#x5B9E;&#x73B0;">2. &#x5E95;&#x5C42;&#x5B9E;&#x73B0;</h1><h2 id="&#x7C7B;&#x7ED3;&#x6784;">2.1. &#x7C7B;&#x7ED3;&#x6784;</h2><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReentrantLock</span></span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x5185;&#x90E8;&#x62BD;&#x8C61;&#x7C7B; &#x7EE7;&#x627F; AQS</span></span><br><span class="line">    <span class="keyword">abstract</span> static <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>{</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &#x5185;&#x90E8;&#x7C7B;-&#x516C;&#x5E73;&#x9501;</span></span><br><span class="line">    static <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span> </span>{</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &#x5185;&#x90E8;&#x7C7B;-&#x975E;&#x516C;&#x5E73;&#x9501;</span></span><br><span class="line">    static <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NonfairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span> </span>{</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="&#x4E3E;&#x4F8B;">2.2. &#x4E3E;&#x4F8B;</h2><p>&#x6211;&#x4EEC;&#x4F9D;&#x636E;&#x6392;&#x961F;&#x4E70;&#x7968;&#x4E3E;&#x4F8B;: &#x73B0;&#x6709;abcd&#x56DB;&#x4F4D;&#x5BA2;&#x4EBA;&#x6765;&#x4E70;&#x7968;&#x5982;&#x4E0B;</p>
<p><code>&#x7A97;&#x53E3; : a &lt; b &lt; c &lt; d</code></p>
<p>&#x6B64;&#x65F6;a&#x6B63;&#x5728;&#x529E;&#x7406;&#x90A3;&#x4E48;&#x6392;&#x961F;&#x7684;&#x4EBA;&#x4E2D;&#x6709;bcd, &#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">&#x529E;&#x7406;&#x4E2D;: <span class="keyword">a</span></span><br><span class="line">&#x6392;&#x961F;: <span class="literal">null</span> &lt; b &lt; c &lt; d</span><br></pre></td></tr></table></figure>

<h3 id="&#x521B;&#x5EFA;&#x5BF9;&#x8C61;">2.2.1. &#x521B;&#x5EFA;&#x5BF9;&#x8C61;</h3><p><code>ReentrantLock lock = new ReentrantLock();</code></p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="constructor">ReentrantLock()</span> {</span><br><span class="line">    <span class="comment">// &#x9ED8;&#x8BA4;&#x521B;&#x5EFA;&#x975E;&#x516C;&#x5E73;&#x9501;</span></span><br><span class="line">    sync = <span class="keyword">new</span> <span class="constructor">NonfairSync()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x4F20;&#x5165;boolean&#x503C;&#x6765;&#x521B;&#x5EFA; </span></span><br><span class="line"><span class="comment">// true: &#x516C;&#x5E73;&#x9501; false: &#x975E;&#x516C;&#x5E73;&#x9501;</span></span><br><span class="line">public <span class="constructor">ReentrantLock(<span class="params">boolean</span> <span class="params">fair</span>)</span> {</span><br><span class="line">    sync = fair ? <span class="keyword">new</span> <span class="constructor">FairSync()</span> : <span class="keyword">new</span> <span class="constructor">NonfairSync()</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x52A0;&#x9501;">2.2.2. &#x52A0;&#x9501;</h3><p><code>lock.lock();</code></p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span>(<span class="params"></span>)</span> {</span><br><span class="line">    sync.<span class="keyword">lock</span>();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6B64;&#x5904;&#x8C03;&#x7528;&#x7684;&#x662F;&#x62BD;&#x8C61;&#x7C7B;&#x7684;lock&#x65B9;&#x6CD5;, &#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x4EEC;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x516C;&#x5E73;&#x9501;</span></span><br><span class="line">FairSync extends Sync {</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">void</span> lock() {</span><br><span class="line">        <span class="comment">// &#x6392;&#x961F;</span></span><br><span class="line">        acquire(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x975E;&#x516C;&#x5E73;&#x9501;</span></span><br><span class="line">NonfairSync extends Sync {</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">void</span> lock() {</span><br><span class="line">        <span class="comment">// &#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x9501;</span></span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">            setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment">// &#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x9501;&#x5C31;&#x6392;&#x961F;</span></span><br><span class="line">            acquire(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><strong>&#x53EF;&#x4EE5;&#x770B;&#x5230;, &#x516C;&#x5E73;&#x9501;&#x548C;&#x975E;&#x516C;&#x5E73;&#x9501;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x533A;&#x522B;&#x662F;&#x5728;&#x975E;&#x516C;&#x5E73;&#x9501;&#x8C03;&#x7528;&#x65F6;&#x5148;&#x53BB;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x4E0B;&#x9501;</strong></p>
<p>&#x4E3E;&#x4F8B;: </p>
<p><code>&#x7A97;&#x53E3; : a &lt; b &lt; c &lt; d</code></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">&#x529E;&#x7406;&#x4E2D;: <span class="keyword">a</span></span><br><span class="line">&#x6392;&#x961F;: <span class="literal">null</span> &lt; b &lt; c &lt; d</span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x65F6;&#x6765;&#x4E2A;&#x65B0;&#x4E58;&#x5BA2;f</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">&#x516C;&#x5E73;&#x9501;: </span><br><span class="line">    &#x529E;&#x7406;&#x4E2D;: <span class="keyword">a</span></span><br><span class="line">    &#x6392;&#x961F;: <span class="literal">null</span> &lt; b &lt; c &lt; d &lt; e</span><br><span class="line">&#x975E;&#x516C;&#x5E73;&#x9501;:</span><br><span class="line">    <span class="keyword">a</span>&#x6B63;&#x597D;&#x529E;&#x7406;&#x5B8C;&#x4E86;, f&#x4F1A;&#x548C;b&#x4E89;&#x593A;&#x9501;, &#x5982;&#x679C;f&#x62A2;&#x5230;&#x4E86;, &#x90A3;&#x4E48;f&#x76F4;&#x63A5;&#x6267;&#x884C;</span><br><span class="line">        &#x529E;&#x7406;&#x4E2D;: f</span><br><span class="line">        &#x6392;&#x961F;: <span class="literal">null</span> &lt; b &lt; c &lt; d &lt; e</span><br><span class="line">    <span class="keyword">a</span>&#x6CA1;&#x529E;&#x7406;&#x5B8C;</span><br><span class="line">        &#x529E;&#x7406;&#x4E2D;: <span class="keyword">a</span></span><br><span class="line">        &#x6392;&#x961F;: <span class="literal">null</span> &lt; b &lt; c &lt; d &lt; e</span><br></pre></td></tr></table></figure>

<h3 id="tryAcquire-arg">2.2.3. tryAcquire(arg)</h3><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public final void acquire(<span class="built_in">int</span> arg) {</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">try</span><span class="constructor">Acquire(<span class="params">arg</span>)</span> &amp;&amp;</span><br><span class="line">        acquire<span class="constructor">Queued(<span class="params">addWaiter</span>(Node.EXCLUSIVE)</span>, arg))</span><br><span class="line">        self<span class="constructor">Interrupt()</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5173;&#x4E8E; <code>#acquire</code> &#x65B9;&#x6CD5;&#x5728; AQS&#x4E2D;&#x5DF2;&#x7ECF;&#x8BB2;&#x8FC7;&#x4E86;, &#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;&#x4E86; <code>&#x62BD;&#x8C61;&#x65B9;&#x6CD5;#tryAcquire</code> , &#x800C; <code>ReentrantLock</code> &#x5BF9;&#x8BE5;&#x65B9;&#x6CD5;&#x7F16;&#x5199;&#x4E86;&#x4E24;&#x5957;&#x4E0D;&#x540C;&#x7684;&#x5B9E;&#x73B0;</p>
<h4 id="&#x516C;&#x5E73;&#x9501;">2.2.3.1. &#x516C;&#x5E73;&#x9501;</h4><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">protected final boolean <span class="keyword">try</span><span class="constructor">Acquire(<span class="params">int</span> <span class="params">acquires</span>)</span> {</span><br><span class="line">    final Thread current = <span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>current<span class="constructor">Thread()</span>;</span><br><span class="line">    <span class="comment">// &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x52A0;&#x9501;&#x72B6;&#x6001;</span></span><br><span class="line">    <span class="built_in">int</span> c = get<span class="constructor">State()</span>;</span><br><span class="line">    <span class="comment">// &#x672A;&#x52A0;&#x9501;</span></span><br><span class="line">    <span class="keyword">if</span> (c<span class="operator"> == </span><span class="number">0</span>) {</span><br><span class="line">        <span class="comment">// hasQueuedPredecessors() &#x5224;&#x65AD;&#x81EA;&#x5DF1;&#x662F;&#x5426;&#x9700;&#x8981;&#x6392;&#x961F; [&#x540E;&#x9762;&#x5355;&#x72EC;&#x8BF4;]</span></span><br><span class="line">        <span class="comment">// compareAndSetState() &#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x6392;&#x961F;&#x90A3;&#x4E48;&#x5C1D;&#x8BD5;&#x7ADE;&#x4E89;&#x9501;</span></span><br><span class="line">        <span class="keyword">if</span> (!has<span class="constructor">QueuedPredecessors()</span> &amp;&amp;</span><br><span class="line">            compare<span class="constructor">AndSetState(0, <span class="params">acquires</span>)</span>) {</span><br><span class="line">            <span class="comment">// setExclusiveOwnerThread() &#x8BBE;&#x7F6E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E3A;&#x62E5;&#x6709;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x65B9;&#x9762;&#x540E;&#x9762;&#x5224;&#x65AD;&#x662F;&#x4E0D;&#x662F;&#x91CD;&#x5165;</span></span><br><span class="line">            set<span class="constructor">ExclusiveOwnerThread(<span class="params">current</span>)</span>;</span><br><span class="line">            return <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x52A0;&#x9501;&#x7684;&#x8BDD;&#x9700;&#x8981;&#x5224;&#x65AD;&#x91CD;&#x5165;, &#x5982;&#x679C;&#x8BE5;&#x7EBF;&#x7A0B;&#x7B49;&#x4E8E;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7EBF;&#x7A0B;, &#x5219;state + 1</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current<span class="operator"> == </span>get<span class="constructor">ExclusiveOwnerThread()</span>) {</span><br><span class="line">        <span class="built_in">int</span> nextc = c + acquires;</span><br><span class="line">        <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>)</span><br><span class="line">            throw <span class="keyword">new</span> <span class="constructor">Error(<span class="string">&quot;Maximum lock count exceeded&quot;</span>)</span>;</span><br><span class="line">        set<span class="constructor">State(<span class="params">nextc</span>)</span>;</span><br><span class="line">        return <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    return <span class="literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="&#x975E;&#x516C;&#x5E73;&#x9501;">2.2.3.2. &#x975E;&#x516C;&#x5E73;&#x9501;</h4><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">protected final boolean <span class="keyword">try</span><span class="constructor">Acquire(<span class="params">int</span> <span class="params">acquires</span>)</span> {</span><br><span class="line">    <span class="comment">// &#x8C03;&#x7528;&#x7236;&#x7C7B; sync &#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line">    return nonfair<span class="constructor">TryAcquire(<span class="params">acquires</span>)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">final boolean nonfair<span class="constructor">TryAcquire(<span class="params">int</span> <span class="params">acquires</span>)</span> {</span><br><span class="line">    final Thread current = <span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>current<span class="constructor">Thread()</span>;</span><br><span class="line">    <span class="built_in">int</span> c = get<span class="constructor">State()</span>;</span><br><span class="line">    <span class="keyword">if</span> (c<span class="operator"> == </span><span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">if</span> (compare<span class="constructor">AndSetState(0, <span class="params">acquires</span>)</span>) {</span><br><span class="line">            set<span class="constructor">ExclusiveOwnerThread(<span class="params">current</span>)</span>;</span><br><span class="line">            return <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current<span class="operator"> == </span>get<span class="constructor">ExclusiveOwnerThread()</span>) {</span><br><span class="line">        <span class="built_in">int</span> nextc = c + acquires;</span><br><span class="line">        <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">            throw <span class="keyword">new</span> <span class="constructor">Error(<span class="string">&quot;Maximum lock count exceeded&quot;</span>)</span>;</span><br><span class="line">        set<span class="constructor">State(<span class="params">nextc</span>)</span>;</span><br><span class="line">        return <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    return <span class="literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x516C;&#x5E73;&#x9501;&#x4E0E;&#x975E;&#x516C;&#x5E73;&#x9501;&#x7684;&#x533A;&#x522B;">2.2.4. &#x516C;&#x5E73;&#x9501;&#x4E0E;&#x975E;&#x516C;&#x5E73;&#x9501;&#x7684;&#x533A;&#x522B;</h3><p>&#x6BD4;&#x8F83;&#x540E;&#x53D1;&#x73B0;, &#x516C;&#x5E73;&#x9501;&#x6BD4;&#x975E;&#x516C;&#x5E73;&#x9501;&#x5728;&#x672A;&#x52A0;&#x9501;&#x72B6;&#x6001;&#x4E0B;&#x591A;&#x4E86;&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x6392;&#x961F;, &#x5176;&#x4ED6;&#x4EE3;&#x7801;&#x4E00;&#x6A21;&#x4E00;&#x6837;</p>
<p>&#x81F3;&#x6B64;<code>FairSync</code> &#x548C; <code>NonfairSync</code> &#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x7684;&#x65B9;&#x6CD5;&#x5DF2;&#x7ECF;&#x6BD4;&#x8F83;&#x5B8C;&#x6BD5;, &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#x7ED3;&#x8BBA;:</p>
<ol>
<li>&#x975E;&#x516C;&#x5E73;&#x9501;&#x5728;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x8FDB;&#x6765;&#x65F6;&#x76F4;&#x63A5;&#x53BB;&#x62A2;&#x5360;&#x9501;, &#x62A2;&#x5360;&#x4E0D;&#x5230;&#x518D;&#x6392;&#x961F;</li>
<li>&#x516C;&#x5E73;&#x9501;&#x8FDB;&#x6765;&#x540E;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x6392;&#x961F;&#x83B7;&#x53D6;</li>
</ol>
<h3 id="hasQueuedPredecessors">2.2.5. hasQueuedPredecessors()</h3><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">public final boolean hasQueuedPredecessors() {</span><br><span class="line">    // &#x5C3E;&#x7ED3;&#x70B9;</span><br><span class="line">    <span class="keyword">Node</span> <span class="title">t</span> = tail;</span><br><span class="line">    // &#x5934;&#x7ED3;&#x70B9;</span><br><span class="line">    <span class="keyword">Node</span> <span class="title">h</span> = head;</span><br><span class="line">    <span class="keyword">Node</span> <span class="title">s</span>;</span><br><span class="line">    // h.next &#x4E3A;&#x961F;&#x5217;&#x9996;&#x4E2A;&#x5BF9;&#x8C61;, &#x5982;&#x679C;&#x8FD9;&#x4E2A;</span><br><span class="line">    return h != t &amp;&amp;</span><br><span class="line">        ((s = h.next) == null || s.thread != Thread.currentThread());</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>h != t</strong><ul>
<li>&#x5217;&#x961F;&#x4E3A;&#x7A7A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;h=null t=null</li>
<li>&#x5217;&#x961F;&#x4E0D;&#x4E3A;null&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x6392;&#x961F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;, &#x5934;&#x7ED3;&#x70B9;&#x548C;&#x5C3E;&#x7ED3;&#x70B9;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;, &#x5BF9;&#x8C61;&#x4E2D;&#x7684;thread&#x4E3A;&#x7A7A;</li>
</ul>
</li>
<li><strong>((s = h.next) == null || s.thread != Thread.currentThread())</strong><ul>
<li>&#x5982;&#x679C;&#x5934;&#x7ED3;&#x70B9;!=&#x5C3E;&#x7ED3;&#x70B9;, &#x90A3;&#x4E48;&#x5224;&#x65AD;&#x5217;&#x961F;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x662F;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;, &#x5982;&#x679C;&#x662F;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;, &#x5219;&#x8BA4;&#x4E3A;&#x6CA1;&#x6709;&#x6392;&#x961F;</li>
</ul>
</li>
</ol>
<h3 id="&#x89E3;&#x9501;">2.2.6. &#x89E3;&#x9501;</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">ReentrantLock</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sync sync;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> unlock() {</span><br><span class="line">        <span class="comment">// 1. &#x8C03;&#x7528; sync &#x7236;&#x7C7B; AQS &#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line">        sync.release(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> static <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>{</span><br><span class="line">    <span class="comment">// 4. &#x8BE5;&#x65B9;&#x6CD5;&#x5982;&#x679C;&#x89E3;&#x9501;&#x6210;&#x529F;&#x4F1A;&#x8FD4;&#x56DE;true, &#x5426;&#x5219;&#x8FD4;&#x56DE;false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> boolean tryRelease(int releases) {</span><br><span class="line">        <span class="comment">// &#x5BF9;&#x72B6;&#x6001;&#x503C;&#x8FDB;&#x884C; -1 &#x64CD;&#x4F5C;</span></span><br><span class="line">        int c = getState() - releases;</span><br><span class="line">        <span class="keyword">if</span> (<span class="type">Thread</span>.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalMonitorStateException</span>();</span><br><span class="line">        boolean free = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// c == 0 &#x89E3;&#x9501;&#x6210;&#x529F;</span></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="number">0</span>) {</span><br><span class="line">            free = <span class="literal">true</span>;</span><br><span class="line">            setExclusiveOwnerThread(<span class="literal">null</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// &#x91CD;&#x5165;&#x9501;&#x4FEE;&#x6539; state</span></span><br><span class="line">        setState(c);</span><br><span class="line">        <span class="keyword">return</span> free;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="symbol">AbstractQueuedSynchronizer</span> {</span><br><span class="line">    <span class="comment">// 2.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="built_in">bool</span>ean release(<span class="built_in">int</span> arg) {</span><br><span class="line">        <span class="comment">// 3. tryRelease(arg) &#x8C03;&#x7528; Sync &#x7684;&#x65B9;&#x6CD5; &#x8FD4;&#x56DE;true&#x8868;&#x793A;&#x89E3;&#x9501;&#x6210;&#x529F;</span></span><br><span class="line">        <span class="keyword">if</span> (tryRelease(arg)) {</span><br><span class="line">            Node h = head;</span><br><span class="line">            <span class="comment">// h.waitStatus != 0 &#x4EE3;&#x8868;&#x540E;&#x9762;&#x6709;&#x4EBA;&#x6392;&#x961F;</span></span><br><span class="line">            <span class="keyword">if</span> (h != <span class="literal">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">                <span class="comment">// &#x5524;&#x9192;&#x4E0B;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;</span></span><br><span class="line">                unparkSuccessor(h);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">void</span> unparkSuccessor(Node node) {</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * If status is negative (i.e., possibly needing signal) try</span></span><br><span class="line"><span class="comment">         * to clear in anticipation of signalling.  It is OK if this</span></span><br><span class="line"><span class="comment">         * fails or if status is changed by waiting thread.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">int</span> ws = node.waitStatus;</span><br><span class="line">        <span class="keyword">if</span> (ws &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="comment">// &#x5934;&#x7ED3;&#x70B9; waitStatus &#x6539;&#x4E3A;0</span></span><br><span class="line">            compareAndSetWaitStatus(node, ws, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// &#x83B7;&#x53D6;&#x4E0B;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;</span></span><br><span class="line">        Node s = node.next;</span><br><span class="line">        <span class="comment">// &#x5982;&#x679C;&#x4E0B;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E3A;&#x7A7A;&#x6216;&#x8005;&#x6807;&#x8BC6;&#x4E3A;&#x53D6;&#x6D88;</span></span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span> || s.waitStatus &gt; <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// &#x7F6E;&#x7A7A;</span></span><br><span class="line">            s = <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">// &#x4ECE;&#x5C3E;&#x7ED3;&#x70B9;&#x5411;&#x524D;&#x8FDB;&#x884C;&#x5FAA;&#x73AF;, &#x5982;&#x679C;&#x5FAA;&#x73AF;&#x5230;&#x7684;&#x503C;&#x4E3A;null &#x6216;&#x8005; &#x5FAA;&#x73AF;&#x5230; node &#x7684;&#x4F4D;&#x7F6E; &#x5219;&#x505C;&#x6B62;</span></span><br><span class="line">            <span class="keyword">for</span> (Node t = tail; t != <span class="literal">null</span> &amp;&amp; t != node; t = t.prev)</span><br><span class="line">                <span class="comment">// &#x6B64;&#x64CD;&#x4F5C;&#x662F;&#x4E3A;&#x4E86;&#x4ECE;&#x540E;&#x5411;&#x524D;&#x627E;&#x51FA;&#x7B2C;&#x4E00;&#x4E2A;&#x53EF;&#x7528;&#x7684;&#x7ED3;&#x70B9;</span></span><br><span class="line">                <span class="keyword">if</span> (t.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                    s = t;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// &#x5982;&#x679C;&#x5B58;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5219;&#x8FDB;&#x884C;unpark&#x64CD;&#x4F5C;</span></span><br><span class="line">        <span class="keyword">if</span> (s != <span class="literal">null</span>)</span><br><span class="line">            LockSupport.unpark(s.thread);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
  </entry>
  <entry>
    <title>并发6:AQS</title>
    <url>/2019/AQS/</url>
    <content><![CDATA[<h1 id="&#x7B80;&#x4ECB;">1. &#x7B80;&#x4ECB;</h1><blockquote>
<p>AQS &#x5168;&#x62FC;&#x4E3A; <code>AbstractQueuedSynchronizer</code> , &#x5373;<strong>&#x961F;&#x5217;&#x540C;&#x6B65;&#x5668;</strong>. &#x5B83;&#x662F;&#x6784;&#x5EFA;&#x9501;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x540C;&#x6B65;&#x7EC4;&#x4EF6;&#x7684;&#x57FA;&#x7840;&#x6846;&#x67B6;(&#x5982; ReentrantLock&#x3001;ReentrantReadWriteLock&#x3001;Semaphore &#x7B49;). &#x5B83;&#x662F; J.U.C &#x5E76;&#x53D1;&#x5305;&#x4E2D;&#x7684;&#x6838;&#x5FC3;&#x57FA;&#x7840;&#x7EC4;&#x4EF6;&#x3002;<br><code>JAVA API</code> &#x63CF;&#x8FF0;&#x5982;&#x4E0B;: &#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x6846;&#x67B6;&#xFF0C;&#x7528;&#x4E8E;&#x5B9E;&#x73B0;&#x4F9D;&#x8D56;&#x5148;&#x8FDB;&#x5148;&#x51FA;&#xFF08;FIFO&#xFF09;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x7684;&#x963B;&#x585E;&#x9501;&#x548C;&#x76F8;&#x5173;&#x540C;&#x6B65;&#x5668;&#xFF08;&#x4FE1;&#x53F7;&#x91CF;&#xFF0C;&#x4E8B;&#x4EF6;&#x7B49;&#xFF09;&#x3002; &#x8BE5;&#x7C7B;&#x88AB;&#x8BBE;&#x8BA1;&#x4E3A;&#x5927;&#x591A;&#x6570;&#x7C7B;&#x578B;&#x7684;&#x540C;&#x6B65;&#x5668;&#x7684;&#x6709;&#x7528;&#x4F9D;&#x636E;&#xFF0C;&#x8FD9;&#x4E9B;&#x540C;&#x6B65;&#x5668;&#x4F9D;&#x8D56;&#x4E8E;&#x5355;&#x4E2A;&#x539F;&#x5B50;int&#x503C;&#x6765;&#x8868;&#x793A;&#x72B6;&#x6001;&#x3002; &#x5B50;&#x7C7B;&#x5FC5;&#x987B;&#x5B9A;&#x4E49;&#x6539;&#x53D8;&#x6B64;&#x72B6;&#x6001;&#x7684;&#x53D7;&#x4FDD;&#x62A4;&#x65B9;&#x6CD5;&#xFF0C;&#x4EE5;&#x53CA;&#x6839;&#x636E;&#x8BE5;&#x5BF9;&#x8C61;&#x88AB;&#x83B7;&#x53D6;&#x6216;&#x91CA;&#x653E;&#x6765;&#x5B9A;&#x4E49;&#x8BE5;&#x72B6;&#x6001;&#x7684;&#x542B;&#x4E49;&#x3002; &#x7ED9;&#x5B9A;&#x8FD9;&#x4E9B;&#xFF0C;&#x8FD9;&#x4E2A;&#x7C7B;&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x6240;&#x6709;&#x6392;&#x961F;&#x548C;&#x963B;&#x585E;&#x673A;&#x5236;&#x3002; &#x5B50;&#x7C7B;&#x53EF;&#x4EE5;&#x4FDD;&#x6301;&#x5176;&#x4ED6;&#x72B6;&#x6001;&#x5B57;&#x6BB5;&#xFF0C;&#x4F46;&#x53EA;&#x4EE5;&#x539F;&#x5B50;&#x65B9;&#x5F0F;&#x66F4;&#x65B0;int&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x64CD;&#x7EB5;&#x503C;getState() &#xFF0C; setState(int)&#x548C;compareAndSetState(int, int)&#x88AB;&#x8DDF;&#x8E2A;&#x76F8;&#x5BF9;&#x4E8E;&#x540C;&#x6B65;&#x3002;</p>
</blockquote>
<p>&#x6211;&#x4EEC;&#x7B80;&#x5355;&#x7406;&#x89E3;&#x5982;&#x4E0B;:</p>
<ol>
<li><p>AQS &#x901A;&#x8FC7;&#x5185;&#x7F6E;&#x7684; FIFO &#x540C;&#x6B65;&#x961F;&#x5217;&#x6765;&#x5B8C;&#x6210;&#x8D44;&#x6E90;&#x83B7;&#x53D6;&#x7EBF;&#x7A0B;&#x7684;&#x6392;&#x961F;&#x5DE5;&#x4F5C;&#xFF1A;</p>
<ul>
<li>&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x5931;&#x8D25;&#xFF08;&#x9501;&#xFF09;&#x65F6;&#xFF0C;AQS &#x5219;&#x4F1A;&#x5C06;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4EE5;&#x53CA;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x7B49;&#x4FE1;&#x606F;&#x6784;&#x9020;&#x6210;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF08;Node&#xFF09;&#x5E76;&#x5C06;&#x5176;&#x52A0;&#x5165;&#x540C;&#x6B65;&#x961F;&#x5217;&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x963B;&#x585E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;</li>
<li>&#x5F53;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x91CA;&#x653E;&#x65F6;&#xFF0C;&#x5219;&#x4F1A;&#x628A;&#x8282;&#x70B9;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x5524;&#x9192;&#xFF0C;&#x4F7F;&#x5176;&#x518D;&#x6B21;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;</li>
</ul>
</li>
<li><p>AQS &#x7684;&#x4E3B;&#x8981;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x662F;&#x7EE7;&#x627F;&#xFF0C;&#x5B50;&#x7C7B;&#x901A;&#x8FC7;&#x7EE7;&#x627F;AQS&#x540C;&#x6B65;&#x5668;&#xFF0C;&#x5E76;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x6765;&#x7BA1;&#x7406;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;</p>
</li>
<li><p>AQS &#x4F7F;&#x7528;&#x4E00;&#x4E2A; int &#x7C7B;&#x578B;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF; <code>state</code> &#x6765;&#x8868;&#x793A;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF1A;</p>
<ul>
<li>&#x5F53; <code>state &gt; 0</code> &#x65F6;&#xFF0C;&#x8868;&#x793A;&#x5DF2;&#x7ECF;&#x83B7;&#x53D6;&#x4E86;&#x9501;&#x3002;</li>
<li>&#x5F53; <code>state = 0</code> &#x65F6;&#xFF0C;&#x8868;&#x793A;&#x91CA;&#x653E;&#x4E86;&#x9501;&#x3002;</li>
</ul>
</li>
<li><p>&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x6765;&#x5BF9;&#x540C;&#x6B65;&#x72B6;&#x6001; <code>state</code> &#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x4E14; AQS &#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x5BF9; <code>state</code> &#x7684;&#x64CD;&#x4F5C;&#x662F;&#x5B89;&#x5168;&#x7684;&#xFF1A;</p>
<ul>
<li>getState()</li>
<li>setState(int newState)</li>
<li>compareAndSetState(int expect, int update)</li>
</ul>
</li>
</ol>
<a id="more"></a>

<p><img src="/2019/AQS/aqs%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt></p>
<hr>
<h1 id="CLH-&#x540C;&#x6B65;&#x5217;&#x961F;">2. CLH &#x540C;&#x6B65;&#x5217;&#x961F;</h1><h2 id="AbstractQueuedSynchronizer">2.1. AbstractQueuedSynchronizer</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractQueuedSynchronizer</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractOwnableSynchronizer</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">AbstractQueuedSynchronizer</span><span class="params">()</span> </span>{ }</span><br><span class="line">    <span class="comment">// Node&#x5934;&#x8282;&#x70B9;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node head;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Node&#x5C3E;&#x8282;&#x70B9;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node tail;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x540C;&#x6B65;&#x72B6;&#x6001; &#x5F53; state &gt; 0 &#x65F6;&#xFF0C;&#x8868;&#x793A;&#x5DF2;&#x7ECF;&#x83B7;&#x53D6;&#x4E86;&#x9501;; &#x5F53; state = 0 &#x65F6;&#xFF0C;&#x8868;&#x793A;&#x91CA;&#x653E;&#x4E86;&#x9501;&#x3002;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;&#x6B64;&#x5904;<code>AbstractQueuedSynchronizer</code>&#x62BD;&#x8C61;&#x7C7B;&#x7684;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x65E0;&#x53C2;&#x6784;&#x9020;, &#x6CA1;&#x6709;&#x5BF9;&#x4EFB;&#x4F55;&#x5E38;&#x91CF;&#x8FDB;&#x884C;&#x8D4B;&#x503C;</p>
<h2 id="&#x5185;&#x90E8;&#x9759;&#x6001;&#x7C7B;-Node">2.2. &#x5185;&#x90E8;&#x9759;&#x6001;&#x7C7B; Node</h2><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> Node {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x5171;&#x4EAB;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Node SHARED = <span class="keyword">new</span> Node();</span><br><span class="line">    <span class="comment">// &#x72EC;&#x5360;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Node EXCLUSIVE = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x56E0;&#x4E3A;&#x8D85;&#x65F6;&#x6216;&#x8005;&#x4E2D;&#x65AD;&#xFF0C;&#x8282;&#x70B9;&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;&#x53D6;&#x6D88;&#x72B6;&#x6001;&#xFF0C;&#x88AB;&#x53D6;&#x6D88;&#x7684;&#x8282;&#x70B9;&#x65F6;&#x4E0D;&#x4F1A;&#x53C2;&#x4E0E;&#x5230;&#x7ADE;&#x4E89;&#x4E2D;&#x7684;&#xFF0C;&#x4ED6;&#x4F1A;&#x4E00;&#x76F4;&#x4FDD;&#x6301;&#x53D6;&#x6D88;&#x72B6;&#x6001;&#x4E0D;&#x4F1A;&#x8F6C;&#x53D8;&#x4E3A;&#x5176;&#x4ED6;&#x72B6;&#x6001;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CANCELLED =  <span class="number">1</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x540E;&#x7EE7;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x5904;&#x4E8E;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x5982;&#x679C;&#x91CA;&#x653E;&#x4E86;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6216;&#x8005;&#x88AB;&#x53D6;&#x6D88;&#xFF0C;&#x5C06;&#x4F1A;&#x901A;&#x77E5;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#xFF0C;&#x4F7F;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x5F97;&#x4EE5;&#x8FD0;&#x884C;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIGNAL    = -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x8282;&#x70B9;&#x5728;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x8282;&#x70B9;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x5728;Condition&#x4E0A;&#xFF0C;&#x5F53;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5BF9;Condition&#x8C03;&#x7528;&#x4E86;signal()&#x540E;&#xFF0C;&#x8BE5;&#x8282;&#x70B9;&#x5C06;&#x4F1A;&#x4ECE;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#x8F6C;&#x79FB;&#x5230;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x52A0;&#x5165;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x83B7;&#x53D6;&#x4E2D;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONDITION = -<span class="number">2</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x8868;&#x793A;&#x4E0B;&#x4E00;&#x6B21;&#x5171;&#x4EAB;&#x5F0F;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x83B7;&#x53D6;&#xFF0C;&#x5C06;&#x4F1A;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x4F20;&#x64AD;&#x4E0B;&#x53BB;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PROPAGATE = -<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** &#x7B49;&#x5F85;&#x72B6;&#x6001; */</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> waitStatus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** &#x524D;&#x9A71;&#x8282;&#x70B9;&#xFF0C;&#x5F53;&#x8282;&#x70B9;&#x6DFB;&#x52A0;&#x5230;&#x540C;&#x6B65;&#x961F;&#x5217;&#x65F6;&#x88AB;&#x8BBE;&#x7F6E;&#xFF08;&#x5C3E;&#x90E8;&#x6DFB;&#x52A0;&#xFF09; */</span></span><br><span class="line">    <span class="keyword">volatile</span> Node prev;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** &#x540E;&#x7EE7;&#x8282;&#x70B9; */</span></span><br><span class="line">    <span class="keyword">volatile</span> Node <span class="keyword">next</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** &#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x540E;&#x7EED;&#x8282;&#x70B9;&#x3002;&#x5982;&#x679C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x5171;&#x4EAB;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x5B57;&#x6BB5;&#x5C06;&#x662F;&#x4E00;&#x4E2A; SHARED &#x5E38;&#x91CF;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x8282;&#x70B9;&#x7C7B;&#x578B;&#xFF08;&#x72EC;&#x5360;&#x548C;&#x5171;&#x4EAB;&#xFF09;&#x548C;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x540E;&#x7EED;&#x8282;&#x70B9;&#x5171;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5; */</span></span><br><span class="line">    Node nextWaiter;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** &#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x7EBF;&#x7A0B; */</span></span><br><span class="line">    <span class="keyword">volatile</span> Thread thread;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> isShared() {</span><br><span class="line">        <span class="keyword">return</span> nextWaiter == SHARED;</span><br><span class="line">    }</span><br><span class="line">    Node() {    <span class="comment">// Used to establish initial head or SHARED marker</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Node(Thread thread, Node mode) {     <span class="comment">// Used by addWaiter</span></span><br><span class="line">        <span class="keyword">this</span>.nextWaiter = mode;</span><br><span class="line">        <span class="keyword">this</span>.thread = thread;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Node(Thread thread, <span class="keyword">int</span> waitStatus) { <span class="comment">// Used by Condition</span></span><br><span class="line">        <span class="keyword">this</span>.waitStatus = waitStatus;</span><br><span class="line">        <span class="keyword">this</span>.thread = thread;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<h2 id="&#x6574;&#x4F53;&#x6A21;&#x578B;">2.3. &#x6574;&#x4F53;&#x6A21;&#x578B;</h2><p><img src="/2019/AQS/aqs%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84.png" alt></p>
<p><strong>&#x6CE8;&#x610F;:</strong> </p>
<blockquote>
<p>Node &#x662F;&#x94FE;&#x8868;&#x7ED3;&#x6784;, &#x6B64;&#x5904;&#x7684;&#x591A;&#x4E2A; Node &#x662F;&#x5B58;&#x653E;&#x5728; <code>AbstractQueuedSynchronizer</code> &#x7C7B;&#x7684; <code>private transient volatile Node head</code> &#x4E2D;</p>
<ol>
<li><code>Node&#x94FE;&#x8868; = head.next</code></li>
<li><strong><code>head</code> &#x8282;&#x70B9;&#x5B58;&#x653E;&#x7684;&#x662F;&#x5F53;&#x524D;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x7EBF;&#x7A0B;, &#x5BF9;&#x5E94;&#x7684;thread&#x4E3A;&#x7A7A;, &#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x7B2C;&#x4E00;&#x4E2A;&#x4EBA;&#x6B63;&#x5728;&#x529E;&#x7406;,&#x4ECE;&#x7B2C;&#x4E8C;&#x4E2A;&#x4EBA;&#x5F00;&#x59CB;&#x624D;&#x7B97;&#x6392;&#x961F;</strong></li>
<li><code>tail = Node&#x94FE;&#x8868;&#x6700;&#x540E;&#x4E00;&#x4E2A; = head&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;</code></li>
</ol>
</blockquote>
<h2 id="&#x6E90;&#x7801;">2.4. &#x6E90;&#x7801;</h2><p>&#x7B80;&#x5355;&#x60F3;&#x4E00;&#x4E0B;, &#x5927;&#x81F4;&#x6D41;&#x7A0B;&#x5E94;&#x8BE5;&#x5206;&#x4E3A;&#x4E09;&#x6B65;</p>
<ol>
<li>tail &#x6307;&#x5411;&#x65B0;&#x8282;&#x70B9;</li>
<li>&#x65B0;&#x8282;&#x70B9;&#x7684; pre &#x6307;&#x5411;&#x8001;&#x8282;&#x70B9;</li>
<li>&#x8001;&#x8282;&#x70B9;&#x7684; next &#x6307;&#x5411;&#x65B0;&#x8282;&#x70B9; </li>
</ol>
<p>&#x518D;&#x8003;&#x8651;&#x5230;&#x5E76;&#x53D1;&#x60C5;&#x51B5;, &#x4F7F;&#x7528;&#x7C7B;&#x4F3C; synchronized &#x4E4B;&#x7C7B;&#x7684;&#x7ED9;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x52A0;&#x9501;</p>
<h3 id="&#x5165;&#x5217;">2.4.1. &#x5165;&#x5217;</h3><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">private <span class="keyword">Node</span> <span class="title">addWaiter</span>(<span class="keyword">Node</span> <span class="title">mode</span>) {</span><br><span class="line">    // &#x65B0;&#x5EFA;&#x8282;&#x70B9; this.nextWaiter = mode; this.thread = thread;</span><br><span class="line">    <span class="keyword">Node</span> <span class="title">node</span> = new <span class="keyword">Node</span><span class="title">(Thread</span>.currentThread(), mode);</span><br><span class="line">    // &#x8BB0;&#x5F55;&#x539F;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">    <span class="keyword">Node</span> <span class="title">pred</span> = tail;</span><br><span class="line">    // &#x5FEB;&#x901F;&#x5C1D;&#x8BD5;&#xFF0C;&#x6DFB;&#x52A0;&#x65B0;&#x8282;&#x70B9;&#x4E3A;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">    if (pred != null) {</span><br><span class="line">        // &#x8BBE;&#x7F6E;&#x65B0; <span class="keyword">Node</span> <span class="title">&#x8282;&#x70B9;&#x7684;&#x5C3E;&#x8282;&#x70B9;&#x4E3A;&#x539F;&#x5C3E;&#x8282;&#x70B9;</span></span><br><span class="line"><span class="title">        node</span>.prev = pred;</span><br><span class="line">        // CAS &#x8BBE;&#x7F6E;&#x65B0;&#x7684;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">        if (compareAndSetTail(pred, <span class="keyword">node</span><span class="title">)) {</span></span><br><span class="line"><span class="title">            // &#x6210;&#x529F;&#xFF0C;&#x539F;&#x5C3E;&#x8282;&#x70B9;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E3A;&#x65B0;&#x8282;&#x70B9;</span></span><br><span class="line"><span class="title">            pred</span>.next = <span class="keyword">node</span><span class="title">;</span></span><br><span class="line"><span class="title">            return</span> <span class="keyword">node</span><span class="title">;</span></span><br><span class="line"><span class="title">        }</span></span><br><span class="line"><span class="title">    }</span></span><br><span class="line"><span class="title">    // &#x5931;&#x8D25;&#xFF0C;&#x591A;&#x6B21;&#x5C1D;&#x8BD5;&#xFF0C;&#x76F4;&#x5230;&#x6210;&#x529F;</span></span><br><span class="line"><span class="title">    enq</span>(<span class="keyword">node</span><span class="title">);</span></span><br><span class="line"><span class="title">    return</span> <span class="keyword">node</span><span class="title">;</span></span><br><span class="line"><span class="title">}</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">private</span> <span class="keyword">Node</span> <span class="title">enq</span>(final <span class="keyword">Node</span> <span class="title">node</span>) {</span><br><span class="line">    // &#x591A;&#x6B21;&#x5C1D;&#x8BD5;&#xFF0C;&#x76F4;&#x5230;&#x6210;&#x529F;&#x4E3A;&#x6B62;</span><br><span class="line">    for (;;) {</span><br><span class="line">        // &#x8BB0;&#x5F55;&#x539F;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">        <span class="keyword">Node</span> <span class="title">t</span> = tail;</span><br><span class="line">        // &#x539F;&#x5C3E;&#x8282;&#x70B9;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x521B;&#x5EFA;&#x9996;&#x5C3E;&#x8282;&#x70B9;&#x90FD;&#x4E3A; new <span class="keyword">Node</span><span class="title">()</span></span><br><span class="line"><span class="title">        if</span> (t == null) {</span><br><span class="line">            if (compareAndSetHead(new <span class="keyword">Node</span><span class="title">()))</span></span><br><span class="line"><span class="title">                tail</span> = head;</span><br><span class="line">        // &#x539F;&#x5C3E;&#x8282;&#x70B9;&#x5B58;&#x5728;&#xFF0C;&#x6DFB;&#x52A0;&#x65B0;&#x8282;&#x70B9;&#x4E3A;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">        } else {</span><br><span class="line">            //&#x8BBE;&#x7F6E;&#x4E3A;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">            <span class="keyword">node</span>.<span class="title">prev</span> = t;</span><br><span class="line">            // CAS &#x8BBE;&#x7F6E;&#x65B0;&#x7684;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">            if (compareAndSetTail(t, <span class="keyword">node</span><span class="title">)) {</span></span><br><span class="line"><span class="title">                // &#x6210;&#x529F;&#xFF0C;&#x539F;&#x5C3E;&#x8282;&#x70B9;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E3A;&#x65B0;&#x8282;&#x70B9;</span></span><br><span class="line"><span class="title">                t</span>.next = <span class="keyword">node</span><span class="title">;</span></span><br><span class="line"><span class="title">                return</span> t;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F; :</p>
<blockquote>
<ol>
<li>&#x5728;&#x8C03;&#x7528; <code>#enq(final Node node)</code> &#x65B9;&#x6CD5;&#x65F6;, &#x5982;&#x679C;tail&#x4E3A;null, &#x521B;&#x5EFA;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;Node&#x8282;&#x70B9;, &#x5E76;&#x4E14;&#x8FD9;&#x4E2A;Node&#x8282;&#x70B9;&#x91CC;&#x9762;&#x7684;&#x5B57;&#x6BB5;&#x503C;&#x90FD;&#x6CA1;&#x6709;&#x521D;&#x59CB;&#x5316;</li>
<li>&#x7136;&#x540E;&#x8FDB;&#x884C;&#x7B2C;&#x4E8C;&#x6B21;&#x5FAA;&#x73AF;, &#x8FD9;&#x65F6; tail &#x5DF2;&#x7ECF;&#x4E0D;&#x4E3A;Null, &#x518D;&#x8FDB;&#x884C;&#x8D4B;&#x503C;</li>
</ol>
</blockquote>
<p>&#x4E0D;&#x592A;&#x660E;&#x767D;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;&#x5FEB;&#x901F;&#x5C1D;&#x8BD5;&#x90A3;&#x4E00;&#x6B65;,  <code>#enq(final Node node)</code> &#x65B9;&#x6CD5;&#x7684;&#x4EE3;&#x7801;&#x6709;&#x7740;&#x540C;&#x6837;&#x7684;&#x529F;&#x80FD;, &#x53EF;&#x80FD;&#x662F;&#x4E3A;&#x4E86;&#x4EE3;&#x7801;&#x7684;&#x53EF;&#x8BFB;&#x6027;&#x5427;.</p>
<h3 id="&#x51FA;&#x5217;">2.4.2. &#x51FA;&#x5217;</h3><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">private void setHead(<span class="keyword">Node</span> <span class="title">node</span>) {</span><br><span class="line">    head = <span class="keyword">node</span><span class="title">;</span></span><br><span class="line"><span class="title">    node</span>.thread = null;</span><br><span class="line">    <span class="keyword">node</span>.<span class="title">prev</span> = null;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;, &#x6B64;&#x5904;&#x4E3A;&#x5355;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;,&#x4E0D;&#x9700;&#x52A0;&#x9501;</p>
<hr>
<h1 id="&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x83B7;&#x53D6;&#x4E0E;&#x91CA;&#x653E;">3. &#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x83B7;&#x53D6;&#x4E0E;&#x91CA;&#x653E;</h1><p>AQS &#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x91C7;&#x7528;&#x7684;&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;&#xFF0C;&#x5B50;&#x7C7B;&#x901A;&#x8FC7;&#x7EE7;&#x627F;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x6765;&#x7BA1;&#x7406;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;&#x5BF9;&#x4E8E;&#x5B50;&#x7C7B;&#x800C;&#x8A00;&#xFF0C;&#x5B83;&#x5E76;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x7684;&#x6D3B;&#x8981;&#x505A;&#xFF0C;AQS &#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x540C;&#x6B65;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x5206;&#x4E3A;&#x4E09;&#x7C7B;&#xFF1A;</p>
<ul>
<li>&#x72EC;&#x5360;&#x5F0F;&#x83B7;&#x53D6;&#x548C;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;</li>
<li>&#x5171;&#x4EAB;&#x5F0F;&#x83B7;&#x53D6;&#x548C;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;</li>
<li>&#x67E5;&#x8BE2;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x7B49;&#x5F85;&#x7EBF;&#x7A0B;&#x60C5;&#x51B5;&#x3002;</li>
</ul>
<h2 id="&#x7C7B;&#x5185;&#x90E8;&#x65B9;&#x6CD5;">3.1. &#x7C7B;&#x5185;&#x90E8;&#x65B9;&#x6CD5;</h2><p>AQS &#x4E3B;&#x8981;&#x63D0;&#x4F9B;&#x4E86;&#x5982;&#x4E0B;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ul>
<li><p><code>#getState()</code>&#xFF1A;&#x8FD4;&#x56DE;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x5F53;&#x524D;&#x503C;&#x3002;</p>
</li>
<li><p><code>#setState(int newState)</code>&#xFF1A;&#x8BBE;&#x7F6E;&#x5F53;&#x524D;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;</p>
</li>
<li><p><code>#compareAndSetState(int expect, int update)</code>&#xFF1A;&#x4F7F;&#x7528; CAS &#x8BBE;&#x7F6E;&#x5F53;&#x524D;&#x72B6;&#x6001;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x72B6;&#x6001;&#x8BBE;&#x7F6E;&#x7684;&#x539F;&#x5B50;&#x6027;&#x3002;</p>
</li>
<li><p>&#x3010;&#x53EF;&#x91CD;&#x5199;&#x3011;<code>#tryAcquire(int arg)</code>&#xFF1A;&#x72EC;&#x5360;&#x5F0F;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x8BE5;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x624D;&#x80FD;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;</p>
</li>
<li><p>&#x3010;&#x53EF;&#x91CD;&#x5199;&#x3011;<code>#tryRelease(int arg)</code>&#xFF1A;&#x72EC;&#x5360;&#x5F0F;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;</p>
</li>
<li><p>&#x3010;&#x53EF;&#x91CD;&#x5199;&#x3011;<code>#tryAcquireShared(int arg)</code>&#xFF1A;&#x5171;&#x4EAB;&#x5F0F;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x5927;&#x4E8E;&#x7B49;&#x4E8E; 0 &#xFF0C;&#x5219;&#x8868;&#x793A;&#x83B7;&#x53D6;&#x6210;&#x529F;&#xFF1B;&#x5426;&#x5219;&#xFF0C;&#x83B7;&#x53D6;&#x5931;&#x8D25;&#x3002;</p>
</li>
<li><p>&#x3010;&#x53EF;&#x91CD;&#x5199;&#x3011;<code>#tryReleaseShared(int arg)</code>&#xFF1A;&#x5171;&#x4EAB;&#x5F0F;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;</p>
</li>
<li><p>&#x3010;&#x53EF;&#x91CD;&#x5199;&#x3011;<code>#isHeldExclusively()</code>&#xFF1A;&#x5F53;&#x524D;&#x540C;&#x6B65;&#x5668;&#x662F;&#x5426;&#x5728;&#x72EC;&#x5360;&#x5F0F;&#x6A21;&#x5F0F;&#x4E0B;&#x88AB;&#x7EBF;&#x7A0B;&#x5360;&#x7528;&#xFF0C;&#x4E00;&#x822C;&#x8BE5;&#x65B9;&#x6CD5;&#x8868;&#x793A;&#x662F;&#x5426;&#x88AB;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6240;&#x72EC;&#x5360;&#x3002;</p>
</li>
<li><p><code>acquire(int arg)</code>&#xFF1A;&#x72EC;&#x5360;&#x5F0F;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x7531;&#x8BE5;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#xFF1B;&#x5426;&#x5219;&#xFF0C;&#x5C06;&#x4F1A;&#x8FDB;&#x5165;&#x540C;&#x6B65;&#x961F;&#x5217;&#x7B49;&#x5F85;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x5C06;&#x4F1A;&#x8C03;&#x7528;&#x53EF;&#x91CD;&#x5199;&#x7684; <code>#tryAcquire(int arg)</code> &#x65B9;&#x6CD5;&#xFF1B;</p>
</li>
<li><p><code>#acquireInterruptibly(int arg)</code>&#xFF1A;&#x4E0E; <code>#acquire(int arg)</code> &#x76F8;&#x540C;&#xFF0C;&#x4F46;&#x662F;&#x8BE5;&#x65B9;&#x6CD5;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x3002;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E3A;&#x83B7;&#x53D6;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x800C;&#x8FDB;&#x5165;&#x5230;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x88AB;&#x4E2D;&#x65AD;&#xFF0C;&#x5219;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x629B;&#x51FA;InterruptedException &#x5F02;&#x5E38;&#x5E76;&#x8FD4;&#x56DE;&#x3002;</p>
</li>
<li><p><code>#tryAcquireNanos(int arg, long nanos)</code>&#xFF1A;&#x8D85;&#x65F6;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5728; nanos &#x65F6;&#x95F4;&#x5185;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x4F1A;&#x8FD4;&#x56DE; false &#xFF0C;&#x5DF2;&#x7ECF;&#x83B7;&#x53D6;&#x5219;&#x8FD4;&#x56DE; true &#x3002;</p>
</li>
<li><p><code>#acquireShared(int arg)</code>&#xFF1A;&#x5171;&#x4EAB;&#x5F0F;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x672A;&#x83B7;&#x53D6;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x5C06;&#x4F1A;&#x8FDB;&#x5165;&#x540C;&#x6B65;&#x961F;&#x5217;&#x7B49;&#x5F85;&#xFF0C;&#x4E0E;&#x72EC;&#x5360;&#x5F0F;&#x7684;&#x4E3B;&#x8981;&#x533A;&#x522B;&#x662F;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF1B;</p>
</li>
<li><p><code>#acquireSharedInterruptibly(int arg)</code>&#xFF1A;&#x5171;&#x4EAB;&#x5F0F;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x3002;</p>
</li>
<li><p><code>#tryAcquireSharedNanos(int arg, long nanosTimeout)</code>&#xFF1A;&#x5171;&#x4EAB;&#x5F0F;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x589E;&#x52A0;&#x8D85;&#x65F6;&#x9650;&#x5236;&#x3002;</p>
</li>
<li><p><code>#release(int arg)</code>&#xFF1A;&#x72EC;&#x5360;&#x5F0F;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x5728;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x4E4B;&#x540E;&#xFF0C;&#x5C06;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x5305;&#x542B;&#x7684;&#x7EBF;&#x7A0B;&#x5524;&#x9192;&#x3002;</p>
</li>
<li><p><code>#releaseShared(int arg)</code>&#xFF1A;&#x5171;&#x4EAB;&#x5F0F;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;</p>
</li>
</ul>
<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x770B;&#x4E0B;&#x6765;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x53EF;&#x4EE5;&#x5206;&#x6210; 3 &#x7C7B;&#xFF1A;</p>
<ul>
<li>&#x72EC;&#x5360;&#x5F0F;&#x83B7;&#x53D6;&#x4E0E;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;</li>
<li>&#x5171;&#x4EAB;&#x5F0F;&#x83B7;&#x53D6;&#x4E0E;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;</li>
<li>&#x67E5;&#x8BE2;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x7B49;&#x5F85;&#x7EBF;&#x7A0B;&#x60C5;&#x51B5;</li>
</ul>
<h2 id="&#x72EC;&#x5360;&#x5F0F;">3.2. &#x72EC;&#x5360;&#x5F0F;</h2><p>&#x540C;&#x4E00;&#x65F6;&#x523B;&#xFF0C;&#x4EC5;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;</p>
<h3 id="&#x72EC;&#x5360;&#x5F0F;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x83B7;&#x53D6;">3.2.1. &#x72EC;&#x5360;&#x5F0F;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x83B7;&#x53D6;</h3><blockquote>
<p><code>#acquire(int arg)</code> &#x65B9;&#x6CD5;&#xFF0C;&#x4E3A; AQS &#x63D0;&#x4F9B;&#x7684;&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x4E3A;&#x72EC;&#x5360;&#x5F0F;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x4F46;&#x662F;&#x8BE5;&#x65B9;&#x6CD5;&#x5BF9;&#x4E2D;&#x65AD;&#x4E0D;&#x654F;&#x611F;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x7531;&#x4E8E;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x5931;&#x8D25;&#x800C;&#x52A0;&#x5165;&#x5230; CLH &#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x540E;&#x7EED;&#x5BF9;&#x8BE5;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x4E2D;&#x65AD;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x7EBF;&#x7A0B;&#x4E0D;&#x4F1A;&#x4ECE; CLH &#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#x79FB;&#x9664;&#x3002;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
</blockquote>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public final void acquire(<span class="built_in">int</span> arg) {</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">try</span><span class="constructor">Acquire(<span class="params">arg</span>)</span> &amp;&amp;</span><br><span class="line">        acquire<span class="constructor">Queued(<span class="params">addWaiter</span>(Node.EXCLUSIVE)</span>, arg))</span><br><span class="line">        self<span class="constructor">Interrupt()</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x62C6;&#x5206;&#x6210;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x770B;</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public final void acquire(<span class="built_in">int</span> arg) {</span><br><span class="line">    <span class="comment">// &#x9996;&#x5148;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x72EC;&#x5360;&#x9501; (&#x8BE5;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;), &#x5C1D;&#x8BD5;&#x5931;&#x8D25;&#x540E;&#x6267;&#x884C;&#x4E0B;&#x65B9;&#x4EE3;&#x7801;</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">try</span><span class="constructor">Acquire(<span class="params">arg</span>)</span>){</span><br><span class="line">        <span class="comment">// static final Node EXCLUSIVE = null;</span></span><br><span class="line">        <span class="comment">// &#x4E0A;&#x65B9;&#x8BB2;&#x5230;&#x7684;&#x5165;&#x5217;&#x7684;&#x52A8;&#x4F5C;</span></span><br><span class="line">        Node node = add<span class="constructor">Waiter(Node.EXCLUSIVE)</span>;</span><br><span class="line">        <span class="comment">// &#x81EA;&#x65CB;&#x76F4;&#x5230;&#x83B7;&#x5F97;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6210;&#x529F; </span></span><br><span class="line">        <span class="comment">// &#x5F53;&#x8FD4;&#x56DE; true &#x65F6;&#xFF0C;&#x8868;&#x793A;&#x5728;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x53D1;&#x751F;&#x8FC7;&#x7EBF;&#x7A0B;&#x4E2D;&#x65AD;</span></span><br><span class="line">        boolean flag = acquire<span class="constructor">Queued(<span class="params">node</span>, <span class="params">arg</span>)</span>;</span><br><span class="line">        <span class="keyword">if</span>(flag){</span><br><span class="line">            <span class="comment">// &#x6062;&#x590D;&#x7EBF;&#x7A0B;&#x4E2D;&#x65AD;&#x7684;&#x6807;&#x8BC6;</span></span><br><span class="line">            self<span class="constructor">Interrupt()</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">static void self<span class="constructor">Interrupt()</span> {</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>current<span class="constructor">Thread()</span>.interrupt<span class="literal">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="acquireQueued">3.2.1.1. acquireQueued</h4><p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E3A;&#x4E00;&#x4E2A;&#x81EA;&#x65CB;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#xFF08;Node&#xFF09;&#x8FDB;&#x5165;&#x540C;&#x6B65;&#x961F;&#x5217;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x8FDB;&#x5165;&#x4E00;&#x4E2A;&#x81EA;&#x65CB;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x4F1A;&#x81EA;&#x7701;&#x5730;&#x89C2;&#x5BDF;&#xFF0C;&#x5F53;&#x6761;&#x4EF6;&#x6EE1;&#x8DB3;&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4ECE;&#x8FD9;&#x4E2A;&#x81EA;&#x65CB;&#x8FC7;&#x7A0B;&#x4E2D;&#x9000;&#x51FA;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x4E00;&#x76F4;&#x6267;&#x884C;&#x4E0B;&#x53BB;&#x3002;<br><img src="/2019/AQS/acquireQueued.png" alt="&#x6D41;&#x7A0B;&#x56FE;"></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="built_in">bool</span>ean acquireQueued(<span class="keyword">final</span> Node node, <span class="built_in">int</span> arg) {</span><br><span class="line">    <span class="comment">// &#x8BB0;&#x5F55;&#x662F;&#x5426;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6210;&#x529F;</span></span><br><span class="line">    <span class="built_in">bool</span>ean failed = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">// &#x8BB0;&#x5F55;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x662F;&#x5426;&#x53D1;&#x751F;&#x7EBF;&#x7A0B;&#x4E2D;&#x65AD;</span></span><br><span class="line">        <span class="built_in">bool</span>ean <span class="built_in">int</span>errupted = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * &#x81EA;&#x65CB;&#x8FC7;&#x7A0B;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x6B7B;&#x5FAA;&#x73AF;&#x800C;&#x5DF2;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="comment">// &#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x524D;&#x9A71;&#x8282;&#x70B9;</span></span><br><span class="line">            <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">            <span class="comment">// &#x524D;&#x9A71;&#x8282;&#x70B9;&#x662F;&#x5934;&#x7ED3;&#x70B9;</span></span><br><span class="line">            <span class="keyword">if</span> (p == head) {</span><br><span class="line">                <span class="comment">// &#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x72EC;&#x5360;&#x9501;</span></span><br><span class="line">                <span class="keyword">if</span>(tryAcquire(arg)){</span><br><span class="line">                    <span class="comment">// &#x8BBE;&#x7F6E;&#x5F53;&#x524D;&#x8282;&#x70B9;( &#x7EBF;&#x7A0B; )&#x4E3A;&#x65B0;&#x7684; head</span></span><br><span class="line">                    setHead(node);</span><br><span class="line">                    <span class="comment">// &#x8BBE;&#x7F6E;&#x8001;&#x7684;&#x5934;&#x8282;&#x70B9; p &#x4E0D;&#x518D;&#x6307;&#x5411;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x8BA9;&#x5B83;&#x81EA;&#x8EAB;&#x66F4;&#x5FEB;&#x7684;&#x88AB; GC &#x3002;</span></span><br><span class="line">                    p.next = <span class="literal">null</span>;</span><br><span class="line">                    <span class="comment">// &#x6807;&#x8BB0; failed = false &#xFF0C;&#x8868;&#x793A;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6210;&#x529F;</span></span><br><span class="line">                    failed = <span class="literal">false</span>;</span><br><span class="line">                    <span class="comment">// &#x8FD4;&#x56DE;&#x8BB0;&#x5F55;&#x83B7;&#x53D6;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x662F;&#x5426;&#x53D1;&#x751F;&#x7EBF;&#x7A0B;&#x4E2D;&#x65AD;&#x3002;</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">int</span>errupted;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// &#x5224;&#x65AD;&#x83B7;&#x53D6;&#x5931;&#x8D25;&#x540E;&#xFF0C;&#x662F;&#x5426;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x3002;</span></span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node)){</span><br><span class="line">               <span class="comment">// &#x7EBF;&#x7A0B;&#x7B49;&#x5F85;, &#x8C03;&#x7528;&#x7684;&#x662F; LockSupport.park(this); &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x8BA9;&#x51FA;CPU</span></span><br><span class="line">                <span class="keyword">if</span>(parkAndCheckInterrupt()){</span><br><span class="line">                    <span class="built_in">int</span>errupted = <span class="literal">true</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } finally {</span><br><span class="line">        <span class="comment">// &#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#xFF0C;&#x53D6;&#x6D88;&#x83B7;&#x53D6;&#x3002;&#xFF08;&#x4E00;&#x822C;&#x7528;&#x4E0D;&#x5230;&#xFF0C; &#x53EF;&#x5FFD;&#x7565;&#xFF09;</span></span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="built_in">bool</span>ean parkAndCheckInterrupt() {</span><br><span class="line">    LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> Thread.<span class="built_in">int</span>errupted();</span><br><span class="line">}</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Thread</span>{</span><br><span class="line">    <span class="keyword">public</span> static <span class="built_in">bool</span>ean <span class="built_in">int</span>errupted() {</span><br><span class="line">        <span class="keyword">return</span> currentThread().isInterrupted(<span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<h4 id="shouldParkAfterFailedAcquire-&#xFF08;&#x662F;&#x5426;&#x9700;&#x8981;park&#xFF09;">3.2.1.2. shouldParkAfterFailedAcquire &#xFF08;&#x662F;&#x5426;&#x9700;&#x8981;park&#xFF09;</h4><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>&#x56E0;&#x4E3A;&#x8D85;&#x65F6;&#x6216;&#x8005;&#x4E2D;&#x65AD;&#xFF0C;&#x8282;&#x70B9;&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;&#x53D6;&#x6D88;&#x72B6;&#x6001;&#xFF0C;&#x88AB;&#x53D6;&#x6D88;&#x7684;&#x8282;&#x70B9;&#x65F6;&#x4E0D;&#x4F1A;&#x53C2;&#x4E0E;&#x5230;&#x7ADE;&#x4E89;&#x4E2D;&#x7684;&#xFF0C;&#x4ED6;&#x4F1A;&#x4E00;&#x76F4;&#x4FDD;&#x6301;&#x53D6;&#x6D88;&#x72B6;&#x6001;&#x4E0D;&#x4F1A;&#x8F6C;&#x53D8;&#x4E3A;&#x5176;&#x4ED6;&#x72B6;&#x6001; (&#x4E00;&#x822C;&#x7528;&#x4E0D;&#x5230;&#xFF0C;&#x5FFD;&#x7565;)</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> */</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> CANCELLED =  <span class="number">1</span>;</span><br><span class="line"><span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x5904;&#x4E8E;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x5982;&#x679C;&#x91CA;&#x653E;&#x4E86;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6216;&#x8005;&#x88AB;&#x53D6;&#x6D88;&#xFF0C;&#x5C06;&#x4F1A;&#x901A;&#x77E5;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#xFF0C;&#x4F7F;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x5F97;&#x4EE5;&#x8FD0;&#x884C;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>&#x9ED8;&#x8BA4;&#x503C;&#x4E3A; 0&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x5FAA;&#x73AF;&#x4F1A;&#x53D8;&#x4E3A;-1&#xFF0C;&#x5982;&#x679C;&#x4E3A;-1 &#xFF0C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;park&#x3002; &#x53EF;&#x4EE5;&#x4F7F;&#x7528;status &#xFF01;= 0 &#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#xFF08;&#x5982;&#x679C;&#x662F;&#x5C3E;&#x7ED3;&#x70B9;&#xFF0C;status = 0&#xFF09;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> */</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> SIGNAL    = <span class="number">-1</span>;</span><br><span class="line"><span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>&#x8282;&#x70B9;&#x5728;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x8282;&#x70B9;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x5728;Condition&#x4E0A;&#xFF0C;&#x5F53;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5BF9;Condition&#x8C03;&#x7528;&#x4E86;signal()&#x540E;&#xFF0C;&#x8BE5;&#x8282;&#x70B9;&#x5C06;&#x4F1A;&#x4ECE;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#x8F6C;&#x79FB;&#x5230;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x52A0;&#x5165;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x83B7;&#x53D6;&#x4E2D;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> */</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> CONDITION = <span class="number">-2</span>;</span><br><span class="line"><span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>&#x8868;&#x793A;&#x4E0B;&#x4E00;&#x6B21;&#x5171;&#x4EAB;&#x5F0F;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x83B7;&#x53D6;&#xFF0C;&#x5C06;&#x4F1A;&#x65E0;&#x6761;&#x4EF6;&#x5730;&#x4F20;&#x64AD;&#x4E0B;&#x53BB;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> */</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> PROPAGATE = <span class="number">-3</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">private static boolean shouldParkAfterFailedAcquire(<span class="keyword">Node</span> <span class="title">pred</span>, <span class="keyword">Node</span> <span class="title">node</span>) {</span><br><span class="line">    // &#x83B7;&#x5F97;&#x524D;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x7B49;&#x5F85;&#x72B6;&#x6001;</span><br><span class="line">    int ws = pred.waitStatus;</span><br><span class="line">    // &#x7B49;&#x5F85;&#x72B6;&#x6001;&#x4E3A; <span class="keyword">Node</span>.<span class="title">SIGNAL</span> &#x65F6;&#xFF0C;&#x8868;&#x793A; pred &#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9; <span class="keyword">node</span> <span class="title">&#x7684;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x3002;&#x5728; pred</span> &#x7684;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x4F1A;&#x5BF9; <span class="keyword">node</span> <span class="title">&#x7684;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x5524;&#x9192;&#x901A;&#x77E5;&#x3002;</span></span><br><span class="line"><span class="title">    // &#x8FD4;&#x56DE; true</span> &#xFF0C;&#x8868;&#x660E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x88AB; park&#xFF0C;&#x5B89;&#x5168;&#x7684;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x3002;</span><br><span class="line">    if (ws == <span class="keyword">Node</span>.<span class="title">SIGNAL</span>) </span><br><span class="line">        return <span class="literal">true</span>;</span><br><span class="line">    if (ws &gt; <span class="number">0</span>) {</span><br><span class="line">        // &#x7B49;&#x5F85;&#x72B6;&#x6001;&#x4E3A; <span class="keyword">NODE</span>.<span class="title">CANCELLED</span> &#x65F6;&#xFF0C;&#x5219;&#x8868;&#x660E;&#x8BE5;&#x7EBF;&#x7A0B;&#x7684;&#x524D;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x5DF2;&#x7ECF;&#x7B49;&#x5F85;&#x8D85;&#x65F6;&#x6216;&#x8005;&#x88AB;&#x4E2D;&#x65AD;&#x4E86;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x4ECE; CLH &#x961F;&#x5217;&#x4E2D;&#x5C06;&#x8BE5;&#x524D;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x5220;&#x9664;&#x6389;&#xFF0C;&#x5FAA;&#x73AF;&#x56DE;&#x6EAF;&#xFF0C;&#x76F4;&#x5230;&#x524D;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x72B6;&#x6001; <span class="tag">&lt;= 0 </span></span><br><span class="line"><span class="tag">        do {</span></span><br><span class="line"><span class="tag">            node.prev = pred = pred.prev;</span></span><br><span class="line"><span class="tag">        } while (pred.waitStatus &gt;</span> <span class="number">0</span>);</span><br><span class="line">        pred.next = <span class="keyword">node</span><span class="title">;</span></span><br><span class="line"><span class="title">    } else</span> {</span><br><span class="line">        // &#x7B49;&#x5F85;&#x72B6;&#x6001;&#x4E3A; <span class="number">0</span> &#x6216;&#x8005; <span class="keyword">Node</span>.<span class="title">PROPAGATE</span> &#x65F6;&#xFF0C;&#x901A;&#x8FC7; CAS &#x8BBE;&#x7F6E;&#xFF0C;&#x5C06;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A; <span class="keyword">Node</span>.<span class="title">SIGNAL</span></span><br><span class="line">        compareAndSetWaitStatus(pred, ws, <span class="keyword">Node</span>.<span class="title">SIGNAL</span>);</span><br><span class="line">    }</span><br><span class="line">    return <span class="literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="cancelAcquire&#xFF08;&#x4E00;&#x822C;&#x7528;&#x4E0D;&#x5230;&#xFF0C;-&#x53EF;&#x5FFD;&#x7565;&#xFF09;">3.2.1.3. cancelAcquire&#xFF08;&#x4E00;&#x822C;&#x7528;&#x4E0D;&#x5230;&#xFF0C; &#x53EF;&#x5FFD;&#x7565;&#xFF09;</h4><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> void cancel<span class="constructor">Acquire(Node <span class="params">node</span>)</span> {</span><br><span class="line">    <span class="comment">// &#x5C06;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x7F6E;&#x7A7A;</span></span><br><span class="line">    node.thread = null;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x524D;&#x7F6E;&#x8282;&#x70B9;</span></span><br><span class="line">    Node pred = node.prev;</span><br><span class="line">    <span class="comment">// &#x524D;&#x7F6E;&#x8282;&#x70B9;&#x8D85;&#x65F6;&#x6216;&#x7B49;&#x5F85;, &#x5220;&#x9664;&#x524D;&#x7F6E;&#x8282;&#x70B9;</span></span><br><span class="line">    <span class="keyword">while</span> (pred.waitStatus &gt; <span class="number">0</span>){</span><br><span class="line">        node.prev = pred = pred.prev;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x7531;&#x4E8E;&#x5B58;&#x5728;&#x5E76;&#x53D1;&#x60C5;&#x51B5;, &#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06; pred.next &#x6682;&#x5B58;&#x8D77;&#x6765;</span></span><br><span class="line">    Node predNext = pred.next;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &#x8BBE;&#x7F6E; node &#x8282;&#x70B9;&#x7684;&#x4E3A;&#x53D6;&#x6D88;&#x7684;&#x7B49;&#x5F85;&#x72B6;&#x6001; Node.CANCELLED</span></span><br><span class="line">    <span class="comment">// &#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x76F4;&#x63A5;&#x5199;&#xFF0C;&#x800C;&#x4E0D;&#x662F; CAS</span></span><br><span class="line">    <span class="comment">// &#x5728;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x4E4B;&#x540E;&#xFF0C;&#x5176;&#x5B83; Node &#x8282;&#x70B9;&#x53EF;&#x4EE5;&#x5FFD;&#x7565; node</span></span><br><span class="line">    node.waitStatus = Node.CANCELLED;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x5982;&#x679C;node&#x4E3A;&#x5C3E;&#x7ED3;&#x70B9; &#x5E76;&#x4E14;--cas&#x8BBE;&#x7F6E;this&#x7684;&#x5C3E;&#x7ED3;&#x70B9;&#x4E3A;&#x7F13;&#x5B58;&#x7684;&#x524D;&#x7F6E;&#x8282;&#x70B9;, &#x671F;&#x671B;&#x503C;&#x4E3A;node-- &#x6210;&#x529F;</span></span><br><span class="line">    <span class="keyword">if</span> (node<span class="operator"> == </span>tail<span class="operator"> &amp;&amp; </span>compare<span class="constructor">AndSetTail(<span class="params">node</span>, <span class="params">pred</span>)</span>) {</span><br><span class="line">        <span class="comment">// cas&#x8BBE;&#x7F6E;&#x7F13;&#x5B58;&#x7684;&#x524D;&#x7F6E;&#x8282;&#x70B9;&#x7684;&#x540E;&#x7F6E;&#x8282;&#x70B9;&#x4E3A; null, &#x671F;&#x671B;&#x503C;&#x4E3A;predNext</span></span><br><span class="line">        compare<span class="constructor">AndSetNext(<span class="params">pred</span>, <span class="params">predNext</span>, <span class="params">null</span>)</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// If successor needs signal, try to set pred&apos;s next-link</span></span><br><span class="line">        <span class="comment">// so it will get one. Otherwise wake it up to propagate.</span></span><br><span class="line">        <span class="built_in">int</span> ws;</span><br><span class="line">        <span class="comment">// &#x524D;&#x7F6E;&#x8282;&#x70B9;&#x4E0D;&#x4E3A;&#x5934;&#x7ED3;&#x70B9;</span></span><br><span class="line">        <span class="comment">// &#x5E76;&#x4E14; (&#x524D;&#x7F6E;&#x8282;&#x70B9;&#x7684;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x4E3A; Node.SIGNAL &#x6216;&#x8005; (&#x524D;&#x7F6E;&#x8282;&#x70B9;&#x7684;&#x7B49;&#x5F85;&#x72B6;&#x6001; &lt;0 &#x5E76;&#x4E14; &#x5C1D;&#x8BD5;&#x5C06;&#x524D;&#x7F6E;&#x8282;&#x70B9;&#x7684;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A; Node.SIGNAL &#x6210;&#x529F; &#x5E76;&#x4E14; &#x524D;&#x7F6E;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x4E0D;&#x4E3A;null)</span></span><br><span class="line">        <span class="keyword">if</span> (pred != head<span class="operator"> &amp;&amp; </span></span><br><span class="line">            ((ws = pred.waitStatus)<span class="operator"> == </span>Node.SIGNAL <span class="pattern-match"><span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">             (ws &lt;= 0 <span class="operator">&amp;&amp;</span> compare<span class="constructor">AndSetWaitStatus(<span class="params">pred</span>, <span class="params">ws</span>, Node.SIGNAL)</span>)) <span class="operator">&amp;&amp;</span></span></span><br><span class="line"><span class="pattern-match">            pred.thread != null) {</span></span><br><span class="line"><span class="pattern-match">            <span class="constructor">Node</span> next = node.next;</span></span><br><span class="line"><span class="pattern-match">            <span class="keyword">if</span> (next != null <span class="operator">&amp;&amp;</span> next.wait<span class="constructor">Status</span> &lt;= 0)</span></span><br><span class="line"><span class="pattern-match">                <span class="operator">/</span><span class="operator">/</span> <span class="constructor">CAS</span> &#x8BBE;&#x7F6E; pred &#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E3A; next</span></span><br><span class="line"><span class="pattern-match">                compare<span class="constructor">AndSetNext(<span class="params">pred</span>, <span class="params">predNext</span>, <span class="params">next</span>)</span>;</span></span><br><span class="line"><span class="pattern-match">        } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="pattern-match">            <span class="operator">/</span><span class="operator">/</span> &#x5524;&#x9192; node &#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;</span></span><br><span class="line"><span class="pattern-match">            unpark<span class="constructor">Successor(<span class="params">node</span>)</span>;</span></span><br><span class="line"><span class="pattern-match">        }</span></span><br><span class="line"><span class="pattern-match"></span></span><br><span class="line"><span class="pattern-match">        node.next = node; <span class="operator">/</span><span class="operator">/</span> help <span class="constructor">GC</span></span></span><br><span class="line"><span class="pattern-match">    }</span></span><br><span class="line"><span class="pattern-match">}</span></span><br><span class="line"><span class="pattern-match"><span class="keyword">private</span> final boolean compare<span class="constructor">AndSetTail(Node <span class="params">expect</span>, Node <span class="params">update</span>)</span> {</span></span><br><span class="line"><span class="pattern-match">    <span class="operator">/</span><span class="operator">/</span> &#x53D8;&#x66F4; this&#x7684;&#x5C3E;&#x7ED3;&#x70B9; &#x4E3A; update ,&#x671F;&#x671B;&#x53D8;&#x66F4;&#x4E3A; expect</span></span><br><span class="line"><span class="pattern-match">    return unsafe.compare<span class="constructor">AndSwapObject(<span class="params">this</span>, <span class="params">tailOffset</span>, <span class="params">expect</span>, <span class="params">update</span>)</span>;</span></span><br><span class="line"><span class="pattern-match">}</span></span><br><span class="line"><span class="pattern-match"><span class="keyword">private</span> static final boolean compare<span class="constructor">AndSetNext(Node <span class="params">node</span>, Node <span class="params">expect</span>, Node <span class="params">update</span>)</span> {</span></span><br><span class="line"><span class="pattern-match">    <span class="operator">/</span><span class="operator">/</span> &#x53D8;&#x66F4; node &#x7684;&#x540E;&#x7F6E;&#x8282;&#x70B9; &#x4E3A; update ,&#x671F;&#x671B;&#x53D8;&#x66F4;&#x4E3A; expect</span></span><br><span class="line"><span class="pattern-match">    return unsafe.compare<span class="constructor">AndSwapObject(<span class="params">node</span>, <span class="params">nextOffset</span>, <span class="params">expect</span>, <span class="params">update</span>)</span>;</span></span><br><span class="line"><span class="pattern-match">}</span></span><br></pre></td></tr></table></figure>
<h3 id="&#x72EC;&#x5360;&#x5F0F;&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;">3.2.2. &#x72EC;&#x5360;&#x5F0F;&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;</h3><p>AQS &#x63D0;&#x4F9B;&#x4E86;<code>acquire(int arg)</code> &#x65B9;&#x6CD5;&#xFF0C;&#x4EE5;&#x4F9B;&#x72EC;&#x5360;&#x5F0F;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x4F46;&#x662F;&#x8BE5;&#x65B9;&#x6CD5;&#x5BF9;&#x4E2D;&#x65AD;&#x4E0D;&#x54CD;&#x5E94;&#xFF0C;&#x5BF9;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x4E2D;&#x65AD;&#x64CD;&#x4F5C;&#x540E;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;&#x4F1A;&#x4F9D;&#x7136;&#x4F4D;&#x4E8E;CLH&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x7B49;&#x5F85;&#x7740;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x3002;&#x4E3A;&#x4E86;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF0C;AQS &#x63D0;&#x4F9B;&#x4E86;<code>#acquireInterruptibly(int arg)</code> &#x65B9;&#x6CD5;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x5728;&#x7B49;&#x5F85;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x88AB;&#x4E2D;&#x65AD;&#x4E86;&#xFF0C;&#x4F1A;&#x7ACB;&#x523B;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF0C;&#x5E76;&#x629B;&#x51FA; <code>InterruptedException</code> &#x5F02;&#x5E38;&#x3002;</p>
<p><strong>&#x5927;&#x90E8;&#x5206;&#x6458;&#x6284;&#x81EA;</strong>: </p>
<ol>
<li><a href="http://www.iocoder.cn/categories/JUC/?vip" target="_blank" rel="noopener">&#x828B;&#x9053;&#x6E90;&#x7801;</a></li>
<li><a href="http://cmsblogs.com/?p=2197" target="_blank" rel="noopener">&#x5C0F;&#x660E;&#x54E5;</a></li>
<li><a href="https://blog.csdn.net/java_lyvee/article/details/98966684" target="_blank" rel="noopener">JUC AQS ReentrantLock&#x6E90;&#x7801;&#x5206;&#x6790;</a></li>
</ol>
]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
  </entry>
  <entry>
    <title>并发5:CAS</title>
    <url>/2019/CAS/</url>
    <content><![CDATA[<h1 id="&#x7B80;&#x4ECB;">1. &#x7B80;&#x4ECB;</h1><blockquote>
<p>CAS &#x5168;&#x62FC;&#x4E3A; <code>Compare And Swap</code> &#x6BD4;&#x8F83;&#x548C;&#x4EA4;&#x6362;, &#x4E5F;&#x6709;&#x4EBA;&#x7406;&#x89E3;&#x4E3A; <code>Compare And Set</code>&#x6BD4;&#x8F83;&#x548C;&#x8D4B;&#x503C;</p>
</blockquote>
<h1 id="&#x9501;&#x4E0E;&#x5171;&#x4EAB;&#x53D8;&#x91CF;">2. &#x9501;&#x4E0E;&#x5171;&#x4EAB;&#x53D8;&#x91CF;</h1><ul>
<li>&#x52A0;&#x9501;&#x662F;&#x4E00;&#x79CD;&#x60B2;&#x89C2;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x5B83;&#x603B;&#x662F;&#x8BA4;&#x4E3A;&#x6BCF;&#x6B21;&#x8BBF;&#x95EE;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x603B;&#x4F1A;&#x53D1;&#x751F;&#x51B2;&#x7A81;&#xFF0C;&#x6240;&#x4EE5;&#x5B81;&#x613F;&#x727A;&#x7272;&#x6027;&#x80FD;&#xFF08;&#x65F6;&#x95F4;&#xFF09;&#x6765;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x5B89;&#x5168;&#x3002;</li>
<li>&#x65E0;&#x9501;&#x662F;&#x4E00;&#x79CD;&#x4E50;&#x89C2;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x5B83;&#x5047;&#x8BBE;&#x7EBF;&#x7A0B;&#x8BBF;&#x95EE;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x51B2;&#x7A81;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x9700;&#x8981;&#x52A0;&#x9501;&#xFF0C;&#x56E0;&#x6B64;&#x7EBF;&#x7A0B;&#x5C06;&#x4E0D;&#x65AD;&#x6267;&#x884C;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x505C;&#x6B62;&#x3002;&#x4E00;&#x65E6;&#x78B0;&#x5230;&#x51B2;&#x7A81;&#xFF0C;&#x5C31;&#x91CD;&#x8BD5;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x76F4;&#x5230;&#x6CA1;&#x6709;&#x51B2;&#x7A81;&#x4E3A;&#x6B62;&#x3002;</li>
<li>&#x65E0;&#x9501;&#x7684;&#x7B56;&#x7565;&#x4F7F;&#x7528;&#x4E00;&#x79CD;&#x53EB;&#x505A;&#x6BD4;&#x8F83;&#x4EA4;&#x6362;&#x7684;&#x6280;&#x672F;&#xFF08;CAS Compare And Swap&#xFF09;&#x6765;&#x9274;&#x522B;&#x7EBF;&#x7A0B;&#x51B2;&#x7A81;&#xFF0C;&#x4E00;&#x65E6;&#x68C0;&#x6D4B;&#x5230;&#x51B2;&#x7A81;&#x4EA7;&#x751F;&#xFF0C;&#x5C31;&#x91CD;&#x8BD5;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x76F4;&#x5230;&#x6CA1;&#x6709;&#x51B2;&#x7A81;&#x4E3A;&#x6B62;&#x3002;</li>
</ul>
<a id="more"></a>

<h1 id="CAS&#x539F;&#x7406;">3. CAS&#x539F;&#x7406;</h1><p>&#x6267;&#x884C;&#x51FD;&#x6570;&#xFF1A;CAS(V&#xFF0C;E&#xFF0C;N)</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">V:</span> &#x51C6;&#x5907;&#x8981;&#x88AB;&#x66F4;&#x65B0;&#x7684;&#x53D8;&#x91CF;</span><br><span class="line"><span class="symbol">E:</span> &#x671F;&#x671B;&#x503C;</span><br><span class="line"><span class="symbol">N:</span> &#x8868;&#x793A;&#x65B0;&#x503C;</span><br></pre></td></tr></table></figure>
<p>V&#x662F;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#xFF0C;&#x6211;&#x4EEC;&#x62FF;&#x7740;&#x81EA;&#x5DF1;&#x51C6;&#x5907;&#x7684;&#x8FD9;&#x4E2A;E&#xFF0C;&#x53BB;&#x8DDF;V&#x53BB;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#x679C;E == V &#xFF0C;&#x8BF4;&#x660E;&#x5F53;&#x524D;&#x6CA1;&#x6709;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x5728;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x6211;&#x4EEC;&#x628A;N &#x8FD9;&#x4E2A;&#x503C; &#x5199;&#x5165;&#x5BF9;&#x8C61;&#x7684; V &#x53D8;&#x91CF;&#x4E2D;&#x3002;&#x5982;&#x679C; E &#xFF01;= V &#xFF0C;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x51C6;&#x5907;&#x7684;&#x8FD9;&#x4E2A;E&#xFF0C;&#x5DF2;&#x7ECF;&#x8FC7;&#x65F6;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x91CD;&#x65B0;&#x51C6;&#x5907;&#x4E00;&#x4E2A;&#x6700;&#x65B0;&#x7684;E &#xFF0C;&#x53BB;&#x8DDF;V &#x6BD4;&#x8F83;&#xFF0C;&#x6BD4;&#x8F83;&#x6210;&#x529F;&#x540E;&#x624D;&#x80FD;&#x66F4;&#x65B0; V&#x7684;&#x503C;&#x4E3A;N&#x3002;</p>
<p><img src="/2019/CAS/cas.png" alt></p>
<h1 id="ABA&#x95EE;&#x9898;">4. ABA&#x95EE;&#x9898;</h1><h2 id="&#x95EE;&#x9898;">4.1. &#x95EE;&#x9898;</h2><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> a = <span class="number">0</span>;</span><br><span class="line">Thread t1,t2,t3;</span><br><span class="line">t1: a=<span class="number">1</span>   cas(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">t2: a=<span class="number">0</span>   cas(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line">t3: a=<span class="number">1</span>   cas(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>&#x5728;&#x4E0A;&#x65B9;&#x4F2A;&#x4EE3;&#x7801;&#x7684;&#x60C5;&#x51B5;&#x4E0B;, </p>
<ol>
<li>&#x7EBF;&#x7A0B;t1&#x4F7F;&#x7528;cas&#x5C06;a&#x4ECE;0&#x4FEE;&#x6539;&#x4E3A;1, &#x671F;&#x671B;&#x503C;&#x4E3A;0(&#x6210;&#x7ACB;)</li>
<li>&#x7EBF;&#x7A0B;t2&#x4F7F;&#x7528;cas&#x5C06;a&#x4ECE;1&#x4FEE;&#x6539;&#x4E3A;0, &#x671F;&#x671B;&#x503C;&#x4E3A;1(&#x6210;&#x7ACB;)</li>
<li>&#x7EBF;&#x7A0B;t3&#x4F7F;&#x7528;cas&#x5C06;a&#x4ECE;0&#x4FEE;&#x6539;&#x4E3A;1, &#x671F;&#x671B;&#x503C;&#x4E3A;0(&#x6210;&#x7ACB;)</li>
</ol>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;, &#x5728; t3 &#x8FDB;&#x884C;&#x5BF9;a&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x7684;&#x65F6;&#x5019;, a&#x7684;&#x503C;&#x5DF2;&#x7ECF;&#x88AB;t1,t2&#x4FEE;&#x6539;&#x8FC7;&#x4E86;, &#x8FD9;&#x5C31;&#x662F;aba&#x95EE;&#x9898;</p>
<h2 id="&#x89E3;&#x51B3;&#x601D;&#x8DEF;">4.2. &#x89E3;&#x51B3;&#x601D;&#x8DEF;</h2><p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;, &#x5728;cas&#x7684;&#x65F6;&#x5019;&#x8BBE;&#x7F6E;&#x8FDB;&#x53BB;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x53F7;, &#x7528;&#x4E8E;&#x8BB0;&#x5F55;. &#x6BCF;&#x6B21;&#x4FEE;&#x6539;&#x90FD;&#x5BF9;&#x7248;&#x672C;&#x53F7;&#x8FDB;&#x884C;&#x53D8;&#x66F4;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">CAS(V&#xFF0C;E, version&#xFF0C;N)</span><br><span class="line"><span class="built_in">int</span> a = <span class="number">0</span>;</span><br><span class="line">Thread t1,t2,t3;</span><br><span class="line">t1: a=<span class="number">1</span>   cas(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">t2: a=<span class="number">0</span>   cas(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line">t3: a=<span class="number">1</span>   cas(<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x5728;t3 &#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#x7248;&#x672C;&#x53F7;&#x4E0D;&#x5BF9;, &#x4FEE;&#x6539;&#x5931;&#x8D25;.</p>
<h1 id="&#x65E0;&#x9501;&#x7684;&#x6548;&#x679C;">5. &#x65E0;&#x9501;&#x7684;&#x6548;&#x679C;</h1><ul>
<li>&#x5982;&#x679C;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x4F7F;&#x7528;CAS&#x64CD;&#x4F5C;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x80FD;&#x591F;&#x4FEE;&#x6539;&#x6210;&#x529F;&#x3002;&#x5176;&#x4F59;&#x7684;&#x7EBF;&#x7A0B;&#x63D0;&#x4F9B;&#x7684;&#x671F;&#x671B;&#x503C;&#x5DF2;&#x7ECF;&#x4E0E;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x503C;&#x4E0D;&#x4E00;&#x6837;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5747;&#x4F1A;&#x5931;&#x8D25;&#x3002;</li>
<li>&#x7531;&#x4E8E;CAS&#x64CD;&#x4F5C;&#x5C5E;&#x4E8E;&#x4E50;&#x89C2;&#x6D3E;&#xFF0C;&#x5B83;&#x603B;&#x662F;&#x8BA4;&#x4E3A;&#x81EA;&#x5DF1;&#x80FD;&#x591F;&#x64CD;&#x4F5C;&#x6210;&#x529F;&#xFF0C;&#x6240;&#x4EE5;&#x64CD;&#x4F5C;&#x5931;&#x8D25;&#x7684;&#x7EBF;&#x7A0B;&#x5C06;&#x4F1A;&#x518D;&#x6B21;&#x53D1;&#x8D77;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x88AB;OS&#x6302;&#x8D77;&#x3002;&#x6240;&#x4EE5;&#x8BF4;&#xFF0C;&#x5373;&#x4F7F;CAS&#x64CD;&#x4F5C;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x540C;&#x6B65;&#x9501;&#xFF0C;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x4E5F;&#x80FD;&#x591F;&#x77E5;&#x9053;&#x5BF9;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x5F71;&#x54CD;&#x3002;</li>
<li>&#x56E0;&#x4E3A;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x6CA1;&#x6709;&#x88AB;&#x6302;&#x8D77;&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x4F1A;&#x518D;&#x6B21;&#x53D1;&#x8D77;&#x4FEE;&#x6539;&#x5C1D;&#x8BD5;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x9501;&#x64CD;&#x4F5C;&#x5373;CAS&#x64CD;&#x4F5C;&#x5929;&#x751F;&#x514D;&#x75AB;&#x6B7B;&#x9501;&#x3002;</li>
<li>&#x53E6;&#x5916;&#x4E00;&#x70B9;&#x9700;&#x8981;&#x77E5;&#x9053;&#x7684;&#x662F;&#xFF0C;CAS&#x662F;&#x7CFB;&#x7EDF;&#x539F;&#x8BED;&#xFF0C;CAS&#x64CD;&#x4F5C;&#x662F;&#x4E00;&#x6761;CPU&#x7684;&#x539F;&#x5B50;&#x6307;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x6709;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;</li>
</ul>
<p>&#x8F6C;&#x81EA;<a href="https://blog.csdn.net/yanluandai1985/article/details/82686486" target="_blank" rel="noopener">&#x65E0;&#x9501;&#x673A;&#x5236;&#x2014;-&#x6BD4;&#x8F83;&#x4EA4;&#x6362;CAS</a></p>
]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
  </entry>
  <entry>
    <title>并发4:懒汉模式与枚举模式</title>
    <url>/2019/ehan-enum/</url>
    <content><![CDATA[<h2 id="&#x61D2;&#x6C49;&#x6A21;&#x5F0F;">0.1. &#x61D2;&#x6C49;&#x6A21;&#x5F0F;</h2><h3 id="&#x61D2;&#x6C49;&#x6A21;&#x5F0F;-&#x521D;&#x59CB;&#x7248;">0.1.1. &#x61D2;&#x6C49;&#x6A21;&#x5F0F;(&#x521D;&#x59CB;&#x7248;)</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton singleton;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (Singleton<span class="class">.<span class="keyword">class</span>) </span>{</span><br><span class="line">            <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) {</span><br><span class="line">                singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6B64;&#x65F6;&#x7684;&#x61D2;&#x6C49;&#x6A21;&#x5F0F;&#x7684;&#x6027;&#x80FD;&#x662F;&#x975E;&#x5E38;&#x5DEE;&#x7684;, &#x6BCF;&#x6B21;&#x5C06;&#x5BF9;&#x5B83;&#x8FDB;&#x884C;&#x52A0;&#x9501;&#x540E;&#x8FDB;&#x884C;&#x83B7;&#x53D6;. &#x4E0B;&#x9762;&#x5C06;&#x5BF9;&#x5B83;&#x8FDB;&#x884C;&#x4F18;&#x5316;</p>
<a id="more"></a>

<h3 id="&#x61D2;&#x6C49;&#x6A21;&#x5F0F;-&#x52A0;&#x5F3A;&#x7248;">0.1.2. &#x61D2;&#x6C49;&#x6A21;&#x5F0F;(&#x52A0;&#x5F3A;&#x7248;)</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton singleton;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton<span class="class">.<span class="keyword">class</span>) </span>{</span><br><span class="line">                <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) {</span><br><span class="line">                    singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5728;&#x83B7;&#x53D6;<code>singleton</code>&#x7684;&#x65F6;&#x5019;,&#x53EA;&#x6709;<code>singleton</code>&#x4E3A;&#x7A7A;&#x65F6;&#x624D;&#x4F1A;&#x5BF9;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x52A0;&#x9501;,&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x4E86;&#x7A0B;&#x5E8F;&#x7684;&#x6548;&#x7387;.<br>&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x4ED4;&#x7EC6;&#x770B;&#x5176;&#x4E2D;&#x7684;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x7684;&#x90E8;&#x5206;, &#x8FD9;&#x4E2A;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x771F;&#x7684;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x5417;?<br>&#x5728;JVM&#x4E2D;<code>Singleton singleton = new Singleton();</code>&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x539F;&#x5B50;&#x6027;&#x7684;&#x64CD;&#x4F5C;,&#x4F1A;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x4E09;&#x4E2A;&#x6B65;&#x9AA4;</p>
<ol>
<li>&#x7ED9; <code>singleton</code> &#x5206;&#x914D;&#x7A7A;&#x95F4;&#x3001;</li>
<li>&#x8C03;&#x7528; <code>Singleton</code> &#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6765;&#x521D;&#x59CB;&#x5316;&#x3001;</li>
<li>&#x5C06;<code>singleton</code>&#x5BF9;&#x8C61;&#x6307;&#x5411;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;, <code>singleton</code>&#x6307;&#x5411;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x540E;&#x5C31;&#x4E0D;&#x4E3A;<code>null</code>&#x4E86;;</li>
</ol>
<p>&#x7531;&#x4E8E;JVM&#x7684;&#x6307;&#x4EE4;&#x91CD;&#x6392;, &#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x786E;&#x4FDD;&#x8FD9;&#x4E09;&#x4E2A;&#x6B65;&#x9AA4;&#x90FD;&#x5728;&#x7EBF;&#x7A0B;2&#x5728;&#x8FDB;&#x884C;<code>if (singleton == null)</code>&#x7684;&#x65F6;&#x5019;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x4E86;<code>2&#x6B65;&#x9AA4;</code>, &#x8FD9;&#x65F6;&#x7EBF;&#x7A0B;2&#x83B7;&#x53D6;&#x5230;&#x7684;<code>singleton</code>&#x5BF9;&#x8C61;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7A7A;&#x5BF9;&#x8C61;,&#x5982;&#x679C;&#x8C03;&#x7528;&#x5C31;&#x4F1A;&#x5F15;&#x53D1;&#x7A7A;&#x6307;&#x9488;&#x5F02;&#x5E38;</p>
<h3 id="&#x61D2;&#x6C49;&#x6A21;&#x5F0F;-&#x6700;&#x7EC8;&#x7248;">0.1.3. &#x61D2;&#x6C49;&#x6A21;&#x5F0F;(&#x6700;&#x7EC8;&#x7248;)</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton singleton;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton<span class="class">.<span class="keyword">class</span>) </span>{</span><br><span class="line">                <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) {</span><br><span class="line">                    singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>volatile</code> &#x5173;&#x952E;&#x5B57;&#x7981;&#x6B62;&#x4E86;&#x6307;&#x4EE4;&#x91CD;&#x6392;, &#x53EF;&#x4EE5;&#x5B8C;&#x7F8E;&#x89E3;&#x51B3;&#x4E0A;&#x65B9;&#x56E0;&#x6307;&#x4EE4;&#x91CD;&#x62CD;&#x5F15;&#x53D1;&#x7684;&#x95EE;&#x9898;</p>
<h2 id="&#x679A;&#x4E3E;&#x6A21;&#x5F0F;">0.2. &#x679A;&#x4E3E;&#x6A21;&#x5F0F;</h2><figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> {</span></span><br><span class="line">    <span class="keyword">private</span> Singleton() {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static <span class="class"><span class="keyword">enum</span> <span class="title">SingletonHandler</span> {</span></span><br><span class="line">        SINGLETON;</span><br><span class="line">        <span class="keyword">private</span> Singleton singleton;</span><br><span class="line"></span><br><span class="line">        SingletonHandler() {</span><br><span class="line">            singleton = new Singleton();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Singleton getInstance() {</span><br><span class="line">            <span class="keyword">return</span> singleton;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>并发3:volatile</title>
    <url>/2019/volatile/</url>
    <content><![CDATA[<h2 id="&#x786C;&#x4EF6;&#x5185;&#x5B58;&#x67B6;&#x6784;">0.1. &#x786C;&#x4EF6;&#x5185;&#x5B58;&#x67B6;&#x6784;</h2><p>&#x5728;CPU&#x5185;&#x90E8;&#x6709;&#x4E00;&#x7EC4;CPU&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5BC4;&#x5B58;&#x5668;&#x662F;cpu&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x548C;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x653E;&#x6570;&#x636E;&#x7684;&#x7A7A;&#x95F4;&#x3002;&#x4E00;&#x822C;CPU&#x90FD;&#x4F1A;&#x4ECE;&#x5185;&#x5B58;&#x53D6;&#x6570;&#x636E;&#x5230;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x5185;&#x5B58;&#x7684;&#x5904;&#x7406;&#x901F;&#x5EA6;&#x8FDC;&#x8FDC;&#x4F4E;&#x4E8E;CPU&#xFF0C;&#x5BFC;&#x81F4;CPU&#x5728;&#x5904;&#x7406;&#x6307;&#x4EE4;&#x65F6;&#x5F80;&#x5F80;&#x82B1;&#x8D39;&#x5F88;&#x591A;&#x65F6;&#x95F4;&#x5728;&#x7B49;&#x5F85;&#x5185;&#x5B58;&#x505A;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E8E;&#x662F;&#x5728;&#x5BC4;&#x5B58;&#x5668;&#x548C;&#x4E3B;&#x5185;&#x5B58;&#x95F4;&#x6DFB;&#x52A0;&#x4E86;CPU&#x7F13;&#x5B58;&#xFF0C;CPU&#x7F13;&#x5B58;&#x6BD4;&#x8F83;&#x5C0F;&#xFF0C;&#x4F46;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x6BD4;&#x4E3B;&#x5185;&#x5B58;&#x5FEB;&#x5F97;&#x591A;&#xFF0C;&#x5982;&#x679C;CPU&#x603B;&#x662F;&#x64CD;&#x4F5C;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x540C;&#x4E00;&#x5740;&#x5730;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5F71;&#x54CD;CPU&#x6267;&#x884C;&#x901F;&#x5EA6;&#xFF0C;&#x6B64;&#x65F6;CPU&#x7F13;&#x5B58;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x4ECE;&#x5185;&#x5B58;&#x63D0;&#x53D6;&#x7684;&#x6570;&#x636E;&#x6682;&#x65F6;&#x4FDD;&#x5B58;&#x8D77;&#x6765;&#xFF0C;&#x5982;&#x679C;&#x5BC4;&#x5B58;&#x5668;&#x8981;&#x53D6;&#x5185;&#x5B58;&#x4E2D;&#x540C;&#x4E00;&#x4F4D;&#x7F6E;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x76F4;&#x63A5;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x63D0;&#x53D6;&#xFF0C;&#x65E0;&#x9700;&#x76F4;&#x63A5;&#x4ECE;&#x4E3B;&#x5185;&#x5B58;&#x53D6;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5BC4;&#x5B58;&#x5668;&#x5E76;&#x4E0D;&#x6BCF;&#x6B21;&#x6570;&#x636E;&#x90FD;&#x53EF;&#x4EE5;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x53D6;&#x5F97;&#x6570;&#x636E;&#xFF0C;&#x4E07;&#x4E00;&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x5730;&#x5740;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x5BC4;&#x5B58;&#x5668;&#x8FD8;&#x5FC5;&#x987B;&#x76F4;&#x63A5;&#x7ED5;&#x8FC7;&#x7F13;&#x5B58;&#x4ECE;&#x5185;&#x5B58;&#x4E2D;&#x53D6;&#x6570;&#x636E;&#x3002;&#x6240;&#x4EE5;&#x5E76;&#x4E0D;&#x6BCF;&#x6B21;&#x90FD;&#x5F97;&#x5230;&#x7F13;&#x5B58;&#x4E2D;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x79CD;&#x73B0;&#x8C61;&#x6709;&#x4E2A;&#x4E13;&#x4E1A;&#x7684;&#x540D;&#x79F0;&#x53EB;&#x505A;&#x7F13;&#x5B58;&#x7684;&#x547D;&#x4E2D;&#x7387;&#xFF0C;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x53D6;&#x5C31;&#x547D;&#x4E2D;&#xFF0C;&#x4E0D;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x53D6;&#x4ECE;&#x5185;&#x5B58;&#x4E2D;&#x53D6;&#xFF0C;&#x5C31;&#x6CA1;&#x547D;&#x4E2D;&#xFF0C;&#x53EF;&#x89C1;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#x7684;&#x9AD8;&#x4F4E;&#x4E5F;&#x4F1A;&#x5F71;&#x54CD;CPU&#x6267;&#x884C;&#x6027;&#x80FD;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;CPU&#x3001;&#x7F13;&#x5B58;&#x4EE5;&#x53CA;&#x4E3B;&#x5185;&#x5B58;&#x95F4;&#x7684;&#x7B80;&#x8981;&#x4EA4;&#x4E92;&#x8FC7;&#x7A0B;&#xFF0C;&#x603B;&#x800C;&#x8A00;&#x4E4B;&#x5F53;&#x4E00;&#x4E2A;CPU&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x4E3B;&#x5B58;&#x65F6;&#xFF0C;&#x4F1A;&#x5148;&#x8BFB;&#x53D6;&#x4E00;&#x90E8;&#x5206;&#x4E3B;&#x5B58;&#x6570;&#x636E;&#x5230;CPU&#x7F13;&#x5B58;(&#x5F53;&#x7136;&#x5982;&#x679C;CPU&#x7F13;&#x5B58;&#x4E2D;&#x5B58;&#x5728;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x5C31;&#x4F1A;&#x76F4;&#x63A5;&#x4ECE;&#x7F13;&#x5B58;&#x83B7;&#x53D6;)&#xFF0C;&#x8FDB;&#x800C;&#x5728;&#x8BFB;&#x53D6;CPU&#x7F13;&#x5B58;&#x5230;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5F53;CPU&#x9700;&#x8981;&#x5199;&#x6570;&#x636E;&#x5230;&#x4E3B;&#x5B58;&#x65F6;&#xFF0C;&#x540C;&#x6837;&#x4F1A;&#x5148;&#x5237;&#x65B0;&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5230;CPU&#x7F13;&#x5B58;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x628A;&#x6570;&#x636E;&#x5237;&#x65B0;&#x5230;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;</p>
<p><img src="/2019/volatile/%E7%A1%AC%E4%BB%B6%E5%86%85%E5%AD%98%E6%9E%B6%E6%9E%84.png" alt="&#x786C;&#x4EF6;&#x5185;&#x5B58;&#x67B6;&#x6784;"></p>
<a id="more"></a>

<h2 id="Java&#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;">0.2. Java&#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;</h2><p>&#x7531;&#x4E8E;CPU&#x548C;&#x5185;&#x5B58;&#x4E4B;&#x95F4;&#x7684;&#x8FD9;&#x79CD;&#x5173;&#x7CFB;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;Java&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x5185;&#x5B58;&#x6A21;&#x578B;&#x4E5F;&#x6781;&#x4E3A;&#x76F8;&#x4F3C;&#x3002;Java&#x5185;&#x5B58;&#x6A21;&#x578B;(&#x5373;Java Memory Model&#xFF0C;&#x7B80;&#x79F0;JMM)&#x672C;&#x8EAB;&#x662F;&#x4E00;&#x79CD;&#x62BD;&#x8C61;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x5E76;&#x4E0D;&#x771F;&#x5B9E;&#x5B58;&#x5728;&#xFF0C;&#x5B83;&#x63CF;&#x8FF0;&#x7684;&#x662F;&#x4E00;&#x7EC4;&#x89C4;&#x5219;&#x6216;&#x89C4;&#x8303;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x7EC4;&#x89C4;&#x8303;&#x5B9A;&#x4E49;&#x4E86;&#x7A0B;&#x5E8F;&#x4E2D;&#x5404;&#x4E2A;&#x53D8;&#x91CF;&#xFF08;&#x5305;&#x62EC;&#x5B9E;&#x4F8B;&#x5B57;&#x6BB5;&#xFF0C;&#x9759;&#x6001;&#x5B57;&#x6BB5;&#x548C;&#x6784;&#x6210;&#x6570;&#x7EC4;&#x5BF9;&#x8C61;&#x7684;&#x5143;&#x7D20;&#xFF09;&#x7684;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;&#x3002;&#x7531;&#x4E8E;JVM&#x8FD0;&#x884C;&#x7A0B;&#x5E8F;&#x7684;&#x5B9E;&#x4F53;&#x662F;&#x7EBF;&#x7A0B;&#xFF0C;&#x800C;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x521B;&#x5EFA;&#x65F6;JVM&#x90FD;&#x4F1A;&#x4E3A;&#x5176;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;(&#x6709;&#x4E9B;&#x5730;&#x65B9;&#x79F0;&#x4E3A;&#x6808;&#x7A7A;&#x95F4;)&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x7EBF;&#x7A0B;&#x79C1;&#x6709;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x800C;Java&#x5185;&#x5B58;&#x6A21;&#x578B;&#x4E2D;&#x89C4;&#x5B9A;&#x6240;&#x6709;&#x53D8;&#x91CF;&#x90FD;&#x5B58;&#x50A8;&#x5728;&#x4E3B;&#x5185;&#x5B58;&#xFF0C;&#x4E3B;&#x5185;&#x5B58;&#x662F;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x57DF;&#xFF0C;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x90FD;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#xFF0C;&#x4F46;&#x7EBF;&#x7A0B;&#x5BF9;&#x53D8;&#x91CF;&#x7684;&#x64CD;&#x4F5C;(&#x8BFB;&#x53D6;&#x8D4B;&#x503C;&#x7B49;)&#x5FC5;&#x987B;&#x5728;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x8FDB;&#x884C;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x5C06;&#x53D8;&#x91CF;&#x4ECE;&#x4E3B;&#x5185;&#x5B58;&#x62F7;&#x8D1D;&#x7684;&#x81EA;&#x5DF1;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x540E;&#x518D;&#x5C06;&#x53D8;&#x91CF;&#x5199;&#x56DE;&#x4E3B;&#x5185;&#x5B58;&#xFF0C;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x64CD;&#x4F5C;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x5B58;&#x50A8;&#x7740;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#x526F;&#x672C;&#x62F7;&#x8D1D;&#xFF0C;&#x524D;&#x9762;&#x8BF4;&#x8FC7;&#xFF0C;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x662F;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x79C1;&#x6709;&#x6570;&#x636E;&#x533A;&#x57DF;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x95F4;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x5BF9;&#x65B9;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#xFF0C;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;(&#x4F20;&#x503C;)&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x4E3B;&#x5185;&#x5B58;&#x6765;&#x5B8C;&#x6210;&#xFF0C;&#x5176;&#x7B80;&#x8981;&#x8BBF;&#x95EE;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;</p>
<p> <img src="/2019/volatile/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.png" alt="Java&#x591A;&#x7EBF;&#x7A0B;&#x5185;&#x5B58;&#x6A21;&#x578B;"></p>
<p> &#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;JMM&#x4E0E;Java&#x5185;&#x5B58;&#x533A;&#x57DF;&#x7684;&#x5212;&#x5206;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x6982;&#x5FF5;&#x5C42;&#x6B21;&#xFF0C;&#x66F4;&#x6070;&#x5F53;&#x8BF4;JMM&#x63CF;&#x8FF0;&#x7684;&#x662F;&#x4E00;&#x7EC4;&#x89C4;&#x5219;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x7EC4;&#x89C4;&#x5219;&#x63A7;&#x5236;&#x7A0B;&#x5E8F;&#x4E2D;&#x5404;&#x4E2A;&#x53D8;&#x91CF;&#x5728;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x533A;&#x57DF;&#x548C;&#x79C1;&#x6709;&#x6570;&#x636E;&#x533A;&#x57DF;&#x7684;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;&#xFF0C;JMM&#x662F;&#x56F4;&#x7ED5;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x6709;&#x5E8F;&#x6027;&#x3001;&#x53EF;&#x89C1;&#x6027;&#x5C55;&#x5F00;&#x7684;(&#x7A0D;&#x540E;&#x4F1A;&#x5206;&#x6790;)&#x3002;JMM&#x4E0E;Java&#x5185;&#x5B58;&#x533A;&#x57DF;&#x552F;&#x4E00;&#x76F8;&#x4F3C;&#x70B9;&#xFF0C;&#x90FD;&#x5B58;&#x5728;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x533A;&#x57DF;&#x548C;&#x79C1;&#x6709;&#x6570;&#x636E;&#x533A;&#x57DF;&#xFF0C;&#x5728;JMM&#x4E2D;&#x4E3B;&#x5185;&#x5B58;&#x5C5E;&#x4E8E;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x533A;&#x57DF;&#xFF0C;&#x4ECE;&#x67D0;&#x4E2A;&#x7A0B;&#x5EA6;&#x4E0A;&#x8BB2;&#x5E94;&#x8BE5;&#x5305;&#x62EC;&#x4E86;&#x5806;&#x548C;&#x65B9;&#x6CD5;&#x533A;&#xFF0C;&#x800C;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x6570;&#x636E;&#x7EBF;&#x7A0B;&#x79C1;&#x6709;&#x6570;&#x636E;&#x533A;&#x57DF;&#xFF0C;&#x4ECE;&#x67D0;&#x4E2A;&#x7A0B;&#x5EA6;&#x4E0A;&#x8BB2;&#x5219;&#x5E94;&#x8BE5;&#x5305;&#x62EC;&#x7A0B;&#x5E8F;&#x8BA1;&#x6570;&#x5668;&#x3001;&#x865A;&#x62DF;&#x673A;&#x6808;&#x4EE5;&#x53CA;&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x6808;&#x3002;&#x6216;&#x8BB8;&#x5728;&#x67D0;&#x4E9B;&#x5730;&#x65B9;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x770B;&#x89C1;&#x4E3B;&#x5185;&#x5B58;&#x88AB;&#x63CF;&#x8FF0;&#x4E3A;&#x5806;&#x5185;&#x5B58;&#xFF0C;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x88AB;&#x79F0;&#x4E3A;&#x7EBF;&#x7A0B;&#x6808;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4ED6;&#x4EEC;&#x8868;&#x8FBE;&#x7684;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x542B;&#x4E49;&#x3002;&#x5173;&#x4E8E;JMM&#x4E2D;&#x7684;&#x4E3B;&#x5185;&#x5B58;&#x548C;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x8BF4;&#x660E;&#x5982;&#x4E0B;</p>
<h3 id="&#x4E3B;&#x5185;&#x5B58;">0.2.1. &#x4E3B;&#x5185;&#x5B58;</h3><p>&#x4E3B;&#x8981;&#x5B58;&#x50A8;&#x7684;&#x662F;Java&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x521B;&#x5EFA;&#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x90FD;&#x5B58;&#x653E;&#x5728;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x4E0D;&#x7BA1;&#x8BE5;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x662F;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x8FD8;&#x662F;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x672C;&#x5730;&#x53D8;&#x91CF;(&#x4E5F;&#x79F0;&#x5C40;&#x90E8;&#x53D8;&#x91CF;)&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x5305;&#x62EC;&#x4E86;&#x5171;&#x4EAB;&#x7684;&#x7C7B;&#x4FE1;&#x606F;&#x3001;&#x5E38;&#x91CF;&#x3001;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x3002;&#x7531;&#x4E8E;&#x662F;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x533A;&#x57DF;&#xFF0C;&#x591A;&#x6761;&#x7EBF;&#x7A0B;&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x8BBF;&#x95EE;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x73B0;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;</p>
<h3 id="&#x5DE5;&#x4F5C;&#x5185;&#x5B58;">0.2.2. &#x5DE5;&#x4F5C;&#x5185;&#x5B58;</h3><p>&#x4E3B;&#x8981;&#x5B58;&#x50A8;&#x5F53;&#x524D;&#x65B9;&#x6CD5;&#x7684;&#x6240;&#x6709;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x4FE1;&#x606F;(&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x5B58;&#x50A8;&#x7740;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#x526F;&#x672C;&#x62F7;&#x8D1D;)&#xFF0C;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EA;&#x80FD;&#x8BBF;&#x95EE;&#x81EA;&#x5DF1;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#xFF0C;&#x5373;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x5BF9;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x662F;&#x4E0D;&#x53EF;&#x89C1;&#x7684;&#xFF0C;&#x5C31;&#x7B97;&#x662F;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7684;&#x662F;&#x540C;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x5B83;&#x4EEC;&#x4E5F;&#x4F1A;&#x5404;&#x81EA;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x521B;&#x5EFA;&#x5C5E;&#x4E8E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x672C;&#x5730;&#x53D8;&#x91CF;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x5305;&#x62EC;&#x4E86;&#x5B57;&#x8282;&#x7801;&#x884C;&#x53F7;&#x6307;&#x793A;&#x5668;&#x3001;&#x76F8;&#x5173;Native&#x65B9;&#x6CD5;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x6CE8;&#x610F;&#x7531;&#x4E8E;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x662F;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x79C1;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x7EBF;&#x7A0B;&#x95F4;&#x65E0;&#x6CD5;&#x76F8;&#x4E92;&#x8BBF;&#x95EE;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#xFF0C;&#x56E0;&#x6B64;&#x5B58;&#x50A8;&#x5728;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x5B58;&#x5728;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x5F04;&#x6E05;&#x695A;&#x4E3B;&#x5185;&#x5B58;&#x548C;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x540E;&#xFF0C;&#x63A5;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x4E3B;&#x5185;&#x5B58;&#x4E0E;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x4EE5;&#x53CA;&#x64CD;&#x4F5C;&#x65B9;&#x5F0F;&#xFF0C;&#x6839;&#x636E;&#x865A;&#x62DF;&#x673A;&#x89C4;&#x8303;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x6210;&#x5458;&#x65B9;&#x6CD5;&#x800C;&#x8A00;&#xFF0C;&#x5982;&#x679C;&#x65B9;&#x6CD5;&#x4E2D;&#x5305;&#x542B;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x662F;&#x57FA;&#x672C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF08;boolean,byte,short,char,int,long,float,double&#xFF09;&#xFF0C;&#x5C06;&#x76F4;&#x63A5;&#x5B58;&#x50A8;&#x5728;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x5E27;&#x6808;&#x7ED3;&#x6784;&#x4E2D;&#xFF0C;&#x4F46;&#x5018;&#x82E5;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x662F;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x53D8;&#x91CF;&#x7684;&#x5F15;&#x7528;&#x4F1A;&#x5B58;&#x50A8;&#x5728;&#x529F;&#x80FD;&#x5185;&#x5B58;&#x7684;&#x5E27;&#x6808;&#x4E2D;&#xFF0C;&#x800C;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x5C06;&#x5B58;&#x50A8;&#x5728;&#x4E3B;&#x5185;&#x5B58;(&#x5171;&#x4EAB;&#x6570;&#x636E;&#x533A;&#x57DF;&#xFF0C;&#x5806;)&#x4E2D;&#x3002;&#x4F46;&#x5BF9;&#x4E8E;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x4E0D;&#x7BA1;&#x5B83;&#x662F;&#x57FA;&#x672C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x6216;&#x8005;&#x5305;&#x88C5;&#x7C7B;&#x578B;(Integer&#x3001;Double&#x7B49;)&#x8FD8;&#x662F;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#xFF0C;&#x90FD;&#x4F1A;&#x88AB;&#x5B58;&#x50A8;&#x5230;&#x5806;&#x533A;&#x3002;&#x81F3;&#x4E8E;static&#x53D8;&#x91CF;&#x4EE5;&#x53CA;&#x7C7B;&#x672C;&#x8EAB;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x5C06;&#x4F1A;&#x5B58;&#x50A8;&#x5728;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x88AB;&#x591A;&#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#xFF0C;&#x5018;&#x82E5;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x8C03;&#x7528;&#x4E86;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x540C;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;&#x4E24;&#x6761;&#x7EBF;&#x7A0B;&#x4F1A;&#x5C06;&#x8981;&#x64CD;&#x4F5C;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x4E00;&#x4EFD;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x64CD;&#x4F5C;&#x540E;&#x624D;&#x5237;&#x65B0;&#x5230;&#x4E3B;&#x5185;&#x5B58;&#xFF0C;&#x7B80;&#x5355;&#x793A;&#x610F;&#x56FE;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p> <img src="/2019/volatile/%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%8F%98%E9%87%8F.png" alt="&#x7EBF;&#x7A0B;&#x4E0E;&#x53D8;&#x91CF;"></p>
<h2 id="volatile&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;">0.3. volatile&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;</h2><h3 id="&#x7EBF;&#x7A0B;&#x9690;&#x8BD5;&#x901A;&#x4FE1;">0.3.1. &#x7EBF;&#x7A0B;&#x9690;&#x8BD5;&#x901A;&#x4FE1;</h3><p>&#x5DF2;&#x77E5;<code>int a = 2</code> &#xFF0C;&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x6709;&#x7EBF;&#x7A0B;A&#x3001;&#x7EBF;&#x7A0B;B&#x5BF9;a&#x8FDB;&#x884C;&#x4E86;&#x64CD;&#x4F5C;&#xFF0C; &#x7EBF;&#x7A0B;A&#x6267;&#x884C;a++; &#x8FD9;&#x65F6;B&#x8BFB;&#x53D6;&#x5230;&#x7684;&#x53EF;&#x80FD;&#x662F;&#x51E0;.</p>
<ol>
<li>&#x521D;&#x59CB;&#x72B6;&#x6001;</li>
</ol>
<table>
<thead>
<tr>
<th align="center">&#x7EBF;&#x7A0B;</th>
<th align="center">&#x5BC4;&#x5B58;&#x5668;</th>
<th align="center">&#x5DE5;&#x4F5C;&#x5185;&#x5B58;</th>
<th align="center">&#x5171;&#x4EAB;&#x5185;&#x5B58;</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&#x7EBF;&#x7A0B;A</td>
<td align="center"></td>
<td align="center">a=2</td>
<td align="center">a=2</td>
</tr>
<tr>
<td align="center">&#x7EBF;&#x7A0B;B</td>
<td align="center"></td>
<td align="center">a=2</td>
<td align="center">a=2</td>
</tr>
</tbody></table>
<ol start="2">
<li>&#x7EBF;&#x7A0B;A&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5230;&#x5BC4;&#x5B58;&#x5668;&#x8FDB;&#x884C;+1&#x64CD;&#x4F5C;</li>
</ol>
<table>
<thead>
<tr>
<th align="center">&#x7EBF;&#x7A0B;</th>
<th align="center">&#x5BC4;&#x5B58;&#x5668;</th>
<th align="center">&#x5DE5;&#x4F5C;&#x5185;&#x5B58;</th>
<th align="center">&#x5171;&#x4EAB;&#x5185;&#x5B58;</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&#x7EBF;&#x7A0B;A</td>
<td align="center">a=2+1=3</td>
<td align="center">a=2</td>
<td align="center">a=2</td>
</tr>
<tr>
<td align="center">&#x7EBF;&#x7A0B;B</td>
<td align="center"></td>
<td align="center">a=2</td>
<td align="center">a=2</td>
</tr>
</tbody></table>
<ol start="3">
<li>&#x7EBF;&#x7A0B;A&#x56DE;&#x5199;&#x6570;&#x636E;&#x5230;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x5230;&#x5171;&#x4EAB;&#x5185;&#x5B58;</li>
</ol>
<table>
<thead>
<tr>
<th align="center">&#x7EBF;&#x7A0B;</th>
<th align="center">&#x5BC4;&#x5B58;&#x5668;</th>
<th align="center">&#x5DE5;&#x4F5C;&#x5185;&#x5B58;</th>
<th align="center">&#x5171;&#x4EAB;&#x5185;&#x5B58;</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&#x7EBF;&#x7A0B;A</td>
<td align="center"></td>
<td align="center">a=3</td>
<td align="center">a=3</td>
</tr>
<tr>
<td align="center">&#x7EBF;&#x7A0B;B</td>
<td align="center"></td>
<td align="center">a=2</td>
<td align="center">a=3</td>
</tr>
</tbody></table>
<ol start="4">
<li>&#x7EBF;&#x7A0B;B&#x5237;&#x65B0;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x6570;&#x636E;</li>
</ol>
<table>
<thead>
<tr>
<th align="center">&#x7EBF;&#x7A0B;</th>
<th align="center">&#x5BC4;&#x5B58;&#x5668;</th>
<th align="center">&#x5DE5;&#x4F5C;&#x5185;&#x5B58;</th>
<th align="center">&#x5171;&#x4EAB;&#x5185;&#x5B58;</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&#x7EBF;&#x7A0B;A</td>
<td align="center"></td>
<td align="center">a=3</td>
<td align="center">a=3</td>
</tr>
<tr>
<td align="center">&#x7EBF;&#x7A0B;B</td>
<td align="center"></td>
<td align="center">a=3</td>
<td align="center">a=3</td>
</tr>
</tbody></table>
<p>&#x8FD9;&#x65F6;&#x4F1A;&#x51FA;&#x73B0;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x7B2C;&#x56DB;&#x90E8;&#x6267;&#x884C;&#x7684;&#x65F6;&#x95F4;&#x662F;&#x65E0;&#x6CD5;&#x63A7;&#x5236;&#x7684;&#xFF0C;&#x5728;&#x7EBF;&#x7A0B;A&#x5BF9;a&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x540E;&#x5E76;&#x4E0D;&#x80FD;&#x7ACB;&#x5373;&#x4F7F;&#x7EBF;&#x7A0B;B&#x62FF;&#x5230;&#x66F4;&#x65B0;&#x540E;&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x65F6;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x58F0;&#x660E;&#x53D8;&#x91CF;a&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;<code>volatile</code>&#x5173;&#x952E;&#x5B57;&#x3002;</p>
<h3 id="&#x89E3;&#x51B3;&#x65B9;&#x6848;">0.3.2. &#x89E3;&#x51B3;&#x65B9;&#x6848;</h3><p>&#x5F53;&#x5199;&#x4E00;&#x4E2A;<code>volatile</code>&#x53D8;&#x91CF;&#x65F6;&#xFF0C;JMM&#x4F1A;&#x628A;&#x8BE5;&#x7EBF;&#x7A0B;&#x5BF9;&#x5E94;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x503C;&#x5237;&#x65B0;&#x5230;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x8BE5;&#x53D8;&#x91CF;&#x7F6E;&#x4E3A;&#x65E0;&#x6548;&#xFF0C;&#x5F53;&#x8BFB;&#x53D6;<code>volatile</code>&#x53D8;&#x91CF;&#x65F6;&#xFF0C;&#x53EA;&#x80FD;&#x4ECE;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x91CD;&#x65B0;&#x8BFB;&#x53D6;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x3002;<code>volatile</code>&#x53D8;&#x91CF;&#x6B63;&#x662F;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x5199;-&#x8BFB;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x5BF9;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x53EF;&#x89C1;</p>
<h2 id="volatile&#x7981;&#x6B62;&#x6307;&#x4EE4;&#x91CD;&#x6392;">0.4. volatile&#x7981;&#x6B62;&#x6307;&#x4EE4;&#x91CD;&#x6392;</h2><h3 id="&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x7684;&#x5B9A;&#x4E49;">0.4.1. &#x6307;&#x4EE4;&#x91CD;&#x6392;&#x7684;&#x5B9A;&#x4E49;</h3><p>&#x8BA1;&#x7B97;&#x673A;&#x5728;&#x6267;&#x884C;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x548C;&#x5904;&#x7406;&#x5668;&#x7684;&#x5E38;&#x5E38;&#x4F1A;&#x5BF9;&#x6307;&#x4EE4;&#x505A;&#x91CD;&#x6392;&#xFF0C;&#x4E00;&#x822C;&#x5206;&#x4EE5;&#x4E0B;3&#x79CD;</p>
<ol>
<li>&#x7F16;&#x8BD1;&#x5668;&#x4F18;&#x5316;&#x7684;&#x91CD;&#x6392;</li>
</ol>
<p>&#x7F16;&#x8BD1;&#x5668;&#x5728;&#x4E0D;&#x6539;&#x53D8;&#x5355;&#x7EBF;&#x7A0B;&#x7A0B;&#x5E8F;&#x8BED;&#x4E49;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x5B89;&#x6392;&#x8BED;&#x53E5;&#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x3002;</p>
<ol start="2">
<li>&#x6307;&#x4EE4;&#x5E76;&#x884C;&#x7684;&#x91CD;&#x6392;</li>
</ol>
<p>&#x73B0;&#x4EE3;&#x5904;&#x7406;&#x5668;&#x91C7;&#x7528;&#x4E86;&#x6307;&#x4EE4;&#x7EA7;&#x5E76;&#x884C;&#x6280;&#x672F;&#x6765;&#x5C06;&#x591A;&#x6761;&#x6307;&#x4EE4;&#x91CD;&#x53E0;&#x6267;&#x884C;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x6570;&#x636E;&#x4F9D;&#x8D56;&#x6027;(&#x5373;&#x540E;&#x4E00;&#x4E2A;&#x6267;&#x884C;&#x7684;&#x8BED;&#x53E5;&#x65E0;&#x9700;&#x4F9D;&#x8D56;&#x524D;&#x9762;&#x6267;&#x884C;&#x7684;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x679C;)&#xFF0C;&#x5904;&#x7406;&#x5668;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x8BED;&#x53E5;&#x5BF9;&#x5E94;&#x7684;&#x673A;&#x5668;&#x6307;&#x4EE4;&#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;</p>
<ol start="3">
<li>&#x5185;&#x5B58;&#x7CFB;&#x7EDF;&#x7684;&#x91CD;&#x6392;</li>
</ol>
<p>&#x7531;&#x4E8E;&#x5904;&#x7406;&#x5668;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x548C;&#x8BFB;&#x5199;&#x7F13;&#x5B58;&#x51B2;&#x533A;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97;&#x52A0;&#x8F7D;(load)&#x548C;&#x5B58;&#x50A8;(store)&#x64CD;&#x4F5C;&#x770B;&#x4E0A;&#x53BB;&#x53EF;&#x80FD;&#x662F;&#x5728;&#x4E71;&#x5E8F;&#x6267;&#x884C;&#xFF0C;&#x56E0;&#x4E3A;&#x4E09;&#x7EA7;&#x7F13;&#x5B58;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x4E0E;&#x7F13;&#x5B58;&#x7684;&#x6570;&#x636E;&#x540C;&#x6B65;&#x5B58;&#x5728;&#x65F6;&#x95F4;&#x5DEE;&#x3002;</p>
<h3 id="&#x5355;&#x7EBF;&#x7A0B;-&#x591A;&#x7EBF;&#x7A0B;&#x4E0B;&#x6307;&#x4EE4;&#x91CD;&#x6392;">0.4.2. &#x5355;&#x7EBF;&#x7A0B;/&#x591A;&#x7EBF;&#x7A0B;&#x4E0B;&#x6307;&#x4EE4;&#x91CD;&#x6392;</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">int</span> b = <span class="number">4</span>;</span><br><span class="line"><span class="built_in">int</span> c = a+b</span><br><span class="line"><span class="built_in">int</span> d = a+<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>JVM&#x5728;&#x5BF9;&#x4E0A;&#x65B9;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;&#x65F6;&#x4F1A;&#x5728;&#x4E0D;&#x6539;&#x53D8;&#x5355;&#x7EBF;&#x7A0B;&#x7A0B;&#x5E8F;&#x8BED;&#x4E49;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x5BF9;&#x4E0A;&#x65B9;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x91CD;&#x65B0;&#x6392;&#x5E8F;<br>&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x7406;&#x89E3;&#x8D77;&#x6765;&#x5E76;&#x4E0D;&#x590D;&#x6742;&#xFF0C;&#x4E0D;&#x8FC7;&#x611F;&#x89C9;&#x6CA1;&#x5FC5;&#x8981;&#x4ECE;&#x6DF1;&#x5C42;&#x6B21;&#x53BB;&#x63A2;&#x7A76;&#x3002;&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E0B;&#xFF0C;&#x6709;&#x4E0B;&#x65B9;&#x4EE3;&#x7801;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">&#x53EF;&#x80FD;<span class="number">1</span>&#xFF1A;</span><br><span class="line"><span class="built_in">int</span> b = <span class="number">4</span>;</span><br><span class="line"><span class="built_in">int</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">int</span> c = a+b</span><br><span class="line"><span class="built_in">int</span> d = a+<span class="number">1</span>;</span><br><span class="line">&#x53EF;&#x80FD;<span class="number">2</span>&#xFF1A;</span><br><span class="line"><span class="built_in">int</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">int</span> d = a+<span class="number">1</span>;</span><br><span class="line"><span class="built_in">int</span> b = <span class="number">4</span>;</span><br><span class="line"><span class="built_in">int</span> c = a+b</span><br><span class="line">&#x53EF;&#x80FD;<span class="number">3</span>&#xFF1A;</span><br><span class="line"><span class="built_in">int</span> b = <span class="number">4</span>;</span><br><span class="line"><span class="built_in">int</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">int</span> d = a+<span class="number">1</span>;</span><br><span class="line"><span class="built_in">int</span> c = a+b</span><br></pre></td></tr></table></figure>
<p><strong>&#x91CD;&#x6392;&#x540E;&#x5728;&#x5355;&#x7EBF;&#x7A0B;&#x4E2D;&#x4F1A;&#x63D0;&#x9AD8;&#x7A0B;&#x5E8F;&#x7684;&#x6267;&#x884C;&#x901F;&#x5EA6;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x591A;&#x7EBF;&#x7A0B;&#x73AF;&#x5883;&#x800C;&#x5DF2;&#xFF0C;&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x5C31;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x4E25;&#x91CD;&#x7684;&#x7A0B;&#x5E8F;&#x8F6E;&#x5E8F;&#x6267;&#x884C;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x4E0B;</strong></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">MixedOrder</span>{</span><br><span class="line">    <span class="built_in">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">bool</span>ean flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> writer(){</span><br><span class="line">        a = <span class="number">1</span>;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> read(){</span><br><span class="line">        <span class="keyword">if</span>(flag){</span><br><span class="line">            <span class="built_in">int</span> i = a + <span class="number">1</span>&#xFF1B;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5982;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#xFF0C;&#x540C;&#x65F6;&#x5B58;&#x5728;&#x7EBF;&#x7A0B;A&#x548C;&#x7EBF;&#x7A0B;B&#x5BF9;&#x8BE5;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x5176;&#x4E2D;A&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x5199;&#x5165;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;B&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x8BFB;&#x53D6;&#x65B9;&#x6CD5;&#xFF0C;&#x7531;&#x4E8E;&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x7B49;&#x539F;&#x56E0;&#xFF0C;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x53D8;&#x4E3A;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x7EBF;&#x7A0B;A</span>                    <span class="string">&#x7EBF;&#x7A0B;B</span></span><br><span class="line"><span class="string">writer&#xFF1A;</span>                 <span class="string">read&#xFF1A;</span></span><br><span class="line"><span class="number">1</span><span class="string">:flag</span> <span class="string">=</span> <span class="literal">true</span><span class="string">;</span>           <span class="number">1</span><span class="string">:flag</span> <span class="string">=</span> <span class="literal">true</span><span class="string">;</span></span><br><span class="line"><span class="number">2</span><span class="string">:a</span> <span class="string">=</span> <span class="number">1</span><span class="string">;</span>                 <span class="attr">2:</span> <span class="string">a</span> <span class="string">=</span> <span class="number">0</span> <span class="string">;</span> <span class="string">//&#x8BEF;&#x8BFB;</span></span><br><span class="line"><span class="number">3</span><span class="string">:i</span> <span class="string">=</span> <span class="number">2</span><span class="string">;</span>                 <span class="attr">3:</span> <span class="string">i</span> <span class="string">=</span> <span class="number">1</span> <span class="string">;</span></span><br></pre></td></tr></table></figure>
<p>&#x7531;&#x4E8E;&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x7EBF;&#x7A0B;A&#x7684;flag&#x7F6E;&#x4E3A;true&#x88AB;&#x63D0;&#x524D;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x800C;a&#x8D4B;&#x503C;&#x4E3A;1&#x7684;&#x7A0B;&#x5E8F;&#x8FD8;&#x672A;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x6B64;&#x65F6;&#x7EBF;&#x7A0B;B&#xFF0C;&#x6070;&#x597D;&#x8BFB;&#x53D6;flag&#x7684;&#x503C;&#x4E3A;true&#xFF0C;&#x76F4;&#x63A5;&#x83B7;&#x53D6;a&#x7684;&#x503C;&#xFF08;&#x6B64;&#x65F6;B&#x7EBF;&#x7A0B;&#x5E76;&#x4E0D;&#x77E5;&#x9053;a&#x4E3A;0&#xFF09;&#x5E76;&#x6267;&#x884C;i&#x8D4B;&#x503C;&#x64CD;&#x4F5C;&#xFF0C;&#x7ED3;&#x679C;i&#x7684;&#x503C;&#x4E3A;1&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x9884;&#x671F;&#x7684;2&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x591A;&#x7EBF;&#x7A0B;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x5BFC;&#x81F4;&#x7684;&#x7A0B;&#x5E8F;&#x4E71;&#x5E8F;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x53EA;&#x4F1A;&#x4FDD;&#x8BC1;&#x5355;&#x7EBF;&#x7A0B;&#x4E2D;&#x4E32;&#x884C;&#x8BED;&#x4E49;&#x7684;&#x6267;&#x884C;&#x7684;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x4F1A;&#x5173;&#x5FC3;&#x591A;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x8BED;&#x4E49;&#x4E00;&#x81F4;&#x6027;&#x3002;</p>
<h2 id="JVM&#x7684;happens-before&#x539F;&#x5219;">0.5. JVM&#x7684;happens-before&#x539F;&#x5219;</h2><p>&#x5018;&#x82E5;&#x5728;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x4EC5;&#x9760;sychronized&#x548C;volatile&#x5173;&#x952E;&#x5B57;&#x6765;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;&#x3001;&#x53EF;&#x89C1;&#x6027;&#x4EE5;&#x53CA;&#x6709;&#x5E8F;&#x6027;&#xFF0C;&#x90A3;&#x4E48;&#x7F16;&#x5199;&#x5E76;&#x53D1;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4F1A;&#x663E;&#x5F97;&#x5341;&#x5206;&#x9EBB;&#x70E6;&#xFF0C;&#x5E78;&#x8FD0;&#x7684;&#x662F;&#xFF0C;&#x5728;Java&#x5185;&#x5B58;&#x6A21;&#x578B;&#x4E2D;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;happens-before &#x539F;&#x5219;&#x6765;&#x8F85;&#x52A9;&#x4FDD;&#x8BC1;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x7684;&#x539F;&#x5B50;&#x6027;&#x3001;&#x53EF;&#x89C1;&#x6027;&#x4EE5;&#x53CA;&#x6709;&#x5E8F;&#x6027;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5B83;&#x662F;&#x5224;&#x65AD;&#x6570;&#x636E;&#x662F;&#x5426;&#x5B58;&#x5728;&#x7ADE;&#x4E89;&#x3001;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x5B89;&#x5168;&#x7684;&#x4F9D;&#x636E;&#xFF0C;happens-before &#x539F;&#x5219;&#x5185;&#x5BB9;&#x5982;&#x4E0B;</p>
<ul>
<li><p>&#x7A0B;&#x5E8F;&#x987A;&#x5E8F;&#x539F;&#x5219;&#xFF0C;&#x5373;&#x5728;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5185;&#x5FC5;&#x987B;&#x4FDD;&#x8BC1;&#x8BED;&#x4E49;&#x4E32;&#x884C;&#x6027;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x6309;&#x7167;&#x4EE3;&#x7801;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x3002;</p>
</li>
<li><p>&#x9501;&#x89C4;&#x5219; &#x89E3;&#x9501;(unlock)&#x64CD;&#x4F5C;&#x5FC5;&#x7136;&#x53D1;&#x751F;&#x5728;&#x540E;&#x7EED;&#x7684;&#x540C;&#x4E00;&#x4E2A;&#x9501;&#x7684;&#x52A0;&#x9501;(lock)&#x4E4B;&#x524D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x9501;&#x89E3;&#x9501;&#x540E;&#xFF0C;&#x518D;&#x52A0;&#x9501;&#xFF0C;&#x90A3;&#x4E48;&#x52A0;&#x9501;&#x7684;&#x52A8;&#x4F5C;&#x5FC5;&#x987B;&#x5728;&#x89E3;&#x9501;&#x52A8;&#x4F5C;&#x4E4B;&#x540E;(&#x540C;&#x4E00;&#x4E2A;&#x9501;)&#x3002;</p>
</li>
<li><p>volatile&#x89C4;&#x5219; volatile&#x53D8;&#x91CF;&#x7684;&#x5199;&#xFF0C;&#x5148;&#x53D1;&#x751F;&#x4E8E;&#x8BFB;&#xFF0C;&#x8FD9;&#x4FDD;&#x8BC1;&#x4E86;volatile&#x53D8;&#x91CF;&#x7684;&#x53EF;&#x89C1;&#x6027;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x7406;&#x89E3;&#x5C31;&#x662F;&#xFF0C;volatile&#x53D8;&#x91CF;&#x5728;&#x6BCF;&#x6B21;&#x88AB;&#x7EBF;&#x7A0B;&#x8BBF;&#x95EE;&#x65F6;&#xFF0C;&#x90FD;&#x5F3A;&#x8FEB;&#x4ECE;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x8BFB;&#x8BE5;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x800C;&#x5F53;&#x8BE5;&#x53D8;&#x91CF;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x53C8;&#x4F1A;&#x5F3A;&#x8FEB;&#x5C06;&#x6700;&#x65B0;&#x7684;&#x503C;&#x5237;&#x65B0;&#x5230;&#x4E3B;&#x5185;&#x5B58;&#xFF0C;&#x4EFB;&#x4F55;&#x65F6;&#x523B;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x603B;&#x662F;&#x80FD;&#x591F;&#x770B;&#x5230;&#x8BE5;&#x53D8;&#x91CF;&#x7684;&#x6700;&#x65B0;&#x503C;&#x3002;</p>
</li>
<li><p>&#x7EBF;&#x7A0B;&#x542F;&#x52A8;&#x89C4;&#x5219; &#x7EBF;&#x7A0B;&#x7684;start()&#x65B9;&#x6CD5;&#x5148;&#x4E8E;&#x5B83;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x52A8;&#x4F5C;&#xFF0C;&#x5373;&#x5982;&#x679C;&#x7EBF;&#x7A0B;A&#x5728;&#x6267;&#x884C;&#x7EBF;&#x7A0B;B&#x7684;start&#x65B9;&#x6CD5;&#x4E4B;&#x524D;&#x4FEE;&#x6539;&#x4E86;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x7EBF;&#x7A0B;B&#x6267;&#x884C;start&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x7EBF;&#x7A0B;A&#x5BF9;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x4FEE;&#x6539;&#x5BF9;&#x7EBF;&#x7A0B;B&#x53EF;&#x89C1;</p>
</li>
<li><p>&#x4F20;&#x9012;&#x6027; A&#x5148;&#x4E8E;B &#xFF0C;B&#x5148;&#x4E8E;C &#x90A3;&#x4E48;A&#x5FC5;&#x7136;&#x5148;&#x4E8E;C</p>
</li>
<li><p>&#x7EBF;&#x7A0B;&#x7EC8;&#x6B62;&#x89C4;&#x5219; &#x7EBF;&#x7A0B;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x5148;&#x4E8E;&#x7EBF;&#x7A0B;&#x7684;&#x7EC8;&#x7ED3;&#xFF0C;Thread.join()&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x7B49;&#x5F85;&#x5F53;&#x524D;&#x6267;&#x884C;&#x7684;&#x7EBF;&#x7A0B;&#x7EC8;&#x6B62;&#x3002;&#x5047;&#x8BBE;&#x5728;&#x7EBF;&#x7A0B;B&#x7EC8;&#x6B62;&#x4E4B;&#x524D;&#xFF0C;&#x4FEE;&#x6539;&#x4E86;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#xFF0C;&#x7EBF;&#x7A0B;A&#x4ECE;&#x7EBF;&#x7A0B;B&#x7684;join&#x65B9;&#x6CD5;&#x6210;&#x529F;&#x8FD4;&#x56DE;&#x540E;&#xFF0C;&#x7EBF;&#x7A0B;B&#x5BF9;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x4FEE;&#x6539;&#x5C06;&#x5BF9;&#x7EBF;&#x7A0B;A&#x53EF;&#x89C1;&#x3002;</p>
</li>
<li><p>&#x7EBF;&#x7A0B;&#x4E2D;&#x65AD;&#x89C4;&#x5219; &#x5BF9;&#x7EBF;&#x7A0B; interrupt()&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x5148;&#x884C;&#x53D1;&#x751F;&#x4E8E;&#x88AB;&#x4E2D;&#x65AD;&#x7EBF;&#x7A0B;&#x7684;&#x4EE3;&#x7801;&#x68C0;&#x6D4B;&#x5230;&#x4E2D;&#x65AD;&#x4E8B;&#x4EF6;&#x7684;&#x53D1;&#x751F;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Thread.interrupted()&#x65B9;&#x6CD5;&#x68C0;&#x6D4B;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x4E2D;&#x65AD;&#x3002;</p>
</li>
<li><p>&#x5BF9;&#x8C61;&#x7EC8;&#x7ED3;&#x89C4;&#x5219; &#x5BF9;&#x8C61;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6267;&#x884C;&#xFF0C;&#x7ED3;&#x675F;&#x5148;&#x4E8E;finalize()&#x65B9;&#x6CD5;</p>
</li>
</ul>
<p>&#x4E0A;&#x8FF0;8&#x6761;&#x539F;&#x5219;&#x65E0;&#x9700;&#x624B;&#x52A8;&#x6DFB;&#x52A0;&#x4EFB;&#x4F55;&#x540C;&#x6B65;&#x624B;&#x6BB5;(synchronized|volatile)&#x5373;&#x53EF;&#x8FBE;&#x5230;&#x6548;&#x679C;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x7ED3;&#x5408;&#x524D;&#x9762;&#x7684;&#x6848;&#x4F8B;&#x6F14;&#x793A;&#x8FD9;8&#x6761;&#x539F;&#x5219;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x5B89;&#x5168;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">MixedOrder</span>{</span><br><span class="line">    <span class="built_in">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">bool</span>ean flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> writer(){</span><br><span class="line">        a = <span class="number">1</span>;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> read(){</span><br><span class="line">        <span class="keyword">if</span>(flag){</span><br><span class="line">            <span class="built_in">int</span> i = a + <span class="number">1</span>&#xFF1B;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>
<p>&#x540C;&#x6837;&#x7684;&#x9053;&#x7406;&#xFF0C;&#x5B58;&#x5728;&#x4E24;&#x6761;&#x7EBF;&#x7A0B;A&#x548C;B&#xFF0C;&#x7EBF;&#x7A0B;A&#x8C03;&#x7528;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x7684;writer()&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x7EBF;&#x7A0B;B&#x8C03;&#x7528;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x7684;read()&#x65B9;&#x6CD5;&#xFF0C;&#x7EBF;&#x7A0B;A&#x5148;&#x542F;&#x52A8;&#x800C;&#x7EBF;&#x7A0B;B&#x540E;&#x542F;&#x52A8;&#xFF0C;&#x90A3;&#x4E48;&#x7EBF;&#x7A0B;B&#x8BFB;&#x53D6;&#x5230;&#x7684;i&#x503C;&#x662F;&#x591A;&#x5C11;&#x5462;&#xFF1F;&#x73B0;&#x5728;&#x4F9D;&#x636E;8&#x6761;&#x539F;&#x5219;&#xFF0C;&#x7531;&#x4E8E;&#x5B58;&#x5728;&#x4E24;&#x6761;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x8C03;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x7A0B;&#x5E8F;&#x6B21;&#x5E8F;&#x539F;&#x5219;&#x4E0D;&#x5408;&#x9002;&#x3002;writer()&#x65B9;&#x6CD5;&#x548C;read()&#x65B9;&#x6CD5;&#x90FD;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x540C;&#x6B65;&#x624B;&#x6BB5;&#xFF0C;&#x9501;&#x89C4;&#x5219;&#x4E5F;&#x4E0D;&#x5408;&#x9002;&#x3002;&#x6CA1;&#x6709;&#x4F7F;&#x7528;volatile&#x5173;&#x952E;&#x5B57;&#xFF0C;volatile&#x53D8;&#x91CF;&#x539F;&#x5219;&#x4E0D;&#x9002;&#x5E94;&#x3002;&#x7EBF;&#x7A0B;&#x542F;&#x52A8;&#x89C4;&#x5219;&#x3001;&#x7EBF;&#x7A0B;&#x7EC8;&#x6B62;&#x89C4;&#x5219;&#x3001;&#x7EBF;&#x7A0B;&#x4E2D;&#x65AD;&#x89C4;&#x5219;&#x3001;&#x5BF9;&#x8C61;&#x7EC8;&#x7ED3;&#x89C4;&#x5219;&#x3001;&#x4F20;&#x9012;&#x6027;&#x548C;&#x672C;&#x6B21;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#x4E5F;&#x4E0D;&#x5408;&#x9002;&#x3002;&#x7EBF;&#x7A0B;A&#x548C;&#x7EBF;&#x7A0B;B&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x867D;&#x7136;&#x6709;&#x5148;&#x540E;&#xFF0C;&#x4F46;&#x7EBF;&#x7A0B;B&#x6267;&#x884C;&#x7ED3;&#x679C;&#x5374;&#x662F;&#x4E0D;&#x786E;&#x5B9A;&#xFF0C;&#x4E5F;&#x662F;&#x8BF4;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x9002;&#x5408;8&#x6761;&#x539F;&#x5219;&#x4E2D;&#x7684;&#x4EFB;&#x610F;&#x4E00;&#x6761;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x540C;&#x6B65;&#x624B;&#x6BB5;&#xFF0C;&#x6240;&#x4EE5;&#x4E0A;&#x8FF0;&#x7684;&#x64CD;&#x4F5C;&#x662F;&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x7EBF;&#x7A0B;B&#x8BFB;&#x53D6;&#x7684;&#x503C;&#x81EA;&#x7136;&#x4E5F;&#x662F;&#x4E0D;&#x786E;&#x5B9A;&#x7684;&#x3002;&#x4FEE;&#x590D;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x65B9;&#x5F0F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x8981;&#x4E48;&#x7ED9;writer()&#x65B9;&#x6CD5;&#x548C;read()&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x540C;&#x6B65;&#x624B;&#x6BB5;&#xFF0C;&#x5982;synchronized&#x6216;&#x8005;&#x7ED9;&#x53D8;&#x91CF;flag&#x6DFB;&#x52A0;volatile&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x786E;&#x4FDD;&#x7EBF;&#x7A0B;A&#x4FEE;&#x6539;&#x7684;&#x503C;&#x5BF9;&#x7EBF;&#x7A0B;B&#x603B;&#x662F;&#x53EF;&#x89C1;&#x3002;</p>
<blockquote>
<p>&#x53C2;&#x8003;: <a href="https://blog.csdn.net/javazejian/article/details/72772461" target="_blank" rel="noopener">&#x5168;&#x9762;&#x7406;&#x89E3;Java&#x5185;&#x5B58;&#x6A21;&#x578B;(JMM)&#x53CA;volatile&#x5173;&#x952E;&#x5B57;</a></p>
</blockquote>
]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
  </entry>
  <entry>
    <title>markdown合并单元格</title>
    <url>/2019/markdown-he-bing-dan-yuan-ge/</url>
    <content><![CDATA[<blockquote>
<p>markdown&#x672C;&#x8EAB;&#x4E0D;&#x652F;&#x6301;&#x5408;&#x5E76;&#x5355;&#x5143;&#x683C;, &#x4F46;&#x662F;&#x517C;&#x5BB9;html, html&#x652F;&#x6301;&#x8BE5;&#x529F;&#x80FD;</p>
</blockquote>
<h2 id="html&#x5B9E;&#x73B0;&#x8868;&#x683C;">0.1. html&#x5B9E;&#x73B0;&#x8868;&#x683C;</h2><h3 id="&#x57FA;&#x7840;&#x7528;&#x6CD5;">0.1.1. &#x57FA;&#x7840;&#x7528;&#x6CD5;</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x59D3;&#x540D;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5E74;&#x9F84;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x6027;&#x522B;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x6768;&#x8FC7;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>18<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5357;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5C0F;&#x9F99;&#x5973;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>18<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5973;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
    <tr>
        <td>&#x59D3;&#x540D;</td>
        <td>&#x5E74;&#x9F84;</td>
        <td>&#x6027;&#x522B;</td>
    </tr>
    <tr>
        <td>&#x6768;&#x8FC7;</td>
        <td>18</td>
        <td>&#x7537;</td>
    </tr>
    <tr>
        <td>&#x5C0F;&#x9F99;&#x5973;</td>
        <td>18</td>
        <td>&#x5973;</td>
    </tr>
</table>

<a id="more"></a>

<h3 id="&#x5408;&#x5E76;&#x884C;">0.1.2. &#x5408;&#x5E76;&#x884C;</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x59D3;&#x540D;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5E74;&#x9F84;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x6027;&#x522B;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">rowspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>&#x6768;&#x8FC7;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>18<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x7537;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>18<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5973;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
    <tr>
        <td>&#x59D3;&#x540D;</td>
        <td>&#x5E74;&#x9F84;</td>
        <td>&#x6027;&#x522B;</td>
    </tr>
    <tr>
        <td rowspan="2">&#x6768;&#x8FC7;</td>
        <td>18</td>
        <td>&#x7537;</td>
    </tr>
    <tr>
        <td>18</td>
        <td>&#x5973;</td>
    </tr>
</table>


<h3 id="&#x5408;&#x5E76;&#x5217;">0.1.3. &#x5408;&#x5E76;&#x5217;</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x59D3;&#x540D;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5E74;&#x9F84;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x6027;&#x522B;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>&#x6768;&#x8FC7;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x7537;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5C0F;&#x9F99;&#x5973;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>18<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5973;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<table>
    <tr>
        <td>&#x59D3;&#x540D;</td>
        <td>&#x5E74;&#x9F84;</td>
        <td>&#x6027;&#x522B;</td>
    </tr>
    <tr>
        <td colspan="2">&#x6768;&#x8FC7;</td>
        <td>&#x7537;</td>
    </tr>
    <tr>
        <td>&#x5C0F;&#x9F99;&#x5973;</td>
        <td>18</td>
        <td>&#x5973;</td>
    </tr>
</table>

<h3 id="&#x6DF7;&#x5408;&#x4F7F;&#x7528;">0.1.4. &#x6DF7;&#x5408;&#x4F7F;&#x7528;</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x59D3;&#x540D;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5E74;&#x9F84;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x6027;&#x522B;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span> <span class="attr">rowspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>&#x6768;&#x8FC7;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x7537;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#x5973;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<table>
    <tr>
        <td>&#x59D3;&#x540D;</td>
        <td>&#x5E74;&#x9F84;</td>
        <td>&#x6027;&#x522B;</td>
    </tr>
    <tr>
        <td colspan="2" rowspan="2">&#x6768;&#x8FC7;</td>
        <td>&#x7537;</td>
    </tr>
    <tr>
        <td>&#x5973;</td>
    </tr>
</table>

<h2 id="java&#x8BFB;&#x53D6;excel&#x81EA;&#x52A8;&#x751F;&#x6210;">0.2. java&#x8BFB;&#x53D6;excel&#x81EA;&#x52A8;&#x751F;&#x6210;</h2><h3 id="&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x5C0F;&#x5DE5;&#x5177;">0.2.1. &#x81EA;&#x5DF1;&#x5199;&#x7684;&#x5C0F;&#x5DE5;&#x5177;</h3><figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learning.demo.util.html;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.util.CellRangeAddress;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.<span class="built_in">text</span>.DecimalFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="keyword">HashMap</span>;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Excel&#x89E3;&#x6790;&#x5904;&#x7406;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> class HtmlExcelUtil {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger <span class="built_in">log</span> = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> UNION = <span class="string">&quot;table_union_used&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Workbook workbook;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> HtmlExcelUtil(File file) <span class="keyword">throws</span> Exception {</span><br><span class="line">        workbook = WorkbookFactory.create(<span class="keyword">new</span> FileInputStream(file));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> buildHtmlExcel() {</span><br><span class="line">        TableColumnGroup tableColumnMap = getTableColumnMap();</span><br><span class="line">        soutHtmlTable(tableColumnMap);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> soutHtmlTable(TableColumnGroup tableColumnMap) {</span><br><span class="line">        Map&lt;<span class="keyword">String</span>, TableColumn&gt; <span class="built_in">map</span> = tableColumnMap.getMap();</span><br><span class="line">        Integer maxCell = tableColumnMap.getMaxCell();</span><br><span class="line">        Integer maxRow = tableColumnMap.getMaxRow();</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.<span class="built_in">append</span>(<span class="string">&quot;&lt;table&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt;= maxRow; y++) {</span><br><span class="line">            sb.<span class="built_in">append</span>(<span class="string">&quot;&lt;tr&gt;&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt;= maxCell; x++) {</span><br><span class="line">                TableColumn tableColumn = <span class="built_in">map</span>.<span class="built_in">get</span>(x + <span class="string">&quot;-&quot;</span> + y);</span><br><span class="line">                <span class="keyword">if</span> (tableColumn == <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">String</span> value = tableColumn.getValue();</span><br><span class="line">                <span class="keyword">if</span> (!UNION.equals(value)) {</span><br><span class="line">                    sb.<span class="built_in">append</span>(<span class="string">&quot;&lt;td &quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (tableColumn.getHigh() &gt; <span class="number">1</span>) {</span><br><span class="line">                        sb.<span class="built_in">append</span>(<span class="string">&quot;rowspan=\&quot;&quot;</span>);</span><br><span class="line">                        sb.<span class="built_in">append</span>(tableColumn.getHigh());</span><br><span class="line">                        sb.<span class="built_in">append</span>(<span class="string">&quot;\&quot; &quot;</span>);</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">if</span> (tableColumn.getWide() &gt; <span class="number">1</span>) {</span><br><span class="line">                        sb.<span class="built_in">append</span>(<span class="string">&quot;colspan=\&quot;&quot;</span>);</span><br><span class="line">                        sb.<span class="built_in">append</span>(tableColumn.getWide());</span><br><span class="line">                        sb.<span class="built_in">append</span>(<span class="string">&quot;\&quot; &quot;</span>);</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    sb.<span class="built_in">append</span>(<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">                    sb.<span class="built_in">append</span>(value);</span><br><span class="line">                    sb.<span class="built_in">append</span>(<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            sb.<span class="built_in">append</span>(<span class="string">&quot;&lt;/tr&gt;&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">        sb.<span class="built_in">append</span>(<span class="string">&quot;&lt;/table&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(sb.toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x8BFB;&#x53D6;&#x5904;&#x7406;excel&#x6570;&#x636E;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @throws Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> TableColumnGroup getTableColumnMap() {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Sheet sheet = workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">            Map&lt;<span class="keyword">String</span>, TableColumn&gt; <span class="built_in">map</span> = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;&gt;();</span><br><span class="line">            <span class="comment">// &#x5904;&#x7406;&#x5408;&#x5E76;&#x5355;&#x5143;&#x683C;</span></span><br><span class="line">            buildUnionTable(sheet, <span class="built_in">map</span>);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">int</span> lastRowNum = sheet.getLastRowNum();</span><br><span class="line">            <span class="keyword">short</span> lastCellNum = sheet.getRow(<span class="number">0</span>).getLastCellNum();</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> rowIndex = <span class="number">0</span>; rowIndex &lt;= lastRowNum; rowIndex++) {</span><br><span class="line">                Row row = sheet.getRow(rowIndex);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">short</span> cellIndex = <span class="number">0</span>; cellIndex &lt; lastCellNum; cellIndex++) {</span><br><span class="line"></span><br><span class="line">                    Cell cell = row.getCell(cellIndex);</span><br><span class="line">                    <span class="keyword">String</span> cellValue = (<span class="keyword">String</span>) getCellValue(cell);</span><br><span class="line">                    <span class="keyword">String</span> <span class="built_in">key</span> = cellIndex + <span class="string">&quot;-&quot;</span> + rowIndex;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">map</span>.<span class="built_in">get</span>(<span class="built_in">key</span>) == <span class="keyword">null</span>) {</span><br><span class="line">                        <span class="built_in">map</span>.put(<span class="built_in">key</span>, <span class="keyword">new</span> TableColumn(cellValue));</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TableColumnGroup(<span class="built_in">map</span>, (<span class="built_in">int</span>) lastCellNum, lastRowNum);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            <span class="built_in">log</span>.error(<span class="string">&quot;&#x89E3;&#x6790;Excel&#x5F02;&#x5E38;&quot;</span>, e);</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                workbook.close();</span><br><span class="line">            } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">                <span class="built_in">log</span>.error(<span class="string">&quot;workbook&#x5173;&#x95ED;&#x5F02;&#x5E38;&quot;</span>, e);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x5904;&#x7406;&#x5408;&#x5E76;&#x5355;&#x5143;&#x683C;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param sheet</span></span><br><span class="line"><span class="comment">     * @param map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> buildUnionTable(Sheet sheet, Map&lt;<span class="keyword">String</span>, TableColumn&gt; <span class="built_in">map</span>) {</span><br><span class="line">        <span class="comment">// &#x904D;&#x5386;&#x5408;&#x5E76;&#x533A;&#x57DF;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; sheet.getNumMergedRegions(); i++) {</span><br><span class="line">            CellRangeAddress region = sheet.getMergedRegion(i);<span class="comment">//</span></span><br><span class="line">            <span class="built_in">int</span> firstColumn = region.getFirstColumn();             <span class="comment">// &#x5408;&#x5E76;&#x533A;&#x57DF;&#x9996;&#x5217;&#x4F4D;&#x7F6E;</span></span><br><span class="line">            <span class="built_in">int</span> lastColumn = region.getLastColumn();</span><br><span class="line">            <span class="built_in">int</span> firstRow = region.getFirstRow();                     <span class="comment">// &#x5408;&#x5E76;&#x533A;&#x57DF;&#x9996;&#x884C;&#x4F4D;&#x7F6E;</span></span><br><span class="line">            <span class="built_in">int</span> lastRow = region.getLastRow();</span><br><span class="line">            Row firRow = sheet.getRow(firstRow);</span><br><span class="line">            Cell firCell = firRow.getCell(firstColumn);</span><br><span class="line">            <span class="keyword">String</span> cellValue = (<span class="keyword">String</span>) getCellValue(firCell);</span><br><span class="line">            TableColumn tableColumn = <span class="keyword">new</span> TableColumn(lastColumn - firstColumn + <span class="number">1</span>, lastRow - firstRow + <span class="number">1</span>, cellValue);</span><br><span class="line">            <span class="built_in">map</span>.put(firstColumn + <span class="string">&quot;-&quot;</span> + firstRow, tableColumn);</span><br><span class="line">            <span class="comment">// &#x5904;&#x7406;&#x5408;&#x5E76;&#x5355;&#x5143;&#x683C;</span></span><br><span class="line">            <span class="built_in">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> y = firstRow; y &lt;= lastRow; y++) {</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> x = firstColumn; x &lt;= lastColumn; x++) {</span><br><span class="line">                    <span class="keyword">if</span> (flag) {</span><br><span class="line">                        flag = <span class="keyword">false</span>;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    }</span><br><span class="line">                    TableColumn value = <span class="keyword">new</span> TableColumn(UNION);</span><br><span class="line">                    <span class="built_in">map</span>.put(x + <span class="string">&quot;-&quot;</span> + y, value);</span><br><span class="line"></span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#x83B7;&#x53D6;cell&#x5185;&#x5BB9;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param cell</span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> getCellValue(Cell cell) {</span><br><span class="line">        <span class="keyword">String</span> value = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (cell != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">switch</span> (cell.getCellTypeEnum()) {</span><br><span class="line">                <span class="keyword">case</span> STRING:</span><br><span class="line">                    <span class="keyword">if</span> (cell.getStringCellValue().<span class="built_in">trim</span>().equals(<span class="string">&quot;&apos;&quot;</span>)) {</span><br><span class="line">                        value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    } <span class="keyword">else</span> <span class="keyword">if</span> (cell.getStringCellValue().<span class="built_in">trim</span>().equals(<span class="string">&quot;&quot;</span>)) {</span><br><span class="line">                        value = <span class="keyword">null</span>;</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        value = cell.getStringCellValue();</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> NUMERIC:</span><br><span class="line">                    <span class="keyword">if</span> (DateUtil.isCellDateFormatted(cell)) {</span><br><span class="line">                        value = cell.getDateCellValue().toString();</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        value = <span class="keyword">new</span> DecimalFormat(<span class="string">&quot;#.######&quot;</span>).format(cell.getNumericCellValue());</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> BLANK:</span><br><span class="line">                    value = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    value = <span class="keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(value)) {</span><br><span class="line">            <span class="comment">// &#x66FF;&#x6362;&#x591A;&#x4F59;2&#x4E2A;&#x7684;&#x7A7A;&#x683C;&#x4E3A;&#x5355;&#x4E2A;&#x7A7A;&#x683C;,&#x66FF;&#x6362;&#x7A7A;&#x884C;&#x4E3A;&#x5355;&#x4E2A;&#x7A7A;&#x683C;</span></span><br><span class="line">            value = value.replaceAll(<span class="string">&quot;\\s{2,}&quot;</span>, <span class="string">&quot; &quot;</span>).replaceAll(<span class="string">&quot;(?m)^\\s*$&quot;</span> + System.lineSeparator(), <span class="string">&quot; &quot;</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    class TableColumnGroup {</span><br><span class="line">        <span class="keyword">private</span> Map&lt;<span class="keyword">String</span>, TableColumn&gt; <span class="built_in">map</span>;</span><br><span class="line">        <span class="keyword">private</span> Integer maxCell;</span><br><span class="line">        <span class="keyword">private</span> Integer maxRow;</span><br><span class="line"></span><br><span class="line">        TableColumnGroup(Map&lt;<span class="keyword">String</span>, TableColumn&gt; <span class="built_in">map</span>, Integer maxCell, Integer maxRow) {</span><br><span class="line">            <span class="keyword">this</span>.<span class="built_in">map</span> = <span class="built_in">map</span>;</span><br><span class="line">            <span class="keyword">this</span>.maxCell = maxCell;</span><br><span class="line">            <span class="keyword">this</span>.maxRow = maxRow;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Map&lt;<span class="keyword">String</span>, TableColumn&gt; getMap() {</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">map</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Integer getMaxCell() {</span><br><span class="line">            <span class="keyword">return</span> maxCell;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Integer getMaxRow() {</span><br><span class="line">            <span class="keyword">return</span> maxRow;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    class TableColumn {</span><br><span class="line">        <span class="keyword">private</span> Integer wide;</span><br><span class="line">        <span class="keyword">private</span> Integer high;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">String</span> value;</span><br><span class="line"></span><br><span class="line">        TableColumn(<span class="keyword">String</span> value) {</span><br><span class="line">            <span class="keyword">this</span>.high = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">this</span>.wide = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        TableColumn(Integer wide, Integer high, <span class="keyword">String</span> value) {</span><br><span class="line">            <span class="keyword">this</span>.wide = wide;</span><br><span class="line">            <span class="keyword">this</span>.high = high;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Integer getHigh() {</span><br><span class="line">            <span class="keyword">return</span> high;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Integer getWide() {</span><br><span class="line">            <span class="keyword">return</span> wide;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">String</span> getValue() {</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="&#x8C03;&#x7528;">0.2.2. &#x8C03;&#x7528;</h3><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.learning.demo.util.html;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.<span class="built_in">File</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Classname&#xFF1A;HtmlTableTest</span></span><br><span class="line"><span class="comment"> * Description&#xFF1A;TODO</span></span><br><span class="line"><span class="comment"> * date&#xFF1A;2019-12-17 16:58</span></span><br><span class="line"><span class="comment"> * author&#xFF1A;yuyu</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlTableTest</span> {</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> throws Exception </span>{</span><br><span class="line">        HtmlExcelUtil htmlExcelUtil = <span class="keyword">new</span> HtmlExcelUtil(<span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;/Users/yuyu/Documents/secooDoc/update-&#x4EC5;&#x4FEE;&#x6539;.xlsx&quot;</span>));</span><br><span class="line"></span><br><span class="line">        htmlExcelUtil.buildHtmlExcel();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="&#x5176;&#x4ED6;&#x65B9;&#x6CD5;">1. &#x5176;&#x4ED6;&#x65B9;&#x6CD5;</h1><p>&#x4ECE;excel&#x590D;&#x5236;&#x5230;Typora&#x5373;&#x53EF;, &#x54C8;&#x54C8;&#x54C8;&#x54C8;</p>
]]></content>
      <categories>
        <category>util</category>
      </categories>
      <tags>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>并发2:Synchronized</title>
    <url>/2019/Synchronized/</url>
    <content><![CDATA[<h2 id="&#x9501;&#x673A;&#x5236;&#x6709;&#x5982;&#x4E0B;&#x4E24;&#x79CD;&#x7279;&#x6027;&#xFF1A;">0.1. &#x9501;&#x673A;&#x5236;&#x6709;&#x5982;&#x4E0B;&#x4E24;&#x79CD;&#x7279;&#x6027;&#xFF1A;</h2><ol>
<li>&#x4E92;&#x65A5;&#x6027;&#xFF1A;&#x5373;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x53EA;&#x5141;&#x8BB8;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x9501;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x7279;&#x6027;&#x6765;&#x5B9E;&#x73B0;&#x591A;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#x534F;&#x8C03;&#x673A;&#x5236;&#xFF0C;&#x8FD9;&#x6837;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5BF9;&#x9700;&#x540C;&#x6B65;&#x7684;&#x4EE3;&#x7801;&#x5757;(&#x590D;&#x5408;&#x64CD;&#x4F5C;)&#x8FDB;&#x884C;&#x8BBF;&#x95EE;&#x3002;&#x4E92;&#x65A5;&#x6027;&#x6211;&#x4EEC;&#x4E5F;&#x5F80;&#x5F80;&#x79F0;&#x4E3A;&#x64CD;&#x4F5C;&#x7684;&#x539F;&#x5B50;&#x6027;&#x3002;</li>
<li>&#x53EF;&#x89C1;&#x6027;&#xFF1A;&#x5FC5;&#x987B;&#x786E;&#x4FDD;&#x5728;&#x9501;&#x88AB;&#x91CA;&#x653E;&#x4E4B;&#x524D;&#xFF0C;&#x5BF9;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x6240;&#x505A;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x5BF9;&#x4E8E;&#x968F;&#x540E;&#x83B7;&#x5F97;&#x8BE5;&#x9501;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x662F;&#x53EF;&#x89C1;&#x7684;&#xFF08;&#x5373;&#x5728;&#x83B7;&#x5F97;&#x9501;&#x65F6;&#x5E94;&#x83B7;&#x5F97;&#x6700;&#x65B0;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF09;&#xFF0C;&#x5426;&#x5219;&#x53E6;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x80FD;&#x662F;&#x5728;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x7684;&#x67D0;&#x4E2A;&#x526F;&#x672C;&#x4E0A;&#x7EE7;&#x7EED;&#x64CD;&#x4F5C;&#x4ECE;&#x800C;&#x5F15;&#x8D77;&#x4E0D;&#x4E00;&#x81F4;&#x3002;</li>
</ol>
<h2 id="Synchronized-&#x7684;&#x7528;&#x6CD5;">0.2. Synchronized &#x7684;&#x7528;&#x6CD5;</h2><table><tr><td>&#x5206;&#x7C7B;</td><td>&#x5177;&#x4F53;&#x5206;&#x7C7B;</td><td>&#x88AB;&#x9501;&#x5BF9;&#x8C61;</td><td>&#x4E3E;&#x4F8B;</td></tr><tr><td rowspan="2">&#x65B9;&#x6CD5;</td><td>&#x65B9;&#x6CD5;</td><td>&#x5F53;&#x524D;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;</td><td> public Synchronized void test() { }</td></tr><tr><td>&#x9759;&#x6001;&#x65B9;&#x6CD5;</td><td>&#x7C7B;&#x5BF9;&#x8C61;</td><td> public static Synchronized void test() { }</td></tr><tr><td rowspan="3" colspan="2">&#x4EE3;&#x7801;&#x5757;</td><td>&#x5F53;&#x524D;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;</td><td> public void test() { Synchronized (this){ } }</td></tr><tr><td>class&#x5BF9;&#x8C61;</td><td> public void test() { Synchronized (Test.getClass()){ } }</td></tr><tr><td>&#x4EFB;&#x610F;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;</td><td> private Object lock = new Object(); public void test() { Synchronized (lock){ } }</td></tr></table>


<a id="more"></a>

<h2 id="&#x9501;&#x5BF9;&#x8C61;&#x7684;&#x5206;&#x7C7B;">0.3. &#x9501;&#x5BF9;&#x8C61;&#x7684;&#x5206;&#x7C7B;</h2><ol>
<li><p>&#x5BF9;&#x8C61;&#x9501;</p>
<blockquote>
<p>&#x5982;&#x679C;&#x5BF9;class&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x53CD;&#x7F16;&#x8BD1;&#x53EF;&#x4EE5;&#x770B;&#x5230;,&#x5BF9;&#x8C61;&#x5728;&#x6267;&#x884C;&#x65F6;&#x9996;&#x5148;&#x8981;&#x5148;&#x6267;&#x884C;monitorenter&#x6307;&#x4EE4;&#xFF0C;&#x9000;&#x51FA;&#x7684;&#x65F6;&#x5019;monitorexit&#x6307;&#x4EE4;&#x3002;</p>
</blockquote>
</li>
<li><p>&#x7C7B;&#x9501;</p>
<blockquote>
<p>&#x5728; Java &#x4E2D;&#xFF0C;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x7C7B;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;&#x9501;&#xFF0C;&#x53EF;&#x4EE5;&#x79F0;&#x4E3A;&#x201C;&#x7C7B;&#x9501;&#x201D;&#xFF0C;&#x7C7B;&#x9501;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x901A;&#x8FC7;&#x5BF9;&#x8C61;&#x9501;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5373;&#x7C7B;&#x7684; Class &#x5BF9;&#x8C61;&#x9501;&#x3002;&#x6BCF;&#x4E2A;&#x7C7B;&#x53EA;&#x6709;&#x4E00;&#x4E2A; Class &#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x4E2A;&#x7C7B;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7C7B;&#x9501;&#x3002;</p>
</blockquote>
</li>
</ol>
<hr>
<h2 id="&#x540C;&#x6B65;&#x4EE3;&#x7801;&#x5757;">0.4. &#x540C;&#x6B65;&#x4EE3;&#x7801;&#x5757;</h2><h3 id="&#x5BF9;&#x8C61;&#x9501;&#x6267;&#x884C;&#x6D41;&#x7A0B;">0.4.1. &#x5BF9;&#x8C61;&#x9501;&#x6267;&#x884C;&#x6D41;&#x7A0B;</h3><p>&#x5728;&#x5BF9;&#x5E26;&#x6709; <code>Synchronized</code> &#x9501;&#x7684;&#x7C7B;&#x7684;class&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x53CD;&#x7F16;&#x8BD1;&#x540E;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x5E26;&#x6709;&#x4E0B;&#x65B9;&#x5173;&#x952E;&#x5B57;&#x7684;&#x6D41;&#x7A0B;</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line">monitorenter  <span class="string">//</span>&#x8FDB;&#x5165;&#x540C;&#x6B65;&#x65B9;&#x6CD5;</span><br><span class="line"><span class="string">...</span></span><br><span class="line">monitorexit   <span class="string">//</span>&#x9000;&#x51FA;&#x540C;&#x6B65;&#x65B9;&#x6CD5;</span><br><span class="line"><span class="string">...</span></span><br><span class="line">monitorexit <span class="string">//</span> &#x9000;&#x51FA;&#x540C;&#x6B65;&#x65B9;&#x6CD5;<span class="params">(&#x76F8;&#x5F53;&#x4E8E;finally)</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D; <code>monitorenter</code> &#x6307;&#x4EE4;&#x6307;&#x5411;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#x5757;&#x7684;&#x5F00;&#x59CB;&#x4F4D;&#x7F6E;&#xFF0C;<code>monitorexit</code> &#x6307;&#x4EE4;&#x5219;&#x6307;&#x660E;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#x5757;&#x7684;&#x7ED3;&#x675F;&#x4F4D;&#x7F6E;, &#x5F53;&#x6267;&#x884C; <code>monitorenter</code> &#x6307;&#x4EE4;&#x65F6;&#xFF0C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5C06;&#x8BD5;&#x56FE;&#x83B7;&#x53D6; <strong>&#x5BF9;&#x8C61;&#x9501;</strong> &#x6240;&#x5BF9;&#x5E94;&#x7684; monitor &#x7684;&#x6301;&#x6709;&#x6743;&#xFF0C;&#x5F53; <strong>&#x5BF9;&#x8C61;&#x9501;</strong> &#x7684; monitor &#x7684;&#x8FDB;&#x5165;&#x8BA1;&#x6570;&#x5668;&#x4E3A; 0&#xFF0C;&#x90A3;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x6210;&#x529F;&#x53D6;&#x5F97; monitor&#xFF0C;&#x5E76;&#x5C06;&#x8BA1;&#x6570;&#x5668;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A; 1&#xFF0C;&#x53D6;&#x9501;&#x6210;&#x529F;&#x3002;&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x62E5;&#x6709; <strong>&#x5BF9;&#x8C61;&#x9501;</strong> &#x7684; monitor &#x7684;&#x6301;&#x6709;&#x6743;&#xFF0C;&#x90A3;&#x5B83;&#x53EF;&#x4EE5;&#x91CD;&#x5165;&#x8FD9;&#x4E2A; monitor&#xFF0C;&#x91CD;&#x5165;&#x65F6;&#x8BA1;&#x6570;&#x5668;&#x7684;&#x503C;&#x4E5F;&#x4F1A;&#x52A0; 1&#x3002;&#x5018;&#x82E5;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x62E5;&#x6709; <strong>&#x5BF9;&#x8C61;&#x9501;</strong> &#x7684; monitor &#x7684;&#x6240;&#x6709;&#x6743;&#xFF0C;&#x90A3;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5C06;&#x88AB;&#x963B;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#xFF0C;&#x5373; <code>monitorexit</code>&#x6307;&#x4EE4;&#x88AB;&#x6267;&#x884C;&#xFF0C;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x5C06;&#x91CA;&#x653E; monitor(&#x9501;)&#x5E76;&#x8BBE;&#x7F6E;&#x8BA1;&#x6570;&#x5668;&#x503C;&#x4E3A;0 &#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5C06;&#x6709;&#x673A;&#x4F1A;&#x6301;&#x6709; monitor &#x3002;</p>
<p>&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x7F16;&#x8BD1;&#x5668;&#x5C06;&#x4F1A;&#x786E;&#x4FDD;&#x65E0;&#x8BBA;&#x65B9;&#x6CD5;&#x901A;&#x8FC7;&#x4F55;&#x79CD;&#x65B9;&#x5F0F;&#x5B8C;&#x6210;&#xFF0C;&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;&#x8FC7;&#x7684;&#x6BCF;&#x6761; <code>monitorenter</code> &#x6307;&#x4EE4;&#x90FD;&#x6709;&#x6267;&#x884C;&#x5176;&#x5BF9;&#x5E94; <code>monitorexit</code> &#x6307;&#x4EE4;&#xFF0C;&#x800C;&#x65E0;&#x8BBA;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x6B63;&#x5E38;&#x7ED3;&#x675F;&#x8FD8;&#x662F;&#x5F02;&#x5E38;&#x7ED3;&#x675F;&#x3002;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x5728;&#x65B9;&#x6CD5;&#x5F02;&#x5E38;&#x5B8C;&#x6210;&#x65F6; <code>monitorenter</code> &#x548C; <code>monitorexit</code> &#x6307;&#x4EE4;&#x4F9D;&#x7136;&#x53EF;&#x4EE5;&#x6B63;&#x786E;&#x914D;&#x5BF9;&#x6267;&#x884C;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x81EA;&#x52A8;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x8FD9;&#x4E2A;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x5668;&#x58F0;&#x660E;&#x53EF;&#x5904;&#x7406;&#x6240;&#x6709;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x5B83;&#x7684;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x7528;&#x6765;&#x6267;&#x884C; <code>monitorexit</code> &#x6307;&#x4EE4;&#x3002;&#x4ECE;&#x5B57;&#x8282;&#x7801;&#x4E2D;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x591A;&#x4E86;&#x4E00;&#x4E2A;<code>monitorexit</code>&#x6307;&#x4EE4;&#xFF0C;&#x5B83;&#x5C31;&#x662F;&#x5F02;&#x5E38;&#x7ED3;&#x675F;&#x65F6;&#x88AB;&#x6267;&#x884C;&#x7684;&#x91CA;&#x653E;monitor &#x7684;&#x6307;&#x4EE4;&#x3002;</p>
<p>&#x9501;&#x7684;&#x91CD;&#x5165;&#x6027;: &#x5373;&#x5728;&#x540C;&#x4E00;&#x9501;&#x7A0B;&#x4E2D;&#xFF0C;&#x7EBF;&#x7A0B;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x6B21;&#x83B7;&#x53D6;&#x540C;&#x4E00;&#x628A;&#x9501;&#x3002;<code>Synchronized</code>&#x5148;&#x5929;&#x5177;&#x6709;&#x91CD;&#x5165;&#x6027;&#x3002;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x62E5;&#x6709;&#x4E00;&#x4E2A;&#x8BA1;&#x6570;&#x5668;&#xFF0C;&#x5F53;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x8BE5;&#x5BF9;&#x8C61;&#x9501;&#x540E;&#xFF0C;&#x8BA1;&#x6570;&#x5668;&#x5C31;&#x4F1A;&#x52A0;&#x4E00;&#xFF0C;&#x91CA;&#x653E;&#x9501;&#x540E;&#x5C31;&#x4F1A;&#x5C06;&#x8BA1;&#x6570;&#x5668;&#x51CF;&#x4E00;&#x3002;</p>
<h3 id="&#x5BF9;&#x8C61;&#x5728;&#x5806;&#x5185;&#x5B58;&#x7684;&#x7ED3;&#x6784;">0.4.2. &#x5BF9;&#x8C61;&#x5728;&#x5806;&#x5185;&#x5B58;&#x7684;&#x7ED3;&#x6784;</h3><p>&#x5728;JVM&#x4E2D;&#xFF0C;&#x5BF9;&#x8C61;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5E03;&#x5C40;&#x5206;&#x4E3A;&#x4E09;&#x5757;&#x533A;&#x57DF;&#xFF1A;&#x5BF9;&#x8C61;&#x5934;&#x3001;&#x5B9E;&#x4F8B;&#x6570;&#x636E;&#x548C;&#x586B;&#x5145;&#x6570;&#x636E;</p>
<ol>
<li>&#x5B9E;&#x4F8B;&#x53D8;&#x91CF;&#xFF1A;&#x5B58;&#x653E;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x6570;&#x636E;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#x7236;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x6570;&#x7EC4;&#x7684;&#x5B9E;&#x4F8B;&#x90E8;&#x5206;&#x8FD8;&#x5305;&#x62EC;&#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5B58;&#x6309;4&#x5B57;&#x8282;&#x5BF9;&#x9F50;&#x3002;</li>
<li>&#x586B;&#x5145;&#x6570;&#x636E;&#xFF1A;&#x7531;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x8981;&#x6C42;&#x5BF9;&#x8C61;&#x8D77;&#x59CB;&#x5730;&#x5740;&#x5FC5;&#x987B;&#x662F;8&#x5B57;&#x8282;&#x7684;&#x6574;&#x6570;&#x500D;&#x3002;&#x586B;&#x5145;&#x6570;&#x636E;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x4EC5;&#x4EC5;&#x662F;&#x4E3A;&#x4E86;&#x5B57;&#x8282;&#x5BF9;&#x9F50;&#xFF0C;&#x8FD9;&#x70B9;&#x4E86;&#x89E3;&#x5373;&#x53EF;&#x3002;</li>
<li>&#x5BF9;&#x8C61;&#x5934;,&#x91C7;&#x7528;2&#x4E2A;&#x5B57;&#x6765;&#x5B58;&#x50A8;&#x5BF9;&#x8C61;&#x5934;(&#x5982;&#x679C;&#x5BF9;&#x8C61;&#x662F;&#x6570;&#x7EC4;&#x5219;&#x4F1A;&#x5206;&#x914D;3&#x4E2A;&#x5B57;&#xFF0C;&#x591A;&#x51FA;&#x6765;&#x7684;1&#x4E2A;&#x5B57;&#x8BB0;&#x5F55;&#x7684;&#x662F;&#x6570;&#x7EC4;&#x957F;&#x5EA6;)&#xFF0C;&#x5176;&#x4E3B;&#x8981;&#x7ED3;&#x6784;&#x662F;&#x7531;Mark Word &#x548C; Class Metadata Address &#x7EC4;&#x6210;</li>
</ol>
<h3 id="&#x5BF9;&#x8C61;&#x5934;">0.4.3. &#x5BF9;&#x8C61;&#x5934;</h3><p>&#x5B83;&#x5B9E;&#x73B0;<code>Synchronized</code>&#x7684;&#x9501;&#x5BF9;&#x8C61;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x8FD9;&#x70B9;&#x6211;&#x4EEC;&#x91CD;&#x70B9;&#x5206;&#x6790;&#x5B83;&#xFF0C;&#x4E00;&#x822C;&#x800C;&#x8A00;&#xFF0C;<code>Synchronized</code>&#x4F7F;&#x7528;&#x7684;&#x9501;&#x5BF9;&#x8C61;&#x662F;&#x5B58;&#x50A8;&#x5728;Java&#x5BF9;&#x8C61;&#x5934;&#x91CC;&#x7684;&#xFF0C;jvm&#x4E2D;&#x91C7;&#x7528;2&#x4E2A;&#x5B57;&#x6765;&#x5B58;&#x50A8;&#x5BF9;&#x8C61;&#x5934;(&#x5982;&#x679C;&#x5BF9;&#x8C61;&#x662F;&#x6570;&#x7EC4;&#x5219;&#x4F1A;&#x5206;&#x914D;3&#x4E2A;&#x5B57;&#xFF0C;&#x591A;&#x51FA;&#x6765;&#x7684;1&#x4E2A;&#x5B57;&#x8BB0;&#x5F55;&#x7684;&#x662F;&#x6570;&#x7EC4;&#x957F;&#x5EA6;)&#xFF0C;&#x5176;&#x4E3B;&#x8981;&#x7ED3;&#x6784;&#x662F;&#x7531;Mark Word &#x548C; Class Metadata Address &#x7EC4;&#x6210;&#xFF0C;&#x5176;&#x7ED3;&#x6784;&#x8BF4;&#x660E;&#x5982;&#x4E0B;&#x8868;&#xFF1A;</p>
<table>
<thead>
<tr>
<th align="center">&#x865A;&#x62DF;&#x673A;&#x4F4D;&#x6570;</th>
<th align="center">&#x5934;&#x5BF9;&#x8C61;&#x7ED3;&#x6784;</th>
<th align="center">&#x8BF4;&#x660E;</th>
</tr>
</thead>
<tbody><tr>
<td align="center">32/64bit</td>
<td align="center">Mark Word</td>
<td align="center">&#x5B58;&#x50A8;&#x5BF9;&#x8C61;&#x7684;hashCode&#x3001;&#x9501;&#x4FE1;&#x606F;&#x6216;&#x5206;&#x4EE3;&#x5E74;&#x9F84;&#x6216;GC&#x6807;&#x5FD7;&#x7B49;&#x4FE1;&#x606F;</td>
</tr>
<tr>
<td align="center">32/64bit</td>
<td align="center">Class Metadata Address</td>
<td align="center">&#x7C7B;&#x578B;&#x6307;&#x9488;&#x6307;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x7C7B;&#x5143;&#x6570;&#x636E;&#xFF0C;JVM&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x6307;&#x9488;&#x786E;&#x5B9A;&#x8BE5;&#x5BF9;&#x8C61;&#x662F;&#x54EA;&#x4E2A;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</td>
</tr>
</tbody></table>
<p>&#x5176;&#x4E2D;Mark Word&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x5B58;&#x50A8;&#x7740;&#x5BF9;&#x8C61;&#x7684;HashCode&#x3001;&#x5206;&#x4EE3;&#x5E74;&#x9F84;&#x3001;&#x9501;&#x6807;&#x8BB0;&#x4F4D;&#x7B49;&#x4EE5;&#x4E0B;&#x662F;32&#x4F4D;JVM&#x7684;Mark Word&#x9ED8;&#x8BA4;&#x5B58;&#x50A8;&#x7ED3;&#x6784;</p>
<table>
<thead>
<tr>
<th align="center">&#x9501;&#x72B6;&#x6001;</th>
<th align="center">25bit</th>
<th align="center">4bit</th>
<th align="center">1bit&#x662F;&#x5426;&#x662F;&#x504F;&#x5411;&#x9501;</th>
<th align="center">2bit &#x9501;&#x6807;&#x5FD7;&#x4F4D;</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&#x65E0;&#x9501;&#x72B6;&#x6001;</td>
<td align="center">&#x5BF9;&#x8C61;HashCode</td>
<td align="center">&#x5BF9;&#x8C61;&#x5206;&#x4EE3;&#x5E74;&#x9F84;</td>
<td align="center">0</td>
<td align="center">01</td>
</tr>
</tbody></table>
<p>&#x7531;&#x4E8E;&#x5BF9;&#x8C61;&#x5934;&#x7684;&#x4FE1;&#x606F;&#x662F;&#x4E0E;&#x5BF9;&#x8C61;&#x81EA;&#x8EAB;&#x5B9A;&#x4E49;&#x7684;&#x6570;&#x636E;&#x6CA1;&#x6709;&#x5173;&#x7CFB;&#x7684;&#x989D;&#x5916;&#x5B58;&#x50A8;&#x6210;&#x672C;&#xFF0C;&#x56E0;&#x6B64;&#x8003;&#x8651;&#x5230;JVM&#x7684;&#x7A7A;&#x95F4;&#x6548;&#x7387;&#xFF0C;Mark Word &#x88AB;&#x8BBE;&#x8BA1;&#x6210;&#x4E3A;&#x4E00;&#x4E2A;&#x975E;&#x56FA;&#x5B9A;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x4EE5;&#x4FBF;&#x5B58;&#x50A8;&#x66F4;&#x591A;&#x6709;&#x6548;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5B83;&#x4F1A;&#x6839;&#x636E;&#x5BF9;&#x8C61;&#x672C;&#x8EAB;&#x7684;&#x72B6;&#x6001;&#x590D;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#xFF0C;&#x5982;32&#x4F4D;JVM&#x4E0B;&#xFF0C;&#x9664;&#x4E86;&#x4E0A;&#x8FF0;&#x5217;&#x51FA;&#x7684;Mark Word&#x9ED8;&#x8BA4;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x5982;&#x4E0B;&#x53EF;&#x80FD;&#x53D8;&#x5316;&#x7684;&#x7ED3;&#x6784;&#xFF1A;</p>
<table><tr><td rowspan="2">&#x9501;&#x72B6;&#x6001;</td><td colspan="2">25bit</td><td rowspan="2">4bit</td><td>1bit</td><td>2bit</td></tr><tr><td>23bit</td><td>2bit</td><td>&#x662F;&#x5426;&#x504F;&#x5411;&#x9501;</td><td>&#x9501;&#x6807;&#x5FD7;&#x4F4D;</td></tr><tr><td>&#x65E0;&#x9501;&#x72B6;&#x6001;</td><td colspan="2">&#x5BF9;&#x8C61;&#x7684;hashCode</td><td>&#x5BF9;&#x8C61;&#x5206;&#x4EE3;&#x5E74;&#x9F84;</td><td>0</td><td>01</td></tr><tr><td>&#x8F7B;&#x91CF;&#x7EA7;&#x9501;</td><td colspan="4">&#x6307;&#x5411;&#x6808;&#x4E2D;&#x9501;&#x8BB0;&#x5F55;&#x7684;&#x6307;&#x9488;</td><td>00</td></tr><tr><td>&#x91CD;&#x91CF;&#x7EA7;&#x9501;</td><td colspan="4">&#x6307;&#x5411;&#x4E92;&#x65A5;&#x91CF;(&#x91CD;&#x91CF;&#x7EA7;&#x9501;)&#x7684;&#x6307;&#x9488;</td><td>10</td></tr><tr><td>GC&#x6807;&#x8BB0;</td><td colspan="4">&#x7A7A;</td><td>11</td></tr><tr></tr></table>

<hr>
<h2 id="&#x540C;&#x6B65;&#x65B9;&#x6CD5;">0.5. &#x540C;&#x6B65;&#x65B9;&#x6CD5;</h2><h3 id="&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x6D41;&#x7A0B;">0.5.1. &#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x6D41;&#x7A0B;</h3><p>&#x5728;&#x5BF9;&#x5E26;&#x6709; <code>Synchronized</code> &#x9501;&#x65B9;&#x6CD5;&#x7684;class&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x53CD;&#x7F16;&#x8BD1;&#x540E;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x5E26;&#x6709;&#x4E0B;&#x65B9;&#x5173;&#x952E;&#x5B57;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">  <span class="comment">//==================syncTask&#x65B9;&#x6CD5;======================</span></span><br><span class="line">  <span class="keyword">public</span> Synchronized <span class="built_in">void</span> syncTask();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    <span class="comment">//&#x65B9;&#x6CD5;&#x6807;&#x8BC6;ACC_PUBLIC&#x4EE3;&#x8868;public&#x4FEE;&#x9970;&#xFF0C;ACC_SYNCHRONIZED`&#x6307;&#x660E;&#x8BE5;&#x65B9;&#x6CD5;&#x4E3A;&#x540C;&#x6B65;&#x65B9;&#x6CD5;</span></span><br><span class="line">    flags: ACC_PUBLIC, ACC_SYNCHRONIZED</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">3</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: dup</span><br><span class="line">         <span class="number">2</span>: getfield      #<span class="number">2</span>                  <span class="comment">// Field i:I</span></span><br><span class="line">         <span class="number">5</span>: iconst_1</span><br><span class="line">         <span class="number">6</span>: iadd</span><br><span class="line">         <span class="number">7</span>: putfield      #<span class="number">2</span>                  <span class="comment">// Field i:I</span></span><br><span class="line">        <span class="number">10</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">12</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">10</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x65B9;&#x6CD5;&#x7EA7;&#x7684;&#x540C;&#x6B65;&#x662F;&#x9690;&#x5F0F;&#xFF0C;&#x5373;&#x65E0;&#x9700;&#x901A;&#x8FC7;&#x5B57;&#x8282;&#x7801;&#x6307;&#x4EE4;&#x6765;&#x63A7;&#x5236;&#x7684;&#xFF0C;&#x5B83;&#x5B9E;&#x73B0;&#x5728;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x548C;&#x8FD4;&#x56DE;&#x64CD;&#x4F5C;&#x4E4B;&#x4E2D;&#x3002;JVM&#x53EF;&#x4EE5;&#x4ECE;&#x65B9;&#x6CD5;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x8868;&#x7ED3;&#x6784;(method_info Structure) &#x4E2D;&#x7684; ACC_SYNCHRONIZED &#x8BBF;&#x95EE;&#x6807;&#x5FD7;&#x533A;&#x5206;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x3002;&#x5F53;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x8C03;&#x7528;&#x6307;&#x4EE4;&#x5C06;&#x4F1A; &#x68C0;&#x67E5;&#x65B9;&#x6CD5;&#x7684; ACC_<code>Synchronized</code> &#x8BBF;&#x95EE;&#x6807;&#x5FD7;&#x662F;&#x5426;&#x88AB;&#x8BBE;&#x7F6E;&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#xFF0C;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x5C06;&#x5148;&#x6301;&#x6709;monitor&#xFF08;&#x865A;&#x62DF;&#x673A;&#x89C4;&#x8303;&#x4E2D;&#x7528;&#x7684;&#x662F;&#x7BA1;&#x7A0B;&#x4E00;&#x8BCD;&#xFF09;&#xFF0C; &#x7136;&#x540E;&#x518D;&#x6267;&#x884C;&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x65B9;&#x6CD5;&#x5B8C;&#x6210;(&#x65E0;&#x8BBA;&#x662F;&#x6B63;&#x5E38;&#x5B8C;&#x6210;&#x8FD8;&#x662F;&#x975E;&#x6B63;&#x5E38;&#x5B8C;&#x6210;)&#x65F6;&#x91CA;&#x653E;monitor&#x3002;&#x5728;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x671F;&#x95F4;&#xFF0C;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x4E86;monitor&#xFF0C;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x7EBF;&#x7A0B;&#x90FD;&#x65E0;&#x6CD5;&#x518D;&#x83B7;&#x5F97;&#x540C;&#x4E00;&#x4E2A;monitor&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x671F;&#x95F4;&#x629B; &#x51FA;&#x4E86;&#x5F02;&#x5E38;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x65B9;&#x6CD5;&#x5185;&#x90E8;&#x65E0;&#x6CD5;&#x5904;&#x7406;&#x6B64;&#x5F02;&#x5E38;&#xFF0C;&#x90A3;&#x8FD9;&#x4E2A;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x6240;&#x6301;&#x6709;&#x7684;monitor&#x5C06;&#x5728;&#x5F02;&#x5E38;&#x629B;&#x5230;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x4E4B;&#x5916;&#x65F6;&#x81EA;&#x52A8;&#x91CA;&#x653E;</p>
<h3 id="&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x539F;&#x7406;">0.5.2. &#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x539F;&#x7406;</h3><p>&#x4ECE;&#x5B57;&#x8282;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;<code>Synchronized</code>&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#x5E76;&#x6CA1;&#x6709;monitorenter&#x6307;&#x4EE4;&#x548C;monitorexit&#x6307;&#x4EE4;&#xFF0C;&#x53D6;&#x5F97;&#x4EE3;&#x4E4B;&#x7684;&#x786E;&#x5B9E;&#x662F;ACC_<code>Synchronized</code>&#x6807;&#x8BC6;&#xFF0C;&#x8BE5;&#x6807;&#x8BC6;&#x6307;&#x660E;&#x4E86;&#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x4E00;&#x4E2A;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;JVM&#x901A;&#x8FC7;&#x8BE5;ACC_<code>Synchronized</code>&#x8BBF;&#x95EE;&#x6807;&#x5FD7;&#x6765;&#x8FA8;&#x522B;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x58F0;&#x660E;&#x4E3A;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x4ECE;&#x800C;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x540C;&#x6B65;&#x8C03;&#x7528;&#x3002;&#x8FD9;&#x4FBF;&#x662F;<code>Synchronized</code>&#x9501;&#x5728;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#x5757;&#x548C;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x4E0A;&#x5B9E;&#x73B0;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;&#x3002;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x8FD8;&#x5FC5;&#x987B;&#x6CE8;&#x610F;&#x5230;&#x7684;&#x662F;&#x5728;Java&#x65E9;&#x671F;&#x7248;&#x672C;&#x4E2D;&#xFF0C;<code>Synchronized</code>&#x5C5E;&#x4E8E;&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#xFF0C;&#x6548;&#x7387;&#x4F4E;&#x4E0B;&#xFF0C;&#x56E0;&#x4E3A;&#x76D1;&#x89C6;&#x5668;&#x9501;&#xFF08;monitor&#xFF09;&#x662F;&#x4F9D;&#x8D56;&#x4E8E;&#x5E95;&#x5C42;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;Mutex Lock&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x800C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x5207;&#x6362;&#x65F6;&#x9700;&#x8981;&#x4ECE;&#x7528;&#x6237;&#x6001;&#x8F6C;&#x6362;&#x5230;&#x6838;&#x5FC3;&#x6001;&#xFF0C;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x4E4B;&#x95F4;&#x7684;&#x8F6C;&#x6362;&#x9700;&#x8981;&#x76F8;&#x5BF9;&#x6BD4;&#x8F83;&#x957F;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x65F6;&#x95F4;&#x6210;&#x672C;&#x76F8;&#x5BF9;&#x8F83;&#x9AD8;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x65E9;&#x671F;&#x7684;<code>Synchronized</code>&#x6548;&#x7387;&#x4F4E;&#x7684;&#x539F;&#x56E0;&#x3002;&#x4E0D;&#x8FC7;Java 6&#x4E4B;&#x540E;Java&#x5B98;&#x65B9;&#x5BF9;&#x4ECE;JVM&#x5C42;&#x9762;&#x5BF9;<code>Synchronized</code>&#x8F83;&#x5927;&#x4F18;&#x5316;.</p>
<hr>
<h2 id="&#x9501;&#x7684;&#x5347;&#x7EA7;">0.6. &#x9501;&#x7684;&#x5347;&#x7EA7;</h2><ol>
<li>&#x65E0;&#x9501;&#x72B6;&#x6001;:&#x6CA1;&#x6709;&#x52A0;&#x9501;</li>
<li>&#x504F;&#x5411;&#x9501;&#xFF1A;&#x5728;&#x5BF9;&#x8C61;&#x7B2C;&#x4E00;&#x6B21;&#x88AB;&#x67D0;&#x4E00;&#x7EBF;&#x7A0B;&#x5360;&#x6709;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x5426;&#x504F;&#x5411;&#x9501;&#x7F6E;1&#xFF0C;&#x9501;&#x8868;01&#xFF0C;&#x5199;&#x5165;&#x7EBF;&#x7A0B;&#x53F7;&#xFF0C;&#x5F53;&#x5176;&#x4ED6;&#x7684;&#x7EBF;&#x7A0B;&#x8BBF;&#x95EE;&#x7684;&#x65F6;&#x5019;-&gt;&#x7ADE;&#x4E89;-&gt;&#x5931;&#x8D25;-&gt;&#x8F7B;&#x91CF;&#x7EA7;&#x9501;<ol>
<li>&#x7B2C;&#x4E00;&#x6B21;&#x5360;&#x6709;&#x5B83;&#x7684;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x51E0;&#x7387;&#x4F1A;&#x6BD4;&#x8F83;&#x5927;  </li>
<li>CAS&#x7B97;&#x6CD5; campany and set&#xFF08;CAS&#xFF09;</li>
<li>&#x65E0;&#x9501;&#x72B6;&#x6001;&#x65F6;&#x95F4;&#x975E;&#x5E38;&#x63A5;&#x8FD1;</li>
<li>&#x7ADE;&#x4E89;&#x4E0D;&#x6FC0;&#x70C8;&#x7684;&#x65F6;&#x5019;&#x9002;&#x7528;</li>
</ol>
</li>
<li>&#x8F7B;&#x91CF;&#x7EA7;&#x9501;&#xFF1A;&#x7EBF;&#x7A0B;&#x6709;&#x4EA4;&#x66FF;&#x9002;&#x7528;&#xFF0C;&#x4E92;&#x65A5;&#x6027;&#x4E0D;&#x662F;&#x5F88;&#x5F3A;, CAS&#x5931;&#x8D25;, 00</li>
<li>&#x81EA;&#x65CB;&#x9501;&#xFF1A;&#x7ADE;&#x4E89;&#x5931;&#x8D25;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x662F;&#x9A6C;&#x4E0A;&#x8F6C;&#x5316;&#x7EA7;&#x522B;&#xFF0C;&#x800C;&#x662F;&#x6267;&#x884C;&#x51E0;&#x6B21;&#x7A7A;&#x5FAA;&#x73AF;5 10 </li>
<li>&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#xFF1A;&#x5F3A;&#x4E92;&#x65A5;, &#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x957F;, 10<ol>
<li>&#x91CD;&#x91CF;&#x7EA7;&#x9501;&#x4E5F;&#x5C31;&#x662F;&#x901A;&#x5E38;&#x8BF4;<code>Synchronized</code>&#x7684;&#x5BF9;&#x8C61;&#x9501;&#xFF0C;&#x9501;&#x6807;&#x8BC6;&#x4F4D;&#x4E3A;10&#xFF0C;&#x5176;&#x4E2D;&#x6307;&#x9488;&#x6307;&#x5411;&#x7684;&#x662F;monitor&#x5BF9;&#x8C61;&#xFF08;&#x4E5F;&#x79F0;&#x4E3A;&#x7BA1;&#x7A0B;&#x6216;&#x76D1;&#x89C6;&#x5668;&#x9501;&#xFF09;&#x7684;&#x8D77;&#x59CB;&#x5730;&#x5740;&#x3002;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x5B58;&#x5728;&#x7740;&#x4E00;&#x4E2A; monitor &#x4E0E;&#x4E4B;&#x5173;&#x8054;&#xFF0C;&#x5BF9;&#x8C61;&#x4E0E;&#x5176; monitor &#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x6709;&#x5B58;&#x5728;&#x591A;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x5982;monitor&#x53EF;&#x4EE5;&#x4E0E;&#x5BF9;&#x8C61;&#x4E00;&#x8D77;&#x521B;&#x5EFA;&#x9500;&#x6BC1;&#x6216;&#x5F53;&#x7EBF;&#x7A0B;&#x8BD5;&#x56FE;&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x9501;&#x65F6;&#x81EA;&#x52A8;&#x751F;&#x6210;&#xFF0C;&#x4F46;&#x5F53;&#x4E00;&#x4E2A; monitor &#x88AB;&#x67D0;&#x4E2A;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x540E;&#xFF0C;&#x5B83;&#x4FBF;&#x5904;&#x4E8E;&#x9501;&#x5B9A;&#x72B6;&#x6001;&#x3002;&#x5728;Java&#x865A;&#x62DF;&#x673A;(HotSpot)&#x4E2D;&#xFF0C;monitor&#x662F;&#x7531;ObjectMonitor&#x5B9E;&#x73B0;&#x7684;&#xFF0C;(&#x4F4D;&#x4E8E;HotSpot&#x865A;&#x62DF;&#x673A;&#x6E90;&#x7801;ObjectMonitor.hpp&#x6587;&#x4EF6;&#xFF0C;C++&#x5B9E;&#x73B0;&#x7684;&#xFF09;</li>
</ol>
</li>
<li>&#x9501;&#x6D88;&#x9664;&#xFF1A;JIT&#x5728;&#x7F16;&#x8BD1;&#x7684;&#x65F6;&#x5019;&#x901A;&#x8FC7;&#x5BF9;&#x8FD0;&#x884C;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x626B;&#x63CF;&#xFF0C;&#x53BB;&#x9664;&#x4E0D;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7ADE;&#x4E89;&#x7684;&#x9501;</li>
</ol>
<hr>
<h2 id="&#x4F7F;&#x7528;&#x6CE8;&#x610F;&#x4E8B;&#x9879;">0.7. &#x4F7F;&#x7528;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</h2><ol>
<li>&#x4E0E;moniter&#x5173;&#x8054;&#x7684;&#x5BF9;&#x8C61;&#x4E0D;&#x80FD;&#x4E3A;&#x7A7A;</li>
<li>&#x591A;&#x4E2A;&#x9501;&#x7684;&#x4EA4;&#x53C9;&#x5BFC;&#x81F4;&#x6B7B;&#x9501;</li>
</ol>
<blockquote>
<p>&#x53C2;&#x8003;: <a href="https://blog.csdn.net/javazejian/article/details/72828483" target="_blank" rel="noopener">&#x6DF1;&#x5165;&#x7406;&#x89E3;Java&#x5E76;&#x53D1;&#x4E4B; Synchronized &#x5B9E;&#x73B0;&#x539F;&#x7406;</a></p>
</blockquote>
]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
  </entry>
  <entry>
    <title>maven-optional可选依赖</title>
    <url>/2019/maven-optional-ke-xuan-yi-lai/</url>
    <content><![CDATA[<h2 id="&#x89C4;&#x5219;">0.1. &#x89C4;&#x5219;</h2><p>&#x9879;&#x76EE; A &#x4F9D;&#x8D56;&#x9879;&#x76EE; B, &#x9879;&#x76EE; B &#x4F9D;&#x8D56;&#x9879;&#x76EE; C</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>C<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x6B64;&#x65F6;&#x5982;&#x679C;&#x9879;&#x76EE; A &#x6CA1;&#x6709;&#x663E;&#x793A;&#x7684;&#x4F9D;&#x8D56;&#x9879;&#x76EE; C, &#x5219;&#x9879;&#x76EE; C &#x4E0D;&#x4F1A;&#x88AB;&#x4F9D;&#x8D56;</p>
<a id="more"></a>

<h2 id="&#x5E94;&#x7528;&#x573A;&#x666F;">0.2. &#x5E94;&#x7528;&#x573A;&#x666F;</h2><p>&#x9879;&#x76EE; B &#x4E2D;&#x5BF9; redis &#x5BA2;&#x6237;&#x7AEF; &#x5B9A;&#x4E49;&#x4E86;&#x4E24;&#x79CD;&#x5B9E;&#x73B0;, &#x5982;&#x4E0B;</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>biz.paluch.redis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x5728;&#x4F9D;&#x8D56;&#x9879;&#x76EE; B &#x65F6;&#x5FC5;&#x987B;&#x663E;&#x793A;&#x7684;&#x6307;&#x5B9A;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x7248;&#x672C;&#x7684;&#x5B9E;&#x73B0;</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencys</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>B<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencys</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>util</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>自定义redis锁注解</title>
    <url>/2019/zi-ding-yi-redis-lock-zhu-jie/</url>
    <content><![CDATA[<blockquote>
<p>&#x9879;&#x76EE;&#x4E2D;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x7684;redis&#x9501;&#x5199;&#x8D77;&#x6765;&#x5341;&#x5206;&#x7E41;&#x7410;, &#x540C;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x7F16;&#x5199;&#x591A;&#x6B21;. &#x4E8E;&#x662F;&#x60F3;&#x5230;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x65B9;&#x5F0F;&#x6765;&#x89E3;&#x51B3;</p>
</blockquote>
<h2 id="&#x6784;&#x601D;">0.1. &#x6784;&#x601D;</h2><ol>
<li>&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x4E0D;&#x80FD;&#x786E;&#x5B9A;&#x8FD4;&#x56DE;&#x503C;, &#x6240;&#x4EE5;&#x91C7;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x5F02;&#x5E38;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x89E3;&#x51B3;</li>
<li>redis&#x9501;&#x4E00;&#x822C;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x8FC7;&#x671F;&#x65F6;&#x95F4;, &#x8003;&#x8651;&#x5230;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x4E3A;&#x6C38;&#x4E45;</li>
</ol>
<a id="more"></a>

<h2 id="&#x542F;&#x52A8;&#x7C7B;">0.2. &#x542F;&#x52A8;&#x7C7B;</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x5F00;&#x542F;AOP&#x4EE3;&#x7406;&#x81EA;&#x52A8;&#x914D;&#x7F6E; </span></span><br><span class="line"><span class="comment">// exposeProxy = true &#x8868;&#x793A;&#x901A;&#x8FC7;aop&#x6846;&#x67B6;&#x66B4;&#x9732;&#x8BE5;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#xFF0C;aopContext&#x80FD;&#x591F;&#x8BBF;&#x95EE;</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>(exposeProxy = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SalesApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(SalesApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="&#x81EA;&#x5B9A;&#x4E49;&#x6CE8;&#x89E3;">0.3. &#x81EA;&#x5B9A;&#x4E49;&#x6CE8;&#x89E3;</h2><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Classname&#xFF1A;RedisLockException</span></span><br><span class="line"><span class="comment"> * Description&#xFF1A;&#x81EA;&#x5B9A;&#x4E49;redis&#x5F02;&#x5E38;</span></span><br><span class="line"><span class="comment"> * date&#xFF1A;2019-12-09 15:49</span></span><br><span class="line"><span class="comment"> * author&#xFF1A;yuyu</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">RedisLockException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a new runtime exception with the specified detail message.</span></span><br><span class="line"><span class="comment">     * The cause is not initialized, and may subsequently be initialized by a</span></span><br><span class="line"><span class="comment">     * call to {@link #initCause}.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param message the detail message. The detail message is saved for</span></span><br><span class="line"><span class="comment">     *                later retrieval by the {@link #getMessage()} method.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public <span class="type">RedisLockException</span>(<span class="type">String</span> message) {</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">## redis&#x9501;&#x6CE8;&#x89E3;</span><br></pre></td></tr></table></figure>

<p>/**</p>
<ul>
<li><p>&#x8B66;&#x793A;: key &#x4E0E; enumKey &#x4E8C;&#x9009;&#x4E00;, &#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;!!!</p>
</li>
<li><p>&#x8B66;&#x793A;: &#x5982;&#x679C; key &#x4E0E; enumKey &#x90FD;&#x8BBE;&#x7F6E;, &#x5219;&#x4F7F;&#x7528;key&#x52A0;&#x9501;</p>
</li>
<li><p>&#x8B66;&#x793A;: &#x5982;&#x679C;redis&#x52A0;&#x9501;&#x5931;&#x8D25;&#x4F1A;&#x629B;&#x51FA; RedisLockException &#x5F02;&#x5E38;</p>
</li>
<li><p>&#x8B66;&#x793A;: &#x7C7B;&#x5185;&#x90E8;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x4E0D;&#x751F;&#x6548;, &#x5982;&#x679C;&#x60F3;&#x751F;&#x6548;&#x8BF7;&#x91CD;&#x65B0;&#x4ECE;redis&#x4E2D;&#x83B7;&#x53D6;&#x8BE5;&#x5BF9;&#x8C61;&#x518D;&#x8FDB;&#x884C;&#x8C03;&#x7528;</p>
</li>
<li><p>&#x4F8B;: InvTransactionsSendServiceImpl thisBean = SpringContextUtil.getBean(InvTransactionsSendServiceImpl.class);</p>
</li>
<li><p>thisBean.sendINVTransactionLock(beginDate, endDate);</p>
</li>
<li><p>&#x4F8B;:</p>
</li>
<li><p>String msg;</p>
</li>
<li><p>try {</p>
</li>
<li><p>// testService.test(a) &#x8BE5;&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x4E86; @RedisLock</p>
</li>
<li><p>msg = testService.test(a);</p>
</li>
<li><p>} catch (RedisLockException e) {</p>
</li>
<li><p>msg = e.getMessage();</p>
</li>
<li><p>} catch (Exception e) {</p>
</li>
<li><p>log.error(&#x201C;&#x65B9;&#x6CD5;&#x5F02;&#x5E38;&#x201D;, e);</p>
</li>
<li><p>msg = &#x201C;&#x65B9;&#x6CD5;&#x5F02;&#x5E38;&#x201D;;</p>
</li>
<li><p>}</p>
</li>
<li><p>return msg;</p>
</li>
<li><p>/<br>@Documented<br>@Retention(RetentionPolicy.RUNTIME)<br>@Target(ElementType.METHOD)<br>public @interface RedisLock {</p>
<p>  /**</p>
<ul>
<li><p>redis &#x4E2D;&#x7684;key</p>
</li>
<li><p>/<br>String key() default SalesConstant.REDIS_LOCK_DEFAULT_KEY;</p>
<p>/**</p>
</li>
<li><p>&#x679A;&#x4E3E;&#x7C7B;redis key</p>
</li>
<li><p>/<br>SalesConstant.RedisLockKey enumKey() default SalesConstant.RedisLockKey.DEFAULT_VALUE;</p>
<p>/**</p>
</li>
<li><p>&#x79D2;&#xFF0C;key&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#xFF0C;&#x5982;&#x679C;&#x5C0F;&#x4E8E;0&#x5219;&#x6C38;&#x4E45;, &#x9ED8;&#x8BA4;&#x6C38;&#x4E45;</p>
</li>
<li><p>/<br>long expired() default -1;</p>
</li>
</ul>
</li>
</ul>
<p>}</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## Aspect&#x89E3;&#x6790;&#x6CE8;&#x89E3;</span><br></pre></td></tr></table></figure>
<p>package com.secoo.sales.common.annotation.redis;</p>
<p>import com.secoo.sales.common.constant.SalesConstant;<br>import com.secoo.sales.common.exception.RedisLockException;<br>import com.secooframework.redis.SecooRedisTemplate;<br>import org.aspectj.lang.ProceedingJoinPoint;<br>import org.aspectj.lang.Signature;<br>import org.aspectj.lang.annotation.Around;<br>import org.aspectj.lang.annotation.Aspect;<br>import org.aspectj.lang.annotation.Pointcut;<br>import org.aspectj.lang.reflect.MethodSignature;<br>import org.slf4j.Logger;<br>import org.slf4j.LoggerFactory;</p>
<p>import javax.annotation.Resource;<br>import java.lang.reflect.Method;</p>
<p>/**</p>
<ul>
<li><p>Classname&#xFF1A;RedisLockAspect</p>
</li>
<li><p>Description&#xFF1A;redis&#x9501;&#x5207;&#x9762;</p>
</li>
<li><p>date&#xFF1A;2019-12-09 15:03</p>
</li>
<li><p>author&#xFF1A;yuyu</p>
</li>
<li><p>/<br>@Aspect<br>public class RedisLockAspect {</p>
<p>  private Logger logger = LoggerFactory.getLogger(this.getClass());</p>
<p>  @Resource<br>  private SecooRedisTemplate secooRedisTemplate;</p>
</li>
</ul>
<pre><code>@Pointcut(&quot;@annotation(com.secoo.sales.common.annotation.redis.RedisLock)&quot;)
private void pointcut() {
}


/**
 * &#x73AF;&#x7ED5;&#x901A;&#x77E5;
 *
 * @param joinPoint &#x53EF;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x5207;&#x70B9;&#x7684;&#x7C7B;
 * @throws Throwable
 */
@Around(&quot;pointcut()&quot;)
public Object around(ProceedingJoinPoint joinPoint) throws Throwable {
    RedisLock annotation = getMethod(joinPoint).getAnnotation(RedisLock.class);
    // &#x83B7;&#x53D6;&#x4E0D;&#x662F;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x7684;key, &#x4F18;&#x5148;&#x9009;&#x62E9; key()
    String key = annotation.key();
    if (key.equals(SalesConstant.RedisLockKey.DEFAULT_VALUE.getCode())) {
        key = annotation.enumKey().getCode();
        if (key.equals(SalesConstant.RedisLockKey.DEFAULT_VALUE.getCode())) {
            // key() &#x4E0E; enumKey() &#x5FC5;&#x987B;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;, &#x5982;&#x679C;&#x4E24;&#x4E2A;&#x90FD;&#x662F;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x5219;&#x76F4;&#x63A5;&#x629B;&#x51FA;&#x5F02;&#x5E38;
            logger.info(&quot;Redis&#x52A0;&#x9501;&#x672A;&#x6307;&#x5B9A;key&quot;);
            throw new RedisLockException(&quot;Redis&#x52A0;&#x9501;&#x672A;&#x6307;&#x5B9A;key!&quot;);
        }
    }

    // &#x52A0;&#x9501;
    Boolean flag = secooRedisTemplate.setnx(key, &quot;1&quot;);

    // &#x8FC7;&#x671F;&#x65F6;&#x95F4;
    long expiredTime = annotation.expired();

    if (flag) {
        logger.info(&quot;redis&#x52A0;&#x9501;&#x6210;&#x529F;-key: &quot; + key);
        // &#x5982;&#x679C;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x5927;&#x4E8E;0 , &#x5219;&#x8BBE;&#x7F6E;&#x8FC7;&#x671F;&#x65F6;&#x95F4;
        if (expiredTime &gt; 0) {
            secooRedisTemplate.expire(key, expiredTime);
        }

        try {
            return (Object) joinPoint.proceed();
        } catch (Exception e) {
            throw e;
        } finally {
            // &#x5220;&#x9664;&#x9501;
            secooRedisTemplate.del(key);
            logger.info(&quot;redis&#x5220;&#x9664;&#x9501;&#x6210;&#x529F;-key: &quot; + key);
        }
    } else {
        logger.info(&quot;redis&#x52A0;&#x9501;&#x5931;&#x8D25;-key: &quot; + key);
        throw new RedisLockException(&quot;Redis&#x52A0;&#x9501;&#x5931;&#x8D25;&quot;);
    }
}

private Method getMethod(ProceedingJoinPoint joinPoint) throws NoSuchMethodException {
    Signature signature = joinPoint.getSignature();
    MethodSignature methodSignature = (MethodSignature) signature;
    Method agentMethod = methodSignature.getMethod();
    return joinPoint.getTarget().getClass().getMethod(agentMethod.getName(), agentMethod.getParameterTypes());
}</code></pre><p>}</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## &#x6CE8;&#x610F;&#x4E8B;&#x9879;</span><br><span class="line">&#x7C7B;&#x5185;&#x90E8;&#x8C03;&#x7528;&#x65E0;&#x6CD5;&#x89E6;&#x53D1;&#x5207;&#x9762;&#x4EE3;&#x7406;, &#x4F1A;&#x5BFC;&#x81F4;redis&#x9501;&#x65E0;&#x6548;, &#x5982;&#x679C;&#x60F3;&#x4F7F;&#x7528;&#x9700;&#x4ECE;spring&#x4E2D;&#x518D;&#x6B21;&#x83B7;&#x53D6;&#x8BE5;&#x5BF9;&#x8C61;&#x5E76;&#x8C03;&#x7528;</span><br></pre></td></tr></table></figure>
<p>@Service<br>public class Demo {<br>    private Logger log = LoggerFactory.getLogger(this.getClass());</p>
<pre><code>public void method1(){
    Demo thisBean = SpringContextUtil.getBean(Demo.class);
    try {
        thisBean.method2();
    } catch (RedisLockException e) {
        log.warn(&quot;redis&#x52A0;&#x9501;&#x5931;&#x8D25;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&quot; + e.getMessage());
    } catch (Exception e) {
        log.error(&quot;&#x64CD;&#x4F5C;&#x5F02;&#x5E38;&quot;, e);
    }
}

@RedisLock(enumKey = SalesConstant.RedisLockKey.MSG_INTEGRATION)
public void method2(){

}</code></pre><p>}</p>
<p>```</p>
]]></content>
      <categories>
        <category>spring</category>
        <category>redis</category>
      </categories>
      <tags>
        <tag>annotation</tag>
      </tags>
  </entry>
  <entry>
    <title>1912小目标</title>
    <url>/2019/1912-xiao-mu-biao/</url>
    <content><![CDATA[<p>&#x8FD9;&#x6BB5;&#x65F6;&#x95F4;&#x68B3;&#x7406;&#x81EA;&#x5DF1;&#x7684;&#x5B66;&#x4E60;&#x72B6;&#x51B5;, &#x53D1;&#x73B0;&#x5B66;&#x8FC7;&#x7684;&#x4E1C;&#x897F;&#x5F88;&#x6742;,&#x800C;&#x4E14;&#x90FD;&#x662F;&#x5F88;&#x6D45;&#x5C42;&#x6B21;&#x7684;&#x5B66;&#x4E60;. &#x4E0D;&#x4E86;&#x89E3;&#x5176;&#x4E2D;&#x7684;&#x673A;&#x5236;&#x548C;&#x539F;&#x7406;,&#x4EC5;&#x4EC5;&#x4F1A;&#x4F7F;&#x7528;&#x800C;&#x5DF2;. </p>
<p>&#x9700;&#x8981;&#x5B66;&#x4E60;&#x7684;&#x4E1C;&#x897F;&#x592A;&#x591A;&#x592A;&#x591A;, &#x5E73;&#x65F6;&#x7ECF;&#x5E38;&#x4ECA;&#x5929;&#x5B66;&#x70B9;&#x8FD9;&#x4E2A;,&#x660E;&#x5929;&#x5B66;&#x70B9;&#x90A3;&#x4E2A;, &#x6CA1;&#x6709;&#x65B9;&#x5411;&#x6027;, &#x5BFC;&#x81F4;&#x9664;&#x4E86;&#x6570;&#x636E;&#x5E93;&#x7D22;&#x5F15;&#x8FD8;&#x53EF;&#x4EE5;&#x522B;&#x7684;&#x90FD;&#x4E0D;&#x600E;&#x4E48;&#x6837;, &#x662F;&#x65F6;&#x5019;&#x7ED9;&#x81EA;&#x5DF1;&#x89C4;&#x5212;&#x4E0B;&#x4E86;</p>
<p>&#x4ECA;&#x5929;&#x662F;19&#x5E74;12&#x6708;3&#x65E5;, &#x7ED9;&#x81EA;&#x5DF1;&#x7ACB;12&#x6708;&#x7684;&#x4E00;&#x4E2A;&#x5C0F;&#x76EE;&#x6807;:</p>
<ol>
<li>JAVA NIO (&#x770B;&#x5B8C;&#x5199;&#x603B;&#x7ED3;)</li>
<li>&#x5C0F;&#x660E;&#x54E5;<code>JAVA&#x9AD8;&#x5E76;&#x53D1;&#x7CFB;&#x5217;</code> </li>
</ol>
<p><strong>&#x80FD;&#x591A;&#x5C11;&#x5C31;&#x5B66;&#x591A;&#x5C11;,&#x4F46;&#x662F;&#x4E0D;&#x53BB;&#x770B;&#x522B;&#x7684;&#x6280;&#x672F;&#x4E66;&#x7C4D;</strong></p>
<a id="more"></a>]]></content>
      <categories>
        <category>other</category>
      </categories>
  </entry>
  <entry>
    <title>hexo后台运行</title>
    <url>/2019/hexo-hou-tai-yun-xing/</url>
    <content><![CDATA[<blockquote>
<p>&#x524D;&#x8A00;: hexo&#x90E8;&#x7F72;&#x5728;&#x670D;&#x52A1;&#x5668;&#x540E;, &#x4E00;&#x65E6;&#x65AD;&#x5F00;ssh&#x94FE;&#x63A5;&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x5173;&#x95ED;. &#x6545;&#x5728;&#x7F51;&#x4E0A;&#x627E;&#x4E86;&#x4E2A;&#x63A5;&#x7BA1;hexo&#x8FDB;&#x7A0B;&#x7684;&#x5DE5;&#x5177;</p>
</blockquote>
<h2 id="&#x5B89;&#x88C5;pm2">0.1. &#x5B89;&#x88C5;pm2</h2><figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">npm  install -g pm2</span><br><span class="line">/<span class="regexp">/ &#x4E0B;&#x65B9;&#x4E3A;&#x6253;&#x5370;&#x51FA;&#x7684;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;</span></span><br><span class="line"><span class="regexp">/self</span><span class="regexp">/app/node</span>-v12.<span class="number">13.1</span>-linux-x64/bin/pm2 -&gt; <span class="regexp">/self/app</span><span class="regexp">/node-v12.13.1-linux-x64/lib</span><span class="regexp">/node_modules/pm</span>2/bin/pm2</span><br><span class="line">/<span class="keyword">self</span>/app/node-v12.<span class="number">13.1</span>-linux-x64/bin/pm2-dev -&gt; <span class="regexp">/self/app</span><span class="regexp">/node-v12.13.1-linux-x64/lib</span><span class="regexp">/node_modules/pm</span>2/bin/pm2-dev</span><br><span class="line">/<span class="keyword">self</span>/app/node-v12.<span class="number">13.1</span>-linux-x64/bin/pm2-docker -&gt; <span class="regexp">/self/app</span><span class="regexp">/node-v12.13.1-linux-x64/lib</span><span class="regexp">/node_modules/pm</span>2/bin/pm2-docker</span><br><span class="line">/<span class="keyword">self</span>/app/node-v12.<span class="number">13.1</span>-linux-x64/bin/pm2-runtime -&gt; <span class="regexp">/self/app</span><span class="regexp">/node-v12.13.1-linux-x64/lib</span><span class="regexp">/node_modules/pm</span>2/bin/pm2-runtime</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL <span class="symbol">DEPENDENCY:</span> fsevents@<span class="number">2.1</span>.<span class="number">2</span> (node_modules/pm2/node_modules/fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL <span class="symbol">DEPENDENCY:</span> Unsupported platform <span class="keyword">for</span> fsevents@<span class="number">2.1</span>.<span class="number">2</span>: wanted {<span class="string">&quot;os&quot;</span>:<span class="string">&quot;darwin&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;any&quot;</span>} (<span class="symbol">current:</span> {<span class="string">&quot;os&quot;</span>:<span class="string">&quot;linux&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;x64&quot;</span>})</span><br><span class="line"></span><br><span class="line">+ pm2@<span class="number">4.2</span>.<span class="number">0</span></span><br><span class="line">added <span class="number">206</span> packages from <span class="number">202</span> contributors in <span class="number">12.702</span>s</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>&#x5B8C;&#x6210;&#x540E;&#x4F7F;&#x7528;<code>pm2 -v</code>&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;, &#x5982;&#x679C;&#x63D0;&#x793A;<code>pm2: &#x672A;&#x627E;&#x5230;&#x547D;&#x4EE4;</code>&#x5219;&#x8FDB;&#x884C;&#x4E0B;&#x9762;&#x64CD;&#x4F5C;</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/self/</span>app<span class="regexp">/node-v12.13.1-linux-x64/</span>bin<span class="regexp">/pm2 /u</span>sr<span class="regexp">/bin/</span>pm2</span><br><span class="line">&#x8BF4;&#x660E;:</span><br><span class="line">ln -s pm2&#x5B89;&#x88C5;&#x8DEF;&#x5F84;(&#x4E0A;&#x65B9;&#x5B89;&#x88C5;&#x65F6;&#x6253;&#x5370;&#x7684;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x4E2D;&#x6709;) <span class="regexp">/usr/</span>bin<span class="regexp">/pm2</span></span><br></pre></td></tr></table></figure>
<p>&#x5B8C;&#x6210;&#x540E;&#x518D;&#x6B21;&#x4F7F;&#x7528;<code>pm2 -v</code>&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;</p>
<h2 id="&#x9879;&#x76EE;&#x6587;&#x4EF6;">0.2. &#x9879;&#x76EE;&#x6587;&#x4EF6;</h2><p>&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x589E;&#x52A0;&#x6587;&#x4EF6;<code>hexo_run.js</code> &#x5185;&#x5BB9;&#x5982;&#x4E0B;</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">//run</span><br><span class="line">const { exec } = <span class="built_in">require</span>(<span class="string">&apos;child_process&apos;</span>)</span><br><span class="line">exec(<span class="string">&apos;hexo server&apos;</span>,(<span class="built_in">error</span>, <span class="built_in">stdout</span>, <span class="built_in">stderr</span>) =&gt; {</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">error</span>){</span><br><span class="line">        console.<span class="built_in">log</span>(<span class="string">&apos;exec error: ${error}&apos;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line">    console.<span class="built_in">log</span>(<span class="string">&apos;stdout: ${stdout}&apos;</span>);</span><br><span class="line">    console.<span class="built_in">log</span>(<span class="string">&apos;stderr: ${stderr}&apos;</span>);</span><br><span class="line">})</span><br></pre></td></tr></table></figure>
<h2 id="&#x542F;&#x52A8;">0.3. &#x542F;&#x52A8;</h2><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">pm2 <span class="literal">start</span> hexo_run.js</span><br></pre></td></tr></table></figure>
<h2 id="&#x505C;&#x6B62;">0.4. &#x505C;&#x6B62;</h2><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">pm2 <span class="built_in">stop</span> hexo_run.js</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x5982;&#x679C;&#x6015;&#x5FD8;&#x8BB0;&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>run.sh</code>&#x6587;&#x4EF6;&#x5427;&#x8FD9;&#x4E32;&#x547D;&#x4EE4;&#x653E;&#x8FDB;&#x53BB;,&#x589E;&#x52A0;&#x6743;&#x9650;. &#x4E0B;&#x6B21;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5C31;&#x884C;</p>
</blockquote>
]]></content>
      <categories>
        <category>util</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>linux安装node.js</title>
    <url>/2019/linux-an-zhuang-node-js/</url>
    <content><![CDATA[<h2 id="1-&#x4E0B;&#x8F7D;">0.1. 1.&#x4E0B;&#x8F7D;</h2><p><a href="https://nodejs.org/zh-cn/download/" target="_blank" rel="noopener">&#x5B98;&#x7F51;&#x5B89;&#x88C5;&#x5730;&#x5740;</a></p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">&#x9009;&#x62E9;&#x5F53;&#x524D;&#x7684;&#x957F;&#x671F;&#x652F;&#x6301;&#x7248;&#x672C;&#x5BF9;&#x5E94;&#x7684;linux&#x7248;&#x672C;</span><br><span class="line">&#x53F3;&#x952E;&#x590D;&#x5236;&#x94FE;&#x63A5;&#x5F97;&#x5230;&#x5982;&#x4E0B;&#x94FE;&#x63A5;</span><br><span class="line">https://nodejs.org/dist/v12.<span class="number">13.1</span>/<span class="keyword">node</span><span class="title">-v12</span>.<span class="number">13.1</span>-linux-x64.tar.xz</span><br><span class="line"></span><br><span class="line">&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x8F7D;&#x5373;&#x53EF;</span><br><span class="line">wget https://nodejs.org/dist/v12.<span class="number">13.1</span>/<span class="keyword">node</span><span class="title">-v12</span>.<span class="number">13.1</span>-linux-x64.tar.xz</span><br><span class="line"></span><br><span class="line">&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x662F;&#x6D77;&#x5916;&#x7684;,&#x56FD;&#x5185;&#x8BBF;&#x95EE;&#x5F88;&#x6162;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x963F;&#x91CC;&#x4E91;&#x7684;&#x955C;&#x50CF;,&#x5C06;&#x524D;&#x7F00;&#x4FEE;&#x6539;&#x5982;&#x4E0B;&#x5373;&#x53EF;</span><br><span class="line">https://npm.taobao.org/mirrors/<span class="keyword">node</span><span class="title">/v12</span>.<span class="number">13.1</span>/<span class="keyword">node</span><span class="title">-v12</span>.<span class="number">13.1</span>-linux-x64.tar.xz</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p><img src="/2019/linux-an-zhuang-node-js/node-download.png" alt></p>
<h2 id="&#x5B89;&#x88C5;">0.2. &#x5B89;&#x88C5;</h2><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="comment">## &#x89E3;&#x538B;</span></span><br><span class="line">tar -xcf ./<span class="keyword">node</span><span class="title">-v12</span>.<span class="number">13.1</span>-linux-x64.tar.xz</span><br><span class="line"><span class="comment">## &#x8FDB;&#x5165;&#x76EE;&#x5F55;</span></span><br><span class="line">cd ./<span class="keyword">node</span><span class="title">-v12</span>.<span class="number">13.1</span>-linux-x64/bin</span><br><span class="line"><span class="comment">## &#x91CC;&#x9762;&#x6709;&#x4E09;&#x4E2A;&#x6587;&#x4EF6; node  npm  npx &#x4E0B;&#x9762;&#x67E5;&#x770B;&#x7248;&#x672C;&#x53F7;&#x9A8C;&#x8BC1;</span></span><br><span class="line">./<span class="keyword">node</span> <span class="title">-v</span></span><br><span class="line">./npm -v</span><br></pre></td></tr></table></figure>
<p><strong>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x5168;&#x5C40;&#x4F7F;&#x7528;&#x5219;&#x9700;&#x8981;&#x4E0B;&#x9762;&#x914D;&#x7F6E;</strong></p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">ln -s /self/app/<span class="keyword">node</span><span class="title">-v12</span>.<span class="number">13.1</span>-linux-x64/bin/<span class="keyword">node</span> <span class="title">/usr</span>/bin/<span class="keyword">node</span><span class="title"></span></span><br><span class="line"><span class="title">ln</span> -s /self/app/<span class="keyword">node</span><span class="title">-v12</span>.<span class="number">13.1</span>-linux-x64/bin/npm /usr/bin/npm</span><br><span class="line"></span><br><span class="line"><span class="comment">## &#x67E5;&#x770B;&#x7248;&#x672C;</span></span><br><span class="line"><span class="keyword">node</span> <span class="title">-v</span></span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x6CE8;&#x610F; ln -s &#x540E;&#x9762;&#x8DDF;&#x7684;&#x5FC5;&#x987B;&#x662F;&#x6587;&#x4EF6;&#x7684;&#x5168;&#x8DEF;&#x5F84;, &#x5982;&#x679C;&#x4F7F;&#x7528;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#x7684;</p>
</blockquote>
<h2 id="&#x914D;&#x7F6E;&#x963F;&#x91CC;&#x4E91;&#x955C;&#x50CF;">0.3. &#x914D;&#x7F6E;&#x963F;&#x91CC;&#x4E91;&#x955C;&#x50CF;</h2><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">npm <span class="built_in">config</span> <span class="built_in">set</span> registry https:<span class="comment">//registry.npm.taobao.org</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>安装</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo设置搜索</title>
    <url>/2019/hexo-set-select/</url>
    <content><![CDATA[<h2 id="&#x5B89;&#x88C5;hexo-generator-searchdb&#x63D2;&#x4EF6;">0.1. &#x5B89;&#x88C5;hexo-generator-searchdb&#x63D2;&#x4EF6;</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">npm <span class="keyword">install</span> hexo-generator-searchdb <span class="comment">--save</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>

<h2 id="&#x914D;&#x7F6E;">0.2. &#x914D;&#x7F6E;</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x5728;</span> <span class="string">blog/_config.yml</span> <span class="string">&#x6587;&#x4EF6;&#x8FFD;&#x52A0;</span></span><br><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">html</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">10000</span></span><br><span class="line">  <span class="attr">content:</span> <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line"> <span class="string">&#x5728;</span> <span class="string">blog/themes/hexo-theme-next-master/_config.yml</span> <span class="string">&#x4FEE;&#x6539;</span></span><br><span class="line"> <span class="attr">local_search:</span></span><br><span class="line">   <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x70B9;&#x51FB;&#x641C;&#x7D22;&#x6309;&#x94AE;&#x540E;&#x5F39;&#x51FA;&#x641C;&#x7D22;&#x56FE;&#x5C42;&#x540C;&#x65F6;&#x4F1A;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x7A7A;&#x767D;&#x9875;">0.3. &#x70B9;&#x51FB;&#x641C;&#x7D22;&#x6309;&#x94AE;&#x540E;&#x5F39;&#x51FA;&#x641C;&#x7D22;&#x56FE;&#x5C42;&#x540C;&#x65F6;&#x4F1A;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x7A7A;&#x767D;&#x9875;</h2><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&#x4FEE;&#x6539; blog/themes/hexo-theme-next-master/layout/_partials/header.swig</span><br><span class="line">&#x5C06;</span><br><span class="line">&lt;a <span class="attribute">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;popup-trigger&quot;</span>&gt;</span><br><span class="line">&#x4FEE;&#x6539;&#x4E3A;</span><br><span class="line">&lt;a <span class="attribute">href</span>=<span class="string">&quot;#&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;popup-trigger&quot;</span>&gt;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>util</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo配置本地图片</title>
    <url>/2019/hexo-pei-zhi-ben-di-tu-pian/</url>
    <content><![CDATA[<h1 id="&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;">1. &#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vi /blog/_config.yml</span><br><span class="line"></span><br><span class="line">post_asset_folder: true</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<h1 id="&#x5B89;&#x88C5;hexo-asset-image">2. &#x5B89;&#x88C5;hexo-asset-image</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x5728;hexo&#x76EE;&#x5F55;&#x6267;&#x884C;</span><br><span class="line">npm install https://github.com/CodeFalling/hexo-asset-image --save</span><br></pre></td></tr></table></figure>

<h1 id="&#x4F7F;&#x7528;">3. &#x4F7F;&#x7528;</h1><figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">hexo <span class="built_in">n</span> <span class="string">&quot;git&#x914D;&#x7F6E;sshkey&quot;</span></span><br></pre></td></tr></table></figure>
<p>&#x6B64;&#x65F6;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5728;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A; git&#x914D;&#x7F6E;sshkey &#x6587;&#x4EF6;&#x548C; git&#x914D;&#x7F6E;sshkey &#x6587;&#x4EF6;&#x5939;</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x5728;md&#x6587;&#x6863;&#x4E2D;&#x8F93;&#x5165;&#x5373;&#x53EF;</span><br><span class="line">![](git&#x914D;&#x7F6E;sshkey/gitlib-sshkey.png)</span><br></pre></td></tr></table></figure>

<h1 id="&#x95EE;&#x9898;">4. &#x95EE;&#x9898;</h1><h2 id="&#x90E8;&#x7F72;&#x540E;&#x65E0;&#x6CD5;&#x663E;&#x793A;">4.1. &#x90E8;&#x7F72;&#x540E;&#x65E0;&#x6CD5;&#x663E;&#x793A;</h2><p>&#x5728;&#x9875;&#x9762;&#x67E5;&#x770B;&#x6307;&#x5411;&#x7684;&#x94FE;&#x63A5;&#x662F; <code>.io//gitlib-sshkey.png</code>  </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x4FEE;&#x6539;&#x9879;&#x76EE;&#x6839;&#x8DEF;&#x5F84;&#x4E0B;&#x7684; package.json</span><br><span class="line">&#x5C06; hexo-asset-image &#x7248;&#x672C;&#x4FEE;&#x6539;&#x4E3A; 0.0.1</span><br><span class="line">&quot;hexo-asset-image&quot;: &quot;0.0.1&quot;</span><br><span class="line"></span><br><span class="line">npm install</span><br><span class="line">hexo clean</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>util</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>git配置sshkey</title>
    <url>/2019/git-pei-zhi-sshkey/</url>
    <content><![CDATA[<blockquote>
<p>&#x4E4B;&#x524D;&#x4E00;&#x76F4;&#x4F7F;&#x7528;git&#x63D0;&#x4F9B;&#x7684;http&#x94FE;&#x63A5;&#x6765;&#x63A8;&#x9001;&#x4EE3;&#x7801;, &#x4E0D;&#x8FC7;&#x4ECA;&#x5929;mac&#x7684;sourcetree&#x70B8;&#x4E86;,&#x4E0D;&#x80FD;&#x4FDD;&#x5B58;&#x5BC6;&#x7801;. &#x7F51;&#x4E0A;&#x67E5;&#x4E86;&#x5F88;&#x591A;&#x65B9;&#x6CD5;&#x90FD;&#x4E0D;&#x80FD;&#x89E3;&#x51B3;, &#x6700;&#x540E;&#x51B3;&#x5B9A;&#x6539;&#x7528;ssh&#x767B;&#x5F55;. </p>
</blockquote>
<a id="more"></a>
<h1 id="1-Git&#x7684;userName&#x548C;email">1. 1.Git&#x7684;userName&#x548C;email</h1><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">git<span class="built_in"> config </span>--global user.name <span class="string">&quot;yuyu&quot;</span></span><br><span class="line">git<span class="built_in"> config </span>--global user.email <span class="string">&quot;yuy9501@126.com&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="2-&#x751F;&#x6210;SSH&#x5BC6;&#x94A5;">2. 2.&#x751F;&#x6210;SSH&#x5BC6;&#x94A5;</h1><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">&#x79C1;&#x94A5;&#x6587;&#x4EF6;: id_rsa</span></span><br><span class="line"><span class="section">&#x516C;&#x94A5;&#x6587;&#x4EF6;: id_rsa.pub</span></span><br></pre></td></tr></table></figure>
<h2 id="&#x67E5;&#x770B;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;ssh&#x5BC6;&#x94A5;&#xFF1A;">2.1. &#x67E5;&#x770B;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;ssh&#x5BC6;&#x94A5;&#xFF1A;</h2><figure class="highlight plain"><figcaption><span>~/.ssh```</span></figcaption><table><tr><td class="code"><pre><span class="line">&gt; &#x5982;&#x679C;&#x6CA1;&#x6709;&#x5BC6;&#x94A5;&#x5219;&#x4E0D;&#x4F1A;&#x6709;&#x6B64;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x6709;&#x5219;&#x5907;&#x4EFD;&#x5220;&#x9664;</span><br><span class="line"></span><br><span class="line">## &#x751F;&#x5B58;&#x5BC6;&#x94A5;</span><br><span class="line">```$xslt</span><br><span class="line">ssh-keygen -t rsa -C &quot;yuy9501@126.com&quot;</span><br><span class="line">&#x6309;3&#x4E2A;&#x56DE;&#x8F66;&#xFF0C;&#x5BC6;&#x7801;&#x4E3A;&#x7A7A;&#x3002;</span><br><span class="line">&#x6700;&#x540E;&#x4F1A;&#x751F;&#x6210;&#x4E0A;&#x8FF0; &#x79C1;&#x94A5;&#x6587;&#x4EF6;/&#x516C;&#x94A5;&#x6587;&#x4EF6;</span><br></pre></td></tr></table></figure>
<h2 id="&#x6DFB;&#x52A0;&#x5BC6;&#x94A5;&#x5230;ssh">2.2. &#x6DFB;&#x52A0;&#x5BC6;&#x94A5;&#x5230;ssh</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-add ./id_rsa</span><br></pre></td></tr></table></figure>
<h2 id="&#x6DFB;&#x52A0;&#x516C;&#x94A5;&#x5230;git">2.3. &#x6DFB;&#x52A0;&#x516C;&#x94A5;&#x5230;git</h2><p>&#x590D;&#x5236; <code>id_rsa.pub</code> &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5230;git</p>
<p><img src="/2019/git-pei-zhi-sshkey/gitlib-sshkey.png" alt></p>
]]></content>
      <categories>
        <category>util</category>
      </categories>
      <tags>
        <tag>ssh密钥</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo</title>
    <url>/2019/hexo/</url>
    <content><![CDATA[<h1 id="Hexo">1. Hexo</h1><blockquote>
<p>&#x4F18;&#x52BF;: &#x90E8;&#x7F72;&#x65B9;&#x4FBF;, &#x7B2C;&#x4E09;&#x65B9;&#x4E3B;&#x4F53;&#x975E;&#x5E38;&#x6F02;&#x4EAE;, &#x53EF;&#x4EE5;&#x5728;git&#x4E0A;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x751F;&#x4EA7;&#x7F51;&#x9875;(&#x514D;&#x8D39;)</p>
</blockquote>
<p><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a></p>
<a id="more"></a>

<h1 id="&#x5B89;&#x88C5;">2. &#x5B89;&#x88C5;</h1><p>&#x9996;&#x5148;&#x9700;&#x8981;&#x672C;&#x5730;&#x5B89;&#x88C5;npm , git(&#x6B64;&#x5904;&#x7565;&#x8FC7;)<br>&#x5B89;&#x88C5;hexo</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mkdir hexo</span><br><span class="line">cd hexo</span><br><span class="line">npm <span class="keyword">install</span> hexo-cli -g</span><br><span class="line">hexo init blog</span><br><span class="line">cd blog</span><br><span class="line">npm <span class="keyword">install</span></span><br><span class="line"><span class="comment">-- &#x542F;&#x52A8;</span></span><br><span class="line">hexo <span class="keyword">server</span></span><br><span class="line"><span class="comment">-----&#x542F;&#x52A8;&#x6210;&#x529F;&#x63A7;&#x5236;&#x53F0;&#x4F1A;&#x6253;&#x5370;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;----</span></span><br><span class="line">INFO  Hexo <span class="keyword">is</span> running <span class="keyword">at</span> <span class="keyword">http</span>://localhost:<span class="number">4000</span> . Press Ctrl+C <span class="keyword">to</span> stop.</span><br></pre></td></tr></table></figure>
<p>&#x5C06;&#x9879;&#x76EE;&#x63D0;&#x4EA4;&#x5230;git , &#x4F9D;&#x6B21;&#x70B9;&#x51FB;&#x670D;&#x52A1; -&gt; gitee pages -&gt; &#x9009;&#x62E9;&#x5206;&#x652F; -&gt; &#x90E8;&#x7F72;<br><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1573563198745-9804f1fa-bc74-4980-8a31-28c1e41aa355.png#align=left&amp;display=inline&amp;height=834&amp;name=image.png" alt="image.png"><br>&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x540E;&#x5C31;&#x70B9;&#x51FB;&#x7F51;&#x7AD9;&#x5730;&#x5740;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x4E86;</p>
<hr>
<h1 id="&#x4FEE;&#x6539;&#x914D;&#x7F6E;-blog-config-yml">3. &#x4FEE;&#x6539;&#x914D;&#x7F6E; blog/_config.yml</h1><figure class="highlight ldif"><table><tr><td class="code"><pre><span class="line"><span class="literal">-- &#x4E00;&#x4E0B;&#x4E3A;&#x4FEE;&#x6539;&#x9879; &#x672A;&#x4FEE;&#x6539;&#x7684;&#x6CA1;&#x6709;&#x5C55;&#x793A;&#x51FA;&#x6765;,&#x8BF7;&#x52FF;&#x5220;&#x9664;</span></span><br><span class="line"><span class="literal">-- &#x535A;&#x5BA2;&#x57FA;&#x7840;&#x4FE1;&#x606F;</span></span><br><span class="line"><span class="attribute">title</span>: blog</span><br><span class="line"><span class="attribute">subtitle</span>: yuyu</span><br><span class="line"><span class="attribute">description</span>: &#x4E2A;&#x4EBA;&#x535A;&#x5BA2;</span><br><span class="line"><span class="attribute">keywords:</span></span><br><span class="line"><span class="attribute">author</span>: yuyu</span><br><span class="line"><span class="attribute">language</span>: zh-Hans</span><br><span class="line"><span class="attribute">timezone</span>: Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;</span></span><br><span class="line"><span class="attribute">url</span>: https://reverselight.gitee.io/blog/</span><br><span class="line"><span class="attribute">root</span>: /blog</span><br><span class="line"></span><br><span class="line"><span class="literal">-- &#x6B64;&#x9879;&#x4E3A;&#x5C06;&#x4E3B;&#x9898;&#x8BBE;&#x7F6E;Wie&#x4E0B;&#x9762;&#x8981;&#x8BB2;&#x5230;&#x7684;next&#x4E3B;&#x9898;</span></span><br><span class="line"><span class="attribute">theme</span>: hexo-theme-next-master</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="&#x914D;&#x7F6E;next&#x4E3B;&#x9898;">4. &#x914D;&#x7F6E;next&#x4E3B;&#x9898;</h1><p><a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">git&#x94FE;&#x63A5;</a><br>&#x5C06;&#x4E0B;&#x8F7D;&#x4E0B;&#x6765;&#x7684;&#x6587;&#x4EF6;&#x590D;&#x5236;&#x5230; blog/themes/<br>&#x4FEE;&#x6539; themes/hexo-theme-next-master/_config.yml<br>&#x6253;&#x5F00;themes/next&#x4E0B;&#x7684;_config.yml&#x6587;&#x4EF6;</p>
<h2 id="&#x662F;&#x5426;&#x8986;&#x76D6;&#x5916;&#x90E8;&#x7684;&#x5168;&#x5C40;&#x8BBE;&#x7F6E;">4.1. &#x662F;&#x5426;&#x8986;&#x76D6;&#x5916;&#x90E8;&#x7684;&#x5168;&#x5C40;&#x8BBE;&#x7F6E;</h2><blockquote>
<p>&#x5982;&#x679C;&#x4F60;&#x8981;&#x5728;&#x4E3B;&#x9898;&#x91CC;&#x9762;&#x8BBE;&#x7F6E;&#x5EFA;&#x8BAE;&#x8FD9;&#x91CC;&#x8BBE;&#x4E3A;true.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Set to true, if you want to fully override the default configuration.</span></span><br><span class="line"><span class="comment"># Useful if you don&apos;t want to inherit the theme _config.yml configurations.</span></span><br><span class="line"><span class="attr">override:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x7F51;&#x9875;&#x5173;&#x952E;&#x5B57;&#x548C;&#x56FE;&#x6807;&#x7684;&#x8BBE;&#x7F6E;">4.2. &#x7F51;&#x9875;&#x5173;&#x952E;&#x5B57;&#x548C;&#x56FE;&#x6807;&#x7684;&#x8BBE;&#x7F6E;</h2><figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">favicon:</span></span><br><span class="line"><span class="symbol">  small:</span> <span class="meta-keyword">/images/</span>favicon<span class="number">-16</span>x16-next.png</span><br><span class="line"><span class="symbol">  medium:</span> <span class="meta-keyword">/images/</span>favicon<span class="number">-32</span>x32-next.png</span><br><span class="line"><span class="symbol">  apple_touch_icon:</span> <span class="meta-keyword">/images/</span>apple-touch-icon-next.png</span><br><span class="line"><span class="symbol">  safari_pinned_tab:</span> <span class="meta-keyword">/images/</span>logo.svg</span><br><span class="line">  <span class="meta">#android_manifest: /images/manifest.json</span></span><br><span class="line">  <span class="meta">#ms_browserconfig: /images/browserconfig.xml</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Set default keywords (Use a comma to separate)</span></span><br><span class="line"><span class="symbol">keywords:</span> <span class="string">&quot;java, mysql,CSDN,git,gitee&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x6574;&#x4E2A;&#x7248;&#x9762;&#x6837;&#x5F0F;&#x7684;&#x8BBE;&#x7F6E;">4.3. &#x6574;&#x4E2A;&#x7248;&#x9762;&#x6837;&#x5F0F;&#x7684;&#x8BBE;&#x7F6E;</h2><figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># Schemes</span></span><br><span class="line"><span class="meta"># scheme: Muse</span></span><br><span class="line"><span class="meta"># scheme: Mist</span></span><br><span class="line"><span class="meta"># scheme: Pisces</span></span><br><span class="line">scheme: Gemini</span><br></pre></td></tr></table></figure>

<h2 id="&#x793E;&#x4EA4;&#x5E73;&#x53F0;">4.4. &#x793E;&#x4EA4;&#x5E73;&#x53F0;</h2><figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">menu:</span></span><br><span class="line"><span class="symbol">  home:</span> / || home</span><br><span class="line"><span class="symbol">  tags:</span> <span class="meta-keyword">/tags/</span> || tags</span><br><span class="line"><span class="symbol">  categories:</span> <span class="meta-keyword">/categories/</span> || th</span><br><span class="line"><span class="symbol">  archives:</span> <span class="meta-keyword">/archives/</span> || archive</span><br><span class="line">  <span class="meta">#schedule: /schedule/ || calendar</span></span><br><span class="line"><span class="symbol">  about:</span> <span class="meta-keyword">/about/</span> || user</span><br><span class="line"><span class="symbol">  sitemap:</span> /sitemap.xml || sitemap</span><br></pre></td></tr></table></figure>


<h2 id="&#x8BBE;&#x7F6E;&#x94FE;&#x63A5;">4.5. &#x8BBE;&#x7F6E;&#x94FE;&#x63A5;</h2><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="attribute">social</span>:</span><br><span class="line">  <span class="attribute">GitHub</span>: <span class="attribute">https</span>:<span class="comment">//gitee.com/reverseLight || github</span></span><br><span class="line">  <span class="attribute">E-Mail</span>: yuy9501<span class="variable">@126</span>.com.com || envelope</span><br><span class="line">  #<span class="attribute">Google</span>: <span class="attribute">https</span>:<span class="comment">//plus.google.com/yourname || google</span></span><br><span class="line">  #<span class="attribute">Twitter</span>: <span class="attribute">https</span>:<span class="comment">//twitter.com/yourname || twitter</span></span><br><span class="line">  <span class="number">#FB</span> <span class="attribute">Page</span>: <span class="attribute">https</span>:<span class="comment">//www.facebook.com/yourname || facebook</span></span><br><span class="line">  #VK <span class="attribute">Group</span>: <span class="attribute">https</span>:<span class="comment">//vk.com/yourname || vk</span></span><br><span class="line">  #<span class="attribute">StackOverflow</span>: <span class="attribute">https</span>:<span class="comment">//stackoverflow.com/yourname || stack-overflow</span></span><br><span class="line">  #<span class="attribute">YouTube</span>: <span class="attribute">https</span>:<span class="comment">//youtube.com/yourname || youtube</span></span><br><span class="line">  #<span class="attribute">Instagram</span>: <span class="attribute">https</span>:<span class="comment">//instagram.com/yourname || instagram</span></span><br><span class="line">  #<span class="attribute">Skype</span>: <span class="attribute">skype</span>:yourname?call|chat || skype</span><br><span class="line">  <span class="attribute">blog</span>: <span class="attribute">http</span>:<span class="comment">//www.chenguanting.top || stack-overflow</span></span><br></pre></td></tr></table></figure>


<h2 id="&#x5B57;&#x6570;&#x7EDF;&#x8BA1;">4.6. &#x5B57;&#x6570;&#x7EDF;&#x8BA1;</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Post wordcount display settings</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/willin/hexo-wordcount</span></span><br><span class="line"><span class="attr">post_wordcount:</span></span><br><span class="line">  <span class="attr">item_text:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">wordcount:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">totalcount:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">separated_meta:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x8BBE;&#x7F6E;&#x6253;&#x8D4F;">4.7. &#x8BBE;&#x7F6E;&#x6253;&#x8D4F;</h2><figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="meta">#Reward</span></span><br><span class="line"><span class="symbol">reward_comment:</span> &#x60A8;&#x7684;&#x652F;&#x6301;&#x662F;&#x6211;&#x521B;&#x4F5C;&#x6E90;&#x6E90;&#x4E0D;&#x65AD;&#x7684;&#x52A8;&#x529B;</span><br><span class="line"><span class="symbol">wechatpay:</span> <span class="meta-keyword">/images/</span>reward_weixin.png</span><br><span class="line"><span class="symbol">alipay:</span> <span class="meta-keyword">/images/</span>reward_alipay.jpg</span><br><span class="line"><span class="meta">#bitcoin: /images/logo_width.png</span></span><br></pre></td></tr></table></figure>

<h2 id>4.8. </h2><h2 id="gitalk&#x8BC4;&#x8BBA;&#x63D2;&#x4EF6;">4.9. gitalk&#x8BC4;&#x8BBA;&#x63D2;&#x4EF6;</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Gitalk</span></span><br><span class="line"><span class="attr">gitalk:</span> </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span>    <span class="comment">#&#x7528;&#x6765;&#x505A;&#x542F;&#x7528;&#x5224;&#x65AD;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;</span></span><br><span class="line">  <span class="attr">clientID:</span> <span class="string">&apos;xxxxxxxx&apos;</span>    <span class="comment">#&#x4E0A;&#x9762;&#x751F;&#x6210;&#x7684;&#x5F80;&#x8FD9;&#x91CC;&#x603C;</span></span><br><span class="line">  <span class="attr">clientSecret:</span> <span class="string">&apos;xxxxxxxxxxxxxxxxxxxxxxxxxxx&apos;</span>   <span class="comment">#&#x540C;&#x4E0A;</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">xxxxx.github.com</span>    <span class="comment">#&#x4ED3;&#x5E93;&#x540D;&#x79F0;</span></span><br><span class="line">  <span class="attr">owner:</span> <span class="string">xxxxxx</span>    <span class="comment">#github&#x7528;&#x6237;&#x540D;</span></span><br><span class="line">  <span class="attr">admin:</span> <span class="string">xxxxxxx</span></span><br><span class="line">  <span class="attr">distractionFreeMode:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="&#x5176;&#x4ED6;&#x8BBE;&#x7F6E;">5. &#x5176;&#x4ED6;&#x8BBE;&#x7F6E;</h1><h2 id="next&#x4E3B;&#x9898;&#x8BBE;&#x7F6E;&#x9996;&#x9875;&#x4E0D;&#x663E;&#x793A;&#x5168;&#x6587;-&#x53EA;&#x663E;&#x793A;&#x9884;&#x89C8;">5.1. next&#x4E3B;&#x9898;&#x8BBE;&#x7F6E;&#x9996;&#x9875;&#x4E0D;&#x663E;&#x793A;&#x5168;&#x6587;(&#x53EA;&#x663E;&#x793A;&#x9884;&#x89C8;)</h2><p>&#x4FEE;&#x6539; themes/hexo-theme-next-master/_config.yml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">auto_excerpt:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">length:</span> <span class="number">150</span></span><br></pre></td></tr></table></figure>


<h2 id="&#x672C;&#x5730;&#x90E8;&#x7F72;&#x9875;&#x9762;&#x6B63;&#x5E38;-git&#x90E8;&#x7F72;&#x9875;&#x9762;&#x6392;&#x7248;&#x9519;&#x4E71;">5.2. &#x672C;&#x5730;&#x90E8;&#x7F72;&#x9875;&#x9762;&#x6B63;&#x5E38;, git&#x90E8;&#x7F72;&#x9875;&#x9762;&#x6392;&#x7248;&#x9519;&#x4E71;</h2><p>&#x4FEE;&#x6539; themes/hexo-theme-next-master/_config.yml</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="string">url:</span> <span class="string">https:</span><span class="comment">//reverselight.gitee.io/blog/</span></span><br><span class="line"><span class="string">root:</span> /blog</span><br></pre></td></tr></table></figure>
<h2 id="next&#x4E3B;&#x9898;&#x8BBE;&#x7F6E;&#x6587;&#x7AE0;&#x76EE;&#x5F55;">5.3. next&#x4E3B;&#x9898;&#x8BBE;&#x7F6E;&#x6587;&#x7AE0;&#x76EE;&#x5F55;</h2><p>&#x5728;&#x6B64;&#x6587;&#x4EF6;&#x8FFD;&#x52A0; themes/hexo-theme-next-master/source/css/_custom/custom.styl</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="comment">//&#x6587;&#x7AE0;&#x76EE;&#x5F55;&#x9ED8;&#x8BA4;&#x5C55;&#x5F00;</span></span><br><span class="line"><span class="selector-class">.post-toc</span> <span class="selector-class">.nav</span> <span class="selector-class">.nav-child</span> { <span class="attribute">display</span>: block; }</span><br><span class="line"><span class="comment">// &#x6587;&#x7AE0;&#x76EE;&#x5F55;&#x5B57;&#x4F53;&#x5927;&#x5C0F;&#x8C03;&#x6574;</span></span><br><span class="line"><span class="selector-class">.post-toc</span> <span class="selector-tag">ol</span> {</span><br><span class="line">  <span class="attribute">font-size</span> : <span class="number">13px</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4FEE;&#x6539; themes/hexo-theme-next-master/_config.yml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">toc:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Automatically add list number to toc.</span></span><br><span class="line">  <span class="attr">number:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># If true, all words will placed on next lines if header width longer then sidebar width.</span></span><br><span class="line">  <span class="attr">wrap:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>util</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>spring-boot-data-elasticsearch</title>
    <url>/2019/spring-boot-data-elasticsearch/</url>
    <content><![CDATA[<h1 id="spring-boot-data-elasticsearch">1. spring-boot-data-elasticsearch</h1><h2 id="&#x524D;&#x8A00;">1.1. &#x524D;&#x8A00;:</h2><p>&#x7F51;&#x4E0A;&#x5F88;&#x591A;&#x4EBA;&#x8BF4;spring-boot-data-elasticsearch&#x652F;&#x6301;es&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;,&#x6211;&#x5728;&#x5B98;&#x7F51;&#x53EA;&#x627E;&#x5230;&#x5982;&#x4E0B;&#x7248;&#x672C;&#x5BF9;&#x5E94;&#x8BF4;&#x660E;,&#x6CA1;&#x6709;&#x5173;&#x4E8E;spring-boot-data&#x5BF9;&#x5E94;&#x7248;&#x672C;&#x8BF4;&#x660E;&#x5C31;&#x70B9;&#x5F00;&#x672C;&#x5730;pom&#x770B;&#x4E86;&#x4E0B;</p>
<table>
<thead>
<tr>
<th>spring-data-elasticsearch</th>
<th>elasticsearch</th>
</tr>
</thead>
<tbody><tr>
<td>3.1.x</td>
<td>6.2.2</td>
</tr>
<tr>
<td>3.0.x</td>
<td>5.5.0</td>
</tr>
<tr>
<td>2.1.x</td>
<td>2.4.0</td>
</tr>
<tr>
<td>2.0.x</td>
<td>2.2.0</td>
</tr>
<tr>
<td>1.3.x</td>
<td>1.5.2</td>
</tr>
</tbody></table>
<a id="more"></a>

<p>&#x672C;&#x5730;pom</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x70B9;&#x51FB;spring-boot-starter-data-elasticsearch&#x67E5;&#x770B;&#x5BF9;&#x5E94;pom</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;spring-boot-data-es&#x662F;&#x5BF9;spring-data-es&#x8FDB;&#x884C;&#x4E86;&#x5C01;&#x88C5;, &#x672C;&#x5730;springboot2.1.8&#x5BF9;&#x5E94;spring-data-es3.1.10&#x5BF9;&#x5E94;es&#x7248;&#x672C;&#x4E3A;6.2.2</p>
<hr>
<h2 id="pom&#x914D;&#x7F6E;">1.2. pom&#x914D;&#x7F6E;</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x914D;&#x7F6E;&#x6587;&#x4EF6;">1.3. &#x914D;&#x7F6E;&#x6587;&#x4EF6;</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">spring.application.name=es</span><br><span class="line">server.port=8080</span><br><span class="line">server.servlet.context-path=/es</span><br><span class="line"></span><br><span class="line"># Elasticsearch cluster name.</span><br><span class="line">spring.data.elasticsearch.cluster-name=my-es</span><br><span class="line"># Comma-separated list of cluster node addresses.</span><br><span class="line">spring.data.elasticsearch.cluster-nodes=47.11.11.11:9300</span><br><span class="line"># &#x5F00;&#x542F; Elasticsearch &#x4ED3;&#x5E93;(&#x9ED8;&#x8BA4;&#x503C;:true)</span><br><span class="line">spring.data.elasticsearch.repositories.enabled=true</span><br></pre></td></tr></table></figure>

<h2 id="&#x5B9E;&#x4F53;&#x7C7B;">1.4. &#x5B9E;&#x4F53;&#x7C7B;</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Document</span>(indexName = <span class="string">&quot;book&quot;</span>, type = <span class="string">&quot;_doc&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookBean</span> </span>{</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> String postDate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookBean</span><span class="params">()</span></span>{}</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookBean</span><span class="params">(String id, String title, String author, String postDate)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.id=id;</span><br><span class="line">        <span class="keyword">this</span>.title=title;</span><br><span class="line">        <span class="keyword">this</span>.author=author;</span><br><span class="line">        <span class="keyword">this</span>.postDate=postDate;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> title;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAuthor</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> author;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthor</span><span class="params">(String author)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.author = author;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPostDate</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> postDate;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPostDate</span><span class="params">(String postDate)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.postDate = postDate;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BookBean{&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&apos;&quot;</span> + id + <span class="string">&apos;\&apos;&apos;</span> +</span><br><span class="line">                <span class="string">&quot;, title=&apos;&quot;</span> + title + <span class="string">&apos;\&apos;&apos;</span> +</span><br><span class="line">                <span class="string">&quot;, author=&apos;&quot;</span> + author + <span class="string">&apos;\&apos;&apos;</span> +</span><br><span class="line">                <span class="string">&quot;, postDate=&apos;&quot;</span> + postDate + <span class="string">&apos;\&apos;&apos;</span> +</span><br><span class="line">                <span class="string">&apos;}&apos;</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x7EE7;&#x627F;es&#x63A5;&#x53E3;">1.5. &#x7EE7;&#x627F;es&#x63A5;&#x53E3;</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookRepository</span> <span class="keyword">extends</span> <span class="title">ElasticsearchRepository</span>&lt;<span class="title">BookBean</span>, <span class="title">String</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Optional&lt;BookBean&gt; findById(String id);</span></span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;BookBean&gt; <span class="title">findByAuthor</span><span class="params">(String author)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;BookBean&gt; <span class="title">findByTitle</span><span class="params">(String title)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x8C03;&#x7528;">1.6. &#x8C03;&#x7528;</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServiceTest</span> <span class="keyword">extends</span> <span class="title">EsApplicationTests</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> BookRepository bookRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>{</span><br><span class="line">        BookBean book = <span class="keyword">new</span> BookBean();</span><br><span class="line"></span><br><span class="line">        book.setId(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        book.setAuthor(<span class="string">&quot;yu&quot;</span>);</span><br><span class="line">        book.setPostDate(<span class="string">&quot;2019-09-02&quot;</span>);</span><br><span class="line">        book.setTitle(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        bookRepository.save(book);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByAuthor</span><span class="params">()</span></span>{</span><br><span class="line">        List&lt;BookBean&gt; yu = bookRepository.findByAuthor(<span class="string">&quot;yu&quot;</span>);</span><br><span class="line">        System.out.println(yu);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="&#x51FA;&#x73B0;&#x7684;&#x5F02;&#x5E38;">1.7. &#x51FA;&#x73B0;&#x7684;&#x5F02;&#x5E38;</h2><h3 id="&#x5F02;&#x5E38;&#x4E00;">1.7.1. &#x5F02;&#x5E38;&#x4E00;</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">org.elasticsearch.client.transport.NoNodeAvailableException: None of the configured nodes are available: [{#transport#-1}{3H-4Xug_QMC2lFQpqPJhVw}]</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x5F02;&#x5E38;&#x521D;&#x6B65;&#x5224;&#x65AD;&#x4E3A;&#x672C;&#x5730;&#x8C03;&#x7528;&#x8FDC;&#x7A0B;es&#x4E0D;&#x901A;, &#x4F7F;&#x7528;<a href="http://47.xx.xx.xx:9200/" target="_blank" rel="noopener">http://47.xx.xx.xx:9200/</a>&#x8C03;&#x7528;&#x663E;&#x793A;&#x6B63;&#x5E38;</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    name: &quot;node-1&quot;,</span><br><span class="line">    cluster_name: &quot;my-es&quot;,</span><br><span class="line">    cluster_uuid: &quot;WHiWU6ekREq9xoqXFIbjBg&quot;,</span><br><span class="line">    version: {</span><br><span class="line">    number: &quot;6.6.2&quot;,</span><br><span class="line">    build_flavor: &quot;default&quot;,</span><br><span class="line">    build_type: &quot;tar&quot;,</span><br><span class="line">    build_hash: &quot;3bd3e59&quot;,</span><br><span class="line">    build_date: &quot;2019-03-06T15:16:26.864148Z&quot;,</span><br><span class="line">    build_snapshot: false,</span><br><span class="line">    lucene_version: &quot;7.6.0&quot;,</span><br><span class="line">    minimum_wire_compatibility_version: &quot;5.6.0&quot;,</span><br><span class="line">    minimum_index_compatibility_version: &quot;5.0.0&quot;</span><br><span class="line">    },</span><br><span class="line">    tagline: &quot;You Know, for Search&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="&#x7ECF;&#x67E5;&#x9605;&#x8D44;&#x6599;es&#x9700;&#x8981;&#x4F7F;&#x7528;9200-9400&#x7684;&#x7AEF;&#x53E3;&#x53F7;-&#x5177;&#x4F53;&#x7528;&#x9014;&#x4E0D;&#x6E05;&#x695A;-&#x800C;&#x4E0D;&#x662F;&#x53EA;&#x6709;9200&#x6253;&#x5F00;&#x963F;&#x91CC;&#x4E91;&#x5B89;&#x5168;&#x7EC4;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x4E86;">1.8. &#x7ECF;&#x67E5;&#x9605;&#x8D44;&#x6599;es&#x9700;&#x8981;&#x4F7F;&#x7528;9200-9400&#x7684;&#x7AEF;&#x53E3;&#x53F7;(&#x5177;&#x4F53;&#x7528;&#x9014;&#x4E0D;&#x6E05;&#x695A;)&#x800C;&#x4E0D;&#x662F;&#x53EA;&#x6709;9200&#x6253;&#x5F00;&#x963F;&#x91CC;&#x4E91;&#x5B89;&#x5168;&#x7EC4;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x4E86;</h2><h3 id="&#x5F02;&#x5E38;&#x4E8C;">1.8.1. &#x5F02;&#x5E38;&#x4E8C;</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Caused by: java.net.ConnectException:<span class="built_in"> Connection </span>refused: <span class="literal">no</span> further information</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x5E94;&#x8BE5;&#x662F; &#x5728;spring boot &#x542F;&#x52A8;&#x65F6; &#x68C0;&#x67E5;&#x4E86;&#x4E00;&#x4E0B; es&#x7684;&#x5065;&#x5EB7;&#x72B6;&#x6001; &#x7136;&#x540E;&#x8BF7;&#x6C42;&#x8D70;&#x7684;&#x662F; 9200&#x7AEF;&#x53E3;<br>&#x6211;&#x7684;es &#x5B89;&#x88C5;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x4E86; &#x6CA1;&#x6709;&#x5B89;&#x88C5;&#x5230;&#x672C;&#x5730;<br>RestClientProperties&#x7C7B;&#x4E2D;&#x9ED8;&#x8BA4;&#x4E3A;  localhost:9200 &#x6240;&#x4EE5;&#x62D2;&#x7EDD;&#x5F88;&#x6B63;&#x5E38; &#x56E0;&#x4E3A;&#x672C;&#x5730;&#x5C31;&#x6CA1;&#x6709;<br>&#x6DFB;&#x52A0;&#x914D;&#x7F6E;</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">spring<span class="selector-class">.elasticsearch</span><span class="selector-class">.rest</span>.uris=<span class="number">47</span><span class="selector-class">.xx</span><span class="selector-class">.xx</span><span class="selector-class">.xx</span>:<span class="number">9200</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>Linux安装Elasticsearch6.4.x</title>
    <url>/2019/Linux-an-zhuang-Elasticsearch6-4/</url>
    <content><![CDATA[<h1 id="Linux-&#x5B89;&#x88C5;-Elasticsearch6-4-x">1. Linux &#x5B89;&#x88C5; Elasticsearch6.4.x</h1><h2 id="&#x5B89;&#x88C5;JDK">1.1. &#x5B89;&#x88C5;JDK</h2><p>es&#x4F9D;&#x8D56;&#x4E8E;jdk,&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;jdk,&#x7565;&#x8FC7;</p>
<a id="more"></a>

<h2 id="&#x5B89;&#x88C5;es">1.2. &#x5B89;&#x88C5;es</h2><h3 id="1-&#x4E0B;&#x8F7D;">1.2.1. 1. &#x4E0B;&#x8F7D;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x521B;&#x5EFA;&#x76EE;&#x5F55;</span></span><br><span class="line">cd /usr/local/</span><br><span class="line">mkdir es</span><br><span class="line"><span class="comment">// wget&#x4E0B;&#x8F7D;</span></span><br><span class="line">wget https:<span class="comment">//artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.4.1.tar.gz</span></span><br><span class="line"><span class="comment">// &#x89E3;&#x538B;</span></span><br><span class="line">tar -zxvf elasticsearch-<span class="number">6.4</span><span class="number">.2</span>.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="2-&#x4FEE;&#x6539;es&#x914D;&#x7F6E;&#x6587;&#x4EF6;elasticsearch-yml">1.2.2. 2. &#x4FEE;&#x6539;es&#x914D;&#x7F6E;&#x6587;&#x4EF6;elasticsearch.yml</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">vim /usr/local/es/elasticsearch<span class="number">-6.6</span><span class="number">.2</span>/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line">------------------------------------</span><br><span class="line"># &#x96C6;&#x7FA4;&#x540D;&#x79F0;</span><br><span class="line">cluster.name: my-es</span><br><span class="line"># &#x4E3B;&#x673A;&#x540D;</span><br><span class="line">node.name: node<span class="number">-1</span></span><br><span class="line"><span class="comment">// &#x6570;&#x636E;&#x6587;&#x4EF6;&#x53CA;&#x65E5;&#x5FD7;&#x4F4D;&#x7F6E;</span></span><br><span class="line">path.data: /usr/local/es/elasticsearch<span class="number">-6.6</span><span class="number">.2</span>/data</span><br><span class="line">path.logs: /usr/local/es/elasticsearch<span class="number">-6.6</span><span class="number">.2</span>/logs</span><br><span class="line"></span><br><span class="line">bootstrap.memory_lock: <span class="literal">false</span></span><br><span class="line">bootstrap.system_call_filter: <span class="literal">false</span></span><br><span class="line"><span class="comment">// ip</span></span><br><span class="line">network.host: <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="comment">// &#x7AEF;&#x53E3;&#x53F7;</span></span><br><span class="line">http.port: <span class="number">9200</span></span><br><span class="line">------------------------------------</span><br><span class="line"></span><br><span class="line">:wq</span><br><span class="line"><span class="comment">// &#x521B;&#x5EFA;&#x914D;&#x7F6E;&#x7684;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x53CA;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x76EE;&#x5F55;</span></span><br><span class="line">cd /usr/local/es/elasticsearch<span class="number">-6.6</span><span class="number">.2</span></span><br><span class="line">mkdir data</span><br><span class="line">mkdir logs</span><br></pre></td></tr></table></figure>

<h3 id="3-&#x521B;&#x5EFA;&#x7528;&#x6237;">1.2.3. 3. &#x521B;&#x5EFA;&#x7528;&#x6237;</h3><p>&#x7531;&#x4E8E;Elasticsearch&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x7528;&#x6237;&#x8F93;&#x5165;&#x7684;&#x811A;&#x672C;&#x5E76;&#x4E14;&#x6267;&#x884C;&#xFF0C;&#x4E3A;&#x4E86;&#x7CFB;&#x7EDF;&#x5B89;&#x5168;&#x8003;&#x8651;&#xFF0C;&#x4E0D;&#x5141;&#x8BB8;root&#x8D26;&#x53F7;&#x542F;&#x52A8;&#xFF0C;&#x6240;&#x4EE5;&#x5EFA;&#x8BAE;&#x7ED9;Elasticsearch&#x5355;&#x72EC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x6765;&#x8FD0;&#x884C;Elasticsearch&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// &#x521B;&#x5EFA;&#x7528;&#x6237;<span class="built_in">test</span></span><br><span class="line">useradd <span class="built_in">test</span></span><br><span class="line">// &#x4E3A;<span class="built_in">test</span>&#x5206;&#x914D;&#x5BC6;&#x7801;<span class="built_in">test</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;password&quot;</span> |passwd <span class="built_in">test</span> --<span class="built_in">test</span></span><br><span class="line">// &#x4E3A;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x7528;&#x6237;<span class="built_in">test</span>&#x5206;&#x914D;&#x6587;&#x4EF6;&#x6743;&#x9650;</span><br><span class="line">chown -R <span class="built_in">test</span>:<span class="built_in">test</span> /usr/<span class="built_in">local</span>/es/elasticsearch-6.6.2</span><br><span class="line">// &#x9A8C;&#x8BC1;&#x7528;&#x6237;</span><br><span class="line">1. su <span class="built_in">test</span></span><br><span class="line">2. &#x8F93;&#x5165;&#x5BC6;&#x7801;</span><br><span class="line">3. whoami</span><br><span class="line">4. &#x67E5;&#x770B;&#x8F93;&#x51FA;&#x662F;&#x5426;&#x662F;<span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h3 id="4-&#x4F7F;&#x7528;test&#x7528;&#x6237;&#x8FD0;&#x884C;es">1.2.4. 4. &#x4F7F;&#x7528;test&#x7528;&#x6237;&#x8FD0;&#x884C;es</h3><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/usr/local/es/elasticsearch-6.6.2/bin</span></span><br><span class="line"><span class="string">./elasticsearch</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>./elasticsearch -d</strong> &#x662F;&#x540E;&#x53F0;&#x8FD0;&#x884C;</p>
</blockquote>
<h3 id="5-&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x9519;&#x8BEF;">1.2.5. 5. &#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x9519;&#x8BEF;</h3><hr>
<h3 id="max-file-descriptors-4096-for-elasticsearch-process-is-too-low">1.2.6. max file descriptors [4096] for elasticsearch process is too low</h3><figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="built_in">max</span> <span class="built_in">file</span> descriptors [<span class="number">4096</span>] <span class="keyword">for</span> elasticsearch <span class="built_in">process</span> is too low, increase <span class="built_in">to</span> <span class="keyword">at</span> least [<span class="number">65536</span>]</span><br></pre></td></tr></table></figure>
<p>&#x539F;&#x56E0;&#xFF1A;&#x65E0;&#x6CD5;&#x521B;&#x5EFA;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x95EE;&#x9898;,&#x7528;&#x6237;&#x6700;&#x5927;&#x53EF;&#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x6570;&#x592A;&#x5C0F;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;&#x5207;&#x5230;root &#x7528;&#x6237;&#x4E0B;</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$</span> vim /etc/security/limits.conf &#x5728;&#x6587;&#x4EF6;&#x7684;&#x672B;&#x5C3E;&#x6DFB;&#x52A0;&#x4E0B;&#x9762;&#x7684;&#x53C2;&#x6570;&#x503C;&#xFF1A;</span><br><span class="line"><span class="comment">* soft nofile 65536</span></span><br><span class="line"><span class="comment">* hard nofile 131072</span></span><br><span class="line"><span class="comment">* soft nproc 2048</span></span><br><span class="line"><span class="comment">* hard nproc 4096</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="max-virtual-memory-areas-vm-max-map-count-65530-is-too-low">1.2.6.1. max virtual memory areas vm.max_map_count [65530] is too low</h4><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">ERROR: [1] bootstrap checks failed</span><br><span class="line">[<span class="symbol">1</span>]: <span class="link">max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</span></span><br><span class="line">... ...</span><br><span class="line">[<span class="string">2018-10-30T11:41:51,807</span>][<span class="symbol">INFO </span>][<span class="string">o.e.x.m.j.p.NativeController</span>] Native controller process has stopped - no new native processes can be started</span><br></pre></td></tr></table></figure>
<p>&#x539F;&#x56E0;&#xFF1A;&#x6700;&#x5927;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x592A;&#x5C0F;,&#x9700;&#x8981;&#x4FEE;&#x6539;&#x7CFB;&#x7EDF;&#x53D8;&#x91CF;&#x7684;&#x6700;&#x5927;&#x503C;&#x3002;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;&#x5207;&#x6362;&#x5230;root&#x7528;&#x6237;,&#x4FEE;&#x6539;&#x914D;&#x7F6E;sysctl.conf &#x589E;&#x52A0;&#x914D;&#x7F6E;&#x503C;&#xFF1A; vm.max_map_count=262144</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">vim</span> /etc/sysctl.<span class="keyword">conf</span></span><br><span class="line"><span class="keyword">vm</span>.max_map_count=<span class="number">262144</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="max-number-of-threads-1024-for-user-es-likely-too-low">1.2.6.2. max number of threads [1024] for user [es] likely too low</h4><p>&#x539F;&#x56E0;&#xFF1A;&#x65E0;&#x6CD5;&#x521B;&#x5EFA;&#x672C;&#x5730;&#x7EBF;&#x7A0B;&#x95EE;&#x9898;,&#x7528;&#x6237;&#x6700;&#x5927;&#x53EF;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6570;&#x592A;&#x5C0F;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;&#x5207;&#x6362;&#x5230;root&#x7528;&#x6237;&#xFF0C;&#x8FDB;&#x5165;limits.d&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x4FEE;&#x6539;90-nproc.conf &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">vi /etc/security/limits.d/<span class="number">90</span>-nproc.conf</span><br><span class="line">&#x627E;&#x5230;&#x5982;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</span><br><span class="line">* soft nproc <span class="number">1024</span></span><br><span class="line">#&#x4FEE;&#x6539;&#x4E3A;</span><br><span class="line">* soft nproc <span class="number">2048</span></span><br></pre></td></tr></table></figure>

<h3 id="6-&#x9A8C;&#x8BC1;">1.2.7. 6. &#x9A8C;&#x8BC1;</h3><p>&#x672C;&#x5730;&#x6D4F;&#x89C8;&#x5668;&#x8F93;&#x5165;&#x670D;&#x52A1;&#x5668;ip:9200<img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1569392602300-0bac27b7-7757-47c5-bf24-489462ab9d86.png#align=left&amp;display=inline&amp;height=367&amp;name=image.png&amp;originHeight=734&amp;originWidth=1116&amp;search=&amp;size=126484&amp;status=done&amp;width=558" alt="image.png"></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux安装</tag>
      </tags>
  </entry>
  <entry>
    <title>并发1:JVM</title>
    <url>/2019/JVM/</url>
    <content><![CDATA[<h1 id="JVM">1. JVM</h1><p><a href="https://segmentfault.com/a/1190000014395186?utm_source=tag-newest#articleHeader0" target="_blank" rel="noopener">&#x8F6C;&#x8F7D;&#x81EA;</a></p>
<h2 id="Java&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;">1.1. Java&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;</h2><blockquote>
<p>Java&#x865A;&#x62DF;&#x673A;&#x5728;&#x6267;&#x884C;Java&#x7A0B;&#x5E8F;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x5C06;&#x5176;&#x7BA1;&#x7406;&#x7684;&#x5185;&#x5B58;&#x5212;&#x5206;&#x4E3A;&#x82E5;&#x5E72;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x533A;&#x57DF;&#xFF0C;&#x8FD9;&#x4E9B;&#x533A;&#x57DF;&#x6709;&#x5404;&#x81EA;&#x7684;&#x7528;&#x9014;&#x3001;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x6709;&#x4E9B;&#x533A;&#x57DF;&#x968F;&#x865A;&#x62DF;&#x673A;&#x8FDB;&#x7A0B;&#x7684;&#x542F;&#x52A8;&#x800C;&#x5B58;&#x5728;&#xFF0C;&#x6709;&#x4E9B;&#x533A;&#x57DF;&#x5219;&#x662F;&#x4F9D;&#x8D56;&#x7528;&#x6237;&#x7EBF;&#x7A0B;&#x7684;&#x542F;&#x52A8;&#x548C;&#x7ED3;&#x675F;&#x6765;&#x5EFA;&#x7ACB;&#x548C;&#x9500;&#x6BC1;&#x3002;Java&#x865A;&#x62DF;&#x673A;&#x6240;&#x7BA1;&#x7406;&#x7684;&#x5185;&#x5B58;&#x5305;&#x62EC;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;&#x57DF;&#xFF0C;&#x5982;&#x56FE;&#xFF1A;</p>
</blockquote>
<a id="more"></a>

<p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1565622823732-7478c163-a1a3-4dfe-8df1-f49fdd86d4f3.png#align=left&amp;display=inline&amp;height=423&amp;name=image.png&amp;originHeight=423&amp;originWidth=536&amp;size=96974&amp;status=done&amp;width=536" alt="image.png"></p>
<ol>
<li><p>&#x7A0B;&#x5E8F;&#x8BA1;&#x6570;&#x5668;&#xFF1A;&#x6307;&#x5411;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;&#x5B57;&#x8282;&#x7801;&#x6307;&#x4EE4;&#x3002;&#x7EBF;&#x7A0B;&#x79C1;&#x6709;&#x7684;&#x3002;</p>
</li>
<li><p>&#x865A;&#x62DF;&#x673A;&#x6808;&#xFF1A;&#x865A;&#x62DF;&#x673A;&#x6808;&#x662F;Java&#x6267;&#x884C;&#x65B9;&#x6CD5;&#x7684;&#x5185;&#x5B58;&#x6A21;&#x578B;&#x3002;&#x6BCF;&#x4E2A;&#x65B9;&#x6CD5;&#x88AB;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6808;&#x5E27;&#xFF0C;&#x628A;&#x6808;&#x5E27;&#x538B;&#x4EBA;&#x6808;&#xFF0C;&#x5F53;&#x65B9;&#x6CD5;&#x6B63;&#x5E38;&#x8FD4;&#x56DE;&#x6216;&#x8005;&#x629B;&#x51FA;&#x672A;&#x6355;&#x83B7;&#x7684;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;&#x6808;&#x5E27;&#x5C31;&#x4F1A;&#x51FA;&#x6808;&#x3002;</p>
<ol>
<li>&#x6808;&#x5E27;&#xFF1A;&#x6808;&#x5E27;&#x5B58;&#x50A8;&#x65B9;&#x6CD5;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x542B;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x6570;&#x8868;&#x3001;&#x8FD4;&#x56DE;&#x503C;&#x3001;&#x64CD;&#x4F5C;&#x6570;&#x6808;&#x3001;&#x52A8;&#x6001;&#x94FE;&#x63A5;<ol>
<li>&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x8868;&#xFF1A;&#x5305;&#x542B;&#x4E86;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x53D8;&#x91CF;&#x3002;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x6570;&#x7EC4;&#x6240;&#x9700;&#x8981;&#x7684;&#x7A7A;&#x95F4;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x95F4;&#x5B8C;&#x6210;&#x5206;&#x914D;&#xFF0C;&#x5728;&#x65B9;&#x6CD5;&#x8FD0;&#x884C;&#x671F;&#x95F4;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x6570;&#x7EC4;&#x7684;&#x5927;&#x5C0F;&#x3002;</li>
<li>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;&#x5982;&#x679C;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x8BDD;&#xFF0C;&#x538B;&#x5165;&#x8C03;&#x7528;&#x8005;&#x6808;&#x5E27;&#x4E2D;&#x7684;&#x64CD;&#x4F5C;&#x6570;&#x6808;&#x4E2D;&#xFF0C;&#x5E76;&#x4E14;&#x628A;PC&#x7684;&#x503C;&#x6307;&#x5411; &#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x6307;&#x4EE4; &#x540E;&#x9762;&#x7684;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#x5730;&#x5740;&#x3002;</li>
<li>&#x64CD;&#x4F5C;&#x6570;&#x6808;&#xFF1A;&#x64CD;&#x4F5C;&#x53D8;&#x91CF;&#x7684;&#x5185;&#x5B58;&#x6A21;&#x578B;&#x3002;&#x64CD;&#x4F5C;&#x6570;&#x6808;&#x7684;&#x6700;&#x5927;&#x6DF1;&#x5EA6;&#x5728;&#x7F16;&#x8BD1;&#x7684;&#x65F6;&#x5019;&#x5DF2;&#x7ECF;&#x786E;&#x5B9A;&#xFF08;&#x5199;&#x5165;&#x65B9;&#x6CD5;&#x533A;code&#x5C5E;&#x6027;&#x7684;max_stacks&#x9879;&#x4E2D;&#xFF09;&#x3002;&#x64CD;&#x4F5C;&#x6570;&#x6808;&#x7684;&#x7684;&#x5143;&#x7D20;&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x610F;Java&#x7C7B;&#x578B;&#xFF0C;&#x5305;&#x62EC;long&#x548C;double&#xFF0C;32&#x4F4D;&#x6570;&#x636E;&#x5360;&#x7528;&#x6808;&#x7A7A;&#x95F4;&#x4E3A;1&#xFF0C;64&#x4F4D;&#x6570;&#x636E;&#x5360;&#x7528;2&#x3002;&#x65B9;&#x6CD5;&#x521A;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6808;&#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x5F53;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5404;&#x79CD;&#x5B57;&#x8282;&#x7801;&#x6307;&#x4EE4;&#x5F80;&#x6808;&#x4E2D;&#x5B58;&#x53D6;&#x6570;&#x636E;&#x3002;</li>
<li>&#x52A8;&#x6001;&#x94FE;&#x63A5;&#xFF1A;&#x6BCF;&#x4E2A;&#x6808;&#x5E27;&#x90FD;&#x6301;&#x6709;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x8BE5;&#x6808;&#x5E27;&#x6240;&#x5C5E;&#x65B9;&#x6CD5;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x6301;&#x6709;&#x8FD9;&#x4E2A;&#x5F15;&#x7528;&#x662F;&#x4E3A;&#x4E86;&#x652F;&#x6301;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x3002;</li>
</ol>
</li>
<li>&#x7EBF;&#x7A0B;&#x79C1;&#x6709;</li>
</ol>
</li>
<li><p>&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x6808;&#xFF1A;</p>
<ol>
<li>&#x8C03;&#x7528;&#x672C;&#x5730;native&#x7684;&#x5185;&#x5B58;&#x6A21;&#x578B;</li>
<li>&#x7EBF;&#x7A0B;&#x72EC;&#x4EAB;&#x3002;</li>
</ol>
</li>
<li><p>&#x65B9;&#x6CD5;&#x533A;&#xFF1A;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x5DF2;&#x88AB;&#x865A;&#x62DF;&#x673A;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x4FE1;&#x606F;&#x3001;&#x5E38;&#x91CF;&#x3001;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x3001;&#x5373;&#x65F6;&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x7B49;&#x6570;&#x636E;</p>
<ol>
<li>&#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x7684;</li>
<li>&#x8FD0;&#x884C;&#x65F6;&#x5E38;&#x91CF;&#x6C60;&#xFF1A;<blockquote>
<p>A&#x3001;&#x662F;&#x65B9;&#x6CD5;&#x533A;&#x7684;&#x4E00;&#x90E8;&#x5206;<br>B&#x3001;&#x5B58;&#x653E;&#x7F16;&#x8BD1;&#x671F;&#x751F;&#x6210;&#x7684;&#x5404;&#x79CD;&#x5B57;&#x9762;&#x91CF;&#x548C;&#x7B26;&#x53F7;&#x5F15;&#x7528;<br>C&#x3001;Class&#x6587;&#x4EF6;&#x4E2D;&#x9664;&#x4E86;&#x5B58;&#x6709;&#x7C7B;&#x7684;&#x7248;&#x672C;&#x3001;&#x5B57;&#x6BB5;&#x3001;&#x65B9;&#x6CD5;&#x3001;&#x63A5;&#x53E3;&#x7B49;&#x63CF;&#x8FF0;&#x4FE1;&#x606F;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x9879;&#x662F;&#x5E38;&#x91CF;&#x6C60;&#xFF0C;&#x5B58;&#x6709;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684; &#x7F16;&#x8BD1;&#x671F;&#x751F;&#x6210;&#x7684;&#x5404;&#x79CD;&#x5B57;&#x9762;&#x91CF;&#x548C;&#x7B26;&#x53F7;&#x5F15;&#x7528;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x5C06;&#x5728;&#x7C7B;&#x52A0;&#x8F7D;&#x540E;&#xFF0C;&#x5B58;&#x653E;&#x5230;&#x65B9;&#x6CD5;&#x533A;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x3002;</p>
</blockquote>
</li>
</ol>
</li>
<li><p>&#x5806;&#xFF08;Heap&#xFF09;&#xFF1A;Java&#x5BF9;&#x8C61;&#x5B58;&#x50A8;&#x7684;&#x5730;&#x65B9;</p>
<ol>
<li>Java&#x5806;&#x662F;&#x865A;&#x62DF;&#x673A;&#x7BA1;&#x7406;&#x7684;&#x5185;&#x5B58;&#x4E2D;&#x6700;&#x5927;&#x7684;&#x4E00;&#x5757;</li>
<li>Java&#x5806;&#x662F;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x7684;&#x533A;&#x57DF;</li>
<li>&#x5728;&#x865A;&#x62DF;&#x673A;&#x542F;&#x52A8;&#x65F6;&#x521B;&#x5EFA;</li>
<li>&#x6B64;&#x5185;&#x5B58;&#x533A;&#x57DF;&#x7684;&#x552F;&#x4E00;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x5B58;&#x653E;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#xFF0C;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x90FD;&#x5728;&#x8FD9;&#x91CC;&#x5206;&#x914D;&#x5185;&#x5B58;&#x3002;&#x5B58;&#x653E;new&#x751F;&#x6210;&#x7684;&#x5BF9;&#x8C61;&#x548C;&#x6570;&#x7EC4;</li>
<li>Java&#x5806;&#x662F;&#x5783;&#x573E;&#x6536;&#x96C6;&#x5668;&#x7BA1;&#x7406;&#x7684;&#x5185;&#x5B58;&#x533A;&#x57DF;&#xFF0C;&#x56E0;&#x6B64;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x79F0;&#x4E3A;&#x201C;GC&#x5806;&#x201D;</li>
</ol>
</li>
</ol>
<hr>
<h2 id="JMM-Java&#x5185;&#x5B58;&#x6A21;&#x578B;&#xFF1A;">1.2. JMM Java&#x5185;&#x5B58;&#x6A21;&#x578B;&#xFF1A;</h2><ol>
<li>Java&#x7684;&#x5E76;&#x53D1;&#x91C7;&#x7528;&#x201C;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x201D;&#x6A21;&#x578B;&#xFF0C;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x8BFB;&#x5199;&#x5185;&#x5B58;&#x7684;&#x516C;&#x5171;&#x72B6;&#x6001;&#x8FDB;&#x884C;&#x901A;&#x8BAF;&#x3002;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x662F;&#x4E0D;&#x80FD;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x4F20;&#x9012;&#x6570;&#x636E;&#x4EA4;&#x4E92;&#x7684;&#xFF0C;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x4EA4;&#x4E92;&#x53EA;&#x80FD;&#x901A;&#x8FC7;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x5B9E;&#x73B0;&#x3002;</li>
<li>&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x662F;&#x5B9A;&#x4E49;&#x7A0B;&#x5E8F;&#x4E2D;&#x5404;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x8BBF;&#x95EE;&#x89C4;&#x5219;&#x3002;</li>
<li>Java&#x5185;&#x5B58;&#x6A21;&#x578B;&#x89C4;&#x5B9A;&#x6240;&#x6709;&#x53D8;&#x91CF;&#x90FD;&#x5B58;&#x50A8;&#x5728;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x8FD8;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x3002;<ol>
<li>&#x7EBF;&#x7A0B;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x4FDD;&#x5B58;&#x4E86;&#x88AB;&#x8BE5;&#x7EBF;&#x7A0B;&#x4F7F;&#x7528;&#x5230;&#x7684;&#x53D8;&#x91CF;&#x7684;&#x62F7;&#x8D1D;&#xFF08;&#x4ECE;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x62F7;&#x8D1D;&#x8FC7;&#x6765;&#xFF09;&#xFF0C;&#x7EBF;&#x7A0B;&#x5BF9;&#x53D8;&#x91CF;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x90FD;&#x5FC5;&#x987B;&#x5728;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#x3002;</li>
<li>&#x4E0D;&#x540C;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x5BF9;&#x65B9;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x7EBF;&#x7A0B;&#x95F4;&#x53D8;&#x91CF;&#x503C;&#x7684;&#x4F20;&#x9012;&#x90FD;&#x8981;&#x901A;&#x8FC7;&#x4E3B;&#x5185;&#x5B58;&#x6765;&#x5B8C;&#x6210;&#x3002;</li>
<li>&#x4E3B;&#x5185;&#x5B58;&#x4E3B;&#x8981;&#x5BF9;&#x5E94;Java&#x5806;&#x4E2D;&#x5B9E;&#x4F8B;&#x6570;&#x636E;&#x90E8;&#x5206;&#x3002;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x5BF9;&#x5E94;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x6808;&#x4E2D;&#x90E8;&#x5206;&#x533A;&#x57DF;&#x3002;</li>
</ol>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1565622908799-c0f1ffa7-5841-422b-bd96-151feddfb6c8.png#align=left&amp;display=inline&amp;height=340&amp;name=image.png&amp;originHeight=340&amp;originWidth=745&amp;size=158422&amp;status=done&amp;width=745" alt="image.png"></p>
<ol start="4">
<li>Java&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x7531;&#x5185;&#x5B58;&#x6A21;&#x578B;JMM&#xFF08;Java Memory Model&#xFF09;&#x63A7;&#x5236;&#x3002;</li>
</ol>
<ul>
<li>JMM&#x51B3;&#x5B9A;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5BF9;&#x53D8;&#x91CF;&#x7684;&#x5199;&#x5165;&#x4F55;&#x65F6;&#x5BF9;&#x53E6;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x89C1;&#x3002;</li>
<li>&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x5B58;&#x50A8;&#x5728;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;</li>
<li>&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x6709;&#x4E00;&#x4E2A;&#x79C1;&#x6709;&#x7684;&#x672C;&#x5730;&#x5185;&#x5B58;&#xFF0C;&#x91CC;&#x9762;&#x5B58;&#x50A8;&#x4E86;&#x8BFB;/&#x5199;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x526F;&#x672C;&#x3002;</li>
<li>JMM&#x901A;&#x8FC7;&#x63A7;&#x5236;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x672C;&#x5730;&#x5185;&#x5B58;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#xFF0C;&#x6765;&#x4E3A;&#x7A0B;&#x5E8F;&#x5458;&#x63D0;&#x4F9B;&#x5185;&#x5B58;&#x53EF;&#x89C1;&#x6027;&#x4FDD;&#x8BC1;&#x3002;</li>
</ul>
<ol start="5">
<li>&#x53EF;&#x89C1;&#x6027;&#x3001;&#x6709;&#x5E8F;&#x6027;&#xFF1A;</li>
</ol>
<ul>
<li>&#x5F53;&#x4E00;&#x4E2A;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x5728;&#x591A;&#x4E2A;&#x672C;&#x5730;&#x5185;&#x5B58;&#x4E2D;&#x6709;&#x526F;&#x672C;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x5185;&#x5B58;&#x4FEE;&#x6539;&#x4E86;&#x8BE5;&#x53D8;&#x91CF;&#x7684;&#x526F;&#x672C;&#xFF0C;&#x5176;&#x4ED6;&#x53D8;&#x91CF;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#x770B;&#x5230;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x503C;&#xFF0C;&#x6B64;&#x4E3A;&#x53EF;&#x89C1;&#x6027;&#x3002;</li>
<li>&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x7684;&#x6709;&#x5E8F;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E3A;&#x6709;&#x5E8F;&#x6027;&#x3002;&#xFF08;&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF09;</li>
</ul>
<ol start="6">
<li>&#x5185;&#x5B58;&#x95F4;&#x4EA4;&#x4E92;&#x64CD;&#x4F5C;&#xFF1A;<ol>
<li>lock&#xFF08;&#x9501;&#x5B9A;&#xFF09;&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x4E3B;&#x5185;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x628A;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x6807;&#x8BC6;&#x4E3A;&#x4E00;&#x6761;&#x7EBF;&#x7A0B;&#x72EC;&#x5360;&#x72B6;&#x6001;&#x3002;</li>
<li>unlock&#xFF08;&#x89E3;&#x9501;&#xFF09;&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x4E3B;&#x5185;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x628A;&#x4E00;&#x4E2A;&#x5904;&#x4E8E;&#x9501;&#x5B9A;&#x72B6;&#x6001;&#x7684;&#x53D8;&#x91CF;&#x91CA;&#x653E;&#x51FA;&#x6765;&#xFF0C;&#x91CA;&#x653E;&#x540E;&#x7684;&#x53D8;&#x91CF;&#x624D;&#x53EF;&#x4EE5;&#x88AB;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x9501;&#x5B9A;&#x3002;</li>
<li>read&#xFF08;&#x8BFB;&#x53D6;&#xFF09;&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x4E3B;&#x5185;&#x5B58;&#x53D8;&#x91CF;&#xFF0C;&#x628A;&#x4E3B;&#x5185;&#x5B58;&#x7684;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x8BFB;&#x53D6;&#x5230;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x3002;</li>
<li>load&#xFF08;&#x8F7D;&#x5165;&#xFF09;&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#xFF0C;&#x628A;read&#x64CD;&#x4F5C;&#x8BFB;&#x53D6;&#x5230;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#x8F7D;&#x5165;&#x5230;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#x526F;&#x672C;&#x4E2D;</li>
<li>use&#xFF08;&#x4F7F;&#x7528;&#xFF09;&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x628A;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#x503C;&#x4F20;&#x9012;&#x7ED9;&#x4E00;&#x4E2A;&#x6267;&#x884C;&#x5F15;&#x64CE;&#x3002;</li>
<li>assign&#xFF08;&#x8D4B;&#x503C;&#xFF09;&#xFF1A;&#x4F5C;&#x7528;&#x4E8E;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#x3002;&#x628A;&#x6267;&#x884C;&#x5F15;&#x64CE;&#x63A5;&#x6536;&#x5230;&#x7684;&#x503C;&#x8D4B;&#x503C;&#x7ED9;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#x3002;</li>
<li>store&#xFF08;&#x5B58;&#x50A8;&#xFF09;&#xFF1A;&#x628A;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#x7684;&#x503C;&#x4F20;&#x9012;&#x7ED9;&#x4E3B;&#x5185;&#x5B58;</li>
<li>write&#xFF08;&#x5199;&#x5165;&#xFF09;&#xFF1A;&#x628A;store&#x64CD;&#x4F5C;&#x7684;&#x503C;&#x5165;&#x5230;&#x4E3B;&#x5185;&#x5B58;&#x7684;&#x53D8;&#x91CF;&#x4E2D;</li>
</ol>
</li>
</ol>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong></p>
<ul>
<li>&#x4E0D;&#x5141;&#x8BB8;read&#x3001;load&#x3001;store&#x3001;write&#x64CD;&#x4F5C;&#x4E4B;&#x4E00;&#x5355;&#x72EC;&#x51FA;&#x73B0;</li>
<li>&#x4E0D;&#x5141;&#x8BB8;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E22;&#x5F03;assgin&#x64CD;&#x4F5C;</li>
<li>&#x4E0D;&#x5141;&#x8BB8;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E0D;&#x7ECF;&#x8FC7;assgin&#x64CD;&#x4F5C;&#xFF0C;&#x5C31;&#x628A;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x503C;&#x540C;&#x6B65;&#x5230;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;</li>
<li>&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x53D8;&#x91CF;&#x53EA;&#x80FD;&#x5728;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x751F;&#x6210;</li>
<li>&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x53EA;&#x5141;&#x8BB8;&#x4E00;&#x6761;&#x7EBF;&#x7A0B;&#x5BF9;&#x5176;&#x8FDB;&#x884C;lock&#x64CD;&#x4F5C;&#x3002;&#x4F46;lock&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x88AB;&#x540C;&#x4E00;&#x6761;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x591A;&#x6B21;&#xFF0C;&#x53EA;&#x6709;&#x6267;&#x884C;&#x76F8;&#x540C;&#x6B21;&#x6570;&#x7684;unlock&#x64CD;&#x4F5C;&#xFF0C;&#x53D8;&#x91CF;&#x624D;&#x4F1A;&#x89E3;&#x9501;</li>
<li>&#x5982;&#x679C;&#x5BF9;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x8FDB;&#x884C;lock&#x64CD;&#x4F5C;&#xFF0C;&#x5C06;&#x4F1A;&#x6E05;&#x7A7A;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x6B64;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x5728;&#x6267;&#x884C;&#x5F15;&#x64CE;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x524D;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x6267;&#x884C;load&#x6216;&#x8005;assgin&#x64CD;&#x4F5C;&#x521D;&#x59CB;&#x5316;&#x53D8;&#x91CF;&#x7684;&#x503C;&#x3002;</li>
<li>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x6CA1;&#x6709;&#x88AB;&#x9501;&#x5B9A;&#xFF0C;&#x4E0D;&#x5141;&#x8BB8;&#x5BF9;&#x5176;&#x6267;&#x884C;unlock&#x64CD;&#x4F5C;&#xFF0C;&#x4E5F;&#x4E0D;&#x5141;&#x8BB8;unlock&#x4E00;&#x4E2A;&#x88AB;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x9501;&#x5B9A;&#x7684;&#x53D8;&#x91CF;</li>
<li>&#x5BF9;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x6267;&#x884C;unlock&#x64CD;&#x4F5C;&#x4E4B;&#x524D;&#xFF0C;&#x9700;&#x8981;&#x5C06;&#x8BE5;&#x53D8;&#x91CF;&#x540C;&#x6B65;&#x56DE;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;</li>
</ul>
<hr>
<h2 id="&#x5806;&#x7684;&#x5185;&#x5B58;&#x5212;&#x5206;&#xFF1A;">1.3. &#x5806;&#x7684;&#x5185;&#x5B58;&#x5212;&#x5206;&#xFF1A;</h2><p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1565622945913-0f20f3fa-3c53-4d59-b196-79de1dccc3bb.png#align=left&amp;display=inline&amp;height=253&amp;name=image.png&amp;originHeight=253&amp;originWidth=698&amp;size=54225&amp;status=done&amp;width=698" alt="image.png"><br>  Java&#x5806;&#x7684;&#x5185;&#x5B58;&#x5212;&#x5206;&#x5982;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#x5E74;&#x8F7B;&#x4EE3;&#x3001;Old Memory&#xFF08;&#x8001;&#x5E74;&#x4EE3;&#xFF09;&#x3001;Perm&#xFF08;&#x6C38;&#x4E45;&#x4EE3;&#xFF09;&#x3002;&#x5176;&#x4E2D;&#x5728;Jdk1.8&#x4E2D;&#xFF0C;&#x6C38;&#x4E45;&#x4EE3;&#x88AB;&#x79FB;&#x9664;&#xFF0C;&#x4F7F;&#x7528;MetaSpace&#x4EE3;&#x66FF;&#x3002;</p>
<ol>
<li>&#x65B0;&#x751F;&#x4EE3;&#xFF1A;<ol>
<li>&#x4F7F;&#x7528;&#x590D;&#x5236;&#x6E05;&#x9664;&#x7B97;&#x6CD5;&#xFF08;Copinng&#x7B97;&#x6CD5;&#xFF09;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x5E74;&#x8F7B;&#x4EE3;&#x6BCF;&#x6B21;GC&#x90FD;&#x8981;&#x56DE;&#x6536;&#x5927;&#x90E8;&#x5206;&#x5BF9;&#x8C61;&#x3002;&#x65B0;&#x751F;&#x4EE3;&#x91CC;&#x9762;&#x5206;&#x6210;&#x4E00;&#x4EFD;&#x8F83;&#x5927;&#x7684;Eden&#x7A7A;&#x95F4;&#x548C;&#x4E24;&#x4EFD;&#x8F83;&#x5C0F;&#x7684;Survivor&#x7A7A;&#x95F4;&#x3002;&#x6BCF;&#x6B21;&#x53EA;&#x4F7F;&#x7528;Eden&#x548C;&#x5176;&#x4E2D;&#x4E00;&#x5757;Survivor&#x7A7A;&#x95F4;&#xFF0C;&#x7136;&#x540E;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x628A;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#x653E;&#x5230;&#x672A;&#x4F7F;&#x7528;&#x7684;Survivor&#xFF08;&#x5212;&#x5206;&#x51FA;from&#x3001;to&#xFF09;&#x7A7A;&#x95F4;&#x4E2D;&#xFF0C;&#x6E05;&#x7A7A;Eden&#x548C;&#x521A;&#x624D;&#x4F7F;&#x7528;&#x8FC7;&#x7684;Survivor&#x7A7A;&#x95F4;&#x3002;</li>
<li>&#x5206;&#x4E3A;Eden&#x3001;Survivor From&#x3001;Survivor To&#xFF0C;&#x6BD4;&#x4F8B;&#x9ED8;&#x8BA4;&#x4E3A;8&#xFF1A;1&#xFF1A;1</li>
<li>&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x65F6;&#x53D1;&#x751F;Minor GC</li>
</ol>
</li>
<li>&#x8001;&#x5E74;&#x4EE3;&#xFF1A;<ol>
<li>&#x91C7;&#x7528;&#x6807;&#x8BB0;-&#x6574;&#x7406;&#x7B97;&#x6CD5;&#xFF08;mark-compact&#xFF09;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x8001;&#x5E74;&#x4EE3;&#x6BCF;&#x6B21;GC&#x53EA;&#x4F1A;&#x56DE;&#x6536;&#x5C11;&#x90E8;&#x5206;&#x5BF9;&#x8C61;&#x3002;</li>
</ol>
</li>
<li>Perm&#xFF1A;&#x7528;&#x6765;&#x5B58;&#x50A8;&#x7C7B;&#x7684;&#x5143;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x65B9;&#x6CD5;&#x533A;&#x3002;<ol>
<li>Perm&#x7684;&#x5E9F;&#x9664;&#xFF1A;&#x5728;jdk1.8&#x4E2D;&#xFF0C;Perm&#x88AB;&#x66FF;&#x6362;&#x6210;MetaSpace&#xFF0C;MetaSpace&#x5B58;&#x653E;&#x5728;&#x672C;&#x5730;&#x5185;&#x5B58;&#x4E2D;&#x3002;&#x539F;&#x56E0;&#x662F;&#x6C38;&#x4E45;&#x4EE3;&#x8FDB;&#x573A;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#x7528;&#xFF0C;&#x6216;&#x8005;&#x53D1;&#x751F;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x3002;</li>
<li>MetaSpace&#xFF08;&#x5143;&#x7A7A;&#x95F4;&#xFF09;&#xFF1A;&#x5143;&#x7A7A;&#x95F4;&#x7684;&#x672C;&#x8D28;&#x548C;&#x6C38;&#x4E45;&#x4EE3;&#x7C7B;&#x4F3C;&#xFF0C;&#x90FD;&#x662F;&#x5BF9;JVM&#x89C4;&#x8303;&#x4E2D;&#x65B9;&#x6CD5;&#x533A;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x4E0D;&#x8FC7;&#x5143;&#x7A7A;&#x95F4;&#x4E0E;&#x6C38;&#x4E45;&#x4EE3;&#x4E4B;&#x95F4;&#x6700;&#x5927;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#xFF1A;&#x5143;&#x7A7A;&#x95F4;&#x5E76;&#x4E0D;&#x5728;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#xFF0C;&#x800C;&#x662F;&#x4F7F;&#x7528;&#x672C;&#x5730;&#x5185;&#x5B58;&#x3002;</li>
</ol>
</li>
<li>&#x5806;&#x5185;&#x5B58;&#x7684;&#x5212;&#x5206;&#x5728;JVM&#x91CC;&#x9762;&#x7684;&#x793A;&#x610F;&#x56FE;&#xFF1A;</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1565622972836-f2dce602-b1ea-4fec-83d2-1a800c4f7926.png#align=left&amp;display=inline&amp;height=477&amp;name=image.png&amp;originHeight=477&amp;originWidth=818&amp;size=140755&amp;status=done&amp;width=818" alt="image.png"></p>
<hr>
<h2 id="GC&#x5783;&#x573E;&#x56DE;&#x6536;&#xFF1A;">1.4. GC&#x5783;&#x573E;&#x56DE;&#x6536;&#xFF1A;</h2><h3 id="&#x5224;&#x65AD;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x8981;&#x56DE;&#x6536;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;&#x53EF;&#x8FBE;&#x6027;&#x5206;&#x6790;&#x6CD5;">1.4.1. &#x5224;&#x65AD;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x8981;&#x56DE;&#x6536;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;&#x53EF;&#x8FBE;&#x6027;&#x5206;&#x6790;&#x6CD5;</h3><ol>
<li>&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x201C;GC Roots&#x201D;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x8D77;&#x70B9;&#x8FDB;&#x884C;&#x641C;&#x7D22;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x201C;GC Roots&#x201D;&#x548C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x53EF;&#x8FBE;&#x8DEF;&#x5F84;&#xFF0C;&#x5219;&#x79F0;&#x8BE5;&#x5BF9;&#x8C61;&#x662F;&#x4E0D;&#x53EF;&#x8FBE;&#x7684;&#x3002;&#x4E0D;&#x53EF;&#x8FBE;&#x5BF9;&#x8C61;&#x4E0D;&#x4E00;&#x5B9A;&#x4F1A;&#x6210;&#x4E3A;&#x53EF;&#x56DE;&#x6536;&#x5BF9;&#x8C61;&#x3002;&#x8FDB;&#x5165;DEAD&#x72B6;&#x6001;&#x7684;&#x7EBF;&#x7A0B;&#x8FD8;&#x53EF;&#x4EE5;&#x6062;&#x590D;&#xFF0C;GC&#x4E0D;&#x4F1A;&#x56DE;&#x6536;&#x5B83;&#x7684;&#x5185;&#x5B58;&#x3002;&#xFF08;&#x628A;&#x4E00;&#x4E9B;&#x5BF9;&#x8C61;&#x5F53;&#x505A;root&#x5BF9;&#x8C61;&#xFF0C;JVM&#x8BA4;&#x4E3A;root&#x5BF9;&#x8C61;&#x662F;&#x4E0D;&#x53EF;&#x56DE;&#x6536;&#x7684;&#xFF0C;&#x5E76;&#x4E14;root&#x5BF9;&#x8C61;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x4E5F;&#x662F;&#x4E0D;&#x53EF;&#x56DE;&#x6536;&#x7684;&#xFF09;</li>
<li>&#x4EE5;&#x4E0B;&#x5BF9;&#x8C61;&#x4F1A;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;root&#x5BF9;&#x8C61;&#xFF1A;<ol>
<li>&#x865A;&#x62DF;&#x673A;&#x6808;&#xFF08;&#x6808;&#x5E27;&#x4E2D;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x8868;&#xFF09;&#x4E2D;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;</li>
<li>&#x65B9;&#x6CD5;&#x533A;&#x4E2D;&#x9759;&#x6001;&#x5C5E;&#x6027;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;</li>
<li>&#x65B9;&#x6CD5;&#x533A;&#x4E2D;&#x5E38;&#x91CF;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;</li>
<li>&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x6808;&#x4E2D;Native&#x65B9;&#x6CD5;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;</li>
</ol>
</li>
<li>&#x5BF9;&#x8C61;&#x88AB;&#x5224;&#x5B9A;&#x53EF;&#x88AB;&#x56DE;&#x6536;&#xFF0C;&#x9700;&#x8981;&#x7ECF;&#x5386;&#x4E24;&#x4E2A;&#x9636;&#x6BB5;&#xFF1A;<ol>
<li>&#x7B2C;&#x4E00;&#x4E2A;&#x9636;&#x6BB5;&#x662F;&#x53EF;&#x8FBE;&#x6027;&#x5206;&#x6790;&#xFF0C;&#x5206;&#x6790;&#x8BE5;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x53EF;&#x8FBE;</li>
<li>&#x7B2C;&#x4E8C;&#x4E2A;&#x9636;&#x6BB5;&#x662F;&#x5F53;&#x5BF9;&#x8C61;&#x6CA1;&#x6709;&#x91CD;&#x5199;finalize()&#x65B9;&#x6CD5;&#x6216;&#x8005;finalize()&#x65B9;&#x6CD5;&#x5DF2;&#x7ECF;&#x88AB;&#x8C03;&#x7528;&#x8FC7;&#xFF0C;&#x865A;&#x62DF;&#x673A;&#x8BA4;&#x4E3A;&#x8BE5;&#x5BF9;&#x8C61;&#x4E0D;&#x53EF;&#x4EE5;&#x88AB;&#x6551;&#x6D3B;&#xFF0C;&#x56E0;&#x6B64;&#x56DE;&#x6536;&#x8BE5;&#x5BF9;&#x8C61;&#x3002;&#xFF08;finalize()&#x65B9;&#x6CD5;&#x5728;&#x5783;&#x573E;&#x56DE;&#x6536;&#x4E2D;&#x7684;&#x4F5C;&#x7528;&#x662F;&#xFF0C;&#x7ED9;&#x8BE5;&#x5BF9;&#x8C61;&#x4E00;&#x6B21;&#x6551;&#x6D3B;&#x7684;&#x673A;&#x4F1A;&#xFF09;</li>
</ol>
</li>
<li>&#x65B9;&#x6CD5;&#x533A;&#x4E2D;&#x7684;&#x5783;&#x573E;&#x56DE;&#x6536;&#xFF1A;</li>
<li>&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x4E00;&#x4E9B;&#x5E38;&#x91CF;&#x3001;&#x7B26;&#x53F7;&#x5F15;&#x7528;&#x6CA1;&#x6709;&#x88AB;&#x5F15;&#x7528;&#xFF0C;&#x5219;&#x4F1A;&#x88AB;&#x6E05;&#x7406;&#x51FA;&#x5E38;&#x91CF;&#x6C60;</li>
<li>&#x65E0;&#x7528;&#x7684;&#x7C7B;&#xFF1A;&#x88AB;&#x5224;&#x5B9A;&#x4E3A;&#x65E0;&#x7528;&#x7684;&#x7C7B;&#xFF0C;&#x4F1A;&#x88AB;&#x6E05;&#x7406;&#x51FA;&#x65B9;&#x6CD5;&#x533A;&#x3002;&#x5224;&#x5B9A;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;<ul>
<li>&#x8BE5;&#x7C7B;&#x7684;&#x6240;&#x6709;&#x5B9E;&#x4F8B;&#x88AB;&#x56DE;&#x6536;</li>
<li>&#x52A0;&#x8F7D;&#x8BE5;&#x7C7B;&#x7684;ClassLoader&#x88AB;&#x56DE;&#x6536;</li>
<li>&#x8BE5;&#x7C7B;&#x7684;Class&#x5BF9;&#x8C61;&#x6CA1;&#x6709;&#x88AB;&#x5F15;&#x7528;</li>
</ul>
</li>
<li>finalize():<ul>
<li>GC&#x5783;&#x573E;&#x56DE;&#x6536;&#x8981;&#x56DE;&#x6536;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8C03;&#x7528;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;finalize()&#x65B9;&#x6CD5;&#x3002;&#x7136;&#x540E;&#x5728;&#x4E0B;&#x4E00;&#x6B21;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x624D;&#x53BB;&#x56DE;&#x6536;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x5185;&#x5B58;&#x3002;</li>
<li>&#x53EF;&#x4EE5;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x91CC;&#x9762;&#xFF0C;&#x6307;&#x5B9A;&#x4E00;&#x4E9B;&#x5BF9;&#x8C61;&#x5728;&#x91CA;&#x653E;&#x524D;&#x5FC5;&#x987B;&#x6267;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#x3002;</li>
</ul>
</li>
</ol>
<h3 id="&#x53D1;&#x73B0;&#x865A;&#x62DF;&#x673A;&#x9891;&#x7E41;full-GC&#x65F6;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x529E;&#xFF1A;">1.4.2. &#x53D1;&#x73B0;&#x865A;&#x62DF;&#x673A;&#x9891;&#x7E41;full GC&#x65F6;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x529E;&#xFF1A;</h3><p>&#xFF08;full GC&#x6307;&#x7684;&#x662F;&#x6E05;&#x7406;&#x6574;&#x4E2A;&#x5806;&#x7A7A;&#x95F4;&#xFF0C;&#x5305;&#x62EC;&#x5E74;&#x8F7B;&#x4EE3;&#x548C;&#x6C38;&#x4E45;&#x4EE3;&#xFF09;</p>
<ul>
<li>&#x9996;&#x5148;&#x7528;&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x89E6;&#x53D1;GC&#x7684;&#x539F;&#x56E0;&#x662F;&#x4EC0;&#x4E48; jstat &#x2013;gccause &#x8FDB;&#x7A0B;id</li>
<li>&#x5982;&#x679C;&#x662F;System.gc()&#xFF0C;&#x5219;&#x770B;&#x4E0B;&#x4EE3;&#x7801;&#x54EA;&#x91CC;&#x8C03;&#x7528;&#x4E86;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;</li>
<li>&#x5982;&#x679C;&#x662F;heap inspection(&#x5185;&#x5B58;&#x68C0;&#x67E5;)&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x54EA;&#x91CC;&#x6267;&#x884C;jmap &#x2013;histo[:live]&#x547D;&#x4EE4;</li>
<li>&#x5982;&#x679C;&#x662F;GC locker&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x7A0B;&#x5E8F;&#x4F9D;&#x8D56;&#x7684;JNI&#x5E93;&#x7684;&#x539F;&#x56E0;</li>
</ul>
<h3 id="&#x5E38;&#x89C1;&#x7684;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7B97;&#x6CD5;&#xFF1A;">1.4.3. &#x5E38;&#x89C1;&#x7684;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7B97;&#x6CD5;&#xFF1A;</h3><ol>
<li><p>Mark-Sweep&#xFF08;&#x6807;&#x8BB0;-&#x6E05;&#x9664;&#x7B97;&#x6CD5;&#xFF09;&#xFF1A;</p>
<ul>
<li>&#x601D;&#x60F3;&#xFF1A;&#x6807;&#x8BB0;&#x6E05;&#x9664;&#x7B97;&#x6CD5;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x9636;&#x6BB5;&#xFF0C;&#x6807;&#x8BB0;&#x9636;&#x6BB5;&#x548C;&#x6E05;&#x9664;&#x9636;&#x6BB5;&#x3002;&#x6807;&#x8BB0;&#x9636;&#x6BB5;&#x4EFB;&#x52A1;&#x662F;&#x6807;&#x8BB0;&#x51FA;&#x6240;&#x6709;&#x9700;&#x8981;&#x56DE;&#x6536;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x6E05;&#x9664;&#x9636;&#x6BB5;&#x5C31;&#x662F;&#x6E05;&#x9664;&#x88AB;&#x6807;&#x8BB0;&#x5BF9;&#x8C61;&#x7684;&#x7A7A;&#x95F4;&#x3002;</li>
<li>&#x4F18;&#x7F3A;&#x70B9;&#xFF1A;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#xFF0C;&#x5BB9;&#x6613;&#x4EA7;&#x751F;&#x5185;&#x5B58;&#x788E;&#x7247;</li>
</ul>
</li>
<li><p>Copying&#xFF08;&#x590D;&#x5236;&#x6E05;&#x9664;&#x7B97;&#x6CD5;&#xFF09;&#xFF1A;</p>
<ul>
<li>&#x601D;&#x60F3;&#xFF1A;&#x5C06;&#x53EF;&#x7528;&#x5185;&#x5B58;&#x5212;&#x5206;&#x4E3A;&#x5927;&#x5C0F;&#x76F8;&#x7B49;&#x7684;&#x4E24;&#x5757;&#xFF0C;&#x6BCF;&#x6B21;&#x53EA;&#x4F7F;&#x7528;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x5757;&#x3002;&#x5F53;&#x8FDB;&#x884C;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7684;&#x65F6;&#x5019;&#x4E86;&#xFF0C;&#x628A;&#x5176;&#x4E2D;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#x5168;&#x90E8;&#x590D;&#x5236;&#x5230;&#x53E6;&#x5916;&#x4E00;&#x5757;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5DF2;&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x4E00;&#x6B21;&#x6E05;&#x7A7A;&#x6389;&#x3002;</li>
<li>&#x4F18;&#x7F3A;&#x70B9;&#xFF1A;&#x4E0D;&#x5BB9;&#x6613;&#x4EA7;&#x751F;&#x5185;&#x5B58;&#x788E;&#x7247;&#xFF1B;&#x53EF;&#x7528;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x5C11;&#xFF1B;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#x591A;&#x7684;&#x8BDD;&#xFF0C;&#x6548;&#x7387;&#x4F4E;&#x4E0B;&#x3002;</li>
</ul>
</li>
<li><p>Mark-Compact&#xFF08;&#x6807;&#x8BB0;-&#x6574;&#x7406;&#x7B97;&#x6CD5;&#xFF09;&#xFF1A;</p>
<ul>
<li>&#x601D;&#x60F3;&#xFF1A;&#x5148;&#x6807;&#x8BB0;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#x5411;&#x4E00;&#x8FB9;&#x79FB;&#x52A8;&#xFF0C;&#x7136;&#x540E;&#x6E05;&#x7406;&#x6389;&#x7AEF;&#x8FB9;&#x754C;&#x4EE5;&#x5916;&#x7684;&#x5185;&#x5B58;&#x3002;</li>
<li>&#x4F18;&#x7F3A;&#x70B9;&#xFF1A;&#x4E0D;&#x5BB9;&#x6613;&#x4EA7;&#x751F;&#x5185;&#x5B58;&#x788E;&#x7247;&#xFF1B;&#x5185;&#x5B58;&#x5229;&#x7528;&#x7387;&#x9AD8;&#xFF1B;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#x591A;&#x5E76;&#x4E14;&#x5206;&#x6563;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x79FB;&#x52A8;&#x6B21;&#x6570;&#x591A;&#xFF0C;&#x6548;&#x7387;&#x4F4E;&#x4E0B;</li>
</ul>
</li>
<li><p>&#x5206;&#x4EE3;&#x6536;&#x96C6;&#x7B97;&#x6CD5;&#xFF1A;&#xFF08;&#x76EE;&#x524D;&#x5927;&#x90E8;&#x5206;JVM&#x7684;&#x5783;&#x573E;&#x6536;&#x96C6;&#x5668;&#x6240;&#x91C7;&#x7528;&#x7684;&#x7B97;&#x6CD5;&#xFF09;&#xFF1A;</p>
<blockquote>
<p>&#x601D;&#x60F3;&#xFF1A;&#x628A;&#x5806;&#x5206;&#x6210;&#x65B0;&#x751F;&#x4EE3;&#x548C;&#x8001;&#x5E74;&#x4EE3;&#x3002;&#xFF08;&#x6C38;&#x4E45;&#x4EE3;&#x6307;&#x7684;&#x662F;&#x65B9;&#x6CD5;&#x533A;&#xFF09;</p>
</blockquote>
<ol>
<li>&#x56E0;&#x4E3A;&#x65B0;&#x751F;&#x4EE3;&#x6BCF;&#x6B21;&#x5783;&#x573E;&#x56DE;&#x6536;&#x90FD;&#x8981;&#x56DE;&#x6536;&#x5927;&#x90E8;&#x5206;&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x65B0;&#x751F;&#x4EE3;&#x91C7;&#x7528;Copying&#x7B97;&#x6CD5;&#x3002;&#x65B0;&#x751F;&#x4EE3;&#x91CC;&#x9762;&#x5206;&#x6210;&#x4E00;&#x4EFD;&#x8F83;&#x5927;&#x7684;Eden&#x7A7A;&#x95F4;&#x548C;&#x4E24;&#x4EFD;&#x8F83;&#x5C0F;&#x7684;Survivor&#x7A7A;&#x95F4;&#x3002;&#x6BCF;&#x6B21;&#x53EA;&#x4F7F;&#x7528;Eden&#x548C;&#x5176;&#x4E2D;&#x4E00;&#x5757;Survivor&#x7A7A;&#x95F4;&#xFF0C;&#x7136;&#x540E;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x628A;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#x653E;&#x5230;&#x672A;&#x4F7F;&#x7528;&#x7684;Survivor&#xFF08;&#x5212;&#x5206;&#x51FA;from&#x3001;to&#xFF09;&#x7A7A;&#x95F4;&#x4E2D;&#xFF0C;&#x6E05;&#x7A7A;Eden&#x548C;&#x521A;&#x624D;&#x4F7F;&#x7528;&#x8FC7;&#x7684;Survivor&#x7A7A;&#x95F4;&#x3002;</li>
<li>&#x7531;&#x4E8E;&#x8001;&#x5E74;&#x4EE3;&#x6BCF;&#x6B21;&#x53EA;&#x56DE;&#x6536;&#x5C11;&#x91CF;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x6B64;&#x91C7;&#x7528;mark-compact&#x7B97;&#x6CD5;&#x3002;</li>
<li>&#x5728;&#x5806;&#x533A;&#x5916;&#x6709;&#x4E00;&#x4E2A;&#x6C38;&#x4E45;&#x4EE3;&#x3002;&#x5BF9;&#x6C38;&#x4E45;&#x4EE3;&#x7684;&#x56DE;&#x6536;&#x4E3B;&#x8981;&#x662F;&#x65E0;&#x6548;&#x7684;&#x7C7B;&#x548C;&#x5E38;&#x91CF;</li>
</ol>
</li>
<li><p>GC&#x4F7F;&#x7528;&#x65F6;&#x5BF9;&#x7A0B;&#x5E8F;&#x7684;&#x5F71;&#x54CD;&#xFF1F; </p>
</li>
</ol>
<p>&#x5783;&#x573E;&#x56DE;&#x6536;&#x4F1A;&#x5F71;&#x54CD;&#x7A0B;&#x5E8F;&#x7684;&#x6027;&#x80FD;&#xFF0C;Java&#x865A;&#x62DF;&#x673A;&#x5FC5;&#x987B;&#x8981;&#x8FFD;&#x8E2A;&#x8FD0;&#x884C;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x6709;&#x7528;&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x91CA;&#x653E;&#x6CA1;&#x7528;&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x6D88;&#x8017;&#x5904;&#x7406;&#x5668;&#x65F6;&#x95F4;</p>
<ol start="6">
<li>&#x51E0;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7C7B;&#x578B;&#xFF1A;</li>
</ol>
<ul>
<li><p>Minor GC&#xFF1A;&#x4ECE;&#x5E74;&#x8F7B;&#x4EE3;&#xFF08;&#x5305;&#x62EC;Eden&#x3001;Survivor&#x533A;&#xFF09;&#x56DE;&#x6536;&#x5185;&#x5B58;&#x3002;</p>
<blockquote>
<p>A&#x3001;&#x5F53;JVM&#x65E0;&#x6CD5;&#x4E3A;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5BF9;&#x8C61;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8D8A;&#x5BB9;&#x6613;&#x89E6;&#x53D1;Minor GC&#x3002;&#x6240;&#x4EE5;&#x5206;&#x914D;&#x7387;&#x8D8A;&#x9AD8;&#xFF0C;&#x5185;&#x5B58;&#x8D8A;&#x6765;&#x8D8A;&#x5C11;&#xFF0C;&#x8D8A;&#x9891;&#x7E41;&#x6267;&#x884C;Minor GC<br>B&#x3001;&#x6267;&#x884C;Minor GC&#x64CD;&#x4F5C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x6C38;&#x4E45;&#x4EE3;&#xFF08;Tenured&#xFF09;&#x3002;&#x4ECE;&#x6C38;&#x4E45;&#x4EE3;&#x5230;&#x5E74;&#x8F7B;&#x4EE3;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x88AB;&#x5F53;&#x6210;GC Roots&#xFF0C;&#x4ECE;&#x5E74;&#x8F7B;&#x4EE3;&#x5230;&#x8001;&#x5E74;&#x4EE3;&#x7684;&#x5F15;&#x7528;&#x5728;&#x6807;&#x8BB0;&#x9636;&#x6BB5;&#x76F4;&#x63A5;&#x88AB;&#x5FFD;&#x7565;&#x6389;&#x3002;</p>
</blockquote>
</li>
<li><p>Major GC&#xFF1A;&#x6E05;&#x7406;&#x6574;&#x4E2A;&#x8001;&#x5E74;&#x4EE3;&#xFF0C;&#x5F53;eden&#x533A;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x65F6;&#x89E6;&#x53D1;&#x3002;</p>
</li>
<li><p>Full GC&#xFF1A;&#x6E05;&#x7406;&#x6574;&#x4E2A;&#x5806;&#x7A7A;&#x95F4;&#xFF0C;&#x5305;&#x62EC;&#x5E74;&#x8F7B;&#x4EE3;&#x548C;&#x8001;&#x5E74;&#x4EE3;&#x3002;&#x5F53;&#x8001;&#x5E74;&#x4EE3;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x65F6;&#x89E6;&#x53D1;</p>
</li>
</ul>
]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
  </entry>
  <entry>
    <title>堆栈和队列互相模拟</title>
    <url>/2019/stack-22-qeue/</url>
    <content><![CDATA[<h1 id="&#x7B97;&#x6CD5;&#x5165;&#x95E8;1-&#x5806;&#x6808;&#x548C;&#x961F;&#x5217;&#x4E92;&#x76F8;&#x6A21;&#x62DF;">1. &#x7B97;&#x6CD5;&#x5165;&#x95E8;1:&#x5806;&#x6808;&#x548C;&#x961F;&#x5217;&#x4E92;&#x76F8;&#x6A21;&#x62DF;</h1><h2 id="&#x5806;&#x6808;&#x6A21;&#x62DF;&#x961F;&#x5217;">1.1. &#x5806;&#x6808;&#x6A21;&#x62DF;&#x961F;&#x5217;</h2><p>&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x5806;&#x6808;, &#x4E00;&#x4E2A;&#x8D1F;&#x8D23;&#x8F93;&#x5165;, &#x53E6;&#x4E00;&#x4E2A;&#x8D1F;&#x8D23;&#x8F93;&#x51FA;</p>
<ol>
<li>&#x5C06;&#x6570;&#x636E;push&#x5230;&#x8F93;&#x5165;&#x961F;&#x5217;a&#x4E2D;</li>
<li>&#x5C06;a&#x4E2D;&#x6570;&#x636E;pop&#x5230;&#x8F93;&#x51FA;&#x961F;&#x5217;b&#x4E2D;</li>
<li>pop&#x51FA;b&#x4E2D;&#x6570;&#x636E;</li>
</ol>
<a id="more"></a>

<p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1564449482087-9ea072e2-df27-462f-a559-2b5da15b194d.png#align=left&amp;display=inline&amp;height=182&amp;name=image.png&amp;originHeight=364&amp;originWidth=562&amp;size=33540&amp;status=done&amp;width=281" alt="image.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stackToQueue</span><span class="params">(Stack&lt;Integer&gt; inPut)</span></span>{</span><br><span class="line">    Stack&lt;Integer&gt; outPut = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (!inPut.isEmpty()){</span><br><span class="line">        outPut.push(inPut.pop());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!outPut.isEmpty()){</span><br><span class="line">        System.out.println(outPut.pop());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    Stack&lt;Integer&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    stack.push(<span class="number">1</span>);</span><br><span class="line">    stack.push(<span class="number">2</span>);</span><br><span class="line">    stack.push(<span class="number">3</span>);</span><br><span class="line">    stack.push(<span class="number">4</span>);</span><br><span class="line">    stack.push(<span class="number">5</span>);</span><br><span class="line">    stackToQueue(stack);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x961F;&#x5217;&#x6A21;&#x62DF;&#x5806;&#x6808;">1.2. &#x961F;&#x5217;&#x6A21;&#x62DF;&#x5806;&#x6808;</h2><p>&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5806;&#x6808;&#x4F5C;&#x4E3A;&#x8F85;&#x52A9;&#x5217;</p>
<ol>
<li>&#x5C06;&#x6570;&#x636E;push&#x5230;&#x4E3B;&#x961F;&#x5217;a&#x4E2D;</li>
<li>&#x5C06;a&#x4E2D;&#x6570;&#x636E;&#x6DFB;&#x52A0;&#x5230;b&#x4E2D;&#x4FDD;&#x7559;&#x6700;&#x540E;&#x4E00;&#x4F4D;,&#x8F93;&#x51FA;4,&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x5C31;&#x7B49;&#x4E8E;&#x4E00;&#x6B21;pop</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1564450301204-cb563c97-cd87-4e01-ae69-e281115b37ad.png#align=left&amp;display=inline&amp;height=167&amp;name=image.png&amp;originHeight=334&amp;originWidth=420&amp;size=30006&amp;status=done&amp;width=210" alt="image.png"></p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> static <span class="type">void</span> main(String[] args) {</span><br><span class="line">    Queue&lt;<span class="type">Integer</span>&gt; master = <span class="built_in">new</span> LinkedList&lt;<span class="type">Integer</span>&gt;();</span><br><span class="line">    master.<span class="keyword">add</span>(<span class="number">1</span>);</span><br><span class="line">    master.<span class="keyword">add</span>(<span class="number">2</span>);</span><br><span class="line">    master.<span class="keyword">add</span>(<span class="number">3</span>);</span><br><span class="line">    master.<span class="keyword">add</span>(<span class="number">4</span>);</span><br><span class="line">    master.<span class="keyword">add</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    popAll(master);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">private static <span class="type">void</span> popAll(Queue&lt;<span class="type">Integer</span>&gt; master) {</span><br><span class="line">    Queue&lt;<span class="type">Integer</span>&gt; help = <span class="built_in">new</span> LinkedList&lt;<span class="type">Integer</span>&gt;();</span><br><span class="line">    <span class="keyword">while</span> (master.size() &gt; <span class="number">1</span>) {</span><br><span class="line">        help.<span class="keyword">add</span>(master.poll());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println(master.poll());</span><br><span class="line">    <span class="keyword">if</span> (!help.isEmpty()){</span><br><span class="line">        popAll(help);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>BeanDefinition加载、解析、处理、注册</title>
    <url>/2019/BeanDefinition/</url>
    <content><![CDATA[<h1 id="BeanDefinition&#x52A0;&#x8F7D;&#x3001;&#x89E3;&#x6790;&#x3001;&#x5904;&#x7406;&#x3001;&#x6CE8;&#x518C;">1. BeanDefinition&#x52A0;&#x8F7D;&#x3001;&#x89E3;&#x6790;&#x3001;&#x5904;&#x7406;&#x3001;&#x6CE8;&#x518C;</h1><blockquote>
<p>&#x524D;&#x8A00;: IOC&#x7684;Bean&#x4ECE;xml&#x4E2D;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#x5230;&#x6CE8;&#x518C;&#x5230;IOC&#x5BB9;&#x5668;&#x4E2D;, &#x4E4B;&#x524D;&#x53EA;&#x77E5;&#x9053;&#x5BB9;&#x5668;&#x7684;&#x52A0;&#x8F7D;&#x6D41;&#x7A0B;,&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5374;&#x4E00;&#x76F4;&#x6A21;&#x7CCA;.&#x4ECA;&#x5929;&#x6B63;&#x597D;&#x8FFD;&#x4E86;&#x6E90;&#x4EE3;&#x7801;&#x5E76;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;</p>
</blockquote>
<a id="more"></a>
<hr>
<h2 id="&#x7B80;&#x5355;&#x7684;&#x6CE8;&#x518C;&#x4EE3;&#x7801;">1.1. &#x7B80;&#x5355;&#x7684;&#x6CE8;&#x518C;&#x4EE3;&#x7801;</h2><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x83B7;&#x53D6;&#x8D44;&#x6E90;</span></span><br><span class="line">ClassPathResource resource = <span class="keyword">new</span> <span class="constructor">ClassPathResource(<span class="string">&quot;org/springframework/beans/factory/xml/test.xml&quot;</span>)</span>; <span class="comment">// &lt;1&gt;</span></span><br><span class="line"><span class="comment">// &#x83B7;&#x53D6; BeanFactory</span></span><br><span class="line">DefaultListableBeanFactory factory = <span class="keyword">new</span> <span class="constructor">DefaultListableBeanFactory()</span>;</span><br><span class="line"><span class="comment">// &#x6839;&#x636E;&#x65B0;&#x5EFA;&#x7684; BeanFactory &#x521B;&#x5EFA;&#x4E00;&#x4E2A; BeanDefinitionReader &#x5BF9;&#x8C61;&#xFF0C;&#x8BE5; Reader &#x5BF9;&#x8C61;&#x4E3A;&#x8D44;&#x6E90;&#x7684;&#x89E3;&#x6790;&#x5668;</span></span><br><span class="line">XmlBeanDefinitionReader reader = <span class="keyword">new</span> <span class="constructor">XmlBeanDefinitionReader(<span class="params">factory</span>)</span>; </span><br><span class="line"><span class="comment">// &#x88C5;&#x8F7D;&#x8D44;&#x6E90;</span></span><br><span class="line">reader.load<span class="constructor">BeanDefinitions(<span class="params">resource</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5305;&#x542B;&#x4E86;spring&#x5BF9;&#x52A0;&#x8F7D;&#x3001;&#x89E3;&#x6790;&#x3001;&#x5904;&#x7406;&#x3001;&#x6CE8;&#x518C;&#x7684;&#x5168;&#x90E8;&#x6D41;&#x7A0B;</p>
<hr>
<h2 id="reader-loadBeanDefinitions">1.2. reader.loadBeanDefinitions()</h2><p>&#x524D;&#x4E09;&#x6BB5;&#x4EE3;&#x7801;&#x662F;&#x4E00;&#x4E2A;&#x83B7;&#x53D6;&#x8D44;&#x6E90;&#x8F93;&#x5165;&#x6D41;&#x53CA;&#x51C6;&#x5907;&#x7684;&#x8FC7;&#x7A0B;, &#x4ECE;&#x88C5;&#x5728;&#x8D44;&#x6E90;&#x7684;&#x4F4D;&#x7F6E;&#x5F00;&#x59CB;</p>
<ol>
<li>&#x65B9;&#x6CD5;&#x70B9;&#x8FDB;&#x6765;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5BF9;<code>resource</code>&#x53C8;&#x4E00;&#x6B21;&#x8FDB;&#x884C;&#x4E86;&#x5305;&#x88C5;,<code>**EncodedResource**</code>&#x589E;&#x52A0;&#x4E86;&#x7F16;&#x7801;&#x683C;&#x5F0F;, &#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x4E71;&#x7801;</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1564129495442-bd377720-905a-4bf0-872f-ac0c51a0a039.png#align=left&amp;display=inline&amp;height=106&amp;name=image.png&amp;originHeight=212&amp;originWidth=1494&amp;size=46915&amp;status=done&amp;width=747" alt="image.png"></p>
<ol start="2">
<li><p>&#x8FD9;&#x6BB5;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x9A8C;&#x8BC1;&#x7136;&#x540E;&#x8C03;&#x7528;&#x4E0B;&#x4E00;&#x5C42;&#x65B9;&#x6CD5;</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="built_in">int</span> load<span class="constructor">BeanDefinitions(EncodedResource <span class="params">encodedResource</span>)</span> throws BeanDefinitionStoreException {</span><br><span class="line">	<span class="module-access"><span class="module"><span class="identifier">Assert</span>.</span></span>not<span class="constructor">Null(<span class="params">encodedResource</span>, <span class="string">&quot;EncodedResource must not be null&quot;</span>)</span>;</span><br><span class="line">	<span class="keyword">if</span> (logger.is<span class="constructor">TraceEnabled()</span>) {</span><br><span class="line">		logger.trace(<span class="string">&quot;Loading XML bean definitions from &quot;</span> + encodedResource);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">       <span class="comment">// &#x83B7;&#x53D6;&#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x8FC7;&#x7684;&#x8D44;&#x6E90;</span></span><br><span class="line">	Set&lt;EncodedResource&gt; currentResources = this.resourcesCurrentlyBeingLoaded.get<span class="literal">()</span>;</span><br><span class="line">	<span class="keyword">if</span> (currentResources<span class="operator"> == </span>null) {</span><br><span class="line">		currentResources = <span class="keyword">new</span> HashSet&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">		this.resourcesCurrentlyBeingLoaded.set(currentResources);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> (!currentResources.add(encodedResource)) { <span class="comment">// &#x5C06;&#x5F53;&#x524D;&#x8D44;&#x6E90;&#x52A0;&#x5165;&#x8BB0;&#x5F55;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x5DF2;&#x5B58;&#x5728;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span></span><br><span class="line">		throw <span class="keyword">new</span> <span class="constructor">BeanDefinitionStoreException(<span class="string">&quot;Detected cyclic loading of &quot;</span> + <span class="params">encodedResource</span> + <span class="string">&quot; - check your import definitions!&quot;</span>)</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">try</span> {</span><br><span class="line">           <span class="comment">// &#x4ECE; EncodedResource &#x83B7;&#x53D6;&#x5C01;&#x88C5;&#x7684; Resource &#xFF0C;&#x5E76;&#x4ECE; Resource &#x4E2D;&#x83B7;&#x53D6;&#x5176;&#x4E2D;&#x7684; InputStream</span></span><br><span class="line">		InputStream inputStream = encodedResource.get<span class="constructor">Resource()</span>.get<span class="constructor">InputStream()</span>;</span><br><span class="line">		<span class="keyword">try</span> {</span><br><span class="line">			InputSource inputSource = <span class="keyword">new</span> <span class="constructor">InputSource(<span class="params">inputStream</span>)</span>;</span><br><span class="line">			<span class="keyword">if</span> (encodedResource.get<span class="constructor">Encoding()</span> != null) { <span class="comment">// &#x8BBE;&#x7F6E;&#x7F16;&#x7801;</span></span><br><span class="line">				inputSource.set<span class="constructor">Encoding(<span class="params">encodedResource</span>.<span class="params">getEncoding</span>()</span>);</span><br><span class="line">			}</span><br><span class="line">               <span class="comment">// &#x6838;&#x5FC3;&#x903B;&#x8F91;&#x90E8;&#x5206;&#xFF0C;&#x6267;&#x884C;&#x52A0;&#x8F7D; BeanDefinition</span></span><br><span class="line">               &#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;</span><br><span class="line">			return <span class="keyword">do</span><span class="constructor">LoadBeanDefinitions(<span class="params">inputSource</span>, <span class="params">encodedResource</span>.<span class="params">getResource</span>()</span>);</span><br><span class="line">			&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;&#x203B;</span><br><span class="line">           } finally {</span><br><span class="line">			inputStream.close<span class="literal">()</span>;</span><br><span class="line">		}</span><br><span class="line">	} catch (IOException ex) {</span><br><span class="line">		throw <span class="keyword">new</span> <span class="constructor">BeanDefinitionStoreException(<span class="string">&quot;IOException parsing XML document from &quot;</span> + <span class="params">encodedResource</span>.<span class="params">getResource</span>()</span>, ex);</span><br><span class="line">	} finally {</span><br><span class="line">           <span class="comment">// &#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x5254;&#x9664;&#x8BE5;&#x8D44;&#x6E90;</span></span><br><span class="line">		currentResources.remove(encodedResource);</span><br><span class="line">		<span class="keyword">if</span> (currentResources.is<span class="constructor">Empty()</span>) {</span><br><span class="line">			this.resourcesCurrentlyBeingLoaded.remove<span class="literal">()</span>;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
<li><p>doLoadBeanDefinitions() &#x65B9;&#x6CD5;&#x83B7;&#x53D6;document,&#x5B9E;&#x4F8B;&#x7136;&#x540E;&#x6839;&#x636E; Document &#x5B9E;&#x4F8B;&#xFF0C;&#x6CE8;&#x518C; Bean &#x4FE1;&#x606F;</p>
</li>
<li><p>registerBeanDefinitions() &#x521B;&#x5EFA;XmlReaderContext &#x8FDB;&#x884C;&#x6CE8;&#x518C;</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="built_in">int</span> register<span class="constructor">BeanDefinitions(Document <span class="params">doc</span>, Resource <span class="params">resource</span>)</span> throws BeanDefinitionStoreException {</span><br><span class="line">    <span class="comment">// &#x521B;&#x5EFA; BeanDefinitionDocumentReader &#x5BF9;&#x8C61;</span></span><br><span class="line">	BeanDefinitionDocumentReader documentReader = create<span class="constructor">BeanDefinitionDocumentReader()</span>;</span><br><span class="line">	<span class="comment">// &#x83B7;&#x53D6;&#x5DF2;&#x6CE8;&#x518C;&#x7684; BeanDefinition &#x6570;&#x91CF;</span></span><br><span class="line">	<span class="built_in">int</span> countBefore = get<span class="constructor">Registry()</span>.get<span class="constructor">BeanDefinitionCount()</span>;</span><br><span class="line">	<span class="comment">// &#x521B;&#x5EFA; XmlReaderContext &#x5BF9;&#x8C61;</span></span><br><span class="line">	<span class="comment">// &#x6CE8;&#x518C; BeanDefinition</span></span><br><span class="line">	documentReader.register<span class="constructor">BeanDefinitions(<span class="params">doc</span>, <span class="params">createReaderContext</span>(<span class="params">resource</span>)</span>);</span><br><span class="line">	<span class="comment">// &#x8BA1;&#x7B97;&#x65B0;&#x6CE8;&#x518C;&#x7684; BeanDefinition &#x6570;&#x91CF;</span></span><br><span class="line">	return get<span class="constructor">Registry()</span>.get<span class="constructor">BeanDefinitionCount()</span> - countBefore;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
<li><p>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions</p>
</li>
</ol>
<p>&#x70B9;&#x4E86;&#x8FD9;&#x4E48;&#x4E45;&#x7EC8;&#x4E8E;&#x5230;&#x4E86;&#x771F;&#x6B63;&#x91CD;&#x8981;&#x7684;&#x5730;&#x65B9;</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x89E3;&#x6790;&#x524D;&#x5904;&#x7406;</span></span><br><span class="line">pre<span class="constructor">ProcessXml(<span class="params">root</span>)</span>;</span><br><span class="line"><span class="comment">// &#x89E3;&#x6790;</span></span><br><span class="line">parse<span class="constructor">BeanDefinitions(<span class="params">root</span>, <span class="params">this</span>.<span class="params">delegate</span>)</span>;</span><br><span class="line"><span class="comment">// &#x89E3;&#x6790;&#x540E;&#x5904;&#x7406;</span></span><br><span class="line">post<span class="constructor">ProcessXml(<span class="params">root</span>)</span>;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>parseBeanDefinitions(root, this.delegate)&#x518D;&#x6B21;&#x70B9;&#x8FDB;&#x6765;</li>
</ol>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">protected void process<span class="constructor">BeanDefinition(Element <span class="params">ele</span>, BeanDefinitionParserDelegate <span class="params">delegate</span>)</span> {</span><br><span class="line">    <span class="comment">// &#x8FDB;&#x884C; bean &#x5143;&#x7D20;&#x89E3;&#x6790;&#x3002;</span></span><br><span class="line">       <span class="comment">// &#x5982;&#x679C;&#x89E3;&#x6790;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x8FD4;&#x56DE; BeanDefinitionHolder &#x5BF9;&#x8C61;&#x3002;&#x800C; BeanDefinitionHolder &#x4E3A; name &#x548C; alias &#x7684; BeanDefinition &#x5BF9;&#x8C61;</span></span><br><span class="line">       <span class="comment">// &#x5982;&#x679C;&#x89E3;&#x6790;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x8FD4;&#x56DE; null &#x3002;</span></span><br><span class="line">	BeanDefinitionHolder bdHolder = delegate.parse<span class="constructor">BeanDefinitionElement(<span class="params">ele</span>)</span>;</span><br><span class="line">	<span class="keyword">if</span> (bdHolder != null) {</span><br><span class="line">	    <span class="comment">// &#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x6807;&#x7B7E;&#x5904;&#x7406;</span></span><br><span class="line">		bdHolder = delegate.decorate<span class="constructor">BeanDefinitionIfRequired(<span class="params">ele</span>, <span class="params">bdHolder</span>)</span>;</span><br><span class="line">		<span class="keyword">try</span> {</span><br><span class="line">		    <span class="comment">// &#x8FDB;&#x884C; BeanDefinition &#x7684;&#x6CE8;&#x518C;</span></span><br><span class="line">			<span class="comment">// Register the final decorated instance.</span></span><br><span class="line">			<span class="module-access"><span class="module"><span class="identifier">BeanDefinitionReaderUtils</span>.</span></span>register<span class="constructor">BeanDefinition(<span class="params">bdHolder</span>, <span class="params">getReaderContext</span>()</span>.get<span class="constructor">Registry()</span>);</span><br><span class="line">		} catch (BeanDefinitionStoreException ex) {</span><br><span class="line">			get<span class="constructor">ReaderContext()</span>.error(<span class="string">&quot;Failed to register bean definition with name &apos;&quot;</span> +</span><br><span class="line">					bdHolder.get<span class="constructor">BeanName()</span> + <span class="string">&quot;&apos;&quot;</span>, ele, ex);</span><br><span class="line">		}</span><br><span class="line">		<span class="comment">// &#x53D1;&#x51FA;&#x54CD;&#x5E94;&#x4E8B;&#x4EF6;&#xFF0C;&#x901A;&#x77E5;&#x76F8;&#x5173;&#x7684;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x5DF2;&#x5B8C;&#x6210;&#x8BE5; Bean &#x6807;&#x7B7E;&#x7684;&#x89E3;&#x6790;&#x3002;</span></span><br><span class="line">		<span class="comment">// Send registration event.</span></span><br><span class="line">		get<span class="constructor">ReaderContext()</span>.fire<span class="constructor">ComponentRegistered(<span class="params">new</span> BeanComponentDefinition(<span class="params">bdHolder</span>)</span>);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="beanName&#x6CE8;&#x518C;">1.3. beanName&#x6CE8;&#x518C;</h2><p>BeanDefinitionReaderUtils.registerBeanDefinition();&#x6700;&#x7EC8;&#x4F1A;<strong>&#x6CE8;&#x518C;&#x5230;</strong><br>private final Map&lt;String, BeanDefinition&gt; beanDefinitionMap = new ConcurrentHashMap&lt;&gt;(256);</p>
<h2 id="bean&#x6807;&#x7B7E;&#x6CE8;&#x518C;">1.4. bean&#x6807;&#x7B7E;&#x6CE8;&#x518C;</h2><p>getReaderContext().fireComponentRegistered(new BeanComponentDefinition(bdHolder));</p>
<h2 id="&#x603B;&#x7ED3;">1.5. &#x603B;&#x7ED3;</h2><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;spring&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x5F88;&#x591A;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;, &#x6709;&#x6548;&#x7684;&#x63D0;&#x9AD8;&#x4E86;&#x4EE3;&#x7801;&#x7684;&#x53EF;&#x7EF4;&#x62A4;&#x6027;&#x53CA;&#x53EF;&#x8BFB;&#x6027;.&#x5728;beanname&#x6CE8;&#x518C;&#x65F6;&#x8C03;&#x7528;&#x9759;&#x6001;&#x65B9;&#x6CD5;,&#x800C;&#x5728;bean&#x6807;&#x7B7E;&#x6CE8;&#x518C;&#x65F6;&#x5219;&#x4F7F;&#x7528;&#x76D1;&#x542C;&#x5668;&#x6A21;&#x5F0F;.</p>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring源码</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring 统一资源加载策略</title>
    <url>/2019/spring-tong-yi-zi-yuan-jia-zai-ce-lue/</url>
    <content><![CDATA[<h1 id="Spring-&#x7EDF;&#x4E00;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x7B56;&#x7565;">1. Spring &#x7EDF;&#x4E00;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x7B56;&#x7565;</h1><a id="more"></a>

<h2 id="Resource">1.1. Resource</h2><p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1563980926087-ca4f4275-c96f-426e-8819-302d19701bc5.png" alt="image.png"></p>
<ul>
<li>FileSystemResource &#xFF1A;&#x5BF9; <code>java.io.File</code> &#x7C7B;&#x578B;&#x8D44;&#x6E90;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x53EA;&#x8981;&#x662F;&#x8DDF; File &#x6253;&#x4EA4;&#x9053;&#x7684;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x4E0E; FileSystemResource &#x4E5F;&#x53EF;&#x4EE5;&#x6253;&#x4EA4;&#x9053;&#x3002;&#x652F;&#x6301;&#x6587;&#x4EF6;&#x548C; URL &#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x5B9E;&#x73B0; WritableResource &#x63A5;&#x53E3;&#xFF0C;&#x4E14;&#x4ECE; Spring Framework 5.0 &#x5F00;&#x59CB;&#xFF0C;FileSystemResource &#x4F7F;&#x7528; NIO2 API&#x8FDB;&#x884C;&#x8BFB;/&#x5199;&#x4EA4;&#x4E92;&#x3002;</li>
<li>ByteArrayResource &#xFF1A;&#x5BF9;&#x5B57;&#x8282;&#x6570;&#x7EC4;&#x63D0;&#x4F9B;&#x7684;&#x6570;&#x636E;&#x7684;&#x5C01;&#x88C5;&#x3002;&#x5982;&#x679C;&#x901A;&#x8FC7; InputStream &#x5F62;&#x5F0F;&#x8BBF;&#x95EE;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x8BE5;&#x5B9E;&#x73B0;&#x4F1A;&#x6839;&#x636E;&#x5B57;&#x8282;&#x6570;&#x7EC4;&#x7684;&#x6570;&#x636E;&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x76F8;&#x5E94;&#x7684; ByteArrayInputStream&#x3002;</li>
<li>UrlResource &#xFF1A;&#x5BF9; <code>java.net.URL</code>&#x7C7B;&#x578B;&#x8D44;&#x6E90;&#x7684;&#x5C01;&#x88C5;&#x3002;&#x5185;&#x90E8;&#x59D4;&#x6D3E; URL &#x8FDB;&#x884C;&#x5177;&#x4F53;&#x7684;&#x8D44;&#x6E90;&#x64CD;&#x4F5C;&#x3002;</li>
<li>ClassPathResource &#xFF1A;class path &#x7C7B;&#x578B;&#x8D44;&#x6E90;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x4F7F;&#x7528;&#x7ED9;&#x5B9A;&#x7684; ClassLoader &#x6216;&#x8005;&#x7ED9;&#x5B9A;&#x7684; Class &#x6765;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;&#x3002;</li>
<li>InputStreamResource &#xFF1A;&#x5C06;&#x7ED9;&#x5B9A;&#x7684; InputStream &#x4F5C;&#x4E3A;&#x4E00;&#x79CD;&#x8D44;&#x6E90;&#x7684; Resource &#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x3002;</li>
</ul>
<hr>
<h2 id="ResourceLoader">1.2. ResourceLoader</h2><blockquote>
<p>Resource &#x5B9A;&#x4E49;&#x4E86;&#x7EDF;&#x4E00;&#x7684;&#x8D44;&#x6E90;&#xFF0C;<strong>&#x90A3;&#x8D44;&#x6E90;&#x7684;&#x52A0;&#x8F7D;&#x5219;&#x7531; ResourceLoader &#x6765;&#x7EDF;&#x4E00;&#x5B9A;&#x4E49;</strong>&#x3002;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResourceLoader</span> </span>{</span><br><span class="line"></span><br><span class="line">    String CLASSPATH_URL_PREFIX = ResourceUtils.CLASSPATH_URL_PREFIX; <span class="comment">// CLASSPATH URL &#x524D;&#x7F00;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A;&#xFF1A;&quot;classpath:&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function">Resource <span class="title">getResource</span><span class="params">(String location)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ClassLoader <span class="title">getClassLoader</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>#getResource(String location)</code> &#x65B9;&#x6CD5;&#xFF0C;&#x6839;&#x636E;&#x6240;&#x63D0;&#x4F9B;&#x8D44;&#x6E90;&#x7684;&#x8DEF;&#x5F84; location &#x8FD4;&#x56DE; Resource &#x5B9E;&#x4F8B;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4E0D;&#x786E;&#x4FDD;&#x8BE5; Resource &#x4E00;&#x5B9A;&#x5B58;&#x5728;&#xFF0C;&#x9700;&#x8981;&#x8C03;&#x7528; <code>Resource#exist()</code> &#x65B9;&#x6CD5;&#x6765;&#x5224;&#x65AD;&#x3002;</p>
<ul>
<li>&#x8BE5;&#x65B9;&#x6CD5;&#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x6A21;&#x5F0F;&#x7684;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#xFF1A;<ul>
<li>URL&#x4F4D;&#x7F6E;&#x8D44;&#x6E90;&#xFF0C;&#x5982; <code>&quot;file:C:/test.dat&quot;</code> &#x3002;</li>
<li>ClassPath&#x4F4D;&#x7F6E;&#x8D44;&#x6E90;&#xFF0C;&#x5982; <code>&quot;classpath:test.dat</code> &#x3002;</li>
<li>&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x8D44;&#x6E90;&#xFF0C;&#x5982; <code>&quot;WEB-INF/test.dat&quot;</code> &#xFF0C;&#x6B64;&#x65F6;&#x8FD4;&#x56DE;&#x7684;Resource &#x5B9E;&#x4F8B;&#xFF0C;&#x6839;&#x636E;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x800C;&#x4E0D;&#x540C;&#x3002;</li>
</ul>
</li>
<li>&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x4E3B;&#x8981;&#x5B9E;&#x73B0;&#x662F;&#x5728;&#x5176;&#x5B50;&#x7C7B; DefaultResourceLoader</li>
</ul>
<hr>
<h3 id="DefaultResourceLoader-getResource">1.2.1. DefaultResourceLoader.getResource</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Resource <span class="title">getResource</span><span class="params">(String location)</span> </span>{</span><br><span class="line">    Assert.notNull(location, <span class="string">&quot;Location must not be null&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x9996;&#x5148;&#xFF0C;&#x901A;&#x8FC7; ProtocolResolver &#x6765;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;</span></span><br><span class="line">    <span class="keyword">for</span> (ProtocolResolver protocolResolver : <span class="keyword">this</span>.protocolResolvers) {</span><br><span class="line">        Resource resource = protocolResolver.resolve(location, <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (resource != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> resource;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x5176;&#x6B21;&#xFF0C;&#x4EE5; / &#x5F00;&#x5934;&#xFF0C;&#x8FD4;&#x56DE; ClassPathContextResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;</span></span><br><span class="line">    <span class="keyword">if</span> (location.startsWith(<span class="string">&quot;/&quot;</span>)) {</span><br><span class="line">        <span class="keyword">return</span> getResourceByPath(location);</span><br><span class="line">    <span class="comment">// &#x518D;&#x6B21;&#xFF0C;&#x4EE5; classpath: &#x5F00;&#x5934;&#xFF0C;&#x8FD4;&#x56DE; ClassPathResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;</span></span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (location.startsWith(CLASSPATH_URL_PREFIX)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ClassPathResource(location.substring(CLASSPATH_URL_PREFIX.length()), getClassLoader());</span><br><span class="line">    <span class="comment">// &#x7136;&#x540E;&#xFF0C;&#x6839;&#x636E;&#x662F;&#x5426;&#x4E3A;&#x6587;&#x4EF6; URL &#xFF0C;&#x662F;&#x5219;&#x8FD4;&#x56DE; FileUrlResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x5426;&#x5219;&#x8FD4;&#x56DE; UrlResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// Try to parse the location as a URL...</span></span><br><span class="line">            URL url = <span class="keyword">new</span> URL(location);</span><br><span class="line">            <span class="keyword">return</span> (ResourceUtils.isFileURL(url) ? <span class="keyword">new</span> FileUrlResource(url) : <span class="keyword">new</span> UrlResource(url));</span><br><span class="line">        } <span class="keyword">catch</span> (MalformedURLException ex) {</span><br><span class="line">            <span class="comment">// &#x6700;&#x540E;&#xFF0C;&#x8FD4;&#x56DE; ClassPathContextResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;</span></span><br><span class="line">            <span class="comment">// No URL -&gt; resolve as resource path.</span></span><br><span class="line">            <span class="keyword">return</span> getResourceByPath(location);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x9996;&#x5148;&#xFF0C;&#x901A;&#x8FC7; ProtocolResolver &#x6765;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;&#xFF0C;&#x6210;&#x529F;&#x8FD4;&#x56DE; Resource &#x3002;</li>
<li>&#x5176;&#x6B21;&#xFF0C;&#x82E5; <code>location</code> &#x4EE5; <code>&quot;/&quot;</code> &#x5F00;&#x5934;&#xFF0C;&#x5219;&#x8C03;&#x7528; <code>#getResourceByPath()</code> &#x65B9;&#x6CD5;&#xFF0C;&#x6784;&#x9020; ClassPathContextResource &#x7C7B;&#x578B;&#x8D44;&#x6E90;&#x5E76;&#x8FD4;&#x56DE;&#x3002;</li>
<li>&#x518D;&#x6B21;&#xFF0C;&#x82E5; <code>location</code> &#x4EE5; <code>&quot;classpath:&quot;</code> &#x5F00;&#x5934;&#xFF0C;&#x5219;&#x6784;&#x9020; ClassPathResource &#x7C7B;&#x578B;&#x8D44;&#x6E90;&#x5E76;&#x8FD4;&#x56DE;&#x3002;&#x5728;&#x6784;&#x9020;&#x8BE5;&#x8D44;&#x6E90;&#x65F6;&#xFF0C;&#x901A;&#x8FC7; <code>#getClassLoader()</code> &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7684; ClassLoader&#x3002;</li>
<li>&#x7136;&#x540E;&#xFF0C;&#x6784;&#x9020; URL &#xFF0C;&#x5C1D;&#x8BD5;&#x901A;&#x8FC7;&#x5B83;&#x8FDB;&#x884C;&#x8D44;&#x6E90;&#x5B9A;&#x4F4D;&#xFF0C;&#x82E5;&#x6CA1;&#x6709;&#x629B;&#x51FA; MalformedURLException &#x5F02;&#x5E38;&#xFF0C;&#x5219;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A; FileURL , &#x5982;&#x679C;&#x662F;&#x5219;&#x6784;&#x9020; FileUrlResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x5426;&#x5219;&#x6784;&#x9020; UrlResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;&#x3002;</li>
<li>&#x6700;&#x540E;&#xFF0C;&#x82E5;&#x5728;&#x52A0;&#x8F7D;&#x8FC7;&#x7A0B;&#x4E2D;&#x629B;&#x51FA; MalformedURLException &#x5F02;&#x5E38;&#xFF0C;&#x5219;&#x59D4;&#x6D3E; <code>#getResourceByPath()</code> &#x65B9;&#x6CD5;&#xFF0C;&#x5B9E;&#x73B0;&#x8D44;&#x6E90;&#x5B9A;&#x4F4D;&#x52A0;&#x8F7D;&#x3002;</li>
</ul>
<hr>
<h3 id="ProtocolResolver">1.2.2. ProtocolResolver</h3><p><code>org.springframework.core.io.ProtocolResolver</code> &#xFF0C;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x534F;&#x8BAE;&#x8D44;&#x6E90;&#x89E3;&#x51B3;&#x7B56;&#x7565;&#xFF0C;&#x4F5C;&#x4E3A; DefaultResourceLoader &#x7684; <strong>SPI</strong>&#xFF1A;&#x5B83;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x534F;&#x8BAE;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x7EE7;&#x627F; ResourceLoader &#x7684;&#x5B50;&#x7C7B;&#x3002;<br>&#x5982;&#x679C;&#x8981;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49; Resource&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x7EE7;&#x627F; AbstractResource &#x5373;&#x53EF;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E86; ProtocolResolver &#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x76F4;&#x63A5;&#x7EE7;&#x627F; DefaultResourceLoader&#xFF0C;&#x6539;&#x4E3A;&#x5B9E;&#x73B0; ProtocolResolver &#x63A5;&#x53E3;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x7684; ResourceLoader&#x3002;<br>&#x8C03;&#x7528;&#x65B9;&#x5F0F;:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ProtocolResolver &#x96C6;&#x5408;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;ProtocolResolver&gt; protocolResolvers = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addProtocolResolver</span><span class="params">(ProtocolResolver resolver)</span> </span>{</span><br><span class="line">    Assert.notNull(resolver, <span class="string">&quot;ProtocolResolver must not be null&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.protocolResolvers.add(resolver);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="&#x603B;&#x7ED3;">1.3. &#x603B;&#x7ED3;</h2><ol>
<li>ResourceLoader&#x548C;Resource&#x4E3B;&#x8981;&#x7528;&#x5230;&#x4E86;&#x7B56;&#x7565;&#x6A21;&#x5F0F;, ResourceLoader&#x4F9D;&#x636E;&#x4E0D;&#x540C;location&#x5F00;&#x5934;&#x6765;&#x5B9A;&#x4F4D;&#x4F7F;&#x7528;&#x54EA;&#x4E00;&#x4E2A;Resource&#x5B9E;&#x73B0;&#x7C7B;.</li>
<li>&#x5176;&#x4E2D;&#x611F;&#x89C9;&#x6700;&#x5999;&#x7684;&#x662F;&#x5728;ResourceLoader&#x4E2D;&#x6DFB;&#x52A0;&#x4E86;Set<protocolresolver>,&#x5728;&#x83B7;&#x53D6;&#x8D44;&#x6E90;&#x65F6;&#x5148;&#x8FDB;&#x884C;&#x904D;&#x5386;,&#x4ECE;&#x800C;&#x4F7F;&#x7528;&#x6237;&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x5668;&#x65F6;&#x4E0D;&#x9700;&#x8981;&#x7EE7;&#x627F;ResourceLoader&#x7684;&#x5B50;&#x7C7B;</protocolresolver></li>
<li>&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;&#x4F7F;&#x7528;set&#x96C6;&#x5408;&#x662F;&#x56E0;&#x4E3A;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;Resource&#x7B56;&#x7565;, &#x4F20;&#x5165;&#x7684;_location&#x5728;&#x96C6;&#x5408;&#x4E2D;_&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;Reource,&#x591A;&#x6B21;&#x89E3;&#x6790;location&#x4EE5;&#x83B7;&#x53D6;&#x96C6;&#x5408;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x7D22;&#x5F15;Resource</li>
</ol>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>springboot配置Druid监控</title>
    <url>/2019/springboot-pei-zhi-druid-jian-kong/</url>
    <content><![CDATA[<h1 id="springboot&#x914D;&#x7F6E;Druid&#x76D1;&#x63A7;">1. springboot&#x914D;&#x7F6E;Druid&#x76D1;&#x63A7;</h1><h2 id="&#x914D;&#x7F6E;&#x7C7B;-&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x5728;&#x7C7B;&#x4E2D;">1.1. &#x914D;&#x7F6E;&#x7C7B;(&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x5728;&#x7C7B;&#x4E2D;)</h2><a id="more"></a>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidDBConfig</span> </span>{</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">druidServlet</span><span class="params">()</span> </span>{</span><br><span class="line">        ServletRegistrationBean reg = <span class="keyword">new</span> ServletRegistrationBean();</span><br><span class="line">        reg.setServlet(<span class="keyword">new</span> StatViewServlet());</span><br><span class="line">        reg.addUrlMappings(<span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">        reg.addInitParameter(<span class="string">&quot;loginUsername&quot;</span>, <span class="string">&quot;druid&quot;</span>);</span><br><span class="line">        reg.addInitParameter(<span class="string">&quot;loginPassword&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        reg.addInitParameter(<span class="string">&quot;resetEnable&quot;</span>, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> reg;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">filterRegistrationBean</span><span class="params">()</span> </span>{</span><br><span class="line">        FilterRegistrationBean filterRegistrationBean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">        filterRegistrationBean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line">        Map&lt;String, String&gt; initParams = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        initParams.put(<span class="string">&quot;exclusions&quot;</span>, <span class="string">&quot;*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*&quot;</span>);</span><br><span class="line">        filterRegistrationBean.setInitParameters(initParams);</span><br><span class="line">        filterRegistrationBean.addUrlPatterns(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="&#x914D;&#x7F6E;&#x7C7B;-&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x5728;yml&#x6587;&#x4EF6;&#x4E2D;">1.2. &#x914D;&#x7F6E;&#x7C7B;(&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x5728;yml&#x6587;&#x4EF6;&#x4E2D;)</h2><h2 id="&#x914D;&#x7F6E;&#x7C7B;">1.3. &#x914D;&#x7F6E;&#x7C7B;</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * *&#x6CE8;&#x518C;&#x4E00;&#x4E2A;StatViewServlet</span></span><br><span class="line"><span class="comment">     * *<span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(<span class="string">&quot;datasource.druid.stat-view-servlet&quot;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">druidStatViewServle</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> StatViewServlet());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(<span class="string">&quot;datasource.druid.web-stat-filter&quot;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">druidStatFilter</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FilterRegistrationBean(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<h3 id="yml&#x6587;&#x4EF6;">1.3.1. yml&#x6587;&#x4EF6;</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dataSource:</span></span><br><span class="line"><span class="attr">druid:</span></span><br><span class="line">       <span class="attr">stat-view-servlet:</span></span><br><span class="line">           <span class="comment">#&#x662F;&#x5426;&#x542F;&#x7528;StatViewServlet&#xFF08;&#x76D1;&#x63A7;&#x9875;&#x9762;&#xFF09;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;false&#xFF08;&#x8003;&#x8651;&#x5230;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x9ED8;&#x8BA4;&#x5E76;&#x672A;&#x542F;&#x52A8;&#xFF0C;&#x5982;&#x9700;&#x542F;&#x7528;&#x5EFA;&#x8BAE;&#x8BBE;&#x7F6E;&#x5BC6;&#x7801;&#x6216;&#x767D;&#x540D;&#x5355;&#x4EE5;&#x4FDD;&#x969C;&#x5B89;&#x5168;&#xFF09;</span></span><br><span class="line">           <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">           <span class="attr">url-mappings:</span> <span class="string">&quot;/druid2/*&quot;</span></span><br><span class="line">           <span class="comment"># &#x8BE5;&#x53C2;&#x6570;&#x4E3A;map, key&#x5FC5;&#x987B;&#x4FDD;&#x6301;&#x8BE5;&#x683C;&#x5F0F;</span></span><br><span class="line">           <span class="attr">init-parameters:</span></span><br><span class="line">               <span class="attr">loginUsername:</span> <span class="string">&quot;admin&quot;</span></span><br><span class="line">               <span class="attr">loginPassword:</span> <span class="string">&quot;admin&quot;</span></span><br><span class="line">               <span class="attr">resetEnable:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">       <span class="comment"># WebStatFilter&#x914D;&#x7F6E;&#xFF0C;&#x8BF4;&#x660E;&#x8BF7;&#x53C2;&#x8003;Druid Wiki&#xFF0C;&#x914D;&#x7F6E;_&#x914D;&#x7F6E;WebStatFilter</span></span><br><span class="line">       <span class="attr">web-stat-filter:</span></span><br><span class="line">           <span class="comment">#&#x662F;&#x5426;&#x542F;&#x7528;StatFilter&#x9ED8;&#x8BA4;&#x503C;false</span></span><br><span class="line">           <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">           <span class="attr">url-patterns:</span> <span class="string">&quot;/*&quot;</span></span><br><span class="line">           <span class="comment"># &#x8BE5;&#x53C2;&#x6570;&#x4E3A;map, key&#x5FC5;&#x987B;&#x4FDD;&#x6301;&#x8BE5;&#x683C;&#x5F0F;</span></span><br><span class="line">           <span class="attr">init-parameters:</span></span><br><span class="line">               <span class="attr">exclusions:</span> <span class="string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="&#x6CE8;&#x610F;&#x4E8B;&#x9879;">1.3.2. &#x6CE8;&#x610F;&#x4E8B;&#x9879;</h3><ol>
<li><strong>init-parameters&#x5728;&#x5BF9;&#x5E94;&#x5B9E;&#x4F53;&#x7C7B;&#x4E2D;&#x662F;map</strong>,spring&#x8BFB;&#x53D6;yml&#x540E;&#x4F1A;&#x76F4;&#x63A5;&#x8FDB;&#x884C;put,&#x6240;&#x4EE5;loginUsername,loginPassword&#x7B49;<strong>&#x4E0D;&#x53EF;&#x4EE5;</strong>&#x5199;&#x6210;login-username,login-password&#x683C;&#x5F0F;</li>
<li>&#x5728;&#x8BBE;&#x7F6E;resetEnable(&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x91CD;&#x7F6E;)&#x540E;, &#x9875;&#x9762;&#x4E0A;&#x65B9;&#x7684;&#x91CD;&#x7F6E;&#x6309;&#x94AE;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;,&#x5E76;&#x8FD4;&#x56DE;&#x5DF2;&#x91CD;&#x7F6E;.&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x4E0A;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;</li>
</ol>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>item2免密ssh登录</title>
    <url>/2019/item2-mian-mi-ssh-login/</url>
    <content><![CDATA[<h2 id="&#x67E5;&#x770B;&#x9879;&#x76EE;&#x7ED3;&#x6784;-tree">0.1. &#x67E5;&#x770B;&#x9879;&#x76EE;&#x7ED3;&#x6784;,tree</h2><h2 id="1-ssh&#x643A;&#x5E26;pom&#x8FDC;&#x7A0B;&#x767B;&#x5F55;">0.2. 1. ssh&#x643A;&#x5E26;pom&#x8FDC;&#x7A0B;&#x767B;&#x5F55;</h2><h3 id="&#x65B9;&#x6CD5;1-&#x76F4;&#x63A5;&#x767B;&#x5F55;">0.2.1. &#x65B9;&#x6CD5;1: &#x76F4;&#x63A5;&#x767B;&#x5F55;</h3><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">ssh -i <span class="regexp">/Users/</span>yuyu<span class="regexp">/.ssh/</span><span class="number">123</span>/yuyu.pem yuyu<span class="meta">@ops</span>.com</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<blockquote>
<p>&#x767B;&#x5F55;&#x540E;&#x9700;&#x8981;&#x8F93;&#x5165;&#x5BC6;&#x7801;</p>
</blockquote>
<h3 id="&#x65B9;&#x6CD5;2-&#x514D;&#x5BC6;&#x767B;&#x5F55;">0.2.2. &#x65B9;&#x6CD5;2: &#x514D;&#x5BC6;&#x767B;&#x5F55;</h3><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x6DFB;&#x52A0;pom&#x5230;ssh&#x4E2D;</span></span><br><span class="line">ssh-add -k <span class="regexp">/Users/</span>yuyu<span class="regexp">/.ssh/</span><span class="number">123</span>/yuyu.pem</span><br><span class="line"><span class="comment">// &#x63D0;&#x793A;&#x8F93;&#x5165;&#x5BC6;&#x7801;, &#x6210;&#x529F;</span></span><br><span class="line"><span class="comment">// &#x4E0B;&#x4E00;&#x6B65;&#x76F4;&#x63A5;ssh&#x767B;&#x5F55;&#x5373;&#x53EF;</span></span><br><span class="line">ssh yuyu<span class="meta">@ops</span>.com</span><br></pre></td></tr></table></figure>


<h2 id="2-&#x8D26;&#x53F7;&#x5BC6;&#x7801;&#x767B;&#x5F55;">0.3. 2. &#x8D26;&#x53F7;&#x5BC6;&#x7801;&#x767B;&#x5F55;</h2><h3 id="&#x65B9;&#x6CD5;1-&#x6DFB;&#x52A0;&#x914D;&#x7F6E;&#x6587;&#x4EF6;">0.3.1. &#x65B9;&#x6CD5;1: &#x6DFB;&#x52A0;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</h3><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/Users/yuyu</span><span class="regexp">/.ssh/i</span>tem2</span><br><span class="line">vi ac_test</span><br><span class="line"><span class="regexp">//</span> &#x7F16;&#x8F91;&#x6587;&#x4EF6;, &#x5982;&#x4E0B;&#x65B9;&#x4EE3;&#x7801;&#x5757;</span><br><span class="line"><span class="regexp">//</span> &#x8BBE;&#x7F6E;&#x6743;&#x9650;</span><br><span class="line">chmod <span class="number">666</span></span><br><span class="line"><span class="regexp">//</span> &#x4E0B;&#x4E00;&#x6B65;&#x76F4;&#x63A5;ssh&#x767B;&#x5F55;&#x5373;&#x53EF;</span><br><span class="line">expect <span class="regexp">/Users/yuyu</span><span class="regexp">/.ssh/i</span>tem2<span class="regexp">/ac_test</span></span><br></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"> <span class="builtin-name">set</span><span class="built_in"> PORT </span>22</span><br><span class="line"><span class="builtin-name">set</span> HOST 10.0.0.1</span><br><span class="line"><span class="builtin-name">set</span><span class="built_in"> USER </span>dev</span><br><span class="line"><span class="builtin-name">set</span> PASSWORD 123</span><br><span class="line"></span><br><span class="line">spawn ssh -p <span class="variable">$PORT</span> <span class="variable">$USER</span>@<span class="variable">$HOST</span></span><br><span class="line">expect {</span><br><span class="line">        <span class="string">&quot;yes/no&quot;</span> {send <span class="string">&quot;yes\r&quot;</span>;exp_continue;}</span><br><span class="line">         <span class="string">&quot;*password:*&quot;</span> { send <span class="string">&quot;<span class="variable">$PASSWORD</span>\r&quot;</span> }</span><br><span class="line">        }</span><br><span class="line">interact</span><br></pre></td></tr></table></figure>


<blockquote>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x4E86; expect ,&#x8BE5;&#x547D;&#x4EE4;&#x4F7F;&#x7528;&#x540E;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;lrzsz&#x8FDB;&#x884C;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x53CA;&#x4E0B;&#x8F7D;</p>
</blockquote>
<h3 id="&#x65B9;&#x6CD5;2-&#x4F7F;&#x7528;sshpass&#x547D;&#x4EE4;">0.3.2. &#x65B9;&#x6CD5;2: &#x4F7F;&#x7528;sshpass&#x547D;&#x4EE4;</h3><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x5B89;&#x88C5;</span></span><br><span class="line">brew install <span class="string">http:</span><span class="comment">//git.io/sshpass.rb</span></span><br><span class="line"><span class="comment">// &#x67E5;&#x770B;&#x8DEF;&#x5F84;</span></span><br><span class="line">where sshpass</span><br><span class="line"></span><br><span class="line">&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x6307;&#x4EE4;&#x767B;&#x5F55;</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>sshpass -p passwrod ssh userName<span class="meta">@ip</span></span><br></pre></td></tr></table></figure>

<p>&#x53C2;&#x8003;&#x8D44;&#x6599;:<br><a href="http://www.60sky.com/index.php/archives/61/" target="_blank" rel="noopener">item2&#x514D;&#x5BC6;&#x767B;&#x5F55;ssh</a></p>
]]></content>
      <categories>
        <category>util</category>
      </categories>
      <tags>
        <tag>item2</tag>
      </tags>
  </entry>
  <entry>
    <title>索引合并</title>
    <url>/2019/suo-yin-he-bing/</url>
    <content><![CDATA[<h1 id="&#x7D22;&#x5F15;&#x5408;&#x5E76;">1. &#x7D22;&#x5F15;&#x5408;&#x5E76;</h1><p><a href="https://www.cnblogs.com/zhuifeng-mayi/p/9291503.html" target="_blank" rel="noopener">&#x8F6C;&#x8F7D;&#x81EA;</a></p>
<blockquote>
<p>The Index Merge method is used to retrieve rows with several range scans and to merge their results into one. The merge can produce unions, intersections, or unions-of-intersections of its underlying scans. This access method merges index scans from a single table; it does not merge scans across multiple tables.</p>
</blockquote>
<a id="more"></a>

<ol>
<li>&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x662F;&#x628A;&#x51E0;&#x4E2A;&#x7D22;&#x5F15;&#x7684;&#x8303;&#x56F4;&#x626B;&#x63CF;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x3002;</li>
<li>&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5BF9;&#x7D22;&#x5F15;&#x8FDB;&#x884C;&#x5E76;&#x96C6;&#xFF0C;&#x4EA4;&#x96C6;&#x6216;&#x8005;&#x5148;&#x4EA4;&#x96C6;&#x518D;&#x5E76;&#x96C6;&#x64CD;&#x4F5C;&#xFF0C;&#x4EE5;&#x4FBF;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x3002;</li>
<li>&#x8FD9;&#x4E9B;&#x9700;&#x8981;&#x5408;&#x5E76;&#x7684;&#x7D22;&#x5F15;&#x53EA;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x8868;&#x7684;&#x3002;&#x4E0D;&#x80FD;&#x5BF9;&#x591A;&#x8868;&#x8FDB;&#x884C;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x3002;</li>
</ol>
<h2 id="&#x600E;&#x4E48;&#x786E;&#x5B9A;&#x4F7F;&#x7528;&#x4E86;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#xFF1F;">1.1. &#x600E;&#x4E48;&#x786E;&#x5B9A;&#x4F7F;&#x7528;&#x4E86;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#xFF1F;</h2><p>&#x5728;&#x4F7F;&#x7528;explain&#x5BF9;sql&#x8BED;&#x53E5;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E86;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x8F93;&#x51FA;&#x5185;&#x5BB9;&#x7684;type&#x5217;&#x4F1A;&#x663E;&#x793A; index_merge&#xFF0C;key&#x5217;&#x4F1A;&#x663E;&#x793A;&#x51FA;&#x6240;&#x6709;&#x4F7F;&#x7528;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x5982;&#x4E0B;&#xFF1A;<br>&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x7684;&#x793A;&#x4F8B;</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysql&gt; show create table test\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: test</span><br><span class="line">Create Table: CREATE TABLE `test` (</span><br><span class="line">  `id` int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `key1_part1` int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span><span class="string">&apos;0&apos;</span>,</span><br><span class="line">  `key1_part2` int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span><span class="string">&apos;0&apos;</span>,</span><br><span class="line">  `key2_part1` int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span><span class="string">&apos;0&apos;</span>,</span><br><span class="line">  `key2_part2` int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span><span class="string">&apos;0&apos;</span>,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `key1` (`key1_part1`,`key1_part2`),</span><br><span class="line">  KEY `key2` (`key2_part1`,`key2_part2`)</span><br><span class="line">) <span class="attribute">ENGINE</span>=MyISAM <span class="attribute">AUTO_INCREMENT</span>=18<span class="built_in"> DEFAULT </span><span class="attribute">CHARSET</span>=utf8</span><br><span class="line">row <span class="keyword">in</span> <span class="builtin-name">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x7684;&#x6848;&#x4F8B;">1.1.1. &#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x7684;&#x6848;&#x4F8B;</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select * <span class="keyword">from</span> test where (<span class="attribute">key1_part1</span>=4 <span class="keyword">and</span> <span class="attribute">key1_part2</span>=4) <span class="keyword">or</span> <span class="attribute">key2_part1</span>=4\G</span><br><span class="line"></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line"></span><br><span class="line">           id: 1</span><br><span class="line"></span><br><span class="line">  select_type: SIMPLE</span><br><span class="line"></span><br><span class="line">        table: test</span><br><span class="line"></span><br><span class="line">         type: index_merge</span><br><span class="line"></span><br><span class="line">possible_keys: key1,key2</span><br><span class="line"></span><br><span class="line">          key: key1,key2</span><br><span class="line"></span><br><span class="line">      key_len: 8,4</span><br><span class="line"></span><br><span class="line">          ref: <span class="literal">NULL</span></span><br><span class="line"></span><br><span class="line">         rows: 3</span><br><span class="line"></span><br><span class="line">        Extra: Using sort_union(key1,key2); Using where</span><br><span class="line"></span><br><span class="line">1 row <span class="keyword">in</span> <span class="builtin-name">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="&#x672A;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x7684;&#x6848;&#x4F8B;">1.1.2. &#x672A;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x7684;&#x6848;&#x4F8B;</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select * <span class="keyword">from</span> test where (<span class="attribute">key1_part1</span>=1 <span class="keyword">and</span> <span class="attribute">key1_part2</span>=1) <span class="keyword">or</span> <span class="attribute">key2_part1</span>=4\G</span><br><span class="line"></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line"></span><br><span class="line">           id: 1</span><br><span class="line"></span><br><span class="line">  select_type: SIMPLE</span><br><span class="line"></span><br><span class="line">        table: test</span><br><span class="line"></span><br><span class="line">         type: ALL</span><br><span class="line"></span><br><span class="line">possible_keys: key1,key2</span><br><span class="line"></span><br><span class="line">          key: <span class="literal">NULL</span></span><br><span class="line"></span><br><span class="line">      key_len: <span class="literal">NULL</span></span><br><span class="line"></span><br><span class="line">          ref: <span class="literal">NULL</span></span><br><span class="line"></span><br><span class="line">         rows: 29</span><br><span class="line"></span><br><span class="line">        Extra: Using where</span><br><span class="line"></span><br><span class="line">1 row <span class="keyword">in</span> <span class="builtin-name">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4E24;&#x4E2A;&#x6848;&#x4F8B;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x76F8;&#x540C;&#x6A21;&#x5F0F;&#x7684;sql&#x8BED;&#x53E5;&#xFF0C;&#x53EF;&#x80FD;&#x6709;&#x65F6;&#x80FD;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#xFF0C;&#x6709;&#x65F6;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x3002;&#x662F;&#x5426;&#x80FD;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;mysql&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x5668;&#x5BF9;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#x5206;&#x6790;&#x540E;&#xFF0C;&#x662F;&#x5426;&#x8BA4;&#x4E3A;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x66F4;&#x5FEB;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5355;&#x7EAF;&#x7684;&#x8BA8;&#x8BBA;&#x4E00;&#x6761;sql&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x6709;&#x70B9;&#x7247;&#x9762;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x8003;&#x8651;&#x6570;&#x636E;&#x3002;</p>
<h2 id="&#x6CE8;&#x610F;&#x4E8B;&#x9879;">1.2. &#x6CE8;&#x610F;&#x4E8B;&#x9879;</h2><p>mysql5.6.7&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x9075;&#x5B88;range&#x4F18;&#x5148;&#x7684;&#x539F;&#x5219;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x7684;&#x4E00;&#x4E2A;&#x8FDE;&#x7EED;&#x6BB5;&#xFF0C;&#x5305;&#x542B;&#x6240;&#x6709;&#x7B26;&#x5408;&#x67E5;&#x8BE2;&#x8981;&#x6C42;&#x7684;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x54EA;&#x6015;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x80FD;&#x63D0;&#x4F9B;&#x6548;&#x7387;&#xFF0C;&#x4E5F;&#x4E0D;&#x518D;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select * <span class="keyword">from</span> test where (<span class="attribute">key1_part1</span>=1 <span class="keyword">and</span> <span class="attribute">key1_part2</span>=1) <span class="keyword">and</span> <span class="attribute">key2_part1</span>=1\G</span><br><span class="line"></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line"></span><br><span class="line">           id: 1</span><br><span class="line"></span><br><span class="line">  select_type: SIMPLE</span><br><span class="line"></span><br><span class="line">        table: test</span><br><span class="line"></span><br><span class="line">         type: ref</span><br><span class="line"></span><br><span class="line">possible_keys: key1,key2</span><br><span class="line"></span><br><span class="line">          key: key2</span><br><span class="line"></span><br><span class="line">      key_len: 4</span><br><span class="line"></span><br><span class="line">          ref: const</span><br><span class="line"></span><br><span class="line">         rows: 9</span><br><span class="line"></span><br><span class="line">        Extra: Using where</span><br><span class="line"></span><br><span class="line">1 row <span class="keyword">in</span> <span class="builtin-name">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>&#x4E0A;&#x9762;&#x7B26;&#x5408;&#x67E5;&#x8BE2;&#x8981;&#x6C42;&#x7684;&#x7ED3;&#x679C;&#x53EA;&#x6709;&#x4E00;&#x6761;&#xFF0C;&#x800C;&#x8FD9;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x88AB;&#x7D22;&#x5F15;key2&#x6240;&#x5305;&#x542B;&#x3002;<br>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x6761;sql&#x8BED;&#x53E5;&#x4F7F;&#x7528;&#x4E86;key2&#x7D22;&#x5F15;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x5E76;&#x4E0D;&#x662F;&#x6700;&#x5FEB;&#x7684;&#x6267;&#x884C;&#x65B9;&#x5F0F;&#x3002;&#x5176;&#x5B9E;&#xFF0C;&#x628A;&#x7D22;&#x5F15;key1&#x548C;&#x7D22;&#x5F15;key2&#x8FDB;&#x884C;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#xFF0C;&#x53D6;&#x4EA4;&#x96C6;&#x540E;&#xFF0C;&#x5C31;&#x53D1;&#x73B0;&#x53EA;&#x6709;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x9002;&#x5408;&#x3002;&#x5E94;&#x8BE5;&#x67E5;&#x8BE2;&#x6548;&#x7387;&#x4F1A;&#x66F4;&#x5FEB;&#x3002;</p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>innodb</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql索引最左原则</title>
    <url>/2019/mysql-index-left/</url>
    <content><![CDATA[<h1 id="mysql&#x7D22;&#x5F15;&#x6700;&#x5DE6;&#x539F;&#x5219;">1. mysql&#x7D22;&#x5F15;&#x6700;&#x5DE6;&#x539F;&#x5219;</h1><p><a href="https://www.zhihu.com/question/36996520/answer/93256153" target="_blank" rel="noopener">&#x4F5C;&#x8005;&#xFF1A;&#x6C88;&#x6770;</a></p>
<a id="more"></a>

<h2 id="&#x8868;&#x7ED3;&#x6784;">1.1. &#x8868;&#x7ED3;&#x6784;</h2><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">CREATE TABLE `student` (</span><br><span class="line">  `id` int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(255)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  `cid` int(11)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `name_cid_INX` (`name`,`cid`),</span><br><span class="line">) <span class="attribute">ENGINE</span>=InnoDB <span class="attribute">AUTO_INCREMENT</span>=8<span class="built_in"> DEFAULT </span><span class="attribute">CHARSET</span>=utf8</span><br></pre></td></tr></table></figure>
<p>&#x7D22;&#x5F15;&#x65B9;&#x9762;&#xFF1A;id&#x662F;&#x4E3B;&#x952E;&#xFF0C;(name,cid)&#x662F;&#x4E00;&#x4E2A;&#x591A;&#x5217;&#x7D22;&#x5F15;&#x3002;<br><strong>&#x4E0B;&#x9762;&#x662F;&#x6709;&#x7591;&#x95EE;&#x7684;&#x4E24;&#x4E2A;&#x67E5;&#x8BE2;&#xFF1A;</strong></p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">WHERE</span>   cid=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560502856107-b82078df-7cfe-4b4a-aa60-5a78ac31f3c3.jpeg" alt></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">WHERE</span>   cid=<span class="number">1</span> <span class="keyword">AND</span> <span class="keyword">name</span>=<span class="string">&apos;&#x5C0F;&#x7EA2;&apos;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560502856060-d381fa0b-e37e-4a07-b001-cee36da6500a.jpeg" alt></p>
<p><strong>&#x4F60;&#x7684;&#x7591;&#x95EE;&#x662F;</strong>&#xFF1A;sql&#x67E5;&#x8BE2;&#x7528;&#x5230;&#x7D22;&#x5F15;&#x7684;&#x6761;&#x4EF6;&#x662F;&#x5FC5;&#x987B;&#x8981;&#x9075;&#x5B88;&#x6700;&#x5DE6;&#x524D;&#x7F00;&#x539F;&#x5219;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0A;&#x9762;&#x4E24;&#x4E2A;&#x67E5;&#x8BE2;&#x8FD8;&#x80FD;&#x7528;&#x5230;&#x7D22;&#x5F15;<br>&#x8BB2;&#x4E0A;&#x9762;&#x95EE;&#x9898;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x5148;&#x8865;&#x5145;&#x4E00;&#x4E9B;&#x77E5;&#x8BC6;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x89C9;&#x5F97;&#x4F60;&#x5BF9;&#x7D22;&#x5F15;&#x7406;&#x89E3;&#x662F;&#x72ED;&#x9698;&#x7684;&#xFF1A;<br>&#x4E0A;&#x8FF0;&#x4F60;&#x7684;&#x4E24;&#x4E2A;&#x67E5;&#x8BE2;&#x7684;explain&#x7ED3;&#x679C;&#x4E2D;&#x663E;&#x793A;&#x7528;&#x5230;&#x7D22;&#x5F15;&#x7684;&#x60C5;&#x51B5;&#x7C7B;&#x578B;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x3002;,&#x53EF;&#x89C2;&#x5BDF;explain&#x7ED3;&#x679C;&#x4E2D;&#x7684;type&#x5B57;&#x6BB5;&#x3002;&#x4F60;&#x7684;&#x67E5;&#x8BE2;&#x4E2D;&#x5206;&#x522B;&#x662F;&#xFF1A;</p>
<ol>
<li>type: index</li>
<li>type: ref</li>
</ol>
<p><strong>&#x89E3;&#x91CA;&#xFF1A;</strong><br>index&#xFF1A;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x8868;&#x793A;&#x662F;mysql&#x4F1A;&#x5BF9;&#x6574;&#x4E2A;&#x8BE5;&#x7D22;&#x5F15;&#x8FDB;&#x884C;&#x626B;&#x63CF;&#x3002;&#x8981;&#x60F3;&#x7528;&#x5230;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x5BF9;&#x8FD9;&#x4E2A;&#x7D22;&#x5F15;&#x5E76;&#x65E0;&#x7279;&#x522B;&#x8981;&#x6C42;&#xFF0C;&#x53EA;&#x8981;&#x662F;&#x7D22;&#x5F15;&#xFF0C;&#x6216;&#x8005;&#x67D0;&#x4E2A;&#x590D;&#x5408;&#x7D22;&#x5F15;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;mysql&#x90FD;&#x53EF;&#x80FD;&#x4F1A;&#x91C7;&#x7528;index&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x5F0F;&#x626B;&#x63CF;&#x3002;&#x4F46;&#x662F;&#x5462;&#xFF0C;&#x7F3A;&#x70B9;&#x662F;&#x6548;&#x7387;&#x4E0D;&#x9AD8;&#xFF0C;mysql&#x4F1A;&#x4ECE;&#x7D22;&#x5F15;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x4E00;&#x4E2A;&#x4E2A;&#x7684;&#x67E5;&#x627E;&#x5230;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#xFF0C;&#x76F4;&#x5230;&#x627E;&#x5230;&#x7B26;&#x5408;&#x5224;&#x65AD;&#x6761;&#x4EF6;&#x7684;&#x67D0;&#x4E2A;&#x7D22;&#x5F15;&#x3002;<br><strong>&#x6240;&#x4EE5;&#xFF1A;</strong>&#x5BF9;&#x4E8E;&#x4F60;&#x7684;&#x7B2C;&#x4E00;&#x6761;&#x8BED;&#x53E5;&#xFF1A;</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">WHERE</span>   cid=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>&#x5224;&#x65AD;&#x6761;&#x4EF6;&#x662F;cid=1,&#x800C;cid&#x662F;(name,cid)&#x590D;&#x5408;&#x7D22;&#x5F15;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;index&#x7C7B;&#x578B;&#x7684;&#x7D22;&#x5F15;&#x626B;&#x63CF;&#x65B9;&#x5F0F;&#x3002;explain&#x663E;&#x793A;&#x7ED3;&#x679C;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x7D22;&#x5F15;&#xFF0C;&#x662F;index&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x5F0F;&#x3002;<br>ref&#xFF1A;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x8868;&#x793A;mysql&#x4F1A;&#x6839;&#x636E;&#x7279;&#x5B9A;&#x7684;&#x7B97;&#x6CD5;&#x5FEB;&#x901F;&#x67E5;&#x627E;&#x5230;&#x67D0;&#x4E2A;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F1A;&#x5BF9;&#x7D22;&#x5F15;&#x4E2D;&#x6BCF;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x90FD;&#x8FDB;&#x884C;&#x4E00; &#x4E00;&#x7684;&#x626B;&#x63CF;&#x5224;&#x65AD;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x4F60;&#x5E73;&#x5E38;&#x7406;&#x89E3;&#x7684;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x67E5;&#x8BE2;&#x4F1A;&#x66F4;&#x5FEB;&#x7684;&#x53D6;&#x51FA;&#x6570;&#x636E;&#x3002;&#x800C;&#x8981;&#x60F3;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x67E5;&#x627E;&#xFF0C;&#x7D22;&#x5F15;&#x5374;&#x662F;&#x6709;&#x8981;&#x6C42;&#x7684;&#xFF0C;&#x8981;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x80FD;&#x5FEB;&#x901F;&#x67E5;&#x627E;&#x7684;&#x7B97;&#x6CD5;&#xFF0C;&#x7D22;&#x5F15;&#x5C31;&#x8981;&#x6EE1;&#x8DB3;&#x7279;&#x5B9A;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;<strong>&#x7B80;&#x5355;&#x8BF4;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7D22;&#x5F15;&#x5B57;&#x6BB5;&#x7684;&#x6570;&#x636E;&#x5FC5;&#x987B;&#x662F;&#x6709;&#x5E8F;&#x7684;&#xFF0C;&#x624D;&#x80FD;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x67E5;&#x627E;&#xFF0C;&#x624D;&#x80FD;&#x5229;&#x7528;&#x5230;&#x7D22;&#x5F15;&#x3002;</strong></p>
<p>&#x6709;&#x4E9B;&#x4E86;&#x89E3;&#x7684;&#x4EBA;&#x53EF;&#x80FD;&#x4F1A;&#x95EE;&#xFF0C;&#x7D22;&#x5F15;&#x4E0D;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x5E8F;&#x6392;&#x5217;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E48;&#x3002;&#x4E0D;&#x8FC7;&#x7B54;&#x6848;&#x8BF4;&#x7684;&#x8FD8;&#x4E0D;&#x591F;&#x5B8C;&#x5584;&#xFF0C;&#x90A3;&#x53EA;&#x662F;&#x9488;&#x5BF9;&#x5355;&#x4E2A;&#x7D22;&#x5F15;&#xFF0C;&#x800C;&#x590D;&#x5408;&#x7D22;&#x5F15;&#x7684;&#x60C5;&#x51B5;&#x6709;&#x4E9B;&#x540C;&#x5B66;&#x53EF;&#x80FD;&#x5C31;&#x4E0D;&#x592A;&#x4E86;&#x89E3;&#x4E86;&#x3002;<br><strong>&#x4E0B;&#x9762;&#x5C31;&#x8BF4;&#x4E0B;&#x590D;&#x5408;&#x7D22;&#x5F15;&#xFF1A;</strong><br>&#x4EE5;&#x8BE5;&#x8868;&#x7684;(name,cid)&#x590D;&#x5408;&#x7D22;&#x5F15;&#x4E3A;&#x4F8B;,&#x5B83;&#x5185;&#x90E8;&#x7ED3;&#x6784;&#x7B80;&#x5355;&#x8BF4;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x6392;&#x5217;&#x7684;&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560502856267-18ae6211-caee-4cb8-b58d-d36cd6dc1dcf.jpeg" alt><br>mysql&#x521B;&#x5EFA;&#x590D;&#x5408;&#x7D22;&#x5F15;&#x7684;&#x89C4;&#x5219;&#x662F;&#x9996;&#x5148;&#x4F1A;&#x5BF9;&#x590D;&#x5408;&#x7D22;&#x5F15;&#x7684;&#x6700;&#x5DE6;&#x8FB9;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7B2C;&#x4E00;&#x4E2A;name&#x5B57;&#x6BB5;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#x7684;&#x6392;&#x5E8F;&#x57FA;&#x7840;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5BF9;&#x540E;&#x9762;&#x7B2C;&#x4E8C;&#x4E2A;&#x7684;cid&#x5B57;&#x6BB5;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x3002;&#x5176;&#x5B9E;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x5B9E;&#x73B0;&#x4E86;&#x7C7B;&#x4F3C; order by name cid&#x8FD9;&#x6837;&#x4E00;&#x79CD;&#x6392;&#x5E8F;&#x89C4;&#x5219;&#x3002;<br>&#x6240;&#x4EE5;&#xFF1A;&#x7B2C;&#x4E00;&#x4E2A;name&#x5B57;&#x6BB5;&#x662F;&#x7EDD;&#x5BF9;&#x6709;&#x5E8F;&#x7684;&#xFF0C;&#x800C;&#x7B2C;&#x4E8C;&#x5B57;&#x6BB5;&#x5C31;&#x662F;&#x65E0;&#x5E8F;&#x7684;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7B2C;&#x4E8C;&#x4E2A;cid&#x5B57;&#x6BB5;&#x8FDB;&#x884C;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x662F;&#x7528;&#x4E0D;&#x5230;&#x7D22;&#x5F15;&#x7684;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x4E0A;&#x9762;&#x7684;&#x4F7F;&#x7528;index&#x7C7B;&#x578B;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;mysql&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5F3A;&#x8C03;&#x6700;&#x5DE6;&#x524D;&#x7F00;&#x539F;&#x5219;&#x7684;&#x539F;&#x56E0;&#x3002;<br><strong>&#x90A3;&#x4E48;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x624D;&#x80FD;&#x7528;&#x5230;&#x5462;?</strong><br>&#x5F53;&#x7136;&#x662F;cid&#x5B57;&#x6BB5;&#x7684;&#x7D22;&#x5F15;&#x6570;&#x636E;&#x4E5F;&#x662F;&#x6709;&#x5E8F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x624D;&#x80FD;&#x4F7F;&#x7528;&#x54AF;&#xFF0C;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x624D;&#x662F;&#x6709;&#x5E8F;&#x7684;&#x5462;&#xFF1F;&#x89C2;&#x5BDF;&#x53EF;&#x77E5;&#xFF0C;&#x5F53;&#x7136;&#x662F;&#x5728;name&#x5B57;&#x6BB5;&#x662F;&#x7B49;&#x503C;&#x5339;&#x914D;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;cid&#x624D;&#x662F;&#x6709;&#x5E8F;&#x7684;&#x3002;&#x53D1;&#x73B0;&#x6CA1;&#x6709;&#xFF0C;&#x89C2;&#x5BDF;&#x4E24;&#x4E2A;name&#x540D;&#x5B57;&#x4E3A; c &#x7684;cid&#x5B57;&#x6BB5;&#x662F;&#x4E0D;&#x662F;&#x6709;&#x5E8F;&#x7684;&#x5462;&#x3002;&#x4ECE;&#x4E0A;&#x5F80;&#x4E0B;&#x5206;&#x522B;&#x662F;4  5&#x3002;<br>&#x8FD9;&#x4E5F;&#x5C31;&#x662F;mysql&#x7D22;&#x5F15;&#x89C4;&#x5219;&#x4E2D;&#x8981;&#x6C42;&#x590D;&#x5408;&#x7D22;&#x5F15;&#x8981;&#x60F3;&#x4F7F;&#x7528;&#x7B2C;&#x4E8C;&#x4E2A;&#x7D22;&#x5F15;&#xFF0C;&#x5FC5;&#x987B;&#x5148;&#x4F7F;&#x7528;&#x7B2C;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x7684;&#x539F;&#x56E0;&#x3002;&#xFF08;&#x800C;&#x4E14;&#x7B2C;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x5FC5;&#x987B;&#x662F;&#x7B49;&#x503C;&#x5339;&#x914D;&#xFF09;&#x3002;</p>
<hr>
<p>&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x8FD9;&#x6761;sql&#x67E5;&#x8BE2;&#xFF1A;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">WHERE</span>   cid=<span class="number">1</span> <span class="keyword">AND</span> <span class="keyword">name</span>=<span class="string">&apos;&#x5C0F;&#x7EA2;&apos;</span>;</span><br></pre></td></tr></table></figure>
<p>&#x6CA1;&#x6709;&#x9519;&#xFF0C;&#x800C;&#x4E14;&#x590D;&#x5408;&#x7D22;&#x5F15;&#x4E2D;&#x7684;&#x4E24;&#x4E2A;&#x7D22;&#x5F15;&#x5B57;&#x6BB5;&#x90FD;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x5229;&#x7528;&#x5230;&#x4E86;&#xFF01;&#x56E0;&#x4E3A;&#x8BED;&#x53E5;&#x4E2D;&#x6700;&#x5DE6;&#x9762;&#x7684;name&#x5B57;&#x6BB5;&#x8FDB;&#x884C;&#x4E86;&#x7B49;&#x503C;&#x5339;&#x914D;&#xFF0C;&#x6240;&#x4EE5;cid&#x662F;&#x6709;&#x5E8F;&#x7684;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x5230;&#x7D22;&#x5F15;&#x4E86;&#x3002;<br><strong>&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x95EE;</strong>&#xFF1A;&#x6211;&#x5EFA;&#x7684;&#x7D22;&#x5F15;&#x662F;(name,cid)&#x3002;&#x800C;&#x6211;&#x67E5;&#x8BE2;&#x7684;&#x8BED;&#x53E5;&#x662F;cid=1 AND name=&#x2019;&#x5C0F;&#x7EA2;&#x2019;; &#x6211;&#x662F;&#x5148;&#x67E5;&#x8BE2;cid&#xFF0C;&#x518D;&#x67E5;&#x8BE2;name&#x7684;&#xFF0C;&#x4E0D;&#x662F;&#x5148;&#x4ECE;&#x6700;&#x5DE6;&#x9762;&#x67E5;&#x7684;&#x5440;&#xFF1F;<br>&#x597D;&#x5427;&#xFF0C;&#x6211;&#x518D;&#x89E3;&#x91CA;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x9996;&#x5148;&#x53EF;&#x4EE5;&#x80AF;&#x5B9A;&#x7684;&#x662F;&#x628A;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x53CD;&#x8FC7;&#x6765;&#x53D8;&#x6210;&#x8FD9;&#x6837; name=&#x2019;&#x5C0F;&#x7EA2;&#x2019; and cid=1; &#x6700;&#x540E;&#x6240;&#x67E5;&#x8BE2;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;<br>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x4EA7;&#x751F;&#x4E86;&#xFF1F;&#x65E2;&#x7136;&#x7ED3;&#x679C;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x5230;&#x5E95;&#x4EE5;&#x4F55;&#x79CD;&#x987A;&#x5E8F;&#x7684;&#x67E5;&#x8BE2;&#x65B9;&#x5F0F;&#x6700;&#x597D;&#x5462;&#xFF1F;<br><strong>&#x6240;&#x4EE5;</strong>&#xFF0C;&#x800C;&#x6B64;&#x65F6;&#x90A3;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7684;mysql&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x5668;&#x8BE5;&#x767B;&#x573A;&#x4E86;&#xFF0C;mysql&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x5668;&#x4F1A;&#x5224;&#x65AD;&#x7EA0;&#x6B63;&#x8FD9;&#x6761;sql&#x8BED;&#x53E5;&#x8BE5;&#x4EE5;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x6548;&#x7387;&#x6700;&#x9AD8;&#xFF0C;&#x6700;&#x540E;&#x624D;&#x751F;&#x6210;&#x771F;&#x6B63;&#x7684;&#x6267;&#x884C;&#x8BA1;&#x5212;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5F53;&#x7136;&#x662F;&#x6211;&#x4EEC;&#x80FD;&#x5C3D;&#x91CF;&#x7684;&#x5229;&#x7528;&#x5230;&#x7D22;&#x5F15;&#x65F6;&#x7684;&#x67E5;&#x8BE2;&#x987A;&#x5E8F;&#x6548;&#x7387;&#x6700;&#x9AD8;&#x54AF;&#xFF0C;&#x6240;&#x4EE5;mysql&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x5668;&#x4F1A;&#x6700;&#x7EC8;&#x4EE5;&#x8FD9;&#x79CD;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x6267;&#x884C;&#x3002;</p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>innodb</tag>
      </tags>
  </entry>
  <entry>
    <title>聚集索引与辅助索引</title>
    <url>/2019/jv-ji-suoyin-fu-zhu-suoyin/</url>
    <content><![CDATA[<h1 id="&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x4E0E;&#x8F85;&#x52A9;&#x7D22;&#x5F15;">1. &#x805A;&#x96C6;&#x7D22;&#x5F15;&#x4E0E;&#x8F85;&#x52A9;&#x7D22;&#x5F15;</h1><h2 id="&#x805A;&#x96C6;&#x7D22;&#x5F15;">1.1. &#x805A;&#x96C6;&#x7D22;&#x5F15;</h2><p><strong>InnoDB&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x8868;&#x662F;&#x7D22;&#x5F15;&#x7EC4;&#x7EC7;&#x8868;&#xFF0C;&#x5373;&#x6309;&#x7167;&#x4E3B;&#x952E;&#x7684;&#x987A;&#x5E8F;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x3002;</strong><br>&#x5F53;&#x4E00;&#x4E2A;&#x8868;&#x6CA1;&#x6709;&#x4E3B;&#x952E;&#xFF0C;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#xFF0C;Innodb&#x4F1A;&#x5982;&#x4F55;&#x5904;&#x7406;&#x5462;&#x3002;&#x8BF7;&#x770B;&#x5982;&#x4E0B;&#x89C4;&#x5219;:</p>
<a id="more"></a>

<ul>
<li>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x4E3B;&#x952E;&#x88AB;&#x5B9A;&#x4E49;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x4E3B;&#x952E;&#x5C31;&#x662F;&#x4F5C;&#x4E3A;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x3002;</li>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4E3B;&#x952E;&#x88AB;&#x5B9A;&#x4E49;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x8868;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x552F;&#x4E00;&#x975E;&#x7A7A;&#x7D22;&#x5F15;&#x88AB;&#x4F5C;&#x4E3A;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x3002;</li>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4E3B;&#x952E;&#x4E5F;&#x6CA1;&#x6709;&#x5408;&#x9002;&#x7684;&#x552F;&#x4E00;&#x7D22;&#x5F15;&#xFF0C;&#x90A3;&#x4E48;innodb&#x5185;&#x90E8;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x9690;&#x85CF;&#x7684;&#x4E3B;&#x952E;&#x4F5C;&#x4E3A;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#xFF0C;&#x8FD9;&#x4E2A;&#x9690;&#x85CF;&#x7684;&#x4E3B;&#x952E;&#x662F;&#x4E00;&#x4E2A;6&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x5217;&#xFF0C;&#x8BE5;&#x5217;&#x7684;&#x503C;&#x4F1A;&#x968F;&#x7740;&#x6570;&#x636E;&#x7684;&#x63D2;&#x5165;&#x81EA;&#x589E;&#x3002;</li>
</ul>
<hr>
<p>&#x805A;&#x96C6;&#x7D22;&#x5F15;&#xFF08;clustered index&#xFF09;&#x5C31;&#x662F;&#x6309;&#x7167;&#x6BCF;&#x5F20;&#x8868;&#x7684;&#x4E3B;&#x952E;&#x6784;&#x9020;&#x4E00;&#x68F5;B+&#x6811;&#xFF0C;&#x6811;&#x4E2D;&#x7684;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x5B58;&#x653E;&#x7740;&#x8868;&#x4E2D;&#x7684;&#x884C;&#x8BB0;&#x5F55;&#x6570;&#x636E;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x4E5F;&#x5C06;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x7684;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x79F0;&#x4E3A;&#x6570;&#x636E;&#x9875;&#xFF1B;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x4E2D;&#x5B58;&#x653E;&#x7740;&#x4EC5;&#x4EC5;&#x662F;&#x952E;&#x503C;&#x548C;&#x6307;&#x5411;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x504F;&#x79FB;&#x91CF;&#x3002;&#x6BCF;&#x4E2A;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF08;&#x6570;&#x636E;&#x9875;&#xFF09;&#x90FD;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#x3002;<br>&#x7531;&#x4E8E;&#x5B9E;&#x9645;&#x7684;&#x6570;&#x636E;&#x9875;&#x53EA;&#x80FD;&#x6309;&#x7167;&#x4E00;&#x68F5;B+&#x6811;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x56E0;&#x6B64;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x6BCF;&#x5F20;&#x8868;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x3002;<br>&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x80FD;&#x8FC7;&#x7279;&#x522B;&#x5FEB;&#x7684;&#x8BBF;&#x95EE;&#x9488;&#x5BF9;&#x8303;&#x56F4;&#x503C;&#x7684;&#x67E5;&#x8BE2;&#x3002;</p>
<blockquote>
<p>&#x6CE8;&#x610F;&#xFF1A;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x5E76;&#x4E0D;&#x662F;&#x5728;&#x7269;&#x7406;&#x5B58;&#x50A8;&#x4E0A;&#x662F;&#x8FDE;&#x7EED;&#x7684;&#xFF0C;&#x5176;&#x53EA;&#x662F;&#x5728;&#x903B;&#x8F91;&#x4E0A;&#x8FDE;&#x7EED;&#xFF0C;&#x8FD9;&#x6709;&#x4E24;&#x70B9;&#xFF1A;<br>&#x4E00;&#x3001;&#x6570;&#x636E;&#x9875;&#x662F;&#x6309;&#x7167;&#x4E3B;&#x952E;&#x7684;&#x987A;&#x5E8F;&#x5E76;&#x901A;&#x8FC7;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x94FE;&#x63A5;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x7269;&#x7406;&#x5B58;&#x50A8;&#x4E0A;&#x53EF;&#x4EE5;&#x4E0D;&#x6309;&#x4E3B;&#x952E;&#x987A;&#x5E8F;&#x5B58;&#x50A8;&#x3002;<br>&#x4E8C;&#x3001;&#x6570;&#x636E;&#x9875;&#x4E2D;&#x7684;&#x8BB0;&#x5F55;&#x4E5F;&#x662F;&#x901A;&#x8FC7;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x8FDB;&#x884C;&#x7EF4;&#x62A4;&#x7684;&#xFF0C;&#x7269;&#x7406;&#x5B58;&#x50A8;&#x4E0A;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x4E0D;&#x6309;&#x4E3B;&#x952E;&#x987A;&#x5E8F;&#x5B58;&#x50A8;&#x3002;</p>
</blockquote>
<p>&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x7684;&#x597D;&#x5904;&#xFF1A; </p>
<ol>
<li>&#x5BF9;&#x4E8E;&#x4E3B;&#x952E;&#x7684;&#x6392;&#x5E8F;&#x67E5;&#x627E;&#x975E;&#x5E38;&#x7684;&#x5FEB;&#xFF08;&#x56E0;&#x4E3A;&#x5176;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x662F;&#x7528;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x94FE;&#x63A5;&#x7684;&#xFF09; </li>
<li>&#x5BF9;&#x4E8E;&#x4E3B;&#x952E;&#x7684;&#x8303;&#x56F4;&#x67E5;&#x627E;&#x975E;&#x5E38;&#x7684;&#x5FEB;&#xFF08;&#x56E0;&#x4E3A;&#x901A;&#x8FC7;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x4E0A;&#x5C42;&#x4E2D;&#x95F4;&#x8282;&#x70B9;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x53F6;&#x7ED3;&#x70B9;&#x7684;&#x8303;&#x56F4;&#x503C;&#xFF09;</li>
</ol>
<h2 id="&#x8F85;&#x52A9;&#x7D22;&#x5F15;">1.2. &#x8F85;&#x52A9;&#x7D22;&#x5F15;</h2><p>&#x8F85;&#x52A9;&#x7D22;&#x5F15;&#xFF08;Secondary index&#xFF09;&#x4E5F;&#x662F;B+&#x6811;&#x7ED3;&#x6784;&#xFF0C;&#x4F46;&#x5176;&#x5728;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x4E2D;&#x5E76;&#x4E0D;&#x5305;&#x542B;&#x884C;&#x8BB0;&#x5F55;&#x7684;&#x5168;&#x90E8;&#x6570;&#x636E;&#x3002;&#x9664;&#x4E86;&#x5305;&#x542B;&#x952E;&#x7684;&#x503C;&#xFF08;&#x5EFA;&#x7ACB;&#x8F85;&#x52A9;&#x7D22;&#x5F15;&#x7684;&#x5217;&#x4E2D;&#x7684;&#x503C;&#xFF09;&#x5916;&#xFF0C;&#x8FD8;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;&#x4E66;&#x7B7E;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E66;&#x7B7E;&#x7528;&#x6765;&#x544A;&#x8BC9;InnoDB&#x5F15;&#x64CE;&#x4ECE;&#x54EA;&#x91CC;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x4E0E;&#x7D22;&#x5F15;&#x76F8;&#x5BF9;&#x5E94;&#x7684;&#x884C;&#x6570;&#x636E;&#x3002;&#x7531;&#x4E8E;InnoDB&#x5F15;&#x64CE;&#x662F;&#x7D22;&#x5F15;&#x7EC4;&#x7EC7;&#x8868;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E66;&#x7B7E;&#x5C31;&#x662F;&#x76F8;&#x5E94;&#x7684;&#x884C;&#x6570;&#x636E;&#x7684;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x952E;&#x3002; <br>&#x56E0;&#x4E3A;&#x8F85;&#x52A9;&#x7D22;&#x5F15;&#x4E0D;&#x4F1A;&#x5BF9;&#x5F71;&#x54CD;&#x6570;&#x636E;&#x5728;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#x4E2D;&#x7684;&#x7EC4;&#x7EC7;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x3002;</p>
<blockquote>
<p>&#x9664;&#x4E86;&#x7D22;&#x5F15;&#x7EC4;&#x7EC7;&#x8868;&#x7ED3;&#x6784;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x5806;&#x8868;&#x7684;&#x8868;&#x7ED3;&#x6784;&#xFF0C;&#x5373;&#x884C;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#x662F;&#x6309;&#x7167;&#x63D2;&#x5165;&#x7684;&#x987A;&#x5E8F;&#x5B58;&#x50A8;&#x7684;&#x3002;&#x5982;SQL Server&#x6570;&#x636E;&#x5E93;</p>
</blockquote>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>innodb</tag>
      </tags>
  </entry>
  <entry>
    <title>b+树图文详解</title>
    <url>/2019/b+-tree-tu-wen-jiang-jie/</url>
    <content><![CDATA[<h1 id="b-&#x6811;&#x56FE;&#x6587;&#x8BE6;&#x89E3;-&#x8F6C;">1. b+&#x6811;&#x56FE;&#x6587;&#x8BE6;&#x89E3;(&#x8F6C;)</h1><a id="more"></a>
<p><a href="https://blog.csdn.net/qq_26222859/article/details/80631121" target="_blank" rel="noopener">&#x8F6C;&#x8F7D;&#x81EA;</a><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589478-14eb9760-fa6a-42d2-bb88-c46fd94620b9.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589474-48c993d8-0441-4b9b-a23e-30b0c2758345.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589509-8736f0ff-9215-4e21-b2d5-e362f5f322ef.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589476-76ef0c2e-adc5-453b-9648-c418aae8bab1.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><strong>&#x4E00;&#x4E2A;m&#x9636;&#x7684;B&#x6811;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x7279;&#x5F81;&#xFF1A;</strong><br>1.&#x6839;&#x7ED3;&#x70B9;&#x81F3;&#x5C11;&#x6709;&#x4E24;&#x4E2A;&#x5B50;&#x5973;&#x3002;<br>2.&#x6BCF;&#x4E2A;&#x4E2D;&#x95F4;&#x8282;&#x70B9;&#x90FD;&#x5305;&#x542B;k-1&#x4E2A;&#x5143;&#x7D20;&#x548C;k&#x4E2A;&#x5B69;&#x5B50;&#xFF0C;&#x5176;&#x4E2D; m/2 &lt;= k &lt;= m<br>3.&#x6BCF;&#x4E00;&#x4E2A;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x5305;&#x542B;k-1&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x5176;&#x4E2D; m/2 &lt;= k &lt;= m<br>4.&#x6240;&#x6709;&#x7684;&#x53F6;&#x5B50;&#x7ED3;&#x70B9;&#x90FD;&#x4F4D;&#x4E8E;&#x540C;&#x4E00;&#x5C42;&#x3002;<br>5.&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x6392;&#x5217;&#xFF0C;&#x8282;&#x70B9;&#x5F53;&#x4E2D;k-1&#x4E2A;&#x5143;&#x7D20;&#x6B63;&#x597D;&#x662F;k&#x4E2A;&#x5B69;&#x5B50;&#x5305;&#x542B;&#x7684;&#x5143;&#x7D20;&#x7684;&#x503C;&#x57DF;&#x5206;&#x5212;&#x3002;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589528-d4075698-62c4-4930-b270-5e0e6c2a6041.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><strong>&#x4E00;&#x4E2A;m&#x9636;&#x7684;B+&#x6811;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x7279;&#x5F81;&#xFF1A;</strong><br>1.&#x6709;k&#x4E2A;&#x5B50;&#x6811;&#x7684;&#x4E2D;&#x95F4;&#x8282;&#x70B9;&#x5305;&#x542B;&#x6709;k&#x4E2A;&#x5143;&#x7D20;&#xFF08;B&#x6811;&#x4E2D;&#x662F;k-1&#x4E2A;&#x5143;&#x7D20;&#xFF09;&#xFF0C;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x4E0D;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#xFF0C;&#x53EA;&#x7528;&#x6765;&#x7D22;&#x5F15;&#xFF0C;&#x6240;&#x6709;&#x6570;&#x636E;&#x90FD;&#x4FDD;&#x5B58;&#x5728;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x3002;<br>2.&#x6240;&#x6709;&#x7684;&#x53F6;&#x5B50;&#x7ED3;&#x70B9;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x5168;&#x90E8;&#x5143;&#x7D20;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x53CA;&#x6307;&#x5411;&#x542B;&#x8FD9;&#x4E9B;&#x5143;&#x7D20;&#x8BB0;&#x5F55;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x4E14;&#x53F6;&#x5B50;&#x7ED3;&#x70B9;&#x672C;&#x8EAB;&#x4F9D;&#x5173;&#x952E;&#x5B57;&#x7684;&#x5927;&#x5C0F;&#x81EA;&#x5C0F;&#x800C;&#x5927;&#x987A;&#x5E8F;&#x94FE;&#x63A5;&#x3002;<br>3.&#x6240;&#x6709;&#x7684;&#x4E2D;&#x95F4;&#x8282;&#x70B9;&#x5143;&#x7D20;&#x90FD;&#x540C;&#x65F6;&#x5B58;&#x5728;&#x4E8E;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x5728;&#x5B50;&#x8282;&#x70B9;&#x5143;&#x7D20;&#x4E2D;&#x662F;&#x6700;&#x5927;&#xFF08;&#x6216;&#x6700;&#x5C0F;&#xFF09;&#x5143;&#x7D20;&#x3002;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589471-3186af11-d609-436d-9ceb-364de2f21dfd.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589476-5b9d42b0-8732-4aeb-a00f-1c788d7257cb.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589484-7bb1d0dc-17ea-42c3-a85e-81ef3075c7cf.jpeg#align=left&amp;display=inline&amp;height=328&amp;originHeight=328&amp;originWidth=825&amp;size=0&amp;status=done&amp;width=825" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589522-5002c890-a2ab-4128-b8cc-372c53df9b23.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589492-faff71ce-5837-4d9f-a0da-41a1bde61502.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589521-2acfed97-b6d1-4002-95f3-a0064120669b.jpeg#align=left&amp;display=inline&amp;height=319&amp;originHeight=319&amp;originWidth=826&amp;size=0&amp;status=done&amp;width=826" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589501-3eb8856a-7b23-48bf-8cc3-62135e1ae385.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589530-fd2e230b-564a-4638-a8d0-94fab7482144.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589568-291a6a23-2cd8-439c-bb57-24bfe1b8498a.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589527-7e0b8c44-74bb-4b98-8775-0744a0df63e8.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589511-ee371a52-26bc-4bae-9200-c2f77cdefc83.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589517-3e7149dd-72d0-46ca-a5be-da166e2447a9.jpeg#align=left&amp;display=inline&amp;height=340&amp;originHeight=340&amp;originWidth=851&amp;size=0&amp;status=done&amp;width=851" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589562-ab3b39f5-86e8-47db-80a3-9738049ca1d9.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589532-ca61e798-cec9-43f6-9bdb-de5377a1426c.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br>B-&#x6811;&#x4E2D;&#x7684;&#x536B;&#x661F;&#x6570;&#x636E;&#xFF08;Satellite Information&#xFF09;&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589547-d21f7365-1c57-424b-a0ec-b45a1f1d4b3f.jpeg#align=left&amp;display=inline&amp;height=381&amp;originHeight=381&amp;originWidth=787&amp;size=0&amp;status=done&amp;width=787" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589530-9bf09612-1635-4954-aba1-c0b798ece577.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br>B+&#x6811;&#x4E2D;&#x7684;&#x536B;&#x661F;&#x6570;&#x636E;&#xFF08;Satellite Information&#xFF09;&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589554-e92c2186-358b-45b4-bb86-a741d27fe738.jpeg#align=left&amp;display=inline&amp;height=384&amp;originHeight=384&amp;originWidth=838&amp;size=0&amp;status=done&amp;width=838" alt><br>&#x9700;&#x8981;&#x8865;&#x5145;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x6570;&#x636E;&#x5E93;&#x7684;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#xFF08;Clustered Index&#xFF09;&#x4E2D;&#xFF0C;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x76F4;&#x63A5;&#x5305;&#x542B;&#x536B;&#x661F;&#x6570;&#x636E;&#x3002;&#x5728;&#x975E;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#xFF08;NonClustered Index&#xFF09;&#x4E2D;&#xFF0C;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x5E26;&#x6709;&#x6307;&#x5411;&#x536B;&#x661F;&#x6570;&#x636E;&#x7684;&#x6307;&#x9488;&#x3002;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589536-58fb4184-29c6-4661-8ba5-93c8f056891e.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589540-ca557831-c35e-470b-ad17-0be9b3a596e1.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589550-417eab8c-40f6-4855-9132-731ab819ed83.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br>&#x7B2C;&#x4E00;&#x6B21;&#x78C1;&#x76D8;IO&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589570-163e1e9b-377f-4275-bd2a-4b6bcb3f2915.jpeg#align=left&amp;display=inline&amp;height=318&amp;originHeight=318&amp;originWidth=826&amp;size=0&amp;status=done&amp;width=826" alt><br>&#x7B2C;&#x4E8C;&#x6B21;&#x78C1;&#x76D8;IO&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589552-67efb7f2-60a8-41e1-82ff-74ef4e66c580.jpeg#align=left&amp;display=inline&amp;height=310&amp;originHeight=310&amp;originWidth=818&amp;size=0&amp;status=done&amp;width=818" alt><br>&#x7B2C;&#x4E09;&#x6B21;&#x78C1;&#x76D8;IO&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589586-95d8b4c4-f0b4-4b93-9b48-0465e21c9df5.jpeg#align=left&amp;display=inline&amp;height=307&amp;originHeight=307&amp;originWidth=817&amp;size=0&amp;status=done&amp;width=817" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589573-ed89e685-6d64-4e04-a6c3-e38f7aa8930b.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589575-fc3ea0f7-3156-4678-9343-bbf168658cf9.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589572-81d63403-57d0-438a-986c-b6492fd3246b.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589589-9f9f3fb9-4bd7-4a8e-976a-755e2ab726b9.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589580-6c5c476c-7be2-4f8a-a554-cc24d90dec36.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589586-4f417277-6548-45d3-ba3d-042fd20fe5de.jpeg#align=left&amp;display=inline&amp;height=300&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><strong>B-&#x6811;&#x7684;&#x8303;&#x56F4;&#x67E5;&#x627E;&#x8FC7;&#x7A0B;</strong><br>&#x81EA;&#x9876;&#x5411;&#x4E0B;&#xFF0C;&#x67E5;&#x627E;&#x5230;&#x8303;&#x56F4;&#x7684;&#x4E0B;&#x9650;&#xFF08;3&#xFF09;&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589584-e69f8d72-0341-4199-8559-9551691ae1ab.jpeg#align=left&amp;display=inline&amp;height=310&amp;originHeight=310&amp;originWidth=774&amp;size=0&amp;status=done&amp;width=774" alt><br>&#x4E2D;&#x5E8F;&#x904D;&#x5386;&#x5230;&#x5143;&#x7D20;6&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589595-9044d64a-a55a-4f6f-9ef8-54f5b030bc03.jpeg#align=left&amp;display=inline&amp;height=257&amp;originHeight=314&amp;originWidth=779&amp;size=0&amp;status=done&amp;width=779" alt><br>&#x4E2D;&#x5E8F;&#x904D;&#x5386;&#x5230;&#x5143;&#x7D20;8&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589605-187b66f2-efaf-4a17-bf05-0d2b86a9a2f6.jpeg#align=left&amp;display=inline&amp;height=312&amp;originHeight=312&amp;originWidth=778&amp;size=0&amp;status=done&amp;width=778" alt><br>&#x4E2D;&#x5E8F;&#x904D;&#x5386;&#x5230;&#x5143;&#x7D20;9&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589615-34b0e6f8-5ff0-4c84-9bc3-fd64dd743021.jpeg#align=left&amp;display=inline&amp;height=256&amp;originHeight=308&amp;originWidth=769&amp;size=0&amp;status=done&amp;width=769" alt><br>&#x4E2D;&#x5E8F;&#x904D;&#x5386;&#x5230;&#x5143;&#x7D20;11&#xFF0C;&#x904D;&#x5386;&#x7ED3;&#x675F;&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589626-0637ddda-7cbb-4aa8-85d6-5825068bbad4.jpeg#align=left&amp;display=inline&amp;height=262&amp;originHeight=318&amp;originWidth=774&amp;size=0&amp;status=done&amp;width=774" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589618-48d5a9ce-44eb-4a30-bba8-0b7c0f43e272.jpeg#align=left&amp;display=inline&amp;height=295&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589621-f6f5aad8-e5b2-4010-873d-bc0334ab56b2.jpeg#align=left&amp;display=inline&amp;height=295&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><strong>B+&#x6811;&#x7684;&#x8303;&#x56F4;&#x67E5;&#x627E;&#x8FC7;&#x7A0B;</strong><br>&#x81EA;&#x9876;&#x5411;&#x4E0B;&#xFF0C;&#x67E5;&#x627E;&#x5230;&#x8303;&#x56F4;&#x7684;&#x4E0B;&#x9650;&#xFF08;3&#xFF09;&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589612-03d1cad2-b413-4927-aa14-be43b2afbb03.jpeg#align=left&amp;display=inline&amp;height=248&amp;originHeight=320&amp;originWidth=825&amp;size=0&amp;status=done&amp;width=825" alt><br>&#x901A;&#x8FC7;&#x94FE;&#x8868;&#x6307;&#x9488;&#xFF0C;&#x904D;&#x5386;&#x5230;&#x5143;&#x7D20;6, 8&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589638-14788bcf-3426-4f05-b1f1-d7bc127b5a42.jpeg#align=left&amp;display=inline&amp;height=247&amp;originHeight=319&amp;originWidth=825&amp;size=0&amp;status=done&amp;width=825" alt><br>&#x901A;&#x8FC7;&#x94FE;&#x8868;&#x6307;&#x9488;&#xFF0C;&#x904D;&#x5386;&#x5230;&#x5143;&#x7D20;9, 11&#xFF0C;&#x904D;&#x5386;&#x7ED3;&#x675F;&#xFF1A;<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589643-5241de8c-1f60-473c-8c1a-db456e796978.jpeg#align=left&amp;display=inline&amp;height=242&amp;originHeight=312&amp;originWidth=822&amp;size=0&amp;status=done&amp;width=822" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589650-b37d0f5a-61c9-4997-9140-2e33b4c22365.jpeg#align=left&amp;display=inline&amp;height=295&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589636-a27372bf-a312-4eef-8094-5c419de1d49c.jpeg#align=left&amp;display=inline&amp;height=295&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589655-a615965b-28ad-49f6-91d8-df2b2fdb58ef.jpeg#align=left&amp;display=inline&amp;height=295&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/178066/1560416589653-5c186e9f-8e23-4b8f-a2e2-9195c2964c52.jpeg#align=left&amp;display=inline&amp;height=295&amp;originHeight=300&amp;originWidth=650&amp;size=0&amp;status=done&amp;width=650" alt><br><strong>B+&#x6811;&#x7684;&#x7279;&#x5F81;&#xFF1A;</strong><br>1.&#x6709;k&#x4E2A;&#x5B50;&#x6811;&#x7684;&#x4E2D;&#x95F4;&#x8282;&#x70B9;&#x5305;&#x542B;&#x6709;k&#x4E2A;&#x5143;&#x7D20;&#xFF08;B&#x6811;&#x4E2D;&#x662F;k-1&#x4E2A;&#x5143;&#x7D20;&#xFF09;&#xFF0C;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x4E0D;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#xFF0C;&#x53EA;&#x7528;&#x6765;&#x7D22;&#x5F15;&#xFF0C;&#x6240;&#x6709;&#x6570;&#x636E;&#x90FD;&#x4FDD;&#x5B58;&#x5728;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x3002;<br>2.&#x6240;&#x6709;&#x7684;&#x53F6;&#x5B50;&#x7ED3;&#x70B9;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x5168;&#x90E8;&#x5143;&#x7D20;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x53CA;&#x6307;&#x5411;&#x542B;&#x8FD9;&#x4E9B;&#x5143;&#x7D20;&#x8BB0;&#x5F55;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x4E14;&#x53F6;&#x5B50;&#x7ED3;&#x70B9;&#x672C;&#x8EAB;&#x4F9D;&#x5173;&#x952E;&#x5B57;&#x7684;&#x5927;&#x5C0F;&#x81EA;&#x5C0F;&#x800C;&#x5927;&#x987A;&#x5E8F;&#x94FE;&#x63A5;&#x3002;<br>3.&#x6240;&#x6709;&#x7684;&#x4E2D;&#x95F4;&#x8282;&#x70B9;&#x5143;&#x7D20;&#x90FD;&#x540C;&#x65F6;&#x5B58;&#x5728;&#x4E8E;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x5728;&#x5B50;&#x8282;&#x70B9;&#x5143;&#x7D20;&#x4E2D;&#x662F;&#x6700;&#x5927;&#xFF08;&#x6216;&#x6700;&#x5C0F;&#xFF09;&#x5143;&#x7D20;&#x3002;<br><strong>B+&#x6811;&#x7684;&#x4F18;&#x52BF;&#xFF1A;</strong><br>1.&#x5355;&#x4E00;&#x8282;&#x70B9;&#x5B58;&#x50A8;&#x66F4;&#x591A;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x4F7F;&#x5F97;&#x67E5;&#x8BE2;&#x7684;IO&#x6B21;&#x6570;&#x66F4;&#x5C11;&#x3002;<br>2.&#x6240;&#x6709;&#x67E5;&#x8BE2;&#x90FD;&#x8981;&#x67E5;&#x627E;&#x5230;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x67E5;&#x8BE2;&#x6027;&#x80FD;&#x7A33;&#x5B9A;&#x3002;<br>3.&#x6240;&#x6709;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x5F62;&#x6210;&#x6709;&#x5E8F;&#x94FE;&#x8868;&#xFF0C;&#x4FBF;&#x4E8E;&#x8303;&#x56F4;&#x67E5;&#x8BE2;&#x3002;</p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
  </entry>
  <entry>
    <title>二分查找法与二叉树</title>
    <url>/2019/erfen-chazhao-ercha-shu/</url>
    <content><![CDATA[<h1 id="&#x4E8C;&#x5206;&#x67E5;&#x627E;&#x6CD5;&#x4E0E;&#x4E8C;&#x53C9;&#x6811;">1. &#x4E8C;&#x5206;&#x67E5;&#x627E;&#x6CD5;&#x4E0E;&#x4E8C;&#x53C9;&#x6811;</h1><h1 id="&#x4E8C;&#x5206;&#x67E5;&#x627E;&#x6CD5;">2. &#x4E8C;&#x5206;&#x67E5;&#x627E;&#x6CD5;</h1><blockquote>
<p>&#x5B9A;&#x4E49;: &#x5C06;&#x8BB0;&#x5F55;&#x6309;&#x6709;&#x5E8F;&#x5316;&#x9012;&#x589E;&#x6216;&#x9012;&#x51CF;&#x6392;&#x5217;,&#x5728;&#x67E5;&#x627E;&#x8FC7;&#x7A0B;&#x4E2D;&#x91C7;&#x7528;&#x8DF3;&#x8DC3;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x67E5;&#x627E;,&#x5373;&#x5148;&#x4EE5;&#x6709;&#x5E8F;&#x7684;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;&#x4E3A;&#x6BD4;&#x8F83;&#x5BF9;&#x8C61;,&#x5982;&#x679C;&#x8981;&#x67E5;&#x627E;&#x7684;&#x503C;&#x5C0F;&#x4E8E;&#x4E2D;&#x70B9;&#x5143;&#x7D20;,&#x5219;&#x5C06;&#x5F85;&#x67E5;&#x5E8F;&#x5217;&#x7F29;&#x5C0F;&#x4E3A;&#x5DE6;&#x534A;&#x90E8;&#x5206;,&#x5426;&#x5219;&#x4E3A;&#x53F3;&#x534A;&#x90E8;&#x5206;</p>
</blockquote>
<a id="more"></a>

<p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1560413817062-d21a2118-9f64-410c-9c28-2ff222503b11.png#align=left&amp;display=inline&amp;height=327&amp;name=image.png&amp;originHeight=654&amp;originWidth=1676&amp;size=114051&amp;status=done&amp;width=838" alt="image.png"><br>&#x4ECE;&#x56FE;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;,&#x7528;&#x4E86;3&#x6B21;&#x5C31;&#x67E5;&#x5230;&#x4E86;48&#x8FD9;&#x4E2A;&#x6570;. &#x5982;&#x679C;&#x662F;&#x987A;&#x5E8F;&#x67E5;&#x627E;&#x5219;&#x9700;&#x8981;8&#x6B21;.<br><a name="7CwGV"></a></p>
<h1 id="&#x4E8C;&#x53C9;&#x6811;">3. &#x4E8C;&#x53C9;&#x6811;</h1><blockquote>
<p>&#x5B9A;&#x4E49;: &#x5728;&#x4E8C;&#x53C9;&#x6811;&#x4E2D;,&#x5DE6;&#x5B50;&#x6811;&#x7684;&#x503C;&#x603B;&#x662F;&#x5C0F;&#x4E8E;&#x6839;&#x7684;&#x503C;,&#x53F3;&#x5B50;&#x6811;&#x7684;&#x503C;&#x603B;&#x662F;&#x5927;&#x4E8E;&#x6839;&#x7684;&#x503C;</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1560413936938-88bba89e-b04a-4e82-af57-6a624e0b3226.png#align=left&amp;display=inline&amp;height=281&amp;name=image.png&amp;originHeight=562&amp;originWidth=646&amp;size=67944&amp;status=done&amp;width=323" alt="image.png"><br>&#x67E5;&#x627E;&#x65B9;&#x5F0F;&#x4E3A;&#x5148;&#x67E5;&#x6839;,&#x6BD4;&#x6839;&#x5C0F;&#x67E5;&#x5DE6;&#x5B50;&#x6811;,&#x6BD4;&#x6839;&#x5927;&#x67E5;&#x53F3;&#x5B50;&#x6811;</p>
<hr>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1560414284578-5183cd3d-e778-480b-a23a-01da48d5cc86.png#align=left&amp;display=inline&amp;height=413&amp;name=image.png&amp;originHeight=826&amp;originWidth=658&amp;size=94746&amp;status=done&amp;width=329" alt="image.png"><br>&#x5982;&#x56FE;,&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6548;&#x7387;&#x5F88;&#x4F4E;&#x7684;&#x4E8C;&#x53C9;&#x6811;, &#x4E8C;&#x53C9;&#x6811;&#x82E5;&#x60F3;&#x6700;&#x5927;&#x6027;&#x80FD;&#x7684;&#x6784;&#x9020;,&#x9700;&#x8981;&#x8FD9;&#x9897;&#x4E8C;&#x53C9;&#x6811;&#x662F;&#x5E73;&#x8861;&#x7684;(&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;)<br><a name="FFARU"></a></p>
<h2 id="&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;">3.1. &#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;</h2><blockquote>
<p>&#x5B9A;&#x4E49;: &#x9996;&#x5148;&#x7B26;&#x5408;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x5B9A;&#x4E49;, &#x5176;&#x6B21;&#x5FC5;&#x987B;&#x6EE1;&#x8DB3;&#x4EFB;&#x4F55;&#x8282;&#x70B9;&#x7684;&#x4E24;&#x4E2A;&#x5B50;&#x6811;&#x7684;&#x9AD8;&#x5EA6;&#x6700;&#x5927;&#x5DEE;&#x4E3A;1</p>
</blockquote>
<p><strong>&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x6027;&#x80FD;&#x6BD4;&#x8F83;&#x9AD8;,&#x4F46;&#x662F;&#x7B80;&#x5386;&#x548C;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x9700;&#x8981;&#x5927;&#x91CF;&#x7684;&#x64CD;&#x4F5C;</strong><br>&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;, &#x5F53;&#x7528;&#x6237;&#x9700;&#x8981;&#x63D2;&#x5165;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x503C;&#x4E3A;9&#x7684;&#x8282;&#x70B9;&#x65F6;,&#x9700;&#x8981;&#x505A;&#x5982;&#x4E0B;&#x53D8;&#x52A8;<br><img src="https://cdn.nlark.com/yuque/0/2019/png/178066/1560414856003-593fa0ca-e07d-4afe-8191-4272d2401d88.png#align=left&amp;display=inline&amp;height=400&amp;name=image.png&amp;originHeight=800&amp;originWidth=1264&amp;size=222353&amp;status=done&amp;width=632" alt="image.png"><br><strong>&#x5982;&#x4E0A;&#x56FE;&#x5411;&#x4E00;&#x9897;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x63D2;&#x5165;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8282;&#x70B9;&#x540E;,&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x9700;&#x8981;&#x505A;&#x7684;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;&#x5F88;&#x591A;, &#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x591A;&#x7528;&#x4E8E;&#x5185;&#x5B58;&#x7ED3;&#x6784;&#x5BF9;&#x8C61;&#x4E2D;, &#x7EF4;&#x62A4;&#x7684;&#x5F00;&#x9500;&#x76F8;&#x5BF9;&#x6BD4;&#x8F83;&#x5C0F;</strong></p>
]]></content>
      <categories>
        <category>algorithm</category>
      </categories>
  </entry>
  <entry>
    <title>springboot项目初始化时读取数据库</title>
    <url>/2019/springboot-init-read-db/</url>
    <content><![CDATA[<h2 id="&#x5B9E;&#x73B0;InitializingBean-ServletContextAware">0.1. &#x5B9E;&#x73B0;InitializingBean, ServletContextAware</h2><a id="more"></a>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstanstMap</span>  <span class="keyword">implements</span> <span class="title">InitializingBean</span>, <span class="title">ServletContextAware</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> Map&lt;String, String&gt; initConfig = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ContentVoMapper contentDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServletContext</span><span class="params">(ServletContext servletContext)</span> </span>{</span><br><span class="line">        ContentVoExample contentVoExample = <span class="keyword">new</span> ContentVoExample();</span><br><span class="line">        contentVoExample.createCriteria().andTypeEqualTo(Types.PAGE.getType());</span><br><span class="line">        List&lt;ContentVo&gt; contentVos = contentDao.selectByExampleWithBLOBs(contentVoExample);</span><br><span class="line">        <span class="keyword">for</span> (ContentVo contentVo : contentVos) {</span><br><span class="line">            initConfig.put(contentVo.getSlug(),contentVo.getTitle());</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>innoDB存储引擎</title>
    <url>/2019/innoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/</url>
    <content><![CDATA[<h2 id="Spring-Boot&#x4E2D;&#x4F7F;&#x7528;Swagger2&#x6784;&#x5EFA;RESTful-API&#x6587;&#x6863;">0.1. Spring Boot&#x4E2D;&#x4F7F;&#x7528;Swagger2&#x6784;&#x5EFA;RESTful API&#x6587;&#x6863;</h2><h6 id="&#x5728;springboot&#x9879;&#x76EE;&#x7684;pom-xml&#x4E2D;&#x52A0;&#x5165;Swagger2&#x7684;&#x4F9D;&#x8D56;">0.1.0.0.0.1. &#x5728;springboot&#x9879;&#x76EE;&#x7684;pom.xml&#x4E2D;&#x52A0;&#x5165;Swagger2&#x7684;&#x4F9D;&#x8D56;</h6><a id="more"></a>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="&#x521B;&#x5EFA;Swagger2&#x914D;&#x7F6E;&#x7C7B;">0.1.0.0.0.2. &#x521B;&#x5EFA;Swagger2&#x914D;&#x7F6E;&#x7C7B;</h6><blockquote>
<p>&#x5728;Application.java&#x540C;&#x7EA7;&#x521B;&#x5EFA;Swagger2&#x7684;&#x914D;&#x7F6E;&#x7C7B;Swagger2</p>
</blockquote>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Configuration</span></span><br><span class="line"><span class="variable">@EnableSwagger2</span></span><br><span class="line">public class Swagger2 {</span><br><span class="line">    <span class="variable">@Bean</span></span><br><span class="line">    public Docket createRestApi() {</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">new</span> <span class="selector-tag">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                <span class="selector-class">.apiInfo</span>(apiInfo())</span><br><span class="line">                <span class="selector-class">.select</span>()</span><br><span class="line">                <span class="selector-class">.apis</span>(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.example.demo.controller&quot;</span>))</span><br><span class="line">                <span class="selector-class">.paths</span>(PathSelectors.any())</span><br><span class="line">                <span class="selector-class">.build</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">ApiInfo</span> <span class="selector-tag">apiInfo</span>() {</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">new</span> <span class="selector-tag">ApiInfoBuilder</span>()</span><br><span class="line">                <span class="selector-class">.title</span>(<span class="string">&quot;&#x4F59;&#x745C;&#x7684;Spring Boot&#x4E2D;&#x4F7F;&#x7528;Swagger2&#x6784;&#x5EFA;RESTful APIs&quot;</span>)</span><br><span class="line">                <span class="selector-class">.description</span>(<span class="string">&quot;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x63CF;&#x8FF0;&quot;</span>)</span><br><span class="line">                <span class="selector-class">.termsOfServiceUrl</span>(<span class="string">&quot;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&quot;</span>)</span><br><span class="line">                <span class="selector-class">.contact</span>(<span class="string">&quot;&#x4F59;&#x745C;&quot;</span>)</span><br><span class="line">                <span class="selector-class">.version</span>(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                <span class="selector-class">.build</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x901A;&#x8FC7;@Configuration&#x6CE8;&#x89E3;&#xFF0C;&#x8BA9;Spring&#x6765;&#x52A0;&#x8F7D;&#x8BE5;&#x7C7B;&#x914D;&#x7F6E;&#x3002;&#x518D;&#x901A;&#x8FC7;@EnableSwagger2&#x6CE8;&#x89E3;&#x6765;&#x542F;&#x7528;Swagger2&#x3002;</li>
<li>&#x518D;&#x901A;&#x8FC7;createRestApi&#x51FD;&#x6570;&#x521B;&#x5EFA;Docket&#x7684;Bean&#x4E4B;&#x540E;&#xFF0C;apiInfo()&#x7528;&#x6765;&#x521B;&#x5EFA;&#x8BE5;Api&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#xFF08;&#x8FD9;&#x4E9B;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#x4F1A;&#x5C55;&#x73B0;&#x5728;&#x6587;&#x6863;&#x9875;&#x9762;&#x4E2D;&#xFF09;&#x3002;</li>
<li>select()&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;ApiSelectorBuilder&#x5B9E;&#x4F8B;&#x7528;&#x6765;&#x63A7;&#x5236;&#x54EA;&#x4E9B;&#x63A5;&#x53E3;&#x66B4;&#x9732;&#x7ED9;Swagger&#x6765;&#x5C55;&#x73B0;&#xFF0C;&#x672C;&#x4F8B;&#x91C7;&#x7528;&#x6307;&#x5B9A;&#x626B;&#x63CF;&#x7684;&#x5305;&#x8DEF;&#x5F84;&#x6765;&#x5B9A;&#x4E49;&#xFF0C;Swagger&#x4F1A;&#x626B;&#x63CF;&#x8BE5;&#x5305;&#x4E0B;&#x6240;&#x6709;Controller&#x5B9A;&#x4E49;&#x7684;API&#xFF0C;&#x5E76;&#x4EA7;&#x751F;&#x6587;&#x6863;&#x5185;&#x5BB9;&#xFF08;&#x9664;&#x4E86;&#x88AB;@ApiIgnore&#x6307;&#x5B9A;&#x7684;&#x8BF7;&#x6C42;&#xFF09;&#x3002;</li>
</ul>
<h6 id="&#x6DFB;&#x52A0;&#x6587;&#x6863;&#x5185;&#x5BB9;">0.1.0.0.0.3. &#x6DFB;&#x52A0;&#x6587;&#x6863;&#x5185;&#x5BB9;</h6><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(<span class="keyword">value</span>=&quot;/users&quot;)     // &#x901A;&#x8FC7;&#x8FD9;&#x91CC;&#x914D;&#x7F6E;&#x4F7F;&#x4E0B;&#x9762;&#x7684;&#x6620;&#x5C04;&#x90FD;&#x5728;/users&#x4E0B;&#xFF0C;&#x53EF;&#x53BB;&#x9664;</span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> UserController {</span><br><span class="line"></span><br><span class="line">    static Map&lt;Long, <span class="keyword">User</span>&gt; users = Collections.synchronizedMap(<span class="built_in">new</span> HashMap&lt;Long, <span class="keyword">User</span>&gt;());</span><br><span class="line"></span><br><span class="line">    @ApiOperation(<span class="keyword">value</span>=&quot;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x5217;&#x8868;&quot;, notes=&quot;&quot;)</span><br><span class="line">    @RequestMapping(<span class="keyword">value</span>={&quot;&quot;}, <span class="keyword">method</span>=RequestMethod.<span class="keyword">GET</span>)</span><br><span class="line">    <span class="built_in">public</span> List&lt;<span class="keyword">User</span>&gt; getUserList() {</span><br><span class="line">        List&lt;<span class="keyword">User</span>&gt; r = <span class="built_in">new</span> ArrayList&lt;<span class="keyword">User</span>&gt;(users.<span class="keyword">values</span>());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @ApiOperation(<span class="keyword">value</span>=&quot;&#x521B;&#x5EFA;&#x7528;&#x6237;&quot;, notes=&quot;&#x6839;&#x636E;User&#x5BF9;&#x8C61;&#x521B;&#x5EFA;&#x7528;&#x6237;&quot;)</span><br><span class="line">    @ApiImplicitParam(<span class="type">name</span> = &quot;user&quot;, <span class="keyword">value</span> = &quot;&#x7528;&#x6237;&#x8BE6;&#x7EC6;&#x5B9E;&#x4F53;user&quot;, required = <span class="keyword">true</span>, dataType = &quot;User&quot;)</span><br><span class="line">    @RequestMapping(<span class="keyword">value</span>=&quot;&quot;, <span class="keyword">method</span>=RequestMethod.POST)</span><br><span class="line">    <span class="built_in">public</span> String postUser(@RequestBody <span class="keyword">User</span> <span class="keyword">user</span>) {</span><br><span class="line">        users.put(<span class="keyword">user</span>.getId(), <span class="keyword">user</span>);</span><br><span class="line">        <span class="keyword">return</span> &quot;success&quot;;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @ApiOperation(<span class="keyword">value</span>=&quot;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&quot;, notes=&quot;&#x6839;&#x636E;url&#x7684;id&#x6765;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&quot;)</span><br><span class="line">    @ApiImplicitParam(<span class="type">name</span> = &quot;id&quot;, <span class="keyword">value</span> = &quot;&#x7528;&#x6237;ID&quot;, required = <span class="keyword">true</span>, dataType = &quot;Long&quot;)</span><br><span class="line">    @RequestMapping(<span class="keyword">value</span>=&quot;/{id}&quot;, <span class="keyword">method</span>=RequestMethod.<span class="keyword">GET</span>)</span><br><span class="line">    <span class="built_in">public</span> <span class="keyword">User</span> getUser(@PathVariable Long id) {</span><br><span class="line">        <span class="keyword">return</span> users.<span class="keyword">get</span>(id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @ApiOperation(<span class="keyword">value</span>=&quot;&#x66F4;&#x65B0;&#x7528;&#x6237;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&quot;, notes=&quot;&#x6839;&#x636E;url&#x7684;id&#x6765;&#x6307;&#x5B9A;&#x66F4;&#x65B0;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x6839;&#x636E;&#x4F20;&#x8FC7;&#x6765;&#x7684;user&#x4FE1;&#x606F;&#x6765;&#x66F4;&#x65B0;&#x7528;&#x6237;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&quot;)</span><br><span class="line">    @ApiImplicitParams({</span><br><span class="line">            @ApiImplicitParam(<span class="type">name</span> = &quot;id&quot;, <span class="keyword">value</span> = &quot;&#x7528;&#x6237;ID&quot;, required = <span class="keyword">true</span>, dataType = &quot;Long&quot;),</span><br><span class="line">            @ApiImplicitParam(<span class="type">name</span> = &quot;user&quot;, <span class="keyword">value</span> = &quot;&#x7528;&#x6237;&#x8BE6;&#x7EC6;&#x5B9E;&#x4F53;user&quot;, required = <span class="keyword">true</span>, dataType = &quot;User&quot;)</span><br><span class="line">    })</span><br><span class="line">    @RequestMapping(<span class="keyword">value</span>=&quot;/{id}&quot;, <span class="keyword">method</span>=RequestMethod.PUT)</span><br><span class="line">    <span class="built_in">public</span> String putUser(@PathVariable Long id, @RequestBody <span class="keyword">User</span> <span class="keyword">user</span>) {</span><br><span class="line">        <span class="keyword">User</span> u = users.<span class="keyword">get</span>(id);</span><br><span class="line">        u.setName(<span class="keyword">user</span>.getName());</span><br><span class="line">        u.setAge(<span class="keyword">user</span>.getAge());</span><br><span class="line">        users.put(id, u);</span><br><span class="line">        <span class="keyword">return</span> &quot;success&quot;;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @ApiOperation(<span class="keyword">value</span>=&quot;&#x5220;&#x9664;&#x7528;&#x6237;&quot;, notes=&quot;&#x6839;&#x636E;url&#x7684;id&#x6765;&#x6307;&#x5B9A;&#x5220;&#x9664;&#x5BF9;&#x8C61;&quot;)</span><br><span class="line">    @ApiImplicitParam(<span class="type">name</span> = &quot;id&quot;, <span class="keyword">value</span> = &quot;&#x7528;&#x6237;ID&quot;, required = <span class="keyword">true</span>, dataType = &quot;Long&quot;)</span><br><span class="line">    @RequestMapping(<span class="keyword">value</span>=&quot;/{id}&quot;, <span class="keyword">method</span>=RequestMethod.<span class="keyword">DELETE</span>)</span><br><span class="line">    <span class="built_in">public</span> String deleteUser(@PathVariable Long id) {</span><br><span class="line">        users.remove(id);</span><br><span class="line">        <span class="keyword">return</span> &quot;success&quot;;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x5B8C;&#x6210;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x6DFB;&#x52A0;&#x4E0A;&#xFF0C;&#x542F;&#x52A8;Spring Boot&#x7A0B;&#x5E8F;&#xFF0C;&#x8BBF;&#x95EE;&#xFF1A;<a href="http://localhost:8080/swagger-ui.html" target="_blank" rel="noopener">http://localhost:8080/swagger-ui.html</a><br>&#x3002;&#x5C31;&#x80FD;&#x770B;&#x5230;&#x524D;&#x6587;&#x6240;&#x5C55;&#x793A;&#x7684;RESTful API&#x7684;&#x9875;&#x9762;&#x3002;</p>
</blockquote>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>Swagger2</tag>
      </tags>
  </entry>
  <entry>
    <title>InnoDB和MyISAM区别</title>
    <url>/2019/InnoDB-he-MyISAM-qv-bie/</url>
    <content><![CDATA[<h1 id="&#x533A;&#x522B;&#xFF1A;">1. &#x533A;&#x522B;&#xFF1A;</h1><ol>
<li>InnoDB&#x652F;&#x6301;&#x4E8B;&#x52A1;&#xFF0C;MyISAM&#x4E0D;&#x652F;&#x6301;&#xFF0C;&#x5BF9;&#x4E8E;InnoDB&#x6BCF;&#x4E00;&#x6761;SQL&#x8BED;&#x8A00;&#x90FD;&#x9ED8;&#x8BA4;&#x5C01;&#x88C5;&#x6210;&#x4E8B;&#x52A1;&#xFF0C;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#xFF0C;&#x8FD9;&#x6837;&#x4F1A;&#x5F71;&#x54CD;&#x901F;&#x5EA6;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x597D;&#x628A;&#x591A;&#x6761;SQL&#x8BED;&#x8A00;&#x653E;&#x5728;begin&#x548C;commit&#x4E4B;&#x95F4;&#xFF0C;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#xFF1B;  </li>
<li>InnoDB&#x652F;&#x6301;&#x5916;&#x952E;&#xFF0C;&#x800C;MyISAM&#x4E0D;&#x652F;&#x6301;&#x3002;&#x5BF9;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x5916;&#x952E;&#x7684;InnoDB&#x8868;&#x8F6C;&#x4E3A;MYISAM&#x4F1A;&#x5931;&#x8D25;&#xFF1B;</li>
<li>InnoDB&#x662F;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#xFF0C;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x662F;&#x548C;&#x7D22;&#x5F15;&#x7ED1;&#x5728;&#x4E00;&#x8D77;&#x7684;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x6709;&#x4E3B;&#x952E;&#xFF0C;&#x901A;&#x8FC7;&#x4E3B;&#x952E;&#x7D22;&#x5F15;&#x6548;&#x7387;&#x5F88;&#x9AD8;&#x3002;&#x4F46;&#x662F;&#x8F85;&#x52A9;&#x7D22;&#x5F15;&#x9700;&#x8981;&#x4E24;&#x6B21;&#x67E5;&#x8BE2;&#xFF0C;&#x5148;&#x67E5;&#x8BE2;&#x5230;&#x4E3B;&#x952E;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x901A;&#x8FC7;&#x4E3B;&#x952E;&#x67E5;&#x8BE2;&#x5230;&#x6570;&#x636E;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E3B;&#x952E;&#x4E0D;&#x5E94;&#x8BE5;&#x8FC7;&#x5927;&#xFF0C;&#x56E0;&#x4E3A;&#x4E3B;&#x952E;&#x592A;&#x5927;&#xFF0C;&#x5176;&#x4ED6;&#x7D22;&#x5F15;&#x4E5F;&#x90FD;&#x4F1A;&#x5F88;&#x5927;&#x3002;&#x800C;MyISAM&#x662F;&#x975E;&#x805A;&#x96C6;&#x7D22;&#x5F15;&#xFF0C;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x662F;&#x5206;&#x79BB;&#x7684;&#xFF0C;&#x7D22;&#x5F15;&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x7684;&#x6307;&#x9488;&#x3002;&#x4E3B;&#x952E;&#x7D22;&#x5F15;&#x548C;&#x8F85;&#x52A9;&#x7D22;&#x5F15;&#x662F;&#x72EC;&#x7ACB;&#x7684;&#x3002; </li>
<li>InnoDB&#x4E0D;&#x4FDD;&#x5B58;&#x8868;&#x7684;&#x5177;&#x4F53;&#x884C;&#x6570;&#xFF0C;&#x6267;&#x884C;select count(*) from table&#x65F6;&#x9700;&#x8981;&#x5168;&#x8868;&#x626B;&#x63CF;&#x3002;&#x800C;MyISAM&#x7528;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x4FDD;&#x5B58;&#x4E86;&#x6574;&#x4E2A;&#x8868;&#x7684;&#x884C;&#x6570;&#xFF0C;&#x6267;&#x884C;&#x4E0A;&#x8FF0;&#x8BED;&#x53E5;&#x65F6;&#x53EA;&#x9700;&#x8981;&#x8BFB;&#x51FA;&#x8BE5;&#x53D8;&#x91CF;&#x5373;&#x53EF;&#xFF0C;&#x901F;&#x5EA6;&#x5F88;&#x5FEB;&#xFF1B;</li>
<li>Innodb&#x4E0D;&#x652F;&#x6301;&#x5168;&#x6587;&#x7D22;&#x5F15;&#xFF0C;&#x800C;MyISAM&#x652F;&#x6301;&#x5168;&#x6587;&#x7D22;&#x5F15;&#xFF0C;&#x67E5;&#x8BE2;&#x6548;&#x7387;&#x4E0A;MyISAM&#x8981;&#x9AD8;&#xFF1B;   <a id="more"></a>
<h1 id="&#x5982;&#x4F55;&#x9009;&#x62E9;&#xFF1A;">2. &#x5982;&#x4F55;&#x9009;&#x62E9;&#xFF1A;</h1></li>
<li>&#x662F;&#x5426;&#x8981;&#x652F;&#x6301;&#x4E8B;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x8BF7;&#x9009;&#x62E9;innodb&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x53EF;&#x4EE5;&#x8003;&#x8651;MyISAM&#xFF1B; </li>
<li>&#x5982;&#x679C;&#x8868;&#x4E2D;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x90FD;&#x53EA;&#x662F;&#x8BFB;&#x67E5;&#x8BE2;&#xFF0C;&#x53EF;&#x4EE5;&#x8003;&#x8651;MyISAM&#xFF0C;&#x5982;&#x679C;&#x65E2;&#x6709;&#x8BFB;&#x5199;&#x4E5F;&#x633A;&#x9891;&#x7E41;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;InnoDB&#x3002;</li>
<li>&#x7CFB;&#x7EDF;&#x5954;&#x6E83;&#x540E;&#xFF0C;MyISAM&#x6062;&#x590D;&#x8D77;&#x6765;&#x66F4;&#x56F0;&#x96BE;&#xFF0C;&#x80FD;&#x5426;&#x63A5;&#x53D7;&#xFF1B;</li>
<li>MySQL5.5&#x7248;&#x672C;&#x5F00;&#x59CB;Innodb&#x5DF2;&#x7ECF;&#x6210;&#x4E3A;Mysql&#x7684;&#x9ED8;&#x8BA4;&#x5F15;&#x64CE;(&#x4E4B;&#x524D;&#x662F;MyISAM)&#xFF0C;&#x8BF4;&#x660E;&#x5176;&#x4F18;&#x52BF;&#x662F;&#x6709;&#x76EE;&#x5171;&#x7779;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x77E5;&#x9053;&#x7528;&#x4EC0;&#x4E48;&#xFF0C;&#x90A3;&#x5C31;&#x7528;InnoDB&#xFF0C;&#x81F3;&#x5C11;&#x4E0D;&#x4F1A;&#x5DEE;&#x3002;</li>
</ol>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>innodb</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL中的函数</title>
    <url>/2019/MySQL-han-shu/</url>
    <content><![CDATA[<h1 id="ON-DUPLICATE-KEY-UPDATE">1. ON DUPLICATE KEY UPDATE</h1><blockquote>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x8868;&#x4E2D;day&#x548C;slot&#x90FD;&#x662F;&#x4E3B;&#x952E;,&#x8FDB;&#x884C;&#x63D2;&#x5165;&#x65F6;&#x5982;&#x679C;&#x63D2;&#x5165;&#x7684;&#x6570;&#x636E;&#x4E2D;day&#x6216;&#x8005;slot&#x6709;&#x4E00;&#x9879;&#x548C;&#x8868;&#x4E2D;&#x6570;&#x636E;&#x65F6;&#x91CD;&#x590D;&#x7684;&#x5C31;&#x4E0D;&#x6DFB;&#x52A0;&#x76F4;&#x63A5;&#x5BF9;&#x8868;&#x4E2D;&#x8BE5;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;,cnt = cnt + 1</p>
</blockquote>
<a id="more"></a>

<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="comment">--</span></span><br><span class="line">x&#x8868;&#x4E2D;day&#x88AB;<span class="keyword">group</span> <span class="keyword">by</span>&#x4E86;&#x6240;&#x4EE5;&#x6BCF;&#x5929;&#x7684;&#x4E1C;&#x897F;&#x88AB;&#x6C47;&#x603B;,&#x6BD4;&#x5982;&#x4ECA;&#x5929;&#x5C31;&#x53EA;&#x6709;&#x4E00;&#x6761;&#x6570;&#x636E;,&#x4EE5;&#x4ECA;&#x5929;&#x4E3A;&#x4F8B;&#x548C;c&#x8868;&#x8FDB;&#x884C;&#x5173;&#x8054;&#x540E;,&#x5173;&#x8054;&#x8BED;&#x53E5;&#x4E3A;day&#x76F8;&#x540C;,&#x90A3;&#x4E48;x&#x8868;&#x7684;&#x4ECA;&#x5929;&#x7684;&#x6570;&#x636E;&#x4F1A;&#x548C;c&#x8868;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x4ECA;&#x5929;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x5408;&#x6210;&#x4E00;&#x6761;&#x65B0;&#x7684;&#x6570;&#x636E;. </span><br><span class="line">&#x7136;&#x540E;<span class="keyword">set</span> , &#x5982;&#x679C;&#x69FD;&#x4F4D;&#x76F8;&#x540C;&#x4E5F;&#x5C31;&#x662F;<span class="number">0</span>; &#x90A3;&#x4E48;c&#x8868;&#x4E2D;&#x7684;cnt&#x4F1A;&#x53D8;&#x4E3A;x&#x8868;&#x7684;cnt,&#x540C;&#x65F6;slot&#x4F1A;&#x53D8;&#x4E3A;<span class="number">0</span>,         &#x5426;&#x5219;cnt&#x53D8;&#x4E3A;<span class="number">0</span>,&#x69FD;&#x4F4D;&#x8FD8;&#x662F;&#x539F;&#x6765;&#x7684;&#x69FD;&#x4F4D;.</span><br><span class="line">&#x6709;&#x4E24;&#x6761;<span class="keyword">set</span>&#x5E76;&#x4E14;&#x90FD;&#x6709;<span class="keyword">if</span>&#x662F;&#x56E0;&#x4E3A;&#x6015;&#x8868;&#x4E2D;&#x6CA1;&#x6709;slot=<span class="number">0</span>,&#x90A3;&#x4E48;&#x4E45;&#x5C06;&#x6700;&#x5C0F;&#x7684;&#x90A3;&#x4E2A;slot&#x8D4B;&#x503C;&#x4E3A;<span class="number">0</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> daily_hit_counter(</span><br><span class="line">    day <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    slot tinyint unsigned <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    cnt <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> ,</span><br><span class="line">    <span class="keyword">primary key</span>(day, slot)</span><br><span class="line">)ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> daily_hit_counter(day, slot, cnt)</span><br><span class="line">    <span class="keyword">VALUES</span>(<span class="built_in">CURRENT_DATE</span>, RAND()*<span class="number">100</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span> cnt = cnt + <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h1 id="USING">2. USING()</h1><blockquote>
<p>&#x89C1;&#x4E0A;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#x5982;&#x679C;&#x4E24;&#x5F20;&#x8868;&#x7684;&#x7528;* join&#x505A;&#x5173;&#x8054;,&#x5E76;&#x4E14;on&#x5B57;&#x6BB5;&#x663E;&#x793A;&#x7684;&#x5173;&#x8054;&#x5B57;&#x6BB5;&#x540D;&#x79F0;&#x4E00;&#x81F4;,&#x53EF;&#x4EE5;&#x4F7F;&#x7528;USING()&#x4EE3;&#x66FF;on</p>
</blockquote>
<h1 id="CURRENT-DATE">3. CURRENT_DATE</h1><blockquote>
<p>&#x5F53;&#x524D;&#x65E5;&#x671F;  &#x4E0D;&#x5E26;&#x65F6;&#x5206;&#x79D2;</p>
</blockquote>
<h1 id="RAND">4. RAND()</h1><blockquote>
<p>&#x751F;&#x6210;&#x5927;&#x4E8E;0&#x5C0F;&#x4E8E;1&#x7684;&#x968F;&#x673A;&#x6570;</p>
</blockquote>
<h1 id="CONCAT-a-b">5. CONCAT(a,b)</h1><blockquote>
<p>&#x62FC;&#x63A5;&#x5B57;&#x7B26;&#x4E32;</p>
</blockquote>
<h1 id="LEFT-&#x201C;&#x5B57;&#x7B26;&#x4E32;s&#x201D;-n">6. LEFT(&#x201C;&#x5B57;&#x7B26;&#x4E32;s&#x201D;,n)</h1><blockquote>
<p>&#x622A;&#x53D6;s&#x7684;&#x524D;n&#x4F4D;</p>
</blockquote>
<h1 id="LEFT-NOW-14">7. LEFT(NOW(), 14)</h1><blockquote>
<p>&#x6765;&#x83B7;&#x5F97;&#x5F53;&#x524D;&#x7684;&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x6700;&#x63A5;&#x8FD1;&#x7684;&#x5C0F;&#x65F6;:</p>
</blockquote>
<h1 id="INET-ATON-INET-NTOA">8. INET_ATON() INET_NTOA()</h1><blockquote>
<p>&#x5C06;ip&#x5730;&#x5740;&#x5728;&#x5B57;&#x7B26;&#x4E32;&#x4E0E;&#x8BC1;&#x4E66;&#x4E4B;&#x95F4;&#x8F6C;&#x6362; address to number</p>
</blockquote>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">SELECT</span> <span class="function"><span class="title">INET_ATON</span>(<span class="string">&apos;192.168.1.1&apos;</span>)</span></span><br><span class="line"><span class="variable">SELECT</span> <span class="function"><span class="title">INET_NTOA</span>(<span class="string">&apos;3232235777&apos;</span>)</span></span><br></pre></td></tr></table></figure>

<h1 id="INTERVAL">9. INTERVAL</h1><blockquote>
<p>MySQL&#x65E5;&#x671F;&#x6362;&#x7B97;&#x8FDE;&#x63A5;&#x7B26;</p>
</blockquote>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">1</span>. <span class="selector-tag">MySQL</span> &#x4E3A;&#x65E5;&#x671F;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#xFF1A;<span class="selector-tag">date_add</span>()</span><br><span class="line"><span class="selector-tag">select</span> <span class="selector-tag">date_add</span>(<span class="variable">@now</span>(), interval <span class="number">1</span> day);   <span class="selector-tag">-</span> &#x52A0;<span class="selector-tag">1</span>&#x5929;</span><br></pre></td></tr></table></figure>

<h1 id="TO-DAYS">10. TO_DAYS()</h1><blockquote>
<p>&#x8FD4;&#x56DE;&#x4ECE;0000&#x5E74;&#xFF08;&#x516C;&#x5143;1&#x5E74;&#xFF09;&#x81F3;&#x5F53;&#x524D;&#x65E5;&#x671F;&#x7684;&#x603B;&#x5929;&#x6570;&#x3002;</p>
</blockquote>
<h1 id="CURRENT-DATE-1">11. CURRENT_DATE</h1><blockquote>
<p>&#x83B7;&#x53D6;&#x7684;&#x662F;&#x5F53;&#x5929;&#x65E5;&#x671F;&#xFF0C;&#x5982;&#xFF1A;2015-12-07</p>
</blockquote>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
  </entry>
  <entry>
    <title>高性能mysql学习笔记</title>
    <url>/2019/gao-xing-neng-mysql-node/</url>
    <content><![CDATA[<h1 id="&#x7B2C;&#x4E00;&#x7AE0;-MySQL&#x67B6;&#x6784;">1. &#x7B2C;&#x4E00;&#x7AE0; MySQL&#x67B6;&#x6784;</h1><h2 id="1-1-MySQL&#x903B;&#x8F91;&#x67B6;&#x6784;">1.1. 1.1 MySQL&#x903B;&#x8F91;&#x67B6;&#x6784;</h2><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">graph TB</span><br><span class="line"><span class="function"><span class="title">E</span><span class="params">(&#x5BA2;&#x6237;&#x7AEF;)</span></span>---A</span><br><span class="line"><span class="function"><span class="title">A</span><span class="params">(&#x8FDE;&#x63A5;/&#x7EBF;&#x7A0B;&#x5904;&#x7406;)</span></span>---B(&#x67E5;&#x8BE2;&#x7F13;&#x5B58;)</span><br><span class="line"><span class="function"><span class="title">A---C</span><span class="params">(&#x89E3;&#x6790;&#x5668;)</span></span></span><br><span class="line">C---B</span><br><span class="line"><span class="function"><span class="title">C---D</span><span class="params">(&#x4F18;&#x5316;&#x5668;)</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">graph TB</span><br><span class="line"><span class="function"><span class="title">E</span><span class="params">(&#x5B58;&#x50A8;&#x5F15;&#x64CE;)</span></span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<ul>
<li>&#x6700;&#x4E0A;&#x5C42;&#x7684;&#x670D;&#x52A1;&#x5E76;&#x4E0D;&#x662F;MySQL&#x72EC;&#x6709;&#x7684;,&#x5927;&#x591A;&#x6570;&#x57FA;&#x4E8E;&#x7F51;&#x7EDC;&#x7684;&#x5BA2;&#x6237;&#x7AEF;/&#x670D;&#x52A1;&#x5668;&#x5DE5;&#x5177;&#x6216;&#x8005;&#x670D;&#x52A1;&#x90FD;&#x6709;&#x7C7B;&#x4F3C;&#x7684;&#x7ED3;&#x6784;.&#x6BD4;&#x5982;&#x8FDE;&#x63A5;&#x5904;&#x7406;.&#x6388;&#x6743;&#x8BA4;&#x8BC1;.&#x5B89;&#x5168;&#x7B49;&#x7B49;</li>
<li>&#x7B2C;&#x4E8C;&#x5C42;&#x673A;&#x6784;&#x662F;MySQL&#x6BD4;&#x8F83;&#x6709;&#x610F;&#x601D;&#x7684;&#x90E8;&#x5206;.&#x5305;&#x62EC;&#x67E5;&#x8BE2;&#x89E3;&#x6790;.&#x5206;&#x6790;.&#x4F18;&#x5316;.&#x7F13;&#x5B58;&#x4EE5;&#x53CA;&#x6240;&#x6709;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570;(&#x4F8B;&#x5982;&#x65E5;&#x671F;.&#x6570;&#x5B66;.&#x52A0;&#x5BC6;&#x51FD;&#x6570;),&#x6240;&#x6709;&#x8DE8;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684;&#x529F;&#x80FD;&#x90FD;&#x5728;&#x8FD9;&#x4E00;&#x5C42;&#x5B9E;&#x73B0;:&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;.&#x89E6;&#x53D1;&#x5668;.&#x89C6;&#x56FE;&#x7B49;.</li>
<li>&#x7B2C;&#x4E09;&#x5C42;&#x5305;&#x542B;&#x4E86;&#x5B58;&#x50A8;&#x5F15;&#x64CE;.&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x8D1F;&#x8D23;MySQL&#x4E2D;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#x548C;&#x63D0;&#x53D6;.&#x670D;&#x52A1;&#x5668;&#x901A;&#x8FC7;API&#x4E0E;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x8FDB;&#x884C;&#x901A;&#x4FE1;.&#x8FD9;&#x4E9B;&#x63A5;&#x53E3;&#x5C4F;&#x853D;&#x4E86;&#x4E0D;&#x540C;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;,&#x4F7F;&#x5F97;&#x8FD9;&#x4E9B;&#x5DEE;&#x5F02;&#x5BF9;&#x4E0A;&#x5C42;&#x7684;&#x67E5;&#x8BE2;&#x8FC7;&#x7A0B;&#x900F;&#x660E;.&#x5B58;&#x50A8;&#x5F15;&#x64CE;API&#x5305;&#x542B;&#x51E0;&#x5341;&#x4E2A;&#x5E95;&#x5C42;&#x51FD;&#x6570;,&#x7528;&#x4E8E;&#x6267;&#x884C;&#x8BF8;&#x5982;&#x201D;&#x5F00;&#x59CB;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x201D;&#x6216;&#x8005;&#x201D;&#x6839;&#x636E;&#x4E3B;&#x952E;&#x63D0;&#x53D6;&#x4E00;&#x884C;&#x8BB0;&#x5F55;&#x201D;&#x7B49;&#x64CD;&#x4F5C;.&#x4F46;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E0D;&#x4F1A;&#x53BB;&#x89E3;&#x6790;SQL,&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E4B;&#x95F4;&#x4E5F;&#x4E0D;&#x4F1A;&#x76F8;&#x4E92;&#x901A;&#x4FE1;,&#x800C;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x54CD;&#x5E94;&#x4E0A;&#x5C42;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8BF7;&#x6C42;.</li>
</ul>
<h3 id="1-1-1-&#x8FDE;&#x63A5;&#x7BA1;&#x7406;&#x4E0E;&#x5B89;&#x5168;&#x6027;">1.1.1. 1.1.1 &#x8FDE;&#x63A5;&#x7BA1;&#x7406;&#x4E0E;&#x5B89;&#x5168;&#x6027;</h3><blockquote>
<p>&#x6BCF;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x90FD;&#x4F1A;&#x5728;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x7A0B;&#x4E2D;&#x62E5;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;,&#x8FD9;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;&#x67E5;&#x8BE2;&#x53EA;&#x4F1A;&#x5728;&#x8FD9;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;,&#x8BE5;&#x7EBF;&#x7A0B;&#x53EA;&#x80FD;&#x8F6E;&#x6D41;&#x5728;&#x67D0;&#x4E2A;CPU&#x6838;&#x5FC3;&#x6216;&#x8005;CPU&#x4E2D;&#x8FD0;&#x884C;.&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x8D1F;&#x8D23;&#x7F13;&#x5B58;&#x7EBF;&#x7A0B;,&#x56E0;&#x6B64;&#x4E0D;&#x9700;&#x8981;&#x4E3A;&#x6BCF;&#x4E2A;&#x65B0;&#x5EFA;&#x7684;&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x6216;&#x8005;&#x9500;&#x6BC1;&#x7EBF;&#x7A0B;</p>
</blockquote>
<h3 id="1-1-2-&#x4F18;&#x5316;&#x4E0E;&#x6267;&#x884C;">1.1.2. 1.1.2 &#x4F18;&#x5316;&#x4E0E;&#x6267;&#x884C;</h3><ul>
<li>MySQL&#x4F1A;&#x89E3;&#x6790;&#x67E5;&#x8BE2;,&#x5E76;&#x521B;&#x5EFA;&#x5185;&#x90E8;&#x6570;&#x636E;&#x7ED3;&#x6784;(&#x89E3;&#x6790;&#x6811;),&#x7136;&#x540E;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x5404;&#x79CD;&#x4F18;&#x5316;,&#x5305;&#x62EC;&#x91CD;&#x5199;&#x67E5;&#x8BE2;.&#x51B3;&#x5B9A;&#x8868;&#x7684;&#x8BFB;&#x53D6;&#x987A;&#x5E8F;,&#x4EE5;&#x53CA;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x7D22;&#x5F15;&#x7B49;.</li>
<li>&#x4F18;&#x5316;&#x5668;&#x5E76;&#x4E0D;&#x5173;&#x5FC3;&#x8868;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x5B58;&#x50A8;&#x5F15;&#x64CE;,&#x4F46;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5BF9;&#x4E8E;&#x4F18;&#x5316;&#x67E5;&#x8BE2;&#x662F;&#x6709;&#x5F71;&#x54CD;&#x7684;.&#x4F18;&#x5316;&#x5668;&#x4F1A;&#x8BF7;&#x6C42;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x63D0;&#x4F9B;&#x5BB9;&#x91CF;&#x6216;&#x67D0;&#x4E2A;&#x5177;&#x4F53;&#x64CD;&#x4F5C;&#x7684;&#x5F00;&#x9500;&#x4FE1;&#x606F;,&#x4EE5;&#x53CA;&#x8868;&#x6570;&#x636E;&#x7684;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x7B49;.</li>
<li><ul>
<li>&#x4F8B;&#x5982;,&#x67D0;&#x4E9B;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684;&#x67D0;&#x79CD;&#x7D22;&#x5F15;,&#x53EF;&#x80FD;&#x5BF9;&#x4E00;&#x4E9B;&#x7279;&#x5B9A;&#x7684;&#x67E5;&#x8BE2;&#x6709;&#x4F18;&#x5316;.</li>
</ul>
</li>
<li><strong>&#x5BF9;&#x4E8E;SELECT&#x8BED;&#x53E5;,&#x5728;&#x89E3;&#x6790;&#x67E5;&#x8BE2;&#x4E4B;&#x524D;,&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x5148;&#x68C0;&#x67E5;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;(query cache),&#x5982;&#x679C;&#x80FD;&#x591F;&#x5728;&#x5176;&#x4E2D;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x67E5;&#x8BE2;,&#x670D;&#x52A1;&#x5668;&#x5C31;&#x4E0D;&#x5FC5;&#x5728;&#x6267;&#x884C;&#x67E5;&#x8BE2;&#x89E3;&#x6790;.&#x4F18;&#x5316;&#x548C;&#x6267;&#x884C;&#x7684;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;,&#x800C;&#x662F;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x7ED3;&#x679C;&#x96C6;.</strong></li>
</ul>
<h2 id="1-2-&#x5E76;&#x53D1;&#x63A7;&#x5236;">1.2. 1.2 &#x5E76;&#x53D1;&#x63A7;&#x5236;</h2><blockquote>
<p>&#x65E0;&#x8BBA;&#x4F55;&#x65F6;,&#x53EA;&#x8981;&#x6709;&#x591A;&#x4E2A;&#x67E5;&#x8BE2;&#x9700;&#x8981;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x4FEE;&#x6539;&#x6570;&#x636E;,&#x90FD;&#x4F1A;&#x4EA7;&#x751F;&#x5E76;&#x53D1;&#x63A7;&#x5236;&#x7684;&#x95EE;&#x9898;.MySQL&#x5728;&#x4E24;&#x4E2A;&#x5C42;&#x9762;&#x7684;&#x5E76;&#x53D1;&#x63A7;&#x5236;</p>
<ul>
<li>&#x670D;&#x52A1;&#x5C42;&#x5E76;&#x53D1;&#x63A7;&#x5236;</li>
<li>&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5C42;&#x5E76;&#x53D1;&#x63A7;&#x5236;</li>
</ul>
</blockquote>
<h3 id="1-2-1-&#x8BFB;&#x5199;&#x9501;">1.2.1. 1.2.1 &#x8BFB;&#x5199;&#x9501;</h3><blockquote>
<p>&#x5728;&#x5904;&#x7406;&#x5E76;&#x53D1;&#x8BFB;&#x6216;&#x8005;&#x5199;&#x65F6;,&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7531;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x9501;&#x7EC4;&#x6210;&#x7684;&#x9501;&#x7CFB;&#x7EDF;&#x6765;&#x89E3;&#x51B3;&#x95EE;&#x9898;.&#x8FD9;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x9501;&#x901A;&#x5E38;&#x88AB;&#x79F0;&#x4E3A;&#x5171;&#x4EAB;&#x9501;(shared lock)&#x548C;&#x6392;&#x5B83;&#x9501;(exclusive lock),&#x4E5F;&#x53EB;&#x8BFB;&#x9501;(read lock)&#x548C;&#x5199;&#x9501;(write lock).<br><strong>&#x9501;&#x7684;&#x6982;&#x5FF5;:</strong></p>
</blockquote>
<ul>
<li>&#x8BFB;&#x9501;&#x662F;&#x5171;&#x4EAB;&#x7684;,&#x6216;&#x8005;&#x8BF4;&#x662F;&#x76F8;&#x4E92;&#x4E0D;&#x963B;&#x585E;&#x7684;.&#x591A;&#x4E2A;&#x5BA2;&#x6237;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x8BFB;&#x53D6;&#x540C;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;,&#x800C;&#x4E92;&#x4E0D;&#x5E72;&#x6270;.</li>
<li>&#x5199;&#x9501;&#x5219;&#x662F;&#x6392;&#x4ED6;&#x7684;,&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E00;&#x4E2A;&#x5199;&#x9501;&#x4F1A;&#x963B;&#x585E;&#x5176;&#x4ED6;&#x7684;&#x5199;&#x9501;&#x548C;&#x8BFB;&#x9501;,&#x8FD9;&#x662F;&#x51FA;&#x4E8E;&#x5B89;&#x5168;&#x7B56;&#x7565;&#x7684;&#x8003;&#x8651;,&#x53EA;&#x6709;&#x8FD9;&#x6837;,&#x624D;&#x80FD;&#x786E;&#x4FDD;&#x5728;&#x7ED9;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x91CC;,&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x80FD;&#x6267;&#x884C;&#x5199;&#x5165;,&#x5E76;&#x9632;&#x6B62;&#x5176;&#x4ED6;&#x7528;&#x6237;&#x8BFB;&#x53D6;&#x6B63;&#x5728;&#x5199;&#x5165;&#x7684;&#x7EDF;&#x4E00;&#x8D44;&#x6E90;.</li>
</ul>
<blockquote>
<p>&#x5728;&#x5B9E;&#x9645;&#x7684;&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x4E2D;,&#x6CA1;&#x4E8B;&#x6CA1;&#x8BFE;&#x90FD;&#x5728;&#x53D1;&#x751F;&#x9501;&#x5B9A;,&#x5F53;&#x67D0;&#x4E2A;&#x7528;&#x6237;&#x5728;&#x4FEE;&#x6539;&#x67D0;&#x4E00;&#x90E8;&#x5206;&#x6570;&#x636E;&#x662F;,MySQL&#x4F1A;&#x901A;&#x8FC7;&#x9501;&#x5B9A;&#x9632;&#x6B62;&#x5176;&#x4ED6;&#x7528;&#x6237;&#x8BFB;&#x53D6;&#x7EDF;&#x4E00;&#x6570;&#x636E;.&#x5927;&#x591A;&#x6570;&#x65F6;&#x5019;,MySQL&#x9501;&#x7684;&#x5185;&#x90E8;&#x7BA1;&#x7406;&#x90FD;&#x662F;&#x900F;&#x660E;&#x7684;.</p>
</blockquote>
<h3 id="1-2-2-&#x9501;&#x7C92;&#x5EA6;">1.2.2. 1.2.2 &#x9501;&#x7C92;&#x5EA6;</h3><blockquote>
<p>&#x4E00;&#x79CD;&#x63D0;&#x9AD8;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x5E76;&#x53D1;&#x6027;&#x7684;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x8BA9;&#x9501;&#x5B9A;&#x5BF9;&#x8C61;&#x66F4;&#x6709;&#x9009;&#x62E9;&#x6027;.&#x5C3D;&#x91CF;&#x53EA;&#x9501;&#x5B9A;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x90E8;&#x5206;&#x6570;&#x636E;&#x800C;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x8D44;&#x6E90;.&#x66F4;&#x7406;&#x60F3;&#x7684;&#x65B9;&#x5F0F;&#x662F;,&#x652F;&#x961F;&#x4F1A;&#x4FEE;&#x6539;&#x7684;&#x6570;&#x636E;&#x7247;&#x8FDB;&#x884C;&#x7CBE;&#x786E;&#x7684;&#x9501;&#x5B9A;.&#x4EFB;&#x4F55;&#x65F6;&#x5019;,&#x5728;&#x7ED9;&#x5B9A;&#x7684;&#x8D44;&#x6E90;&#x4E0A;,&#x9501;&#x5B9A;&#x7684;&#x6570;&#x636E;&#x91CF;&#x8D8A;&#x5C11;,&#x5219;&#x7CFB;&#x7EDF;&#x7684;&#x5E76;&#x53D1;&#x6210;&#x90FD;&#x8D8A;&#x9AD8;,&#x53EA;&#x8981;&#x76F8;&#x4E92;&#x4E4B;&#x95F4;&#x4E0D;&#x53D1;&#x751F;&#x51B2;&#x7A81;&#x5373;&#x53EF;.</p>
</blockquote>
<p><strong>&#x95EE;&#x9898;&#x662F;&#x67B7;&#x9501;&#x4E5F;&#x9700;&#x8981;&#x6D88;&#x8017;&#x8D44;&#x6E90;</strong></p>
<p>&#x9501;&#x7684;&#x5404;&#x79CD;&#x64CD;&#x4F5C;,&#x5305;&#x62EC;&#x83B7;&#x5F97;&#x9501;,&#x68C0;&#x67E5;&#x9501;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x89E3;&#x9664;.&#x91CA;&#x653E;&#x9501;&#x7B49;,&#x90FD;&#x4F1A;&#x589E;&#x52A0;&#x7CFB;&#x7EDF;&#x7684;&#x5F00;&#x9500;.&#x5982;&#x679C;&#x7CFB;&#x7EDF;&#x8BDD;&#x8D39;&#x5927;&#x91CF;&#x7684;&#x65F6;&#x95F4;&#x6765;&#x7BA1;&#x7406;&#x6240;,&#x800C;&#x4E0D;&#x662F;&#x5B58;&#x53D6;&#x6570;&#x636E;,&#x90A3;&#x4E48;&#x7CFB;&#x7EDF;&#x7684;&#x6027;&#x80FD;&#x53EF;&#x80FD;&#x4F1A;&#x56E0;&#x6B64;&#x53D7;&#x5F71;&#x54CD;.</p>
<ul>
<li>&#x6240;&#x8C13;&#x7684;&#x9501;&#x7B56;&#x7565;,&#x5C31;&#x662F;&#x5728;&#x9501;&#x7684;&#x5F00;&#x9500;&#x548C;&#x6570;&#x636E;&#x7684;&#x5B89;&#x5168;&#x6027;&#x4E4B;&#x95F4;&#x5BFB;&#x6C42;&#x5E73;&#x8861;,&#x8FD9;&#x79CD;&#x5E73;&#x8861;&#x5F53;&#x7136;&#x4E5F;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x6027;&#x80FD;.&#x5927;&#x591A;&#x6570;&#x5546;&#x4E1A;&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x5E76;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x66F4;&#x591A;&#x7684;&#x9009;&#x62E9;,&#x4E00;&#x822C;&#x90FD;&#x662F;&#x5728;&#x8868;&#x4E0A;&#x65BD;&#x52A0;&#x884C;&#x7EA7;&#x9501;(row-level lock), &#x5E76;&#x4EE5;&#x5404;&#x79CD;&#x590D;&#x6742;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;,&#x4E00;&#x904D;&#x5728;&#x9501;&#x6BD4;&#x8F83;&#x591A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x63D0;&#x4F9B;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;.</li>
<li>MySQL&#x63D0;&#x4F9B;&#x4E86;&#x591A;&#x79CD;&#x9009;&#x62E9;.&#x6BCF;&#x79CD;MySQL&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x90FD;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x9501;&#x7B56;&#x7565;&#x548C;&#x9501;&#x7C92;&#x5EA6;.</li>
<li><ul>
<li>&#x5C06;&#x9501;&#x7C92;&#x5EA6;&#x56FA;&#x5B9A;&#x5728;&#x67D0;&#x4E2A;&#x7EA7;&#x522B;,&#x53EF;&#x4EE5;&#x4E3A;&#x67D0;&#x4E9B;&#x7279;&#x5B9A;&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;&#x63D0;&#x4F9B;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;,&#x4F46;&#x540C;&#x65F6;&#x5374;&#x4F1A;&#x5931;&#x53BB;&#x5BF9;&#x53E6;&#x5916;&#x4E00;&#x4E9B;&#x5E94;&#x7528;&#x573A;&#x666F;&#x7684;&#x826F;&#x597D;&#x652F;&#x6301;.</li>
</ul>
</li>
<li><em>&#x8868;&#x9501;(table lock)*</em><blockquote>
<p>&#x8868;&#x9501;&#x662F;MySQL&#x4E2D;&#x6700;&#x57FA;&#x672C;&#x7684;&#x9501;&#x7B56;&#x7565;,&#x5E76;&#x4E14;&#x662F;&#x5F00;&#x9500;&#x6700;&#x5C0F;&#x7684;&#x7B56;&#x7565;.</p>
</blockquote>
</li>
<li>&#x8868;&#x9501;&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#x4E8E;&#x6709;&#x5956;&#x67B7;&#x9501;&#x673A;&#x5236;:&#x4ED6;&#x4F1A;&#x9501;&#x5B9A;&#x6574;&#x5F20;&#x8868;.&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x5728;&#x5BF9;&#x8868;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;(&#x63D2;&#x5165;.&#x5220;&#x9664;.&#x66F4;&#x65B0;&#x7B49;)&#x94B1;,&#x53D6;&#x6D88;&#x5148;&#x83B7;&#x5F97;&#x5199;&#x9501;,&#x8FD9;&#x4F1A;&#x963B;&#x585E;&#x5176;&#x4ED6;&#x7528;&#x6237;&#x5BF9;&#x8BE5;&#x8868;&#x7684;&#x6240;&#x6709;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;.&#x53EA;&#x6709;&#x6CA1;&#x6709;&#x5199;&#x9501;&#x65F6;,&#x5176;&#x4ED6;&#x8BFB;&#x53D6;&#x7684;&#x7528;&#x6237;&#x624D;&#x80FD;&#x83B7;&#x5F97;&#x8BFB;&#x9501;,&#x8BFB;&#x9501;&#x4E4B;&#x95F4;&#x662F;&#x4E0D;&#x76F8;&#x4E92;&#x963B;&#x585E;&#x7684;.</li>
<li>&#x5728;&#x7279;&#x5B9A;&#x7684;&#x573A;&#x666F;&#x4E2D;,&#x8868;&#x9501;&#x4E5F;&#x53EF;&#x80FD;&#x6709;&#x826F;&#x597D;&#x7684;&#x6027;&#x80FD;.&#x4F8B;&#x5982;: READ LOCAL&#x8868;&#x9501;&#x652F;&#x6301;&#x67D0;&#x4E9B;&#x7C7B;&#x578B;&#x7684;&#x5E76;&#x53D1;&#x5199;&#x64CD;&#x4F5C;.&#x53E6;&#x5916;,&#x5199;&#x9501;&#x4E5F;&#x6BD4;&#x8BFB;&#x9501;&#x6709;&#x66F4;&#x9AD8;&#x7684;&#x4F18;&#x5148;&#x7EA7;,&#x56E0;&#x6B64;&#x4E00;&#x4E2A;&#x5199;&#x9501;&#x8BF7;&#x6C42;&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x63D2;&#x5165;&#x5230;&#x8BFB;&#x9501;&#x5217;&#x961F;&#x7684;&#x524D;&#x9762;(&#x5199;&#x9501;&#x53EF;&#x4EE5;&#x63D2;&#x5165;&#x5230;&#x9501;&#x96F7;&#x5BF9;&#x4E2D;&#x8BFB;&#x9501;&#x7684;&#x524D;&#x9762;,&#x7E41;&#x6B96;&#x8BFB;&#x9501;&#x5219;&#x4E0D;&#x80FD;&#x63D2;&#x5165;&#x5230;&#x5199;&#x9501;&#x7684;&#x524D;&#x9762;).</li>
<li>&#x5C3D;&#x7BA1;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x53EF;&#x4EE5;&#x7BA1;&#x7406;&#x81EA;&#x5DF1;&#x7684;&#x9501;,MySQL&#x672C;&#x8EAB;&#x8FD8;&#x662F;&#x4F1A;&#x4F7F;&#x7528;&#x5404;&#x79CD;&#x6709;&#x6548;&#x7684;&#x8868;&#x9501;&#x6765;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x76EE;&#x7684;.&#x4F8B;&#x5982;: &#x670D;&#x52A1;&#x5668;&#x4F1A;&#x4E3A;&#x8BF8;&#x5982;ALTER TABLE&#x4E4B;&#x7C7B;&#x7684;&#x8BED;&#x53E5;&#x4F7F;&#x7528;&#x8868;&#x9501;,&#x800C;&#x5FFD;&#x7565;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684;&#x9501;&#x673A;&#x5236;.</li>
</ul>
<p><strong>&#x884C;&#x7EA7;&#x9501;(row lock)</strong></p>
<blockquote>
<p>&#x884C;&#x7EA7;&#x9501;&#x53EF;&#x4EE5;&#x6700;&#x5927;&#x7A0B;&#x5EA6;&#x7684;&#x652F;&#x6301;&#x5E76;&#x53D1;&#x5904;&#x7406;(&#x540C;&#x65F6;&#x4E5F;&#x5E26;&#x6765;&#x4E86;&#x6700;&#x5927;&#x7684;&#x9501;&#x5F00;&#x9500;).</p>
</blockquote>
<ul>
<li><strong>MySQL&#x670D;&#x52A1;&#x5668;&#x5C42;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x884C;&#x7EA7;&#x9501;,&#x670D;&#x52A1;&#x5668;&#x5C42;&#x5B8C;&#x5168;&#x4E0D;&#x4E86;&#x89E3;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684;&#x9501;&#x5B9E;&#x73B0;.</strong></li>
</ul>
<h2 id="1-3-&#x4E8B;&#x52A1;">1.3. 1.3 &#x4E8B;&#x52A1;</h2><blockquote>
<p>&#x4E8B;&#x52A1;&#x5185;&#x7684;&#x8BED;&#x53E5;,&#x8981;&#x4E48;&#x5168;&#x90E8;&#x6267;&#x884C;&#x6210;&#x529F;,&#x8981;&#x4E48;&#x5168;&#x90E8;&#x6267;&#x884C;&#x5931;&#x8D25;.</p>
</blockquote>
<ul>
<li><strong>&#x539F;&#x5B50;&#x6027;(atomicity)</strong></li>
<li><ul>
<li>&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x5FC5;&#x987B;&#x88AB;&#x89C6;&#x4E3A;&#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x5206;&#x5272;&#x7684;&#x6700;&#x5C0F;&#x5DE5;&#x4F5C;&#x5355;&#x5143;,&#x6574;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x8981;&#x4E48;&#x5168;&#x90E8;&#x63D0;&#x4EA4;&#x6210;&#x529F;,&#x8981;&#x4E48;&#x5168;&#x90E8;&#x5931;&#x8D25;&#x56DE;&#x6EDA;,&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x6765;&#x8BF4;,&#x4E0D;&#x53EF;&#x80FD;&#x53EA;&#x6267;&#x884C;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x64CD;&#x4F5C;,&#x8FD9;&#x5C31;&#x662F;&#x4E8B;&#x52A1;&#x7684;&#x539F;&#x5B50;&#x6027;.</li>
</ul>
</li>
<li><strong>&#x4E00;&#x81F4;&#x6027;(consistency)</strong></li>
<li><ul>
<li>&#x6570;&#x636E;&#x5E93;&#x603B;&#x662F;&#x4ECE;&#x4E00;&#x4E2A;&#x4E00;&#x81F4;&#x6027;&#x7684;&#x72B6;&#x6001;&#x5207;&#x6362;&#x5230;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x4E00;&#x81F4;&#x6027;&#x7684;&#x72B6;&#x6001;.&#x5728;&#x524D;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;,&#x4E00;&#x81F4;&#x6027;&#x786E;&#x4FDD;&#x4E86;,&#x5373;&#x4F7F;&#x5728;&#x6267;&#x884C;&#x7B2C;&#x4E09;&#x56DB;&#x6761;&#x8BED;&#x53E5;&#x4E4B;&#x95F4;&#x65F6;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;,&#x652F;&#x7968;&#x8D26;&#x6237;&#x4E2D;&#x4E5F;&#x4E0D;&#x4F1A;&#x635F;&#x5931;200$,&#x56E0;&#x4E3A;&#x4E8B;&#x52A1;&#x6700;&#x7EC8;&#x6CA1;&#x6709;&#x63D0;&#x4EA4;,&#x6240;&#x4EE5;&#x4E8B;&#x52A1;&#x4E2D;&#x6240;&#x505A;&#x7684;&#x4FEE;&#x6539;&#x4E5F;&#x4E0D;&#x4F1A;&#x4FDD;&#x5B58;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;.</li>
</ul>
</li>
<li><strong>&#x9694;&#x79BB;&#x6027;(isolation)</strong></li>
<li><ul>
<li>&#x901A;&#x5E38;&#x6765;&#x8BF4;,&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x6240;&#x505A;&#x7684;&#x4FEE;&#x6539;&#x5728;&#x6700;&#x7EC8;&#x63D0;&#x4EA4;&#x4E4B;&#x524D;,&#x5BF9;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x662F;&#x4E0D;&#x53EF;&#x89C1;&#x7684;.&#x5728;&#x524D;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;,&#x5F53;&#x6267;&#x884C;&#x5B8C;&#x7B2C;&#x4E09;&#x6761;&#x8BED;&#x53E5;.&#x7B2C;&#x56DB;&#x6761;&#x8BED;&#x53E5;&#x8FD8;&#x672A;&#x5F00;&#x59CB;&#x65F6;,&#x6B64;&#x65F6;&#x6709;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x8D26;&#x6237;&#x6C47;&#x603B;&#x7A0B;&#x5E8F;&#x5F00;&#x59CB;&#x8FD0;&#x884C;,&#x5219;&#x5176;&#x770B;&#x5230;&#x7684;&#x652F;&#x7968;&#x8D26;&#x6237;&#x7684;&#x6708;&#x5E76;&#x6CA1;&#x6709;&#x88AB;&#x51CF;&#x53BB;200$.</li>
</ul>
</li>
<li><strong>&#x6301;&#x4E45;&#x6027;(durability)</strong></li>
<li><ul>
<li>&#x4E00;&#x65E6;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;,&#x5219;&#x5176;&#x6240;&#x505A;&#x7684;&#x4FEE;&#x6539;&#x5C31;&#x4F1A;&#x6C38;&#x4E45;&#x4FDD;&#x5B58;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;.&#x6B64;&#x65F6;&#x5373;&#x4F7F;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;,&#x4FEE;&#x6539;&#x7684;&#x6570;&#x636E;&#x4E5F;&#x4E0D;&#x4F1A;&#x4E22;&#x5931;.&#x6301;&#x4E45;&#x6027;&#x662F;&#x4E2A;&#x6709;&#x70B9;&#x6A21;&#x7CCA;&#x7684;&#x6982;&#x5FF5;,&#x56E0;&#x4E3A;&#x5B9E;&#x9645;&#x4E0A;&#x6301;&#x4E45;&#x6027;&#x4E5F;&#x5206;&#x5F88;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x7EA7;&#x522B;.&#x6709;&#x4E9B;&#x6301;&#x4E45;&#x6027;&#x7B56;&#x7565;&#x80FD;&#x591F;&#x63D0;&#x4F9B;&#x975E;&#x5E38;&#x5F3A;&#x7684;&#x5B89;&#x5168;&#x4FDD;&#x969C;,&#x800C;&#x6709;&#x4E9B;&#x5219;&#x672A;&#x5FC5;.&#x800C;&#x4E14;&#x4E0D;&#x53EF;&#x80FD;&#x6709;&#x80FD;&#x505A;&#x5230;100%&#x7684;&#x6301;&#x4E45;&#x6027;&#x4FDD;&#x8BC1;&#x7684;&#x7B56;&#x7565;.</li>
</ul>
</li>
</ul>
<h3 id="1-3-1-&#x9694;&#x79BB;&#x7EA7;&#x522B;">1.3.1. 1.3.1 &#x9694;&#x79BB;&#x7EA7;&#x522B;</h3><blockquote>
<p>&#x9694;&#x79BB;&#x6027;&#x5176;&#x5B9E;&#x6BD4;&#x60F3;&#x8C61;&#x4E2D;&#x7684;&#x8981;&#x590D;&#x6742;.&#x5728;SQL&#x6807;&#x51C6;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x56DB;&#x4E2D;&#x9694;&#x79BB;&#x7EA7;&#x522B;,&#x6BCF;&#x4E00;&#x79CD;&#x7EA7;&#x522B;&#x90FD;&#x89C4;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;&#x6240;&#x505A;&#x7684;&#x4FEE;&#x6539;,&#x54EA;&#x4E9B;&#x5728;&#x4E8B;&#x52A1;&#x5185;&#x548C;&#x4E8B;&#x52A1;&#x95F4;&#x662F;&#x53EF;&#x89C1;&#x7684;,&#x54EA;&#x4E9B;&#x662F;&#x4E0D;&#x53EF;&#x89C1;&#x7684;.&#x8F83;&#x4F4E;&#x7EA7;&#x522B;&#x7684;&#x9694;&#x79BB;&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x66F4;&#x9AD8;&#x7684;&#x5E76;&#x53D1;,&#x7CFB;&#x7EDF;&#x7684;&#x5F00;&#x9500;&#x4E5F;&#x66F4;&#x4F4E;.</p>
</blockquote>
<ul>
<li><p><strong>READ UNCOMMITTED(&#x672A;&#x63D0;&#x4EA4;&#x8BFB;)</strong></p>
</li>
<li><ul>
<li>&#x5728;READ UNCOMMITTED&#x7EA7;&#x522B;,&#x4E8B;&#x52A1;&#x4E2D;&#x7684;&#x4FEE;&#x6539;,&#x5373;&#x4F7F;&#x6CA1;&#x6709;&#x63D0;&#x4EA4;,&#x5BF9;&#x5176;&#x4ED6; &#x4E8B;&#x52A1;&#x4E5F;&#x90FD;&#x662F;&#x53EF;&#x89C1;&#x7684;.&#x4E8B;&#x52A1;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x672A;&#x63D0;&#x4EA4;&#x7684;&#x6570;&#x636E;,&#x8FD9;&#x4E5F;&#x88AB;&#x79F0;&#x4E3A;&#x810F;&#x8BFB;(Rirty Read).&#x8FD9;&#x4E2A;&#x7EA7;&#x522B;&#x4F1A;&#x5BFC;&#x81F4;&#x5F88;&#x591A;&#x7684;&#x95EE;&#x9898;,&#x4ECE;&#x6027;&#x80FD;&#x4E0A;&#x6765;&#x8BF4;,READ UNCOMMITTED&#x4E0D;&#x4F1A;&#x6BD4;&#x5176;&#x4ED6;&#x7684;&#x7EA7;&#x522B;&#x597D;&#x592A;&#x591A;,&#x4F46;&#x5374;&#x7F3A;&#x4E4F;&#x5176;&#x4ED6;&#x7EA7;&#x522B;&#x7684;&#x5F88;&#x591A;&#x597D;&#x5904;,&#x9664;&#x975E;&#x771F;&#x7684;&#x6709;&#x975E;&#x5E38;&#x5FC5;&#x8981;&#x7684;&#x7406;&#x7531;,&#x5728;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x4E2D;&#x4E00;&#x822C;&#x5F88;&#x5C11;&#x4F7F;&#x7528;.</li>
</ul>
</li>
<li><p><strong>READ COMMITTED(&#x63D0;&#x4EA4;&#x8BFB;)</strong></p>
</li>
<li><ul>
<li>&#x5927;&#x591A;&#x6570;&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x7684;more&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x90FD;&#x662F;READ COMMITTED(&#x4F46;MySQL&#x4E0D;&#x662F;).READ COMMITTED&#x6EE1;&#x8DB3;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;&#x9694;&#x79BB;&#x6027;&#x7684;&#x7B80;&#x5355;&#x5B9A;&#x4E49;: &#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x5F00;&#x59CB;&#x65F6;,&#x53EA;&#x80FD;&#x201D;&#x770B;&#x89C1;&#x201D;&#x5DF2;&#x7ECF;&#x63D0;&#x4EA4;&#x7684;&#x4E8B;&#x52A1;&#x6240;&#x505A;&#x7684;&#x4FEE;&#x6539;.&#x6362;&#x53E5;&#x8BDD;&#x8BF4;,&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4ECE;&#x5F00;&#x59CB;&#x76F4;&#x5230;&#x63D0;&#x4EA4;&#x4E4B;&#x524D;,&#x6240;&#x505A;&#x7684;&#x4EFB;&#x4F55;&#x4FEE;&#x6539;&#x5BF9;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x90FD;&#x662F;&#x4E0D;&#x53EF;&#x89C1;&#x7684;.&#x8FD9;&#x4E2A;&#x7EA7;&#x522B;&#x6709;&#x65F6;&#x5019;&#x4E5F;&#x53EB;&#x505A;&#x4E0D;&#x53EF;&#x91CD;&#x590D;&#x8BFB;(nonrepeatable read),&#x56E0;&#x4E3A;&#x4E24;&#x6B21;&#x6267;&#x884C;&#x540C;&#x6837;&#x7684;&#x67E5;&#x8BE2;,&#x53EF;&#x80FD;&#x4F1A;&#x5F97;&#x5230;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x7ED3;&#x679C;.</li>
</ul>
</li>
<li><p><strong>REPEATABLE READ(&#x53EF;&#x91CD;&#x590D;&#x8BFB;)</strong></p>
</li>
<li><ul>
<li>REPEATABLE READ&#x89E3;&#x51B3;&#x4E86;&#x810F;&#x8BFB;&#x7684;&#x95EE;&#x9898;.&#x8BE5;&#x7EA7;&#x522B;&#x4FDD;&#x8BC1;&#x4E86;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;&#x591A;&#x6B21;&#x8BFB;&#x53D6;&#x540C;&#x6837;&#x8BB0;&#x5F55;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x4E00;&#x81F4;&#x7684;.&#x4F46;&#x662F;&#x7406;&#x8BBA;&#x4E0A;,&#x53EF;&#x91CD;&#x590D;&#x8BFB;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x8FD8;&#x662F;&#x65E0;&#x6CD5;&#x89E3;&#x51B3;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5E7B;&#x8BFB;(Phantom Read)&#x7684;&#x95EE;&#x9898;.&#x6240;&#x8C13;&#x5E7B;&#x8BFB;,&#x6307;&#x7684;&#x662F;&#x5F53;&#x67D0;&#x4E2A;&#x4E8B;&#x52A1;&#x5728;&#x8BFB;&#x53D6;&#x67D0;&#x4E2A;&#x8303;&#x56F4;&#x5185;&#x7684;&#x8BB0;&#x5F55;&#x65F6;,&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x53C8;&#x5728;&#x8BE5;&#x8303;&#x56F4;&#x5185;&#x63D2;&#x5165;&#x4E86;&#x65B0;&#x7684;&#x8BB0;&#x5F55;,&#x5F53;&#x4E4B;&#x524D;&#x7684;&#x4E8B;&#x52A1;&#x518D;&#x6B21;&#x8BFB;&#x53D6;&#x8BE5;&#x8303;&#x56F4;&#x7684;&#x8BB0;&#x5F55;&#x65F6;,&#x4F1A;&#x4EA7;&#x751F;&#x5E7B;&#x884C;(Phantom Row).  <strong>&#x8BE5;&#x7EA7;&#x522B;&#x4E3A;MySQL&#x7684;&#x9ED8;&#x8BA4;&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;.</strong></li>
</ul>
</li>
<li><p><strong>SERIALIZABLE(&#x53EF;&#x4E32;&#x884C;&#x5316;)</strong></p>
</li>
<li><ul>
<li><p>SERIALIZABLE&#x662F;&#x6700;&#x9AD8;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x522B;.&#x5B83;&#x901A;&#x8FC7;&#x5F3A;&#x5236;&#x4E8B;&#x52A1;&#x4E32;&#x884C;&#x6267;&#x884C;,&#x907F;&#x514D;&#x4E86;&#x524D;&#x9762;&#x8BF4;&#x7684;&#x5E7B;&#x8BFB;&#x7684;&#x95EE;&#x9898;.&#x7B80;&#x5355;&#x6765;&#x8BF4;,SERIALIZABLE&#x4F1A;&#x5728;&#x8BFB;&#x53D6;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x6570;&#x636E;&#x4E0A;&#x90FD;&#x52A0;&#x9501;,&#x6240;&#x4EE5;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x5927;&#x91CF;&#x7684;&#x8D85;&#x65F6;&#x548C;&#x9501;&#x4E89;&#x7528;&#x7684;&#x95EE;&#x9898;.&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x4E2D;&#x4E5F;&#x5F88;&#x5C11;&#x7528;&#x5230;&#x8FD9;&#x4E2A;&#x9694;&#x79BB;&#x7EA7;&#x522B;,&#x53EA;&#x6709;&#x5728;&#x975E;&#x5E38;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x6B21;&#x63A5;&#x53D7;&#x6CA1;&#x6709;&#x5E76;&#x53D1;&#x7684;&#x60C5;&#x51B5;&#x4E0B;,&#x624D;&#x8003;&#x8651;&#x91C7;&#x7528;&#x8BE5;&#x7EA7;&#x522B;.</p>
<pre><code>&#x9694;&#x79BB;&#x7EA7;&#x522B; | &#x810F;&#x8BFB; | &#x4E0D;&#x53EF;&#x91CD;&#x590D;&#x8BFB; | &#x5E7B;&#x8BFB; | &#x52A0;&#x9501;&#x8BFB;
---|---|---|---|---
READ UNCOMMITTED | Yes | Yes | Yes | No
READ COMMITTED | No | Yes | Yes | No
REPEATABLE READ | No | No | Yes | No
SERIALIZABLE | No | No | No | Yes</code></pre></li>
</ul>
</li>
</ul>
<h3 id="1-3-2-&#x6B7B;&#x9501;">1.3.2. 1.3.2 &#x6B7B;&#x9501;</h3><blockquote>
<p>&#x6B7B;&#x9501;&#x662F;&#x6307;&#x4E24;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x4E8B;&#x52A1;&#x5728;&#x540C;&#x4E00;&#x8D44;&#x6E90;&#x4E0A;&#x76F8;&#x4E92;&#x5360;&#x7528;,&#x5E76;&#x8BF7;&#x6C42;&#x9501;&#x5B9A;&#x5BF9;&#x65B9;&#x5360;&#x7528;&#x7684;&#x8D44;&#x6E90;,&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x6076;&#x6027;&#x5FAA;&#x73AF;&#x7684;&#x73B0;&#x8C61;.&#x5F53;&#x591A;&#x4E2A;&#x4E8B;&#x52A1;&#x8BD5;&#x56FE;&#x4EE5;&#x4E0D;&#x540C;&#x7684;&#x987A;&#x5E8F;</p>
</blockquote>
<p><strong>&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x6B7B;&#x9501;&#x95EE;&#x9898;,&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x5B9E;&#x73B0;&#x4E86;&#x5404;&#x79CD;&#x6B7B;&#x9501;&#x68C0;&#x6D4B;&#x548C;&#x6B7B;&#x9501;&#x8D85;&#x65F6;&#x65F6;&#x673A;&#x5236;.</strong></p>
<ul>
<li>&#x8D8A;&#x590D;&#x6742;&#x7684;&#x7CFB;&#x7EDF;,&#x6BD4;&#x5982;InnoDB&#x5B58;&#x50A8;&#x5F15;&#x64CE;,&#x8D8A;&#x80FD;&#x68C0;&#x6D4B;&#x5230;&#x6B7B;&#x9501;&#x7684;&#x5FAA;&#x73AF;&#x4F9D;&#x8D56;,&#x5E76;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;.&#x8FD9;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x5F0F;&#x5F88;&#x6709;&#x6548;,&#x5426;&#x5219;&#x6B7B;&#x9501;&#x4F1A;&#x5BFC;&#x81F4;&#x51FA;&#x73B0;&#x975E;&#x5E38;&#x6162;&#x7684;&#x67E5;&#x8BE2;.</li>
<li>&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x5F0F;,&#x5C31;&#x662F;&#x5F53;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x95F4;&#x8FBE;&#x5230;&#x9501;&#x7B49;&#x5F85;&#x8D85;&#x65F6;&#x7684;&#x8BBE;&#x5B9A;&#x540E;&#x653E;&#x5F03;&#x9501;&#x8BF7;&#x6C42;,&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x901A;&#x5E38;&#x6765;&#x8BF4;&#x4E0D;&#x592A;&#x597D;.InnoDB&#x76EE;&#x524D;&#x5904;&#x7406;&#x6B7B;&#x9501;&#x7684;&#x65B9;&#x6CD5;&#x662F;: &#x5C06;&#x6301;&#x6709;&#x6700;&#x5C11;&#x884C;&#x7EA7;&#x6392;&#x4ED6;&#x9501;&#x7684;&#x4E8B;&#x52A1;&#x8FDB;&#x884C;&#x56DE;&#x6EDA;(&#x8FD9;&#x662F;&#x76F8;&#x5BF9;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x6B7B;&#x9501;&#x56DE;&#x6EDA;&#x7B97;&#x6CD5;)</li>
</ul>
<blockquote>
<p>&#x9501;&#x7684;&#x884C;&#x4E3A;&#x548C;&#x987A;&#x5E8F;&#x662F;&#x548C;&#x50A8;&#x5B58;&#x5F15;&#x64CE;&#x76F8;&#x5173;&#x7684;.&#x4EE5;&#x540C;&#x6837;&#x7684;&#x8BED;&#x53E5;&#x6267;&#x884C;&#x8BED;&#x53E5;,&#x6709;&#x4E9B;&#x50A8;&#x5B58;&#x5F15;&#x64CE;&#x4F1A;&#x4EA7;&#x751F;&#x6B7B;&#x9501;,&#x6709;&#x4E9B;&#x5219;&#x4E0D;&#x4F1A;.&#x6B7B;&#x9501;&#x7684;&#x4EA7;&#x751F;&#x6709;&#x53CC;&#x91CD;&#x539F;&#x56E0;:</p>
</blockquote>
<ul>
<li>&#x6709;&#x4E9B;&#x662F;&#x56E0;&#x4E3A;&#x771F;&#x6B63;&#x7684;&#x6570;&#x636E;&#x51B2;&#x7A81;,&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x901A;&#x5E38;&#x5F88;&#x96BE;&#x907F;&#x514D;</li>
<li>&#x6709;&#x4E9B;&#x5219;&#x5B8C;&#x5168;&#x662F;&#x7531;&#x4E8E;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x5BFC;&#x81F4;&#x7684;</li>
</ul>
<p><strong>&#x6B7B;&#x9501;&#x53D1;&#x751F;&#x4EE5;&#x540E;,&#x53EA;&#x6709;&#x90E8;&#x5206;&#x6216;&#x8005;&#x5168;&#x90E8;&#x56DE;&#x6EDA;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;,&#x624D;&#x80FD;&#x6253;&#x7834;&#x6B7B;&#x9501;.&#x5BF9;&#x4E8E;&#x4E8B;&#x52A1;&#x578B;&#x7684;&#x7CFB;&#x7EDF;,&#x8FD9;&#x662F;&#x65E0;&#x6CD5;&#x907F;&#x514D;&#x7684;,&#x6240;&#x4EE5;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x8BBE;&#x8BA1;&#x65F6;&#x5FC5;&#x987B;&#x8003;&#x8651;&#x5982;&#x4F55;&#x5904;&#x7406;&#x6B7B;&#x9501;.&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x53EA;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x6267;&#x884C;&#x6B7B;&#x9501;&#x6240;&#x56DE;&#x6EDA;&#x7684;&#x4E8B;&#x52A1;&#x5373;&#x53EF;.</strong></p>
<h3 id="1-3-3-&#x4E8B;&#x52A1;&#x65E5;&#x5FD7;">1.3.3. 1.3.3 &#x4E8B;&#x52A1;&#x65E5;&#x5FD7;</h3><ol>
<li>&#x4E8B;&#x52A1;&#x65E5;&#x5FD7;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x63D0;&#x9AD8;&#x4E8B;&#x52A1;&#x7684;&#x6548;&#x7387;.&#x4F7F;&#x7528;&#x4E8B;&#x52A1;&#x65E5;&#x5FD7;,&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5728;&#x4FEE;&#x6539;&#x8868;&#x7684;&#x6570;&#x636E;&#x65F6;&#x53EA;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x5668;&#x5185;&#x5B58;&#x62F7;&#x8D1D;,</li>
<li>&#x518D;&#x628A;&#x6539;&#x4FEE;&#x6539;&#x884C;&#x4E3A;&#x8BB0;&#x5F55;&#x5230;&#x6301;&#x4E45;&#x5728;&#x786C;&#x76D8;&#x4E0A;&#x7684;&#x4E8B;&#x52A1;&#x65E5;&#x5FD7;&#x4E2D;,&#x800C;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x90FD;&#x5C06;&#x4FEE;&#x6539;&#x7684;&#x6570;&#x636E;&#x672C;&#x8EAB;&#x6301;&#x4E45;&#x5230;&#x78C1;&#x76D8;.</li>
<li>&#x4E8B;&#x52A1;&#x65E5;&#x5FD7;&#x91C7;&#x7528;&#x7684;&#x662F;&#x8FFD;&#x52A0;&#x7684;&#x65B9;&#x5F0F;,&#x56E0;&#x6B64;&#x5199;&#x65E5;&#x5FD7;&#x7684;&#x64CD;&#x4F5C;&#x662F;&#x78C1;&#x76D8;&#x4E0A;&#x4E00;&#x5C0F;&#x5757;&#x533A;&#x57DF;&#x5185;&#x7684;&#x987A;&#x5E8F;I/O,&#x800C;&#x4E0D;&#x50CF;&#x968F;&#x673A;I/O&#x9700;&#x8981;&#x5728;&#x78C1;&#x76D8;&#x7684;&#x591A;&#x4E2A;&#x5730;&#x65B9;&#x79FB;&#x52A8;&#x78C1;&#x5934;,&#x6240;&#x4EE5;&#x91C7;&#x7528;&#x4E8B;&#x52A1;&#x65E5;&#x5FD7;&#x7684;&#x65B9;&#x5F0F;&#x76F8;&#x5BF9;&#x6765;&#x8BF4;&#x8981;&#x5FEB;&#x5F97;&#x591A;.</li>
<li>&#x4E8B;&#x52A1;&#x65E5;&#x5FD7;&#x6301;&#x4E45;&#x4EE5;&#x540E;,&#x5185;&#x5B58;&#x4E2D;&#x88AB;&#x4FEE;&#x6539;&#x7684;&#x6570;&#x636E;&#x5728;&#x540E;&#x53F0;&#x53EF;&#x4EE5;&#x6162;&#x6162;&#x7684;&#x5237;&#x56DE;&#x5230;&#x78C1;&#x76D8;.</li>
</ol>
<p>++&#x76EE;&#x524D;&#x5927;&#x591A;&#x6570;&#x50A8;&#x5B58;&#x5F15;&#x64CE;&#x90FD;&#x662F;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;&#x7684;,&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x79F0;&#x4E4B;&#x4E3A;&#x9884;&#x5199;&#x5F0F;&#x65E5;&#x5FD7;(Write-Ahead Logging),&#x4FEE;&#x6539;&#x6570;&#x636E;&#x9700;&#x8981;&#x4E9B;&#x4E24;&#x6B21;&#x78C1;&#x76D8;.++</p>
<blockquote>
<p>&#x5982;&#x679C;&#x6570;&#x636E;&#x7684;&#x4FEE;&#x6539;&#x5DF2;&#x7ECF;&#x8BB0;&#x5F55;&#x5230;&#x4E8B;&#x52A1;&#x65E5;&#x5FD7;&#x5E76;&#x6301;&#x4E45;&#x5316;,&#x4F46;&#x6570;&#x636E;&#x672C;&#x8EAB;&#x8FD8;&#x6CA1;&#x6709;&#x5199;&#x56DE;&#x78C1;&#x76D8;,&#x6B64;&#x65F6;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;,&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5728;&#x91CD;&#x542F;&#x65F6;&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x56DE;&#x590D;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x4FEE;&#x6539;&#x7684;&#x6570;&#x636E;.&#x5177;&#x4F53;&#x7684;&#x56DE;&#x590D;&#x65B9;&#x5F0F;&#x5219;&#x89C6;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x800C;&#x5B9A;.</p>
</blockquote>
<h3 id="1-3-4-MySQL&#x4E2D;&#x7684;&#x4E8B;&#x52A1;">1.3.4. 1.3.4 MySQL&#x4E2D;&#x7684;&#x4E8B;&#x52A1;</h3><blockquote>
<p>MySQL&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;&#x4E8B;&#x52A1;&#x578B;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;: InnoDB&#x548C;NDB Cluster. &#x53E6;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x7B2C;&#x4E09;&#x65B9;&#x50A8;&#x5B58;&#x5F15;&#x64CE;&#x4E5F;&#x652F;&#x6301;&#x4E8B;&#x52A1;,&#x6BD4;&#x8F83;&#x77E5;&#x540D;&#x7684;&#x5305;&#x62EC;XtraDB&#x548C;PBXT.</p>
</blockquote>
<ul>
<li><strong>&#x81EA;&#x52A8;&#x63D0;&#x4EA4;(AUTOCOMMIT)</strong></li>
<li><ul>
<li>MySQL&#x9ED8;&#x8BA4;&#x91C7;&#x7528;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#x6A21;&#x5F0F;.&#x4E5F;&#x5C31;&#x662F;&#x8BF4;,&#x5982;&#x679C;&#x4E0D;&#x662F;&#x663E;&#x5F0F;&#x7684;&#x5F00;&#x59CB;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;,&#x5219;&#x6BCF;&#x4E2A;&#x67E5;&#x8BE2;&#x90FD;&#x88AB;&#x5F53;&#x505A;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x6267;&#x884C;&#x63D0;&#x4EA4;&#x64CD;&#x4F5C;.&#x5728;&#x5F53;&#x524D;&#x8FDE;&#x63A5;&#x4E2D;,&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;AUTOCOMMIT&#x53D8;&#x91CF;&#x6765;&#x542F;&#x7528;&#x6216;&#x8005;&#x7981;&#x7528;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#x6A21;&#x5F0F;: </li>
</ul>
</li>
</ul>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW <span class="keyword">VARIABLES</span> LIKE <span class="comment">&apos;AUTOCOMMIT&apos;</span>;</span><br><span class="line">mysql&gt; <span class="keyword">SET</span> AUTOCOMMIT <span class="comment">= 1</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li><ul>
<li>1&#x6216;&#x8005;ON&#x8868;&#x793A;&#x542F;&#x7528;,0&#x6216;&#x8005;OFF&#x8868;&#x793A;&#x7981;&#x7528;.&#x5F53;AUTOCOMMIT=0&#x65F6;,&#x6240;&#x6709;&#x7684;&#x67E5;&#x8BE2;&#x90FD;&#x662F;&#x5728;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;,&#x77E5;&#x9053;&#x663E;&#x5F0F;&#x7684;&#x6267;&#x884C;COMMIT&#x63D0;&#x4EA4;&#x6216;&#x8005;ROLLBACK&#x56DE;&#x6EDA;,&#x8BE5;&#x4E8B;&#x52A1;&#x7ED3;&#x675F;,&#x540C;&#x65F6;&#x5F00;&#x59CB;&#x4E86;&#x53E6;&#x4E00;&#x4E2A;&#x65B0;&#x4E8B;&#x52A1;.</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>&#x53E6;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x547D;&#x4EE4;,&#x5728;&#x6267;&#x884C;&#x4E4B;&#x524D;&#x4F1A;&#x5F3A;&#x5236;&#x6267;&#x884C;COMMIT&#x63D0;&#x4EA4;&#x5F53;&#x524D;&#x7684;&#x6D3B;&#x52A8;&#x4E8B;&#x52A1;.&#x5178;&#x578B;&#x7684;&#x4F8B;&#x5B50;,&#x5728;&#x6570;&#x636E;&#x5B9A;&#x4E49;&#x8BED;&#x8A00;(DDL)&#x4E2D;,&#x5982;&#x679C;&#x662F;&#x4F1A;&#x5230;&#x65F6;&#x5927;&#x91CF;&#x6570;&#x636E;&#x6539;&#x53D8;&#x7684;&#x64CD;&#x4F5C;,&#x6BD4;&#x5982;ALTER TABLE,&#x5C31;&#x662F;&#x5982;&#x6B64;.&#x6B64;&#x5916;&#x8FD8;&#x6709;LOCK TABLES&#x7B49;&#x5176;&#x4ED6;&#x8BED;&#x53E5;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;&#x540C;&#x6837;&#x7684;&#x7ED3;&#x679C;.</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>MySQL&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6267;&#x884C;SET TRANSACTION ISOLATION LEVEL&#x547D;&#x4EE4;&#x6765;&#x8BBE;&#x7F6E;&#x9694;&#x79BB;&#x7EA7;&#x522B;.&#x65B0;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x4F1A;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x751F;&#x6548;.&#x53EF;&#x4EE5;&#x518D;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x8BBE;&#x7F6E;&#x8BC1;&#x800C;&#x8FC7;&#x6570;&#x636E;&#x5E93;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x522B;,&#x4E5F;&#x53EF;&#x4EE5;&#x53EA;&#x6539;&#x53D8;&#x5F53;&#x524D;&#x4F1A;&#x8BDD;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x522B;:</li>
</ul>
</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SET</span> <span class="keyword">SESSION</span> <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> <span class="keyword">READ</span> <span class="keyword">COMMITTED</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li><ul>
<li>MySQL&#x80FD;&#x591F;&#x8BC6;&#x522B;&#x6240;&#x6709;&#x7684;&#x56DB;&#x4E2A;ANSI&#x9694;&#x79BB;&#x7EA7;&#x522B;,InnoDB&#x5F15;&#x64CE;&#x4E5F;&#x652F;&#x6301;&#x6240;&#x6709;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x522B;.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>&#x5728;&#x4E8B;&#x52A1;&#x4E2D;&#x6DF7;&#x5408;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#x5F15;&#x64CE;</strong></p>
</li>
<li><ul>
<li>MySQL&#x670D;&#x52A1;&#x5668;&#x5C42;&#x4E0D;&#x7BA1;&#x7406;&#x4E8B;&#x52A1;,&#x4E8B;&#x52A1;&#x662F;&#x7531;&#x4E0B;&#x5C42;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5B9E;&#x73B0;&#x7684;.&#x6240;&#x4EE5;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;,&#x4F7F;&#x7528;&#x591A;&#x79CD;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x662F;&#x4E0D;&#x53EF;&#x9760;&#x7684;.</li>
</ul>
</li>
<li><ul>
<li>&#x5982;&#x679C;&#x5728;&#x4E8B;&#x52A1;&#x4E2D;&#x6DF7;&#x5408;&#x4F7F;&#x7528;&#x4E86;&#x4E8B;&#x52A1;&#x578B;&#x548C;&#x975E;&#x4E8B;&#x52A1;&#x578B;&#x7684;&#x8868;(&#x4F8B;&#x5982;InnoDB&#x548C;MyISAM&#x8868;),&#x5728;&#x6B63;&#x5E38;&#x63D0;&#x4EA4;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;.</li>
</ul>
</li>
<li><ul>
<li>&#x4F46;&#x5982;&#x679C;&#x8BE5;&#x4E8B;&#x52A1;&#x9700;&#x8981;&#x56DE;&#x6EDA;,&#x975E;&#x4E8B;&#x52A1;&#x578B;&#x7684;&#x8868;&#x4E0A;&#x7684;&#x53D8;&#x66F4;&#x5C31;&#x65E0;&#x6CD5;&#x64A4;&#x9500;.&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x6570;&#x636E;&#x5E93;&#x5904;&#x4E8E;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x72B6;&#x6001;,&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5F88;&#x96BE;&#x4FEE;&#x590D;,&#x4E8B;&#x52A1;&#x7684;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x5C06;&#x65E0;&#x6CD5;&#x786E;&#x5B9A;.&#x6240;&#x4EE5;,&#x4E3A;&#x6BCF;&#x5F20;&#x8868;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x975E;&#x5E38;&#x91CD;&#x8981;.</li>
</ul>
</li>
<li><ul>
<li>&#x5728;&#x975E;&#x4E8B;&#x52A1;&#x578B;&#x7684;&#x8868;&#x4E0A;&#x6267;&#x884C;&#x4E8B;&#x52A1;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#x7684;&#x65F6;&#x5019;,MySQL&#x901A;&#x5E38;&#x4E0D;&#x4F1A;&#x53D1;&#x51FA;&#x63D0;&#x9192;,&#x4E5F;&#x4E0D;&#x4F1A;&#x62A5;&#x9519;.&#x6709;&#x65F6;&#x5019;&#x53EA;&#x6709;&#x56DE;&#x6EDA;&#x7684;&#x65F6;&#x5019;&#x624D;&#x4F1A;&#x53D1;&#x51FA;&#x4E00;&#x4E2A;&#x8B66;&#x544A;:&#x201D;&#x67D0;&#x4E9B;&#x975E;&#x4E8B;&#x52A1;&#x578B;&#x7684;&#x8868;&#x4E0A;&#x7684;&#x53D8;&#x66F4;&#x4E0D;&#x80FD;&#x88AB;&#x56DE;&#x6EDA;&#x201D;.&#x4F46;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;,&#x5BF9;&#x975E;&#x4E8B;&#x52A1;&#x578B;&#x7684;&#x8868;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x4E0D;&#x4F1A;&#x6709;&#x63D0;&#x793A;.</li>
</ul>
</li>
<li><p><strong>&#x9690;&#x5F0F;&#x548C;&#x663E;&#x5F0F;&#x9501;&#x5B9A;</strong></p>
</li>
<li><ul>
<li>InnoDB&#x91C7;&#x7528;&#x7684;&#x662F;&#x4E24;&#x9636;&#x6BB5;&#x9501;&#x5B9A;&#x534F;&#x8BAE;(two-phase locking protocol).&#x5728;&#x4E8B;&#x52A1;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;,&#x968F;&#x65F6;&#x90FD;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x9501;&#x5B9A;,&#x9501;&#x53EA;&#x6709;&#x5728;&#x6267;&#x884C;COMMIT&#x6216;&#x8005;ROLLBACK&#x7684;&#x65F6;&#x5019;&#x624D;&#x4F1A;&#x91CA;&#x653E;,&#x5E76;&#x4E14;&#x6240;&#x6709;&#x7684;&#x9501;&#x662F;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x88AB;&#x91CA;&#x653E;.&#x524D;&#x9762;&#x63CF;&#x8FF0;&#x7684;&#x9501;&#x5B9A;&#x90FD;&#x662F;&#x9690;&#x5F0F;&#x9501;&#x5B9A;,InnoDB&#x4F1A;&#x6839;&#x636E;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x5728;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#x81EA;&#x52A8;&#x52A0;&#x9501;.</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>InnoDB&#x4E5F;&#x652F;&#x6301;&#x901A;&#x8FC7;&#x7279;&#x5B9A;&#x7684;&#x8BED;&#x53E5;&#x8FDB;&#x884C;&#x663E;&#x5F0F;&#x9501;&#x5B9A;,&#x8FD9;&#x4E9B;&#x8BED;&#x53E5;&#x4E0D;&#x5C5E;&#x4E8E;SQL&#x89C4;&#x8303;:</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">LOCK</span> <span class="keyword">IN</span> <span class="keyword">SHARE</span> <span class="keyword">MODE</span></span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FOR</span> <span class="keyword">UPDATE</span></span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li>MySQL&#x4E5F;&#x652F;&#x6301;LOCK TBALES&#x548C;UNLOCK TABLES&#x8BED;&#x53E5;,&#x8FD9;&#x662F;&#x5728;&#x670D;&#x52A1;&#x5668;&#x5C42;&#x5B9E;&#x73B0;&#x7684;,&#x548C;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x65E0;&#x5173;</li>
</ul>
</li>
<li><blockquote>
<p>LOCK TABLES&#x548C;&#x4E8B;&#x52A1;&#x4E4B;&#x95F4;&#x76F8;&#x4E92;&#x5F71;&#x54CD;&#x7684;&#x8BDD;,&#x60C5;&#x51B5;&#x4F1A;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x590D;&#x6742;,&#x5728;&#x67D0;&#x4E9B;MySQL&#x7248;&#x672C;&#x4E2D;&#x751A;&#x81F3;&#x4F1A;&#x4EA7;&#x751F;&#x65E0;&#x6CD5;&#x9884;&#x6599;&#x7684;&#x7ED3;&#x679C;.</p>
</blockquote>
</li>
<li><blockquote>
<p><strong>&#x9664;&#x4E86;&#x4E8B;&#x52A1;&#x4E2D;&#x7981;&#x7528;&#x4E86;AUTOCOMMIT,&#x4F55;&#x4EE5;&#x5B9E;&#x7528;LOCK TABLES&#x4E4B;&#x5916;,&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x65F6;&#x5019;&#x90FD;&#x4E0D;&#x8981;&#x663E;&#x5F0F;&#x5730;&#x6267;&#x884C;LOCK TABLES, &#x4E0D;&#x5173;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x5B58;&#x50A8;&#x5F15;&#x64CE;.</strong></p>
</blockquote>
</li>
</ul>
<h2 id="1-4-&#x591A;&#x7248;&#x672C;&#x5E76;&#x53D1;&#x63A7;&#x5236;">1.4. 1.4 &#x591A;&#x7248;&#x672C;&#x5E76;&#x53D1;&#x63A7;&#x5236;</h2><blockquote>
<p>MySQL&#x7684;&#x5927;&#x591A;&#x6570;&#x4E8B;&#x52A1;&#x578B;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5B9E;&#x73B0;&#x7684;&#x90FD;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;&#x884C;&#x7EA7;&#x9501;.&#x57FA;&#x4E8E;&#x63D0;&#x5347;&#x5E76;&#x53D1;&#x6027;&#x80FD;&#x7684;&#x8003;&#x8651;,&#x4ED6;&#x4EEC;&#x4E00;&#x822C;&#x90FD;&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#x4E86;&#x591A;&#x7248;&#x672C;&#x5E76;&#x53D1;(MVCC).&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;MVCC&#x662F;&#x884C;&#x7EA7;&#x9501;&#x7684;&#x4E00;&#x4E2A;&#x53D8;&#x79CD;,&#x4F46;&#x662F;&#x5B83;&#x5728;&#x5F88;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#x907F;&#x514D;&#x4E86;&#x52A0;&#x9501;&#x64CD;&#x4F5C;,&#x56E0;&#x6B64;&#x5F00;&#x9500;&#x66F4;&#x4F4E;.</p>
<blockquote>
<p>MVCC&#x7684;&#x5B9E;&#x73B0;,&#x662F;&#x901A;&#x8FC7;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x5728;&#x67D0;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#x7684;&#x5FEB;&#x7167;&#x6765;&#x5B9E;&#x73B0;&#x7684;.&#x4E5F;&#x5C31;&#x662F;&#x8BF4;,&#x4E0D;&#x7BA1;&#x9700;&#x8981;&#x6267;&#x884C;&#x591A;&#x957F;&#x65F6;&#x95F4;,&#x6BCF;&#x4E2A;&#x4E8B;&#x7269;&#x770B;&#x5230;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;&#x4E00;&#x81F4;&#x7684;.</p>
</blockquote>
</blockquote>
<p>**InnoDB&#x7684;MVCC,&#x662F;&#x901A;&#x8FC7;&#x5728;&#x6BCF;&#x884C;&#x8BB0;&#x5F55;&#x540E;&#x9762;&#x4FDD;&#x5B58;&#x4E24;&#x4E2A;&#x9690;&#x85CF;&#x7684;&#x5217;&#x6765;&#x5B9E;&#x73B0;&#x7684;.&#x8FD9;&#x4E24;&#x4E2A;&#x5217;,&#x4E00;&#x4E2A;&#x4FDD;&#x5B58;&#x4E86;&#x884C;&#x7684;&#x521B;&#x5EFA;&#x65F6;&#x95F4;,&#x4E00;&#x4E2A;&#x4FDD;&#x5B58;&#x884C;&#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;(&#x6216;&#x5220;&#x9664;&#x65F6;&#x95F4;).&#x5F53;&#x7136;&#x5B58;&#x50A8;&#x7684;&#x5E76;&#x4E0D;&#x662F;&#x5B9E;&#x9645;&#x7684;&#x65F6;&#x95F4;&#x503C;,&#x800C;&#x662F;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x53F7;(system version numer).&#x6BCF;&#x5F00;&#x59CB;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4E8B;&#x7269;,&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x53F7;&#x90FD;&#x4F1A;&#x81EA;&#x52A8;&#x9012;&#x589E;.&#x4E8B;&#x7269;&#x5F00;&#x59CB;&#x65F6;&#x523B;&#x7684;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x53F7;&#x4F1A;&#x4F5C;&#x4E3A;&#x4E8B;&#x7269;&#x7684;&#x7248;&#x672C;&#x53F7;,&#x7528;&#x6765;&#x548C;&#x67E5;&#x8BE2;&#x5230;&#x7684;&#x6BCF;&#x884C;&#x8BB0;&#x5F55;&#x7684;&#x7248;&#x672C;&#x53F7;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;.&#x4E0B;&#x9762;&#x770B;&#x4E00;&#x4E0B;&#x5728;REPEATBALE READ&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x4E0B;,MVCC&#x5177;&#x4F53;&#x662F;&#x5982;&#x4F55;&#x64CD;&#x4F5C;&#x7684;.</p>
<ul>
<li><p><strong>SELECT</strong> </p>
</li>
<li><ul>
<li>InnoDB&#x4F1A;&#x6839;&#x636E;&#x4EE5;&#x4E0B;&#x4E24;&#x4E2A;&#x6761;&#x4EF6;&#x68C0;&#x67E5;&#x6BCF;&#x884C;&#x8BB0;&#x5F55;:</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>InnoDB&#x53EA;&#x67E5;&#x627E;&#x7248;&#x672C;&#x65E9;&#x4E8E;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#x7248;&#x672C;&#x7684;&#x6570;&#x636E;&#x884C;(&#x4E5F;&#x5C31;&#x662F;,&#x884C;&#x7684;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x53F7;&#x5C0F;&#x9C7C;&#x6216;&#x7B49;&#x4E8E;&#x4E8B;&#x52A1;&#x7684;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x53F7;),&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x4E8B;&#x52A1;&#x8BFB;&#x53D6;&#x7684;&#x884C;,&#x8981;&#x4E48;&#x662F;&#x5728;&#x4E8B;&#x52A1;&#x5F00;&#x59CB;&#x524D;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;,&#x8981;&#x4E48;&#x662F;&#x4E8B;&#x52A1;&#x81EA;&#x8EAB;&#x63D2;&#x5165;&#x6216;&#x8005;&#x4FEE;&#x6539;&#x8FC7;&#x7684;.</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>&#x884C;&#x7684;&#x5220;&#x9664;&#x7248;&#x672C;&#x8981;&#x4E48;&#x672A;&#x5B9A;&#x4E49;,&#x8981;&#x4E48;&#x5927;&#x4E8E;&#x5F53;&#x524D;&#x4E8B;&#x7269;&#x7248;&#x672C;&#x53F7;.&#x8FD9;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x4E8B;&#x52A1;&#x8BFB;&#x53D6;&#x5230;&#x7684;&#x884C;,&#x5728;&#x4E8B;&#x52A1;&#x5F00;&#x59CB;&#x4E4B;&#x524D;&#x672A;&#x88AB;&#x5220;&#x9664;.</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>&#x53EA;&#x6709;&#x7B26;&#x5408;&#x4E0A;&#x8FF0;&#x4E24;&#x4E2A;&#x6761;&#x4EF6;,&#x624D;&#x80FD;&#x8FD4;&#x56DE;&#x4F5C;&#x4E3A;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;.</li>
</ul>
</li>
<li><p><strong>INSERT</strong></p>
</li>
<li><ul>
<li>InnoDB&#x4E3A;&#x65B0;&#x63D2;&#x5165;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x53F7;&#x4F5C;&#x4E3A;&#x884C;&#x7248;&#x672C;&#x53F7;.</li>
</ul>
</li>
<li><p><strong>DELETE</strong></p>
</li>
<li><ul>
<li>InnoDB&#x4E3A;&#x5220;&#x9664;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x53F7;&#x4F5C;&#x4E3A;&#x884C;&#x5220;&#x9664;&#x6807;&#x793A;.</li>
</ul>
</li>
<li><p><strong>UPDATE</strong></p>
</li>
<li><ul>
<li>InnoDB&#x4E3A;&#x63D2;&#x5165;&#x4E00;&#x884C;&#x65B0;&#x7684;&#x8BB0;&#x5F55;,&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x53F7;&#x4F5C;&#x4E3A;&#x884C;&#x7248;&#x672C;&#x53F7;,&#x540C;&#x65F6;&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x53F7;&#x5230;&#x539F;&#x6765;&#x7684;&#x884C;&#x4F5C;&#x4E3A;&#x884C;&#x5220;&#x9664;&#x6807;&#x8BC6;.</li>
</ul>
</li>
<li><p>&#x4FDD;&#x5B58;&#x8FD9;&#x8FDE;&#x4E2A;&#x989D;&#x5916;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x53F7;,&#x4F7F;&#x5927;&#x591A;&#x6570;&#x64CD;&#x4F5C;&#x90FD;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x52A0;&#x9501;.&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x4F7F;&#x5F97;&#x8BFB;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#x5F88;&#x7B80;&#x5355;,&#x6027;&#x80FD;&#x5F88;&#x597D;,&#x5E76;&#x4E14;&#x4E5F;&#x80FD;&#x4FDD;&#x8BC1;&#x667A;&#x6167;&#x8BFB;&#x53D6;&#x5230;&#x7B26;&#x5408;&#x6807;&#x51C6;&#x7684;&#x884C;.&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#x662F;&#x6BCF;&#x884C;&#x8BB0;&#x5F55;&#x90FD;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x50A8;&#x5B58;&#x7A7A;&#x95F4;,&#x9700;&#x8981;&#x505A;&#x66F4;&#x591A;&#x7684;&#x884C;&#x68C0;&#x67E5;&#x5DE5;&#x4F5C;,&#x4EE5;&#x53CA;&#x989D;&#x5916;&#x7684;&#x7EF4;&#x62A4;&#x5DE5;&#x4F5C;.</p>
</li>
<li><p>MVCC&#x53EA;&#x5728;REPEATABLE READ&#x548C;READ COMMITED&#x4E24;&#x4E2A;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x4E0B;&#x5DE5;&#x4F5C;.&#x5176;&#x4ED6;&#x4E24;&#x4E2A;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x90FD;&#x548C;MVCC&#x4E0D;&#x517C;&#x5BB9;,&#x56E0;&#x4E3A;READ UNCOMMITED&#x603B;&#x662F;&#x8BFB;&#x53D6;&#x6700;&#x65B0;&#x7684;&#x6570;&#x636E;&#x884C;,&#x800C;&#x4E0D;&#x662F;&#x7B26;&#x5408;&#x5F53;&#x524D;&#x4E8B;&#x7269;&#x7248;&#x672C;&#x7684;&#x6570;&#x636E;&#x884C;.&#x800C;SERIALIZABLE&#x5219;&#x4F1A;&#x5BF9;&#x6240;&#x6709;&#x8BFB;&#x53D6;&#x7684;&#x884C;&#x90FD;&#x52A0;&#x9501;.</p>
</li>
</ul>
<h2 id="1-5-MySQL&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;">1.5. 1.5 MySQL&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;</h2><blockquote>
<p>&#x5728;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E2D;,MySQL&#x5C06;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4FDD;&#x5B58;&#x4E3A;&#x6570;&#x636E;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x4E00;&#x4E2A;&#x5B50;&#x76EE;&#x5F55;.&#x521B;&#x5EFA;&#x8868;&#x65F6;,MySQL&#x4F1A;&#x5728;&#x6570;&#x636E;&#x5E93;&#x5B50;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x548C;&#x8868;&#x540C;&#x540D;&#x7684;.frm&#x6587;&#x4EF6;&#x4FDD;&#x5B58;&#x8868;&#x7684;&#x5B9A;&#x4E49;.&#x4F8B;&#x5982;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;mytble&#x7684;&#x8868;,MySQL&#x4F1A;&#x5728;mytable.frm&#x6587;&#x4EF6;&#x4E2D;&#x4FDD;&#x5B58;&#x8BE5;&#x8868;&#x7684;&#x5B9A;&#x4E49;.&#x56E0;&#x4E3A;MySQL&#x4F7F;&#x7528;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x6C90;&#x6D74;&#x9732;&#x548C;&#x6587;&#x4EF6;&#x6765;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x5E93;&#x548C;&#x8868;&#x7684;&#x5B9A;&#x4E49;,&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;&#x6027;&#x548C;&#x5177;&#x4F53;&#x7684;&#x5E73;&#x53F0;&#x5BC6;&#x5207;&#x76F8;&#x5173;.&#x5728;Windows&#x4E2D;,&#x5927;&#x5C0F;&#x5199;&#x662F;&#x4E0D;&#x654F;&#x611F;&#x7684;;&#x800C;&#x5728;&#x7C7B;Unix&#x4E2D;&#x5219;&#x662F;&#x654F;&#x611F;&#x7684;.&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x548C;&#x7D22;&#x5F15;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x4E0D;&#x540C;&#x7684;,&#x4F46;&#x8868;&#x7684;&#x5B9A;&#x4E49;&#x5219;&#x662F;&#x5728;MySQL&#x670D;&#x52A1;&#x5C42;&#x7EDF;&#x4E00;&#x5904;&#x7406;&#x7684;.</p>
</blockquote>
<p><strong>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;SHOW TABLE STATUS LIKE &#x2018;t_order&#x2019;&#x547D;&#x4EE4;&#x6765;&#x663E;&#x793A;&#x8868;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;</strong></p>
<ul>
<li>Name</li>
<li><ul>
<li>&#x8868;&#x660E;</li>
</ul>
</li>
<li>Engine</li>
<li><ul>
<li>&#x8868;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7C7B;&#x578B;.&#x5728;&#x65E7;&#x7248;&#x672C;&#x4E2D;,&#x8BE5;&#x5217;&#x7684;&#x540D;&#x5B57;&#x53EB;Type,&#x800C;&#x4E0D;&#x662F;Engine.</li>
</ul>
</li>
<li>Row_format</li>
<li><ul>
<li>&#x884C;&#x7684;&#x683C;&#x5F0F;.&#x5BF9;&#x4E8E;MyISAM&#x8868;,&#x53EF;&#x9009;&#x7684;&#x503C;&#x4E3A;Dynamic.Fixed&#x6216;&#x8005;Compressed.Dynamic&#x7684;&#x884C;&#x957F;&#x5EA6;&#x662F;&#x53EF;&#x53D8;&#x7684;,&#x4E00;&#x822C;&#x5305;&#x542B;&#x53EF;&#x53D8;&#x957F;&#x5EA6;&#x7684;&#x5B57;&#x6BB5;,&#x5165;VARCHAR&#x6216;BLOB.Fixed&#x7684;&#x884C;&#x957F;&#x5EA6;&#x5219;&#x662F;&#x56FA;&#x5B9A;&#x7684;,&#x53EA;&#x5305;&#x542B;&#x56FA;&#x5B9A;&#x957F;&#x5EA6;&#x7684;&#x5217;,&#x5165;CHAR&#x548C;INTEGER.Compressed&#x7684;&#x884C;&#x5219;&#x53EA;&#x5728;&#x538B;&#x7F29;&#x8868;&#x4E2D;&#x5B58;&#x5728;.</li>
</ul>
</li>
<li>Rows</li>
<li><ul>
<li>&#x8868;&#x7684;&#x884C;&#x6570;. &#x5BF9;&#x4E8E;MyISAM&#x548C;&#x5176;&#x4ED6;&#x4E00;&#x4E9B;&#x5B58;&#x50A8;&#x5F15;&#x64CE;,&#x8BE5;&#x503C;&#x662F;&#x7CBE;&#x786E;&#x7684;,&#x4F46;&#x5BF9;&#x4E8E;InnoDB,&#x8BE5;&#x503C;&#x662F;&#x4F30;&#x8BA1;&#x503C;.</li>
</ul>
</li>
<li>Avg_row_length</li>
<li><ul>
<li>&#x5E73;&#x5747;&#x6BCF;&#x884C;&#x5305;&#x542B;&#x7684;&#x5B57;&#x8282;&#x6570;;</li>
</ul>
</li>
<li>Data_length</li>
<li><ul>
<li>&#x8868;&#x6570;&#x636E;&#x7684;&#x5927;&#x5C0F;(&#x4EE5;&#x5B57;&#x8282;&#x4E3A;&#x5355;&#x4F4D;)</li>
</ul>
</li>
<li>Max_data_length</li>
<li><ul>
<li>&#x8868;&#x6570;&#x636E;&#x7684;&#x6700;&#x5927;&#x5BB9;&#x91CF;,&#x8BE5;&#x503C;&#x548C;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x6709;&#x5173;.</li>
</ul>
</li>
<li>Index_length</li>
<li><ul>
<li>&#x7D22;&#x5F15;&#x7684;&#x5927;&#x5C0F;(&#x4EE5;&#x5B57;&#x8282;&#x4E3A;&#x5355;&#x4F4D;)</li>
</ul>
</li>
<li>Data_free</li>
<li><ul>
<li>&#x5BF9;&#x4E8E;MyISAM&#x8868;,&#x8868;&#x793A;&#x5DF2;&#x5206;&#x914D;&#x4F46;&#x76EE;&#x524D;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x7684;&#x7A7A;&#x95F4;.&#x8FD9;&#x90E8;&#x5206;&#x7A7A;&#x95F4;&#x5305;&#x62EC;&#x4E86;&#x4E4B;&#x524D;&#x5220;&#x9664;&#x7684;&#x884C;,&#x4EE5;&#x53CA;&#x540E;&#x7EED;&#x53EF;&#x4EE5;&#x88AB;INSERT&#x5229;&#x7528;&#x5230;&#x7684;&#x7A7A;&#x95F4;.</li>
</ul>
</li>
<li>Auto_increment</li>
<li><ul>
<li>&#x4E0B;&#x4E00;&#x4E2A;AUTO_INCREMENT&#x7684;&#x503C;.</li>
</ul>
</li>
<li>Create_time</li>
<li><ul>
<li>&#x8868;&#x7684;&#x521B;&#x5EFA;&#x65F6;&#x95F4;.</li>
</ul>
</li>
<li>Update_time</li>
<li><ul>
<li>&#x8868;&#x6570;&#x636E;&#x7684;&#x6700;&#x540E;&#x4FEE;&#x6539;&#x65F6;&#x95F4;.</li>
</ul>
</li>
<li>Check_time</li>
<li><ul>
<li>&#x4F7F;&#x7528;CKECK TABLE&#x547D;&#x4EE4;&#x6216;&#x8005;myisamchk&#x5DE5;&#x5177;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x68C0;&#x67E5;&#x8868;&#x7684;&#x65F6;&#x95F4;</li>
</ul>
</li>
<li>Collation</li>
<li><ul>
<li>&#x8868;&#x7684;&#x9ED8;&#x8BA4;&#x5B57;&#x7B26;&#x96C6;&#x548C;&#x5B57;&#x7B26;&#x5217;&#x6392;&#x5E8F;&#x89C4;&#x5219;.</li>
</ul>
</li>
<li>Checksum</li>
<li><ul>
<li>&#x5982;&#x679C;&#x542F;&#x7528;,&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x6574;&#x4E2A;&#x8868;&#x7684;&#x5B9E;&#x65F6;&#x6821;&#x9A8C;&#x548C;.</li>
</ul>
</li>
<li>Create_options</li>
<li><ul>
<li>&#x521B;&#x5EFA;&#x8868;&#x65F6;&#x6307;&#x5B9A;&#x7684;&#x5176;&#x4ED6;&#x9009;&#x9879;.</li>
</ul>
</li>
<li>Comment</li>
<li><ul>
<li>&#x8BE5;&#x5217;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x989D;&#x5916;&#x4FE1;&#x606F;.&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x8868;&#x5728;&#x521B;&#x5EFA;&#x65F6;&#x5E26;&#x7684;&#x6CE8;&#x91CA;.</li>
</ul>
</li>
</ul>
<h3 id="1-5-1-InnoDB&#x5B58;&#x50A8;&#x5F15;&#x64CE;">1.5.1. 1.5.1 InnoDB&#x5B58;&#x50A8;&#x5F15;&#x64CE;</h3><blockquote>
<p>InnoDB&#x662F;MySQL&#x7684;&#x9ED8;&#x8BA4;&#x4E8B;&#x52A1;&#x578B;&#x5F15;&#x64CE;,&#x4E5F;&#x662F;&#x6700;&#x91CD;&#x8981;.&#x4F7F;&#x7528;&#x6700;&#x5E7F;&#x6CDB;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;.&#x5B83;&#x88AB;&#x8BBE;&#x8BA1;&#x7528;&#x6765;&#x5904;&#x7406;&#x5927;&#x91CF;&#x7684;&#x77ED;&#x671F;(short-lived)&#x4E8B;&#x52A1;,&#x77ED;&#x671F;&#x4E8B;&#x52A1;&#x5927;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x662F;&#x6B63;&#x5E38;&#x63D0;&#x4EA4;&#x7684;,&#x5F88;&#x5C11;&#x88AB;&#x56DE;&#x6EDA;.InoDB&#x7684;&#x6027;&#x80FD;&#x548C;&#x81EA;&#x52A8;&#x5D29;&#x6E83;&#x56DE;&#x590D;&#x7279;&#x6027;,&#x662F;&#x7684;&#x5B83;&#x5728;&#x975E;&#x4E8B;&#x52A1;&#x578B;&#x5B58;&#x50A8;&#x7684;&#x9700;&#x6C42;&#x4E2D;&#x4E5F;&#x5F88;&#x6D41;&#x884C;.&#x9664;&#x975E;&#x6709;&#x975E;&#x5E38;&#x7279;&#x522B;&#x7684;&#x539F;&#x56E0;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;,&#x5426;&#x5219;&#x5E94;&#x8BE5;&#x4F18;&#x5148;&#x8003;&#x8651;InnoDB&#x5F15;&#x64CE;.</p>
</blockquote>
<p><strong>InnoDB&#x7684;&#x6982;&#x89C8;</strong></p>
<ul>
<li>InnoDB&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5728;&#x8868;&#x7A7A;&#x95F4;(tablespace)&#x4E2D;,&#x8868;&#x7A7A;&#x95F4;&#x662F;&#x7531;InnoDB&#x7BA1;&#x7406;&#x7684;&#x4E00;&#x4E2A;&#x9ED1;&#x76D2;&#x5B50;,&#x7531;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x7EC4;&#x6210;.&#x5728;MySQL4.1&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#x4E2D;,InnoDB&#x53EF;&#x4EE5;&#x5C06;&#x6BCF;&#x4E2A;&#x8868;&#x7684;&#x6570;&#x636E;&#x548C;&#x7D22;&#x5F15;&#x5B58;&#x653E;&#x5728;&#x5355;&#x72EC;&#x7684;&#x6587;&#x4EF6;&#x4E2D;.InnoDB&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x88F8;&#x8BBE;&#x5907;&#x4F5C;&#x4E3A;&#x8868;&#x7A7A;&#x95F4;&#x7684;&#x5B58;&#x50A8;&#x517C;&#x804C;,&#x4F46;&#x73B0;&#x4EE3;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4F7F;&#x5F97;&#x88F8;&#x8BBE;&#x5907;&#x4E0D;&#x518D;&#x662F;&#x5FC5;&#x8981;&#x7684;&#x9009;&#x62E9;.</li>
<li>InnoDB&#x91C7;&#x7528;MVCC&#x6765;&#x652F;&#x6301;&#x9AD8;&#x5E76;&#x53D1;,&#x5E76;&#x4E14;&#x5B9E;&#x73B0;&#x4E86;&#x56DB;&#x4E2A;&#x6807;&#x51C6;&#x7684;&#x9694;&#x79BB;&#x7EA7;&#x522B;.&#x5176;&#x9ED8;&#x8BA4;&#x7EA7;&#x522B;&#x662F;REPEATABLE READ(&#x53EF;&#x91CD;&#x590D;&#x8BFB;),&#x5E76;&#x4E14;&#x901A;&#x8FC7;&#x95F4;&#x9699;&#x9501;(next-key locking)&#x7B56;&#x7565;&#x9632;&#x6B62;&#x5E7B;&#x8BFB;&#x7684;&#x51FA;&#x73B0;.&#x95F4;&#x9699;&#x9501;&#x4F7F;&#x5F97;InnoDB&#x4E0D;&#x4EC5;&#x4EC5;&#x9501;&#x5B9A;&#x67E5;&#x8BE2;&#x6D89;&#x53CA;&#x7684;&#x884C;,&#x8FD8;&#x4F1A;&#x5BF9;&#x7D22;&#x5F15;&#x4E2D;&#x7684;&#x95F4;&#x9699;&#x8FDB;&#x884C;&#x9501;&#x5B9A;,&#x4EE5;&#x9632;&#x6B62;&#x5E7B;&#x5F71;&#x884C;&#x7684;&#x63D2;&#x5165;.</li>
<li>InnoDB&#x8868;&#x65F6;&#x57FA;&#x4E8E;&#x805A;&#x7C07;&#x7D22;&#x5F15;&#x5EFA;&#x7ACB;&#x7684;.InnoDB&#x7684;&#x7D22;&#x5F15;&#x7ED3;&#x6784;&#x548C;MySQL&#x7684;&#x5176;&#x4ED6;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x6709;&#x5F88;&#x5927;&#x7684;&#x4E0D;&#x540C;,&#x805A;&#x7C07;&#x7D22;&#x5F15;&#x5BF9;&#x4E3B;&#x952E;&#x67E5;&#x8BE2;&#x6709;&#x5F88;&#x9AD8;&#x7684;&#x6027;&#x80FD;.&#x4E0D;&#x8FC7;&#x5B83;&#x7684;&#x4E8C;&#x7EA7;&#x7D22;&#x5F15;(secondary index,&#x975E;&#x4E3B;&#x952E;&#x7D22;&#x5F15;)&#x4E2D;&#x5FC5;&#x987B;&#x5305;&#x542B;&#x4E3B;&#x952E;&#x5217;,&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4E3B;&#x952E;&#x5217;&#x5F88;&#x5927;&#x7684;&#x8BDD;,&#x5176;&#x4ED6;&#x7684;&#x6240;&#x6709;&#x7D22;&#x5F15;&#x90FD;&#x4F1A;&#x5F88;&#x5927;.&#x56E0;&#x6B64;,&#x82E5;&#x8868;&#x4E0A;&#x7684;&#x7D22;&#x5F15;&#x8F83;&#x591A;&#x7684;&#x8BDD;,&#x4E3B;&#x952E;&#x5E94;&#x5F53;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x5C0F;.InnoDB&#x7684;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x662F;&#x5E73;&#x53F0;&#x72EC;&#x7ACB;&#x7684;,&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x53EF;&#x4EE5;&#x5C06;&#x6570;&#x636E;&#x548C;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x4ECE;Intel&#x5E73;&#x53F0;&#x590D;&#x5236;&#x5230;PowerPC&#x6216;&#x8005;Sun SPARC&#x5E73;&#x53F0;.</li>
<li>InnoDB&#x5185;&#x90E8;&#x505A;&#x4E86;&#x5F88;&#x591A;&#x7684;&#x4F18;&#x5316;,&#x5305;&#x62EC;&#x4ECE;&#x78C1;&#x76D8;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x65F6;&#x91C7;&#x7528;&#x7684;&#x53EF;&#x9884;&#x6D4B;&#x6027;&#x9884;&#x8BFB;,&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x521B;&#x5EFA;hash&#x7D22;&#x5F15;&#x4EE5;&#x52A0;&#x901F;&#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x81EA;&#x9002;&#x5E94;&#x54C8;&#x5E0C;&#x7D22;&#x5F15;(adaptive hash index),&#x4EE5;&#x53CA;&#x80FD;&#x591F;&#x52A0;&#x901F;&#x63D2;&#x5165;&#x64CD;&#x4F5C;&#x7684;&#x63D2;&#x5165;&#x7F13;&#x51B2;&#x533A;(insert buffer)&#x7B49;.</li>
<li>InnoDB&#x7684;&#x884C;&#x4E3A;&#x662F;&#x975E;&#x5E38;&#x590D;&#x6742;&#x7684;,&#x4E0D;&#x5BB9;&#x6613;&#x7406;&#x89E3;.&#x9605;&#x8BFB;: &#x5B98;&#x65B9;&#x624B;&#x518C;&#x4E2D;&#x7684;&#x201D;InnoDB&#x4E8B;&#x52A1;&#x6A21;&#x578B;&#x548C;&#x9501;&#x201D;. </li>
<li>&#x4F5C;&#x4E3A;&#x4E8B;&#x52A1;&#x578B;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;,InnoDB&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x673A;&#x5236;&#x548C;&#x5DE5;&#x5177;&#x652F;&#x6301;&#x771F;&#x6B63;&#x7684;&#x70ED;&#x5907;&#x4EFD;,Oracle&#x63D0;&#x4F9B;&#x7684;MySQL Enterprise Backup. Percona &#x63D0;&#x4F9B;&#x7684;&#x5F00;&#x6E90;&#x7684;XtraBackup&#x90FD;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x8FD9;&#x4E00;&#x70B9;.MySQL&#x7684;&#x5176;&#x4ED6;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E0D;&#x652F;&#x6301;&#x70ED;&#x5907;&#x4EFD;,&#x8981;&#x83B7;&#x53D6;&#x4E00;&#x81F4;&#x6027;&#x8BC6;&#x56FE;&#x9700;&#x8981;&#x505C;&#x6B62;&#x5BF9;&#x6240;&#x6709;&#x8868;&#x7684;&#x5199;&#x5165;,&#x800C;&#x5728;&#x8BFB;&#x5199;&#x6DF7;&#x5408;&#x573A;&#x666F;&#x4E2D;,&#x505C;&#x6B62;&#x5199;&#x5165;&#x53EF;&#x80FD;&#x4E5F;&#x610F;&#x5473;&#x7740;&#x505C;&#x6B62;&#x8BFB;&#x53D6;.</li>
</ul>
<h3 id="1-5-2-MyISAM&#x5B58;&#x50A8;&#x5F15;&#x64CE;">1.5.2. 1.5.2 MyISAM&#x5B58;&#x50A8;&#x5F15;&#x64CE;</h3><blockquote>
<p>&#x5728;MySQL 5.1&#x53CA;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;,MyISAM&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;.MyISAM&#x63D0;&#x4F9B;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x7279;&#x6027;,&#x5305;&#x62EC;&#x5168;&#x6587;&#x7D22;&#x5F15;.&#x538B;&#x7F29;.&#x7A7A;&#x95F4;&#x51FD;&#x6570;(GIS)&#x7B49;,&#x4F46;MyISAM&#x4E0D;&#x652F;&#x6301;&#x4E8B;&#x52A1;&#x548C;&#x884C;&#x7EA7;&#x9501;,&#x800C;&#x4E14;&#x6709;&#x4E00;&#x4E2A;&#x6BEB;&#x65E0;&#x7591;&#x95EE;&#x7684;&#x7F3A;&#x9677;&#x5C31;&#x662F;&#x5D29;&#x6E83;&#x540E;&#x65E0;&#x6CD5;&#x5B89;&#x5168;&#x4FEE;&#x590D;.&#x6B63;&#x5F0F;&#x7531;&#x4E8E;MyISAM&#x5F15;&#x64CE;&#x7684;&#x7F18;&#x6545;,&#x5373;&#x4F7F;MySQL&#x652F;&#x6301;&#x4E8B;&#x52A1;&#x5DF2;&#x7ECF;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#x4E86;,&#x5728;&#x5F88;&#x591A;&#x4EBA;&#x7684;&#x6982;&#x5FF5;&#x91CC;MySQL&#x8FD8;&#x662F;&#x975E;&#x4E8B;&#x52A1;&#x578B;&#x7684;&#x6570;&#x636E;&#x5E93;.&#x5C3D;&#x7BA1;MyISAM&#x5F15;&#x64CE;&#x4E0D;&#x652F;&#x6301;&#x4E8B;&#x52A1;.&#x4E0D;&#x652F;&#x6301;&#x5D29;&#x6E83;&#x540E;&#x7684;&#x5B89;&#x5168;&#x4FEE;&#x590D;,&#x4F46;&#x5B83;&#x7EDD;&#x4E0D;&#x662F;&#x4E00;&#x65E0;&#x662F;&#x5904;&#x7684;. &#x5BF9;&#x4E8E;&#x53EA;&#x8BFB;&#x7684;&#x6570;&#x636E;,&#x6216;&#x8005;&#x8868;&#x6BD4;&#x8F83;&#x5C0F;.&#x53EF;&#x4EE5;&#x5FCD;&#x53D7;&#x4FEE;&#x590D;(repair)&#x64CD;&#x4F5C;,&#x5219;&#x4F9D;&#x7136;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;MyISAM(&#x5355;&#x8BF7;&#x4E0D;&#x8981;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;MyISAM,&#x800C;&#x662F;&#x5E94;&#x5F53;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;InnoDB).</p>
</blockquote>
<ul>
<li>&#x5B58;&#x50A8;</li>
<li><ul>
<li>MyISAM&#x4F1A;&#x5728;&#x8868;&#x5B58;&#x50A8;&#x5728;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;: &#x6570;&#x636E;&#x6587;&#x4EF6;&#x548C;&#x7D22;&#x5F15;&#x6587;&#x4EF6;,&#x5206;&#x8D1D;&#x4EEA;.MYD&#x548C;.MYI&#x4E3A;&#x6269;&#x5C55;&#x540D;.MyISAM&#x8868;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x52A8;&#x6001;&#x6216;&#x8005;&#x9759;&#x6001;(&#x957F;&#x5EA6;&#x56FA;&#x5B9A;)&#x884C;.MySQL&#x4F1A;&#x6839;&#x636E;&#x8868;&#x7684;&#x5B9A;&#x4E49;&#x6765;&#x51B3;&#x5B9A;&#x91C7;&#x7528;&#x4F55;&#x79CD;&#x683C;&#x5F0F;.MyISAM&#x8868;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x7684;&#x884C;&#x8BB0;&#x5F55;&#x6570;,&#x4E00;&#x822C;&#x53D7;&#x9650;&#x4E8E;&#x53EF;&#x7528;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;,&#x6216;&#x8005;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E2D;&#x803D;&#x6401;&#x6587;&#x4EF6;&#x7684;&#x6700;&#x5927;&#x5C3A;&#x5BF8;.</li>
</ul>
</li>
<li>MyISAM&#x7279;&#x6027;</li>
<li><ul>
<li>&#x52A0;&#x9501;&#x4E0E;&#x5E76;&#x53D1;</li>
</ul>
</li>
</ul>
<blockquote>
<p>MyISAM&#x5BF9;&#x6574;&#x5F20;&#x8868;&#x52A0;&#x9501;,&#x800C;&#x4E0D;&#x662F;&#x9488;&#x5BF9;&#x884C;.&#x8BFB;&#x53D6;&#x65F6;&#x4F1A;&#x5BF9;&#x9700;&#x8981;&#x8BFB;&#x5230;&#x7684;&#x6240;&#x6709;&#x8868;&#x52A0;&#x5171;&#x4EAB;&#x9501;,&#x5199;&#x5165;&#x65F6;&#x5219;&#x5BF9;&#x8868;&#x52A0;&#x6392;&#x5B83;&#x9501;.&#x4F46;&#x662F;&#x5728;&#x8868;&#x6709;&#x8BFB;&#x53D6;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;,&#x4E5F;&#x53EF;&#x4EE5;&#x5F80;&#x8868;&#x4E2D;&#x63D2;&#x5165;&#x65B0;&#x7684;&#x8BB0;&#x5F55;(&#x8FD9;&#x88AB;&#x79F0;&#x4E3A;&#x5E76;&#x53D1;&#x63D2;&#x5165;,CONCURRENT INSERT).</p>
</blockquote>
<ul>
<li><ul>
<li>&#x4FEE;&#x590D;</li>
</ul>
</li>
</ul>
<blockquote>
<p>&#x5BF9;&#x4E8E;MyISAM&#x8868;,MySQL&#x53EF;&#x4EE5;&#x624B;&#x5DE5;&#x6216;&#x8005;&#x81EA;&#x52A8;&#x6267;&#x884C;&#x68C0;&#x67E5;&#x548C;&#x4FEE;&#x590D;&#x64CD;&#x4F5C;,&#x4F46;&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x4FEE;&#x590D;&#x548C;&#x4E8B;&#x52A1;&#x6062;&#x590D;&#x4EE5;&#x53CA;&#x5D29;&#x6E83;&#x6062;&#x590D;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x6982;&#x5FF5;.&#x6267;&#x884C;&#x8868;&#x7684;&#x4FEE;&#x590D;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x4E22;&#x5931;,&#x800C;&#x4E14;&#x4FEE;&#x590D;&#x64CD;&#x4F5C;&#x662F;&#x975E;&#x5E38;&#x6162;&#x7684;. &#x53EF;&#x4EE5;&#x901A;&#x8FC7; CHECK TABLE mytable &#x68C0;&#x67E5;&#x8868;&#x7684;&#x9519;&#x8BEF;,&#x5982;&#x679C;&#x6709;&#x9519;&#x8BEF;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6267;&#x884C; REPAIR TABLE mytable &#x8FDB;&#x884C;&#x4FEE;&#x590D;. &#x53E6;&#x5916;,&#x5982;&#x679C;MySQL&#x670D;&#x52A1;&#x5668;&#x5DF2;&#x7ECF;&#x5173;&#x95ED;,&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;myisamchk&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#x8FDB;&#x884C;&#x68C0;&#x67E5;&#x548C;&#x4FEE;&#x590D;&#x64CD;&#x4F5C;.</p>
</blockquote>
<ul>
<li><ul>
<li>&#x7D22;&#x5F15;&#x7279;&#x6027;</li>
</ul>
</li>
</ul>
<blockquote>
<p>&#x5BF9;&#x4E8E;MyISAM&#x8868;,&#x5373;&#x4F7F;&#x662F;BLOB&#x548C;TEXT&#x7B49;&#x957F;&#x5B57;&#x6BB5;,&#x4E5F;&#x53EF;&#x4EE5;&#x57FA;&#x4E8E;&#x5176;&#x524D;500&#x4E2A;&#x5B57;&#x7B26;&#x521B;&#x5EFA;&#x7D22;&#x5F15;.MyISAM&#x4E5F;&#x652F;&#x6301;&#x5168;&#x6587;&#x7D22;&#x5F15;,&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x57FA;&#x4E8E;&#x5206;&#x8BCD;&#x521B;&#x5EFA;&#x7684;&#x7D22;&#x5F15;,&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x590D;&#x6742;&#x7684;&#x67E5;&#x8BE2;.</p>
</blockquote>
<ul>
<li><ul>
<li>&#x5EF6;&#x8FDF;&#x66F4;&#x65B0;&#x7D22;&#x5F15;&#x952E;(Delayed Key Write)</li>
</ul>
</li>
</ul>
<blockquote>
<p>&#x521B;&#x5EFA;MyISAM&#x8868;&#x7684;&#x65F6;&#x5019;,&#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E86;DELAY_KEY_WRITE&#x9009;&#x9879;,&#x5728;&#x6BCF;&#x6B21;&#x4FEE;&#x6539;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x65F6;,&#x4E0D;&#x4F1A;&#x7ACB;&#x523B;&#x5C06;&#x4FEE;&#x6539;&#x7684;&#x7D22;&#x5F15;&#x6570;&#x636E;&#x5199;&#x5165;&#x78C1;&#x76D8;,&#x800C;&#x662F;&#x4F1A;&#x5199;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x952E;&#x7F13;&#x51B2;&#x533A;(in-memory key buffer),&#x53EA;&#x6709;&#x5728;&#x6E05;&#x7406;&#x952E;&#x7F13;&#x51B2;&#x533A;&#x6216;&#x8005;&#x5173;&#x95ED;&#x8868;&#x7684;&#x65F6;&#x5019;&#x624D;&#x4F1A;&#x5C06;&#x5BF9;&#x5E94;&#x7684;&#x7D22;&#x5F15;&#x5757;&#x5438;&#x5165;&#x5230;&#x78C1;&#x76D8;.&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x6781;&#x5927;&#x5730;&#x63D0;&#x5347;&#x5199;&#x5165;&#x6027;&#x80FD;,&#x4F46;&#x662F;&#x5728;&#x6570;&#x636E;&#x5E93;&#x6216;&#x8005;&#x4E3B;&#x673A;&#x5D29;&#x6E83;&#x65F6;&#x4F1A;&#x9020;&#x6210;&#x7D22;&#x5F15;&#x635F;&#x574F;,&#x9700;&#x8981;&#x6267;&#x884C;&#x4FEE;&#x590D;&#x64CD;&#x4F5C;.&#x5EF6;&#x8FDF;&#x66F4;&#x65B0;&#x7D22;&#x5F15;&#x952E;&#x7684;&#x7279;&#x6027;,&#x53EF;&#x4EE5;&#x5728;&#x5168;&#x5C40;&#x8BBE;&#x7F6E;,&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;&#x803D;&#x6401;&#x8868;&#x8BBE;&#x7F6E;.</p>
</blockquote>
<ul>
<li>MyISAM&#x538B;&#x7F29;&#x8868;</li>
<li><ul>
<li>&#x5982;&#x679C;&#x8868;&#x5728;&#x521B;&#x5EFA;&#x5E76;&#x5BFC;&#x5165;&#x6570;&#x636E;&#x4EE5;&#x540E;,&#x4E0D;&#x4F1A;&#x518D;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;,&#x90A3;&#x4E48;&#x8FD9;&#x6837;&#x7684;&#x8868;&#x6216;&#x8BB8;&#x9002;&#x5408;&#x91C7;&#x7528;MyISAM&#x538B;&#x7F29;&#x8868;.</li>
</ul>
</li>
<li><ul>
<li>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;myisampack&#x5BF9;MyISAM&#x8868;&#x8FDB;&#x884C;&#x538B;&#x7F29;(&#x4E5F;&#x53EB;&#x6253;&#x5305;pack).&#x538B;&#x7F29;&#x8868;&#x662F;&#x4E0D;&#x80FD;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x7684;(&#x9664;&#x975E;&#x73B0;&#x5C06;&#x8868;&#x63A5;&#x89E6;&#x538B;&#x7F29;,&#x4FEE;&#x6539;&#x6570;&#x636E;,&#x7136;&#x540E;&#x518D;&#x6B21;&#x538B;&#x7F29;). &#x538B;&#x7F29;&#x8868;&#x53EF;&#x4EE5;&#x6781;&#x5927;&#x5730;&#x51CF;&#x5C11;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x5360;&#x7528;,&#x56E0;&#x6B64;&#x4E5F;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x78C1;&#x76D8;I/O,&#x4ECE;&#x800C;&#x63D0;&#x5347;&#x67E5;&#x8BE2;&#x6027;&#x80FD;. &#x538B;&#x7F29;&#x8868;&#x4E5F;&#x652F;&#x6301;&#x7D22;&#x5F15;,&#x4F46;&#x7D22;&#x5F15;&#x4E5F;&#x662F;&#x53EA;&#x8BFB;&#x7684;.</li>
</ul>
</li>
<li><ul>
<li>&#x4EE5;&#x73B0;&#x5728;&#x7684;&#x786C;&#x4EF6;&#x80FD;&#x529B;,&#x5BF9;&#x5927;&#x591A;&#x6570;&#x5E94;&#x7528;&#x573A;&#x666F;,&#x8BFB;&#x53D6;&#x538B;&#x7F29;&#x8868;&#x6570;&#x636E;&#x65F6;&#x7684;&#x89E3;&#x538B;&#x5E26;&#x6765;&#x7684;&#x5F00;&#x9500;&#x5F71;&#x54CD;&#x5E76;&#x4E0D;&#x5927;,&#x800C;&#x51CF;&#x5C11;I/O&#x5E26;&#x6765;&#x7684;&#x597D;&#x5904;&#x5219;&#x8981;&#x5927;&#x5F97;&#x591A;.&#x538B;&#x7F29;&#x65F6;&#x8868;&#x4E2D;&#x7684;&#x8BB0;&#x5F55;&#x65F6;&#x72EC;&#x7ACB;&#x538B;&#x7F29;&#x7684;,&#x6240;&#x4EE5;&#x8BFB;&#x53D6;&#x5355;&#x884C;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x9700;&#x8981;&#x53BB;&#x89E3;&#x538B;&#x6574;&#x4E2A;&#x8868;(&#x751A;&#x81F3;&#x4E5F;&#x4E0D;&#x89E3;&#x538B;&#x884C;&#x6240;&#x5728;&#x7684;&#x6574;&#x4E2A;&#x9875;&#x9762;).</li>
</ul>
</li>
<li>MyISAM&#x6027;&#x80FD;</li>
<li><ul>
<li>MyISAM&#x5F15;&#x64CE;&#x8BBE;&#x8BA1;&#x7B80;&#x5355;,&#x6570;&#x636E;&#x4EE5;&#x7D27;&#x5BC6;&#x683C;&#x5F0F;&#x5B58;&#x50A8;,&#x6240;&#x4EE5;&#x5728;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x4E0B;&#x6027;&#x80FD;&#x5F88;&#x597D;.MyISAM&#x6709;&#x4E00;&#x4E9B;&#x670D;&#x52A1;&#x5668;&#x7EA7;&#x522B;&#x7684;&#x6027;&#x80FD;&#x6269;&#x5C55;&#x9650;&#x5236;,&#x6BD4;&#x5982;&#x5BF9;&#x7D22;&#x5F15;&#x952E;&#x7F13;&#x51B2;&#x533A;(key cache)&#x7684;Mutex&#x9501;,MariaDB&#x57FA;&#x4E8E;&#x6BB5;(segment)&#x7684;&#x7D22;&#x5F15;&#x952E;&#x7F13;&#x51B2;&#x533A;&#x673A;&#x5236;&#x6765;&#x907F;&#x514D;&#x8BE5;&#x95EE;&#x9898;.&#x4F46;MyISAM&#x6700;&#x5178;&#x578B;&#x7684;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x8FD8;&#x662F;&#x8868;&#x9501;&#x7684;&#x95EE;&#x9898;,&#x5982;&#x679C;&#x4F60;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x7684;&#x67E5;&#x8BE2;&#x90FD;&#x957F;&#x671F;&#x5904;&#x4E8E;&#x201D;Locked&#x201D;&#x72B6;&#x6001;,&#x90A3;&#x4E48;&#x6BEB;&#x65E0;&#x7591;&#x95EE;&#x8868;&#x9501;&#x5C31;&#x662F;&#x7F6A;&#x9B41;&#x7978;&#x9996;.</li>
</ul>
</li>
</ul>
<h3 id="1-5-3-MySQL&#x5185;&#x5EFA;&#x7684;&#x5176;&#x4ED6;&#x5B58;&#x50A8;&#x5F15;&#x64CE;">1.5.3. 1.5.3 MySQL&#x5185;&#x5EFA;&#x7684;&#x5176;&#x4ED6;&#x5B58;&#x50A8;&#x5F15;&#x64CE;</h3><h3 id="1-5-4-&#x7B2C;&#x4E09;&#x65B9;&#x5B58;&#x50A8;&#x5F15;&#x64CE;">1.5.4. 1.5.4 &#x7B2C;&#x4E09;&#x65B9;&#x5B58;&#x50A8;&#x5F15;&#x64CE;</h3><p><strong>OLTP&#x7C7B;&#x5F15;&#x64CE;</strong></p>
<ul>
<li>Persona&#x7684;XtraDB&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x662F;&#x57FA;&#x4E8E;InnoDB&#x5F15;&#x64CE;&#x7684;&#x4E00;&#x4E2A;&#x6539;&#x8FDB;&#x7248;&#x672C;,&#x5DF2;&#x7ECF;&#x5305;&#x542B;&#x5728;Percona Server&#x548C;MariaDB&#x4E2D;,&#x5B83;&#x7684;&#x6539;&#x8FDB;&#x70B9;&#x4E3B;&#x8981;&#x96C6;&#x4E2D;&#x5728;&#x6027;.&#x53EF;&#x6D4B;&#x91CF;&#x6027;&#x548C;&#x64CD;&#x4F5C;&#x7075;&#x6D3B;&#x6027;&#x65B9;&#x9762;. XtraDB&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;InnoDB&#x7684;&#x4E00;&#x4E2A;&#x5B8C;&#x5168;&#x7684;&#x66FF;&#x4EE3;&#x4EA7;&#x54C1;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x517C;&#x5BB9;&#x5730;&#x8BFB;&#x5199;InnoDB&#x7684;&#x6570;&#x636E;&#x6587;&#x4EF6;,&#x5E76;&#x652F;&#x6301;InnoDB&#x7684;&#x6240;&#x6709;&#x67E5;&#x8BE2;.</li>
<li>&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x548C;InnoDB&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#x7684;OLTP&#x7C7B;&#x5B58;&#x50A8;&#x5F15;&#x64CE;,&#x6BD4;&#x5982;&#x90FD;&#x652F;&#x6301;ACID&#x4E8B;&#x52A1;&#x548C;MVCC. &#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5C31;&#x662F;PBXT,&#x7531;Paul McCullagh&#x548C; Primebbase GMBH&#x5F00;&#x53D1;. &#x5B83;&#x652F;&#x6301;&#x5F15;&#x64CE;&#x7EA7;&#x522B;&#x7684;&#x590D;&#x5236;.&#x5916;&#x952E;&#x7EA6;&#x675F;,&#x5E76;&#x4E14;&#x4EE5;&#x4E00;&#x79CD;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x7684;&#x67B6;&#x6784;&#x5BF9;&#x56FA;&#x6001;&#x5B58;&#x50A8;(SSD)&#x63D0;&#x4F9B;&#x4E86;&#x9002;&#x5F53;&#x7684;&#x652F;&#x6301;,&#x8FD8;&#x5BF9;&#x8F83;&#x5927;&#x7684;&#x503C;&#x7C7B;&#x578B;&#x6BD4;&#x5982;BLOB&#x4E5F;&#x505A;&#x4E86;&#x4F18;&#x5316;.PBXT&#x662F;&#x4E00;&#x6B3E;&#x793E;&#x533A;&#x652F;&#x6301;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;,MariaDB&#x5305;&#x542B;&#x4E86;&#x8BE5;&#x5F15;&#x64CE;.</li>
<li>TokuDB&#x5F15;&#x64CE;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x79CD;&#x65B0;&#x7684;&#x53EB;&#x505A;&#x5206;&#x5F62;&#x6570;(Fractal Trees)&#x7684;&#x7D22;&#x5F15;&#x6570;&#x636E;&#x7ED3;&#x6784;. &#x8BE5;&#x7ED3;&#x6784;&#x662F;&#x7F13;&#x5B58;&#x65E0;&#x5173;&#x7684;,&#x56E0;&#x6B64;&#x5373;&#x4F7F;&#x5176;&#x5927;&#x5C0F;&#x8D85;&#x8FC7;&#x5185;&#x5B58;&#x6027;&#x80FD;&#x4E5F;&#x4E0D;&#x4F1A;&#x4E0B;&#x964D;,&#x4E5F;&#x5C31;&#x6CA1;&#x6709;&#x5185;&#x5B58;&#x751F;&#x547D;&#x5468;&#x671F;&#x548C;&#x788E;&#x7247;&#x7684;&#x95EE;&#x9898;.TokuDB&#x662F;&#x4E00;&#x79CD;&#x5927;&#x6570;&#x636E;(Big Data)&#x5B58;&#x50A8;&#x5F15;&#x64CE;,&#x56E0;&#x4E3A;&#x5176;&#x62E5;&#x6709;&#x5F88;&#x9AD8;&#x7684;&#x538B;&#x7F29;&#x6BD4;,&#x53EF;&#x4EE5;&#x5728;&#x5F88;&#x5927;&#x7684;&#x6570;&#x636E;&#x91CF;&#x4E0A;&#x521B;&#x5EFA;&#x5927;&#x91CF;&#x7D22;&#x5F15;.</li>
</ul>
<p><strong>&#x9762;&#x5411;&#x5217;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;</strong></p>
<blockquote>
<p>MySQL&#x9ED8;&#x8BA4;&#x662F;&#x9762;&#x5411;&#x884C;&#x7684;,&#x6BCF;&#x4E00;&#x884C;&#x7684;&#x6570;&#x636E;&#x662F;&#x4E00;&#x8D77;&#x5B58;&#x50A8;&#x7684;,&#x670D;&#x52A1;&#x5668;&#x7684;&#x67E5;&#x8BE2;&#x4E5F;&#x662F;&#x4EE5;&#x884C;&#x4E3A;&#x5355;&#x4F4D;&#x5904;&#x7406;&#x7684;. &#x800C;&#x5728;&#x5927;&#x6570;&#x636E;&#x91CF;&#x5904;&#x7406;&#x65F6;,&#x9762;&#x5411;&#x5217;&#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x80FD;&#x6548;&#x7387;&#x66F4;&#x9AD8;. &#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x6574;&#x884C;&#x7684;&#x6570;&#x636E;,&#x9762;&#x5411;&#x5217;&#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x4F20;&#x8F93;&#x66F4;&#x5C11;&#x7684;&#x6570;&#x636E;. &#x5982;&#x679C;&#x6BCF;&#x4E00;&#x5217;&#x90FD;&#x5355;&#x72EC;&#x5B58;&#x50A8;,&#x90A3;&#x4E48;&#x538B;&#x7F29;&#x7684;&#x6548;&#x7387;&#x4E5F;&#x4F1A;&#x66F4;&#x9AD8;.</p>
</blockquote>
<ul>
<li>Infobright&#x662F;&#x6700;&#x6709;&#x540D;&#x7684;&#x9762;&#x5411;&#x5217;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;. &#x5728;&#x975E;&#x5E38;&#x5927;&#x7684;&#x6570;&#x636E;&#x91CF;(&#x6570;&#x5341;TB)&#x65F6;,&#x8BE5;&#x5F15;&#x64CE;&#x5DE5;&#x4F5C;&#x826F;&#x597D;. Infobright&#x662F;&#x4E3A;&#x6570;&#x636E;&#x5206;&#x6790;&#x548C;&#x6570;&#x636E;&#x4ED3;&#x5E93;&#x5E94;&#x7528;&#x8BBE;&#x8BA1;&#x7684;. &#x6570;&#x636E;&#x9AD8;&#x5EA6;&#x538B;&#x7F29;,&#x6309;&#x7167;&#x5757;&#x8FDB;&#x884C;&#x6392;&#x5E8F;,&#x6BCF;&#x4E2A;&#x5757;&#x90FD;&#x5BF9;&#x5E94;&#x6709;&#x4E00;&#x7EC4;&#x5143;&#x6570;&#x636E;. &#x5728;&#x5904;&#x7406;&#x67E5;&#x8BE2;&#x65F6;,&#x8BBF;&#x95EE;&#x5143;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x51B3;&#x5B9A;&#x8DF3;&#x8FC7;&#x8BE5;&#x5757;,&#x751A;&#x81F3;&#x53EF;&#x80FD;&#x53EA;&#x9700;&#x8981;&#x5143;&#x6570;&#x636E;&#x5373;&#x53EF;&#x6EE1;&#x8DB3;&#x67E5;&#x8BE2;&#x7684;&#x9700;&#x6C42;.&#x4F46;&#x8BE5;&#x5F15;&#x64CE;&#x4E0D;&#x652F;&#x6301;&#x7D22;&#x5F15;,&#x4E0D;&#x8FC7;&#x5728;&#x8FD9;&#x4E48;&#x5927;&#x7684;&#x6570;&#x636E;&#x91CF;&#x7EA7;,&#x5373;&#x4F7F;&#x6709;&#x7D22;&#x5F15;&#x4E5F;&#x5F88;&#x96BE;&#x53D1;&#x6325;&#x4F5C;&#x7528;,&#x800C;&#x4E14;&#x5757;&#x7ED3;&#x6784;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x51C6;&#x7D22;&#x5F15;(quasi-index). Infobright&#x9700;&#x8981;&#x5BF9;MySQL&#x670D;&#x52A1;&#x5668;&#x505A;&#x5B9A;&#x5236;,&#x56E0;&#x4E3A;&#x4E00;&#x4E9B;&#x5730;&#x65B9;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4EE5;&#x9002;&#x5E94;&#x9762;&#x5411;&#x5217;&#x5B58;&#x50A8;&#x7684;&#x9700;&#x8981;. &#x5982;&#x679C;&#x67E5;&#x8BE2;&#x65E0;&#x6CD5;&#x518D;&#x5B58;&#x50A8;&#x5C42;&#x4F7F;&#x7528;&#x9762;&#x5411;&#x5217;&#x7684;&#x6A21;&#x5F0F;&#x6267;&#x884C;,&#x5219;&#x9700;&#x8981;&#x5728;&#x670D;&#x52A1;&#x5668;&#x5C42;&#x8F6C;&#x6362;&#x6210;&#x6309;&#x5904;&#x7406;,&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4F1A;&#x5F88;&#x6162;.Infobright&#x6709;&#x793E;&#x533A;&#x7248;&#x548C;&#x5546;&#x4E1A;&#x7248;&#x4E24;&#x4E2A;&#x7248;&#x672C;.</li>
</ul>
<p><strong>&#x793E;&#x533A;&#x5B58;&#x50A8;&#x5F15;&#x64CE;</strong><br>&#x614E;&#x7528;</p>
<h3 id="1-5-5-&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x5F15;&#x64CE;">1.5.5. 1.5.5 &#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x5F15;&#x64CE;</h3><blockquote>
<p>&#x5927;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x4E0B;,InnoDB&#x90FD;&#x662F;&#x6B63;&#x786E;&#x7684;&#x9009;&#x62E9;,&#x6240;&#x4EE5;Oracle&#x5728;MySQL5.5&#x7248;&#x672C;&#x65F6;&#x7EC8;&#x4E8E;&#x5C06;InnoDB&#x4F5C;&#x4E3A;&#x9ED8;&#x8BA4;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;.<strong>&#x9664;&#x975E;&#x9700;&#x8981;&#x7528;&#x5230;&#x67D0;&#x4E9B;InnoDB&#x4E0D;&#x5177;&#x5907;&#x7684;&#x7279;&#x6027;,&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x66FF;&#x4EE3;,&#x5426;&#x5219;&#x90FD;&#x5E94;&#x8BE5;&#x4F18;&#x5148;&#x9009;&#x62E9;InnoDB&#x5F15;&#x64CE;</strong>,&#x9664;&#x975E;&#x4E07;&#x4E0D;&#x5F97;&#x5DF2;,&#x5426;&#x5219;&#x5EFA;&#x8BAE;&#x4E0D;&#x8981;&#x6DF7;&#x5408;&#x4F7F;&#x7528;&#x591A;&#x79CD;&#x5B58;&#x50A8;&#x5F15;&#x64CE;,&#x5426;&#x5219;&#x53EF;&#x80FD;&#x5E26;&#x6765;&#x4E00;&#x4E9B;&#x5217;&#x590D;&#x6742;&#x7684;&#x95EE;&#x9898;,&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x6F5C;&#x5728;&#x7684;bug&#x548C;&#x8FB9;&#x95F4;&#x95EE;&#x9898;.</p>
</blockquote>
<p><strong>&#x5982;&#x679C;&#x5E94;&#x7528;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;,&#x6E05;&#x5148;&#x8003;&#x8651;&#x4E00;&#x4E0B;&#x51E0;&#x4E2A;&#x56E0;&#x7D20;</strong></p>
<ul>
<li><p>&#x4E8B;&#x52A1;</p>
</li>
<li><ul>
<li>&#x5982;&#x679C;&#x5E94;&#x7528;&#x9700;&#x8981;&#x4E8B;&#x52A1;&#x652F;&#x6301;,&#x90A3;&#x4E48;InnoDB(&#x6216;&#x8005;XtraDB)&#x662F;&#x76EE;&#x524D;&#x6700;&#x7A33;&#x5B9A;&#x5E76;&#x4E14;&#x7ECF;&#x8FC7;&#x9A8C;&#x8BC1;&#x7684;&#x9009;&#x62E9;.&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x4E8B;&#x52A1;,&#x5E76;&#x4E14;&#x4E3B;&#x8981;&#x662F; SELECT &#x548C; INSERT &#x64CD;&#x4F5C;,&#x90A3;&#x4E48;MyISAM&#x662F;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;.&#x4E00;&#x822C;&#x65E5;&#x5FD7;&#x578B;&#x7684;&#x5E94;&#x7528;&#x6BD4;&#x8F83;&#x7B26;&#x5408;&#x8FD9;&#x4E00;&#x7279;&#x6027;.</li>
</ul>
</li>
<li><p>&#x5907;&#x4EFD;</p>
</li>
<li><ul>
<li>&#x5907;&#x4EFD;&#x7684;&#x9700;&#x6C42;&#x4E5F;&#x4F1A;&#x5F71;&#x54CD;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684;&#x9009;&#x62E9;. &#x5982;&#x679C;&#x53EF;&#x4EE5;&#x5B9A;&#x671F;&#x5730;&#x5173;&#x95ED;&#x670D;&#x52A1;&#x5668;&#x6765;&#x6267;&#x884C;&#x5907;&#x4EFD;,&#x90A3;&#x4E48;&#x5907;&#x4EFD;&#x7684;&#x56E0;&#x7D20;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;. &#x53CD;&#x4E4B;,&#x5982;&#x679C;&#x9700;&#x8981;&#x5728;&#x7EBF;&#x70ED;&#x5907;&#x4EFD;,&#x90A3;&#x4E48;&#x9009;&#x62E9;InnoDB&#x5C31;&#x662F;&#x57FA;&#x672C;&#x7684;&#x8981;&#x6C42;.</li>
</ul>
</li>
<li><p>&#x5D29;&#x6E83;&#x56DE;&#x590D;</p>
</li>
<li><ul>
<li>&#x6570;&#x636E;&#x91CF;&#x6BD4;&#x8F83;&#x5927;&#x7684;&#x65F6;&#x5019;,&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;&#x540E;&#x5982;&#x4F55;&#x5FEB;&#x901F;&#x5730;&#x6062;&#x590D;&#x662F;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x95EE;&#x9898;. &#x76F8;&#x5BF9;&#x800C;&#x8A00;,MyISAM&#x5D29;&#x6E83;&#x540E;&#x53D1;&#x751F;&#x635F;&#x574F;&#x7684;&#x6982;&#x7387;&#x6BD4;InnoDB&#x8981;&#x9AD8;&#x5F88;&#x591A;,&#x800C;&#x4E14;&#x6062;&#x590D;&#x901F;&#x5EA6;&#x4E5F;&#x8981;&#x6162;. &#x56E0;&#x6B64;,&#x5373;&#x4F7F;&#x4E0D;&#x9700;&#x8981;&#x4E8B;&#x52A1;&#x652F;&#x6301;,&#x5F88;&#x591A;&#x4EBA;&#x4E5F;&#x9009;&#x62E9;InnoDB&#x5F15;&#x64CE;,&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x56E0;&#x7D20;.</li>
</ul>
</li>
<li><p>&#x7279;&#x6709;&#x7684;&#x7279;&#x6027;</p>
</li>
<li><ul>
<li>&#x6709;&#x4E9B;&#x5E94;&#x7528;&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x4E00;&#x4E9B;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x6240;&#x72EC;&#x6709;&#x7684;&#x7279;&#x6027;&#x6216;&#x8005;&#x4F18;&#x5316;,&#x6BD4;&#x5982;&#x5F88;&#x591A;&#x5E94;&#x7528;&#x4F9D;&#x8D56;&#x805A;&#x7C07;&#x7D22;&#x5F15;&#x7684;&#x4F18;&#x5316;. &#x53E6;&#x5916;MySQL&#x4E2D;&#x4E5F;&#x53EA;&#x6709;MyISAM&#x652F;&#x6301;&#x5730;&#x7406;&#x7A7A;&#x95F4;&#x641C;&#x7D22;. &#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x62E5;&#x6709;&#x4E00;&#x4E9B;&#x5173;&#x952E;&#x7684;&#x7279;&#x6027;,&#x540C;&#x65F6;&#x5374;&#x53C8;&#x7F3A;&#x4E4F;&#x4E00;&#x4E9B;&#x5FC5;&#x8981;&#x7684;&#x7279;&#x6027;,&#x90A3;&#x4E48;&#x6709;&#x65F6;&#x5019;&#x4E0D;&#x5F97;&#x4E0D;&#x505A;&#x8FD9;&#x79CD;&#x7684;&#x8003;&#x8651;,&#x6216;&#x8005;&#x5728;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;&#x4E0A;&#x505A;&#x4E00;&#x4E9B;&#x53D6;&#x820D;. &#x67D0;&#x4E9B;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x652F;&#x6301;&#x7684;&#x7279;&#x6027;,&#x6709;&#x65F6;&#x5019;&#x901A;&#x8FC7;&#x53D8;&#x901A;&#x4E5F;&#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;.</li>
</ul>
</li>
<li><p><strong>&#x65E5;&#x5FD7;&#x578B;&#x5E94;&#x7528;</strong></p>
</li>
<li><ul>
<li>&#x5047;&#x8BBE;&#x4F60;&#x9700;&#x8981;&#x8BD5;&#x8BD5;&#x5730;&#x8BB0;&#x5F55;&#x4E00;&#x53F0;&#x4E2D;&#x5FC3;&#x7535;&#x8BDD;&#x4EA4;&#x6362;&#x673A;&#x7684;&#x6BCF;&#x4E00;&#x901A;&#x7535;&#x8BDD;&#x7684;&#x65E5;&#x5FD7;&#x5230;MySQL&#x4E2D;,&#x6216;&#x8005;&#x901A;&#x8FC7;Apache&#x7684;mod_log_sql&#x6A21;&#x5757;&#x5C06;&#x7F51;&#x7AD9;&#x7684;&#x6240;&#x6709;&#x8BBF;&#x95EE;&#x4FE1;&#x606F;&#x76F4;&#x63A5;&#x8BB0;&#x5F55;&#x5230;&#x8868;&#x4E2D;. &#x8FD9;&#x4E00;&#x7C7B;&#x5E94;&#x7528;&#x7684;&#x63D2;&#x5165;&#x901F;&#x5EA6;&#x6709;&#x5F88;&#x9AD8;&#x7684;&#x8981;&#x6C42;,&#x6570;&#x636E;&#x5E93;&#x4E0D;&#x80FD;&#x6210;&#x4E3A;&#x74F6;&#x9888;.MyISAM&#x6216;&#x8005;archive&#x5B58;&#x50A8;&#x9634;&#x5F71;&#x5BF9;&#x8FD9;&#x7C7B;&#x5E94;&#x7528;&#x6BD4;&#x8F83;&#x5408;&#x9002;,&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x5F00;&#x9500;&#x4F4E;,&#x800C;&#x4E14;&#x63D2;&#x5165;&#x901F;&#x5EA6;&#x975E;&#x5E38;&#x5FEB;.</li>
</ul>
</li>
<li><ul>
<li>&#x5982;&#x679C;&#x9700;&#x8981;&#x5BF9;&#x8BB0;&#x5F55;&#x7684;&#x65E5;&#x5FD7;&#x505A;&#x5206;&#x6790;&#x62A5;&#x8868;,&#x5219;&#x4E8B;&#x60C5;&#x5C31;&#x4F1A;&#x53D8;&#x5F97;&#x6709;&#x8DA3;&#x4E86;.&#x751F;&#x6210;&#x62A5;&#x8868;&#x7684;SQL&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x63D2;&#x5165;&#x6548;&#x7387;&#x660E;&#x663E;&#x964D;&#x4F4E;,&#x4E24;&#x79CD;&#x89E3;&#x51B3;&#x529E;&#x6CD5;: </li>
</ul>
</li>
<li><ul>
<li><ul>
<li>&#x5229;&#x7528;MySQL&#x5185;&#x7F6E;&#x7684;&#x590D;&#x5236;&#x65B9;&#x6848;&#x5C06;&#x6570;&#x636E;&#x590D;&#x5236;&#x4E00;&#x4EFD;&#x5230;&#x5907;&#x5E93;,&#x7136;&#x540E;&#x5728;&#x5907;&#x5E93;&#x4E0A;&#x6267;&#x884C;&#x6BD4;&#x8F83;&#x6D88;&#x8017;&#x65F6;&#x95F4;&#x7684;CPU&#x7684;&#x67E5;&#x8BE2;. &#x8FD9;&#x6837;&#x4E3B;&#x5E93;&#x53EA;&#x7528;&#x4E8E;&#x9AD8;&#x6548;&#x7684;&#x63D2;&#x5165;&#x5DE5;&#x4F5C;,&#x800C;&#x5907;&#x5E93;&#x4E0A;&#x6267;&#x884C;&#x7684;&#x67E5;&#x8BE2;&#x4E5F;&#x65E0;&#x9700;&#x62C5;&#x5FC3;&#x5F71;&#x54CD;&#x5230;&#x65E5;&#x5FD7;&#x7684;&#x63D2;&#x5165;&#x6027;&#x80FD;. &#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;&#x8F83;&#x4F4E;&#x7684;&#x65F6;&#x5019;&#x6267;&#x884C;&#x62A5;&#x8868;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;,&#x4F46;&#x5E94;&#x7528;&#x5728;&#x4E0D;&#x65AD;&#x53D8;&#x5316;,&#x5982;&#x679C;&#x4F9D;&#x8D56;&#x8FD9;&#x4E2A;&#x7B56;&#x7565;&#x53EF;&#x80FD;&#x4EE5;&#x540E;&#x4F1A;&#x5BFC;&#x81F4;&#x95EE;&#x9898;.</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>&#x5728;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x8868;&#x7684;&#x540D;&#x5B57;&#x4E2D;&#x5305;&#x542B;&#x5E74;&#x548C;&#x6708;&#x7684;&#x4FE1;&#x606F;,&#x6BD4;&#x5982;web_logs_2012_01. &#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5728;&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;&#x63D2;&#x5165;&#x64CD;&#x4F5C;&#x7684;&#x5386;&#x53F2;&#x8868;&#x4E0A;&#x505A;&#x9891;&#x7E41;&#x7684;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;,&#x800C;&#x4E0D;&#x4F1A;&#x5E72;&#x6270;&#x5230;&#x6700;&#x65B0;&#x7684;&#x5F53;&#x524D;&#x8868;&#x4E0A;&#x7684;&#x63D2;&#x5165;&#x64CD;&#x4F5C;.</li>
</ul>
</li>
</ul>
</li>
<li><p>&#x53EA;&#x8BFB;&#x6216;&#x8005;&#x5927;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x4E0B;&#x53EA;&#x8BFB;&#x7684;&#x8868;</p>
</li>
<li><ul>
<li>&#x6709;&#x4E9B;&#x8868;&#x7684;&#x6570;&#x636E;&#x7528;&#x4E8E;&#x7F16;&#x5236;&#x7C7B;&#x76EE;&#x6216;&#x8005;&#x5206;&#x5217;&#x6E05;&#x5355;(&#x5982;&#x5DE5;&#x4F5C;&#x5C97;&#x4F4D;.&#x7ADE;&#x62CD;.&#x4E0D;&#x52A8;&#x4EA7;&#x7B49;),&#x8FD9;&#x79CD;&#x5E94;&#x7528;&#x573A;&#x666F;&#x662F;&#x5178;&#x578B;&#x7684;&#x8BFB;&#x591A;&#x5199;&#x5C11;&#x7684;&#x96E8;&#x96FE;. &#x5982;&#x679C;&#x4E0D;&#x4ECB;&#x610F;MyISAM&#x7684;&#x5D29;&#x6E83;&#x56DE;&#x590D;&#x95EE;&#x9898;,&#x9009;&#x7528;MyISAMy&#x5F15;&#x64CE;&#x662F;&#x5408;&#x9002;&#x7684;. &#x4E0D;&#x8FC7;&#x4E0D;&#x8981;&#x4F4E;&#x4F30;&#x5D29;&#x6E83;&#x6062;&#x590D;&#x95EE;&#x9898;&#x7684;&#x91CD;&#x8981;&#x6027;,&#x6709;&#x4E9B;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E0D;&#x4F1A;&#x4FDD;&#x8BC1;&#x5C06;&#x6570;&#x636E;&#x5B89;&#x5168;&#x5730;&#x5199;&#x5165;&#x5230;&#x78C1;&#x76D8;&#x4E2D;,&#x800C;&#x8BB8;&#x591A;&#x7528;&#x6237;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x4E0D;&#x6E05;&#x695A;&#x8FD9;&#x6837;&#x6709;&#x591A;&#x5927;&#x7684;&#x5C01;&#x5EFA;(MyISAM &#x53EA;&#x8BB2;&#x6570;&#x636E;&#x5199;&#x5230;&#x5185;&#x5B58;&#x4E2D;,&#x7136;&#x540E;&#x7B49;&#x5F85;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5B9A;&#x671F;&#x5C06;&#x6570;&#x636E;&#x5237;&#x51FA;&#x5230;&#x78C1;&#x76D8;&#x4E0A;).</li>
</ul>
</li>
<li><ul>
<li>&#x5F53;&#x8BBE;&#x8BA1;&#x4E0A;&#x8FF0;&#x7C7B;&#x578B;&#x7684;&#x5E94;&#x7528;&#x65F6;,&#x5EFA;&#x8BAE;&#x91C7;&#x7528;InnoDB.MyISAM&#x5F15;&#x64CE;&#x5728;&#x4E00;&#x5F00;&#x59CB;&#x53EF;&#x80FD;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x95EE;&#x9898;,&#x4F46;&#x968F;&#x7740;&#x5E94;&#x7528;&#x538B;&#x529B;&#x7684;&#x4E0A;&#x5347;,&#x5219;&#x53EF;&#x80FD;&#x8FC5;&#x901F;&#x6076;&#x5316;. &#x5404;&#x79CD;&#x9501;&#x4E89;&#x7528;.&#x5D29;&#x6E83;&#x540E;&#x7684;&#x6570;&#x636E;&#x4E22;&#x5931;&#x95EE;&#x9898;&#x90FD;&#x4F1A;&#x968F;&#x4E4B;&#x800C;&#x6765;.</li>
</ul>
</li>
<li><p>&#x8BA2;&#x5355;&#x5904;&#x7406;</p>
</li>
<li><ul>
<li>&#x5982;&#x679C;&#x6D89;&#x53CA;&#x8BA2;&#x5355;&#x5904;&#x7406;,&#x90A3;&#x4E48;&#x652F;&#x6301;&#x4E8B;&#x52A1;&#x5C31;&#x662F;&#x5FC5;&#x8981;&#x9009;&#x9879;. &#x534A;&#x5B8C;&#x6210;&#x7684;&#x8BA2;&#x5355;&#x662F;&#x65E0;&#x6CD5;&#x7528;&#x6765;&#x5438;&#x5F15;&#x7528;&#x6237;&#x7684;. &#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x8003;&#x8651;&#x70B9;&#x4E8B;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5BF9;&#x5916;&#x952E;&#x7684;&#x652F;&#x6301;&#x60C5;&#x51B5;. InnoDB&#x662F;&#x8BA2;&#x5355;&#x5904;&#x7406;&#x7C7B;&#x5E94;&#x7528;&#x7684;&#x6700;&#x4F73;&#x9009;&#x62E9;.</li>
</ul>
</li>
<li><p>&#x7535;&#x5B50;&#x516C;&#x544A;&#x724C;&#x548C;&#x4E3B;&#x9898;&#x8BA8;&#x8BBA;&#x8BBA;&#x575B;</p>
</li>
<li><ul>
<li>&#x5BF9;&#x4E8E;MySQL&#x7528;&#x6237;,&#x4E3B;&#x9898;&#x8BA8;&#x8BBA;&#x533A;&#x662F;&#x4E2A;&#x5F88;&#x6709;&#x610F;&#x601D;&#x7684;&#x8BDD;&#x9898;. &#x5F53;&#x524D;&#x6709;&#x6210;&#x767E;&#x4E0A;&#x5343;&#x7684;&#x57FA;&#x4E8E;PHP&#x6216;&#x8005;Perl&#x7684;&#x514D;&#x8D39;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x4E3B;&#x9898;&#x8BA8;&#x8BBA;.&#x5176;&#x4E2D;&#x5927;&#x90E8;&#x5206;&#x7684;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x6548;&#x7387;&#x90FD;&#x4E0D;&#x9AD8;,&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5927;&#x591A;&#x503E;&#x5411;&#x4E8E;&#x5728;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x4E2D;&#x6267;&#x884C;&#x5C3D;&#x53EF;&#x80FD;&#x591A;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;. &#x53E6;&#x5916;&#x8FD8;&#x6709;&#x90E8;&#x5206;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x4E3A;&#x4E0D;&#x91C7;&#x7528;&#x6570;&#x636E;&#x5E93;,&#x5F53;&#x7136;&#x5C31;&#x65E0;&#x6CD5;&#x963F;&#x91CC;&#x7528;&#x5230;&#x6570;&#x636E;&#x5E93;&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E9B;&#x65B9;&#x4FBF;&#x7684;&#x7279;&#x6027;. &#x4E3B;&#x9898;&#x8BA8;&#x8BBA;&#x7FA4;&#x533A;&#x4E00;&#x822C;&#x90FD;&#x6709;&#x66F4;&#x65B0;&#x6280;&#x672F;&#x5668;,&#x5E76;&#x4E14;&#x4F1A;&#x4E3A;&#x5404;&#x4E2A;&#x4E3B;&#x9898;&#x8BA1;&#x7B97;&#x8BBF;&#x95EE;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;. &#x591A;&#x5927;&#x80E1;&#x5F15;&#x7528;&#x53EA;&#x8BBE;&#x8BA1;&#x4E86;&#x51E0;&#x5F20;&#x8868;&#x6765;&#x4FDD;&#x5B58;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;,&#x6240;&#x4EE5;&#x6838;&#x5FC3;&#x8868;&#x7684;&#x8BFB;&#x5199;&#x538B;&#x529B;&#x53EF;&#x80FD;&#x975E;&#x5E38;&#x5927;. &#x4E3A;&#x4FDD;&#x8BC1;&#x8FD9;&#x4E9B;&#x6838;&#x5FC3;&#x8868;&#x7684;&#x6570;&#x636E;&#x4E00;&#x81F4;&#x6027;,&#x9501;&#x6210;&#x4E3A;&#x8D44;&#x6E90;&#x4E89;&#x7528;&#x7684;&#x4E3B;&#x8981;&#x56E0;&#x7D20;.</li>
</ul>
</li>
<li><ul>
<li>&#x5C3D;&#x7BA1;&#x6709;&#x8FD9;&#x4E9B;&#x8BBE;&#x8BA1;&#x7F3A;&#x9677;,&#x4F46;&#x5927;&#x591A;&#x6570;&#x5E94;&#x7528;&#x5728;&#x4E2D;&#x4F4E;&#x8D1F;&#x8F7D;&#x65F6;&#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;&#x5F97;&#x5F88;&#x597D;. &#x5982;&#x679C;web&#x7AD9;&#x70B9;&#x7684;&#x89C4;&#x6A21;&#x8FC5;&#x901F;&#x6269;&#x5C55;,&#x6D41;&#x91CF;&#x968F;&#x4E4B;&#x731B;&#x589E;,&#x5219;&#x6570;&#x636E;&#x5E93;&#x8BBF;&#x95EE;&#x53EF;&#x80FD;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x6162;. &#x6B64;&#x65F6;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x66F4;&#x6539;&#x4E3A;&#x652F;&#x6301;&#x66F4;&#x9AD8;&#x8BFB;&#x5199;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;,&#x4F46;&#x6709;&#x65F6;&#x7528;&#x6237;&#x4F1A;&#x53D1;&#x73B0;&#x8FD9;&#x4E48;&#x505A;&#x53CD;&#x800C;&#x5BFC;&#x81F4;&#x7CFB;&#x7EDF;&#x53D8;&#x5F97;&#x66F4;&#x6162;&#x4E86;. &#x7528;&#x6237;&#x53EF;&#x80FD;&#x6CA1;&#x6709;&#x610F;&#x8BC6;&#x5230;&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x67D0;&#x4E9B;&#x7279;&#x6B8A;&#x67E5;&#x8BE2;&#x7684;&#x7F18;&#x6545;,&#x5178;&#x578B;&#x7684;&#x5982;:</li>
</ul>
</li>
</ul>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(*) <span class="keyword">FROM</span> table;</span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li>&#x95EE;&#x9898;&#x5C31;&#x5728;&#x4E8E;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x8FD0;&#x884C;&#x4E0A;&#x8FF0;&#x67E5;&#x8BE2;&#x90FD;&#x975E;&#x5E38;&#x5FEB; : &#x5BF9;&#x4E8E;MyISAM&#x786E;&#x5B9E;&#x4F1A;&#x5F88;&#x5FEB;,&#x4F46;&#x5176;&#x4ED6;&#x7684;&#x53EF;&#x80FD;&#x90FD;&#x4E0D;&#x884C;. &#x6BCF;&#x79CD;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x90FD;&#x5AE9;&#x4E2A;&#x627E;&#x51FA;&#x7C7B;&#x4F3C;&#x7684;&#x5BF9;&#x81EA;&#x5DF1;&#x6709;&#x5229;&#x7684;&#x4F8B;&#x5B50;.</li>
</ul>
</li>
<li>CD-ROM&#x5E94;&#x7528;</li>
<li><ul>
<li>&#x5982;&#x679C;&#x53D1;&#x5E03;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;CD-ROM&#x6216;&#x8005;DVD-ROM&#x5E76;&#x4E14;&#x4F7F;&#x7528;MySQL&#x6570;&#x636E;&#x6587;&#x4EF6;&#x7684;&#x5E94;&#x7528;,&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x4F7F;&#x7528;MyISAM&#x8868;&#x6216;&#x8005;MyISAM&#x538B;&#x7F29;&#x8868;,&#x8FD9;&#x6837;&#x8868;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x9694;&#x79BB;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x540C;&#x4ECB;&#x8D28;&#x4E0A;&#x76F8;&#x4E92;&#x62F7;&#x8D1D;.MyISAM&#x538B;&#x7F29;&#x8868;&#x6BD4;&#x672A;&#x538B;&#x7F29;&#x7684;&#x8868;&#x8981;&#x8282;&#x7EA6;&#x5F88;&#x591A;&#x7A7A;&#x95F4;,&#x4F46;&#x538B;&#x7F29;&#x8868;&#x65F6;&#x53EA;&#x8BFB;&#x7684;. &#x5728;&#x67D0;&#x4E9B;&#x5E94;&#x7528;&#x4E2D;&#x8FD9;&#x53EF;&#x80FD;&#x662F;&#x4E2A;&#x5927;&#x95EE;&#x9898;. &#x4F46;&#x5982;&#x679C;&#x6570;&#x636E;&#x653E;&#x5230;&#x53EA;&#x8BFB;&#x4ECB;&#x8D28;&#x7684;&#x573A;&#x666F;&#x4E0B;,&#x538B;&#x7F29;&#x8868;&#x7684;&#x53EA;&#x8BFB;&#x7279;&#x6027;&#x5C31;&#x4E0D;&#x662F;&#x95EE;&#x9898;,&#x5C31;&#x6CA1;&#x6709;&#x7406;&#x7531;&#x4E0D;&#x91C7;&#x7528;&#x538B;&#x7F29;&#x8868;&#x4E86;.</li>
</ul>
</li>
<li>&#x5927;&#x6570;&#x636E;&#x91CF;</li>
<li><ul>
<li>&#x5982;&#x679C;&#x6570;&#x636E;&#x91CF;&#x589E;&#x957F;&#x5230;10TB&#x4EE5;&#x4E0A;&#x7EA7;&#x522B;,&#x53EF;&#x80FD;&#x5C31;&#x9700;&#x8981;&#x5EFA;&#x7ACB;&#x6570;&#x636E;&#x4ED3;&#x5E93;. Infobright&#x662F; MySQL&#x6570;&#x636E;&#x4ED3;&#x5E93;&#x6700;&#x6210;&#x529F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;.&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x5927;&#x6570;&#x636E;&#x5E93;&#x4E0D;&#x9002;&#x5408;Infobright,&#x5374;&#x53EF;&#x80FD;&#x9002;&#x5408;TokuDB.</li>
</ul>
</li>
</ul>
<h3 id="1-5-6-&#x8F6C;&#x6362;&#x8868;&#x7684;&#x5F15;&#x64CE;">1.5.6. 1.5.6 &#x8F6C;&#x6362;&#x8868;&#x7684;&#x5F15;&#x64CE;</h3><p><strong>ALTER TABLE</strong></p>
<blockquote>
<p>&#x5C06;&#x8868;&#x4ECE;&#x4E00;&#x4E2A;&#x5F15;&#x64CE;&#x4FEE;&#x6539;&#x4E3A;&#x53E6;&#x4E00;&#x4E2A;&#x5F15;&#x64CE;&#x6700;&#x7B80;&#x5355;&#x7684;&#x529E;&#x6CD5;&#x662F;&#x4F7F;&#x7528;ALTER TABLE&#x8BED;&#x53E5;.</p>
</blockquote>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">mysql&gt; ALTER <span class="keyword">TABLE</span> mytable <span class="comment">ENGINE = InnoDB</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x4E0A;&#x8FF0;&#x8BED;&#x6CD5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x5B58;&#x50A8;&#x5F15;&#x64CE;. &#x4F46;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;: &#x9700;&#x8981;&#x6267;&#x884C;&#x5F88;&#x957F;&#x65F6;&#x95F4;. MySQL&#x4F1A;&#x6309;&#x884C;&#x5C06;&#x6570;&#x636E;&#x4ECE;&#x539F;&#x8868;&#x590D;&#x5236;&#x5230;&#x4E00;&#x5F20;&#x65B0;&#x7684;&#x8868;&#x4E2D;, &#x5728;&#x590D;&#x5236;&#x671F;&#x95F4;&#x53EF;&#x80FD;&#x4F1A;&#x6D88;&#x8017;&#x7CFB;&#x7EDF;&#x6240;&#x6709;&#x7684;I/O&#x80FD;&#x529B;,&#x540C;&#x65F6;&#x539F;&#x8868;&#x4E0A;&#x4F1A;&#x52A0;&#x4E0A;&#x8BFB;&#x9501;. &#x6240;&#x4EE5;,&#x5728;&#x7E41;&#x5FD9;&#x7684;&#x8868;&#x4E0A;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#x8981;&#x7279;&#x522B;&#x5C0F;&#x5FC3;. &#x4E00;&#x4E2A;&#x66FF;&#x4EE3;&#x65B9;&#x6848;&#x662F;&#x91C7;&#x7528;&#x5BFC;&#x51FA;&#x5BFC;&#x5165;&#x7684;&#x65B9;&#x6CD5;,&#x624B;&#x5DE5;&#x8FDB;&#x884C;&#x8868;&#x7684;&#x590D;&#x5236;. </li>
<li><blockquote>
<p>&#x5982;&#x679C;&#x8F6C;&#x6362;&#x8868;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;,&#x5C06;&#x4F1A;&#x5931;&#x53BB;&#x548C;&#x539F;&#x5F15;&#x64CE;&#x76F8;&#x5173;&#x7684;&#x6240;&#x6709;&#x7279;&#x6027;. &#x4F8B;&#x5982;,&#x5982;&#x679C;&#x5C06;&#x4E00;&#x5F20;InnoDB&#x8868;&#x88C5;&#x6362;&#x4E3A;MyISAM,&#x7136;&#x540E;&#x518D;&#x8F6C;&#x6362;&#x56DE;InnoDB,&#x539F;InnoDB&#x8868;&#x4E0A;&#x6240;&#x6709;&#x7684;&#x5916;&#x952E;&#x5C06;&#x4E22;&#x5931;.</p>
</blockquote>
</li>
</ul>
<p><strong>&#x5BFC;&#x51FA;&#x4E0E;&#x5BFC;&#x5165;</strong></p>
<blockquote>
<p>&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x5730;&#x63A7;&#x5236;&#x8F6C;&#x6362;&#x7684;&#x8FC7;&#x7A0B;,&#x53EF;&#x4EE5;&#x4F7F;&#x7528;mysqldump&#x5DE5;&#x5177;&#x5C06;&#x6570;&#x636E;&#x5BFC;&#x51FA;&#x5230;&#x6587;&#x4EF6;,&#x7136;&#x540E;&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x4E2D;CREATE TABLE&#x8BED;&#x53E5;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x9009;&#x9879;,&#x6CE8;&#x610F;&#x540C;&#x65F6;&#x4FEE;&#x6539;&#x8868;&#x660E;,&#x56E0;&#x4E3A;&#x540C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x4E0D;&#x80FD;&#x5B58;&#x5728;&#x76F8;&#x540C;&#x7684;&#x8868;&#x660E;,&#x5373;&#x4F7F;&#x5B83;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;. &#x540C;&#x65F6;&#x54DF;&#x554A;&#x6CE8;&#x610F;mysqldump&#x9ED8;&#x8BA4;&#x4F1A;&#x81EA;&#x52A8;&#x5728;CREATE TABLE &#x8BED;&#x53E5;&#x524D;&#x52A0;&#x4E0A;DROP TABLE&#x8BED;&#x53E5;,&#x4E0D;&#x4F4F;&#x4E0E;&#x8FD9;&#x4E00;&#x70B9;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x6570;&#x636E;&#x4E22;&#x5931;.</p>
</blockquote>
<p><strong>&#x521B;&#x5EFA;&#x4E0E;&#x67E5;&#x8BE2;(CREATE&#x548C;SELECT)</strong></p>
<blockquote>
<p>&#x6B64;&#x65B9;&#x6CD5;&#x7EFC;&#x5408;&#x4E86;&#x7B2C;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x9AD8;&#x6548;&#x548C;&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x5B89;&#x5168;.&#x4E0D;&#x9700;&#x8981;&#x5BFC;&#x51FA;&#x6574;&#x4E2A;&#x8868;&#x7684;&#x6570;&#x636E;,&#x800C;&#x662F;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684;&#x8868;,&#x7136;&#x540E;&#x5229;&#x7528;INSERT&#x2026;SELECT &#x8BED;&#x6CD5;&#x6765;&#x5BFC;&#x6570;&#x636E;: </p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> innodb_table <span class="keyword">LIKE</span> myisam_table;</span><br><span class="line">mysql&gt; <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> innodb_table ENGINE=InnoDB;</span><br><span class="line">mysql&gt; <span class="keyword">INSERT</span> <span class="keyword">INTO</span> innodb_table <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myisam_table;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x6570;&#x636E;&#x91CF;&#x4E0D;&#x5927;&#x7684;&#x8BDD;,&#x8FD9;&#x6837;&#x505A;&#x5DE5;&#x4F5C;&#x5F88;&#x597D;. &#x5982;&#x679C;&#x6570;&#x636E;&#x91CF;&#x5F88;&#x5927;,&#x5219;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x5206;&#x6279;&#x5904;&#x7406;, &#x9488;&#x5BF9;&#x6BCF;&#x4E00;&#x6BB5;&#x6570;&#x636E;&#x6267;&#x884C;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x64CD;&#x4F5C;, &#x4EE5;&#x907F;&#x514D;&#x5927;&#x4E8B;&#x52A1;&#x4EA7;&#x751F;&#x8FC7;&#x591A;&#x7684;undo. &#x5047;&#x8BBE;&#x6709;&#x4E3B;&#x89C1;&#x5B57;&#x6BB5;id, &#x91CD;&#x590D;&#x8FD0;&#x884C;&#x4E00;&#x4E0B;&#x8BED;&#x53E5;(&#x6700;&#x5C0F;&#x503C;x&#x548C;&#x6700;&#x5927;&#x503C;y&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x66FF;&#x6362;)&#x5C06;&#x6570;&#x636E;&#x5BFC;&#x5165;&#x5230;&#x65B0;&#x8868;:</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line">mysql&gt; <span class="keyword">INSERT</span> <span class="keyword">INTO</span> innodb_table <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myisam_table </span><br><span class="line">     &gt; <span class="keyword">WHERE</span> id <span class="keyword">BETWEEN</span> x <span class="keyword">And</span> y;</span><br><span class="line">mysql&gt; <span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x8FD9;&#x6837;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x4EE5;&#x540E;,&#x65B0;&#x8868;&#x662F;&#x539F;&#x8868;&#x7684;&#x4E00;&#x4E2A;&#x5168;&#x91CF;&#x590D;&#x5236;,&#x539F;&#x8868;&#x8FD8;&#x5728;,&#x5982;&#x679C;&#x9700;&#x8981;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#x539F;&#x8868;. &#x5982;&#x679C;&#x6709;&#x5FC5;&#x8981;,&#x53EF;&#x4EE5;&#x5728;&#x6267;&#x884C;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x5BF9;&#x539F;&#x8868;&#x52A0;&#x9501;,&#x4EE5;&#x786E;&#x4FDD;&#x65B0;&#x8868;&#x548C;&#x539F;&#x8868;&#x7684;&#x6570;&#x636E;&#x4E00;&#x81F4;.</p>
<blockquote>
<p>Percona Toolkit&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;pt_online_schema_change&#x7684;&#x5DE5;&#x5177;(&#x57FA;&#x4E8E;Facebook&#x7684;&#x5728;&#x7EBF;schema&#x53D8;&#x66F4;&#x6280;&#x672F;),&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;.&#x65B9;&#x4FBF;&#x5730;&#x6267;&#x884C;&#x4E0A;&#x8FF0;&#x8FC7;&#x7A0B;,&#x907F;&#x514D;&#x624B;&#x5DE5;&#x64CD;&#x4F5C;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x7684;&#x5931;&#x8BEF;&#x548C;&#x7E41;&#x7410;.</p>
</blockquote>
</blockquote>
<h1 id="&#x7B2C;&#x4E8C;&#x7AE0;-MySQL&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;">2. &#x7B2C;&#x4E8C;&#x7AE0; MySQL&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;</h1><blockquote>
<p>&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;(benchmark)&#x662F;MySQL&#x65B0;&#x624B;&#x548C;&#x4E13;&#x5BB6;&#x90FD;&#x9700;&#x8981;&#x638C;&#x63E1;&#x7684;&#x4E00;&#x9879;&#x57FA;&#x672C;&#x6280;&#x80FD;. &#x7B80;&#x5355;&#x5730;&#x8BF4;,&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x662F;&#x9488;&#x5BF9;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x7684;&#x4E00;&#x79CD;&#x538B;&#x529B;&#x6D4B;&#x8BD5;. &#x901A;&#x5E38;&#x7684;&#x76EE;&#x6807;&#x662F;&#x4E3A;&#x4E86;&#x638C;&#x63E1;&#x7CFB;&#x7EDF;&#x7684;&#x884C;&#x4E3A;. &#x4F46;&#x4E5F;&#x6709;&#x5176;&#x4ED6;&#x539F;&#x56E0;,&#x5982;&#x91CD;&#x73B0;&#x67D0;&#x4E2A;&#x7CFB;&#x7EDF;&#x72B6;&#x6001;,&#x6216;&#x8005;&#x662F;&#x505A;&#x65B0;&#x786C;&#x4EF6;&#x7684;&#x53EF;&#x9760;&#x6027;&#x6D4B;&#x8BD5;.</p>
</blockquote>
<h1 id="&#x7B2C;&#x4E09;&#x7AE0;-&#x670D;&#x52A1;&#x5668;&#x6027;&#x80FD;&#x5256;&#x6790;">3. &#x7B2C;&#x4E09;&#x7AE0; &#x670D;&#x52A1;&#x5668;&#x6027;&#x80FD;&#x5256;&#x6790;</h1><h2 id="3-1-&#x6027;&#x80FD;&#x4F18;&#x5316;&#x7B80;&#x4ECB;">3.1. 3.1 &#x6027;&#x80FD;&#x4F18;&#x5316;&#x7B80;&#x4ECB;</h2><p>*<em>&#x6027;&#x80FD;: *</em></p>
<ul>
<li>&#x4E3A;&#x5B8C;&#x6210;&#x67D0;&#x4EF6;&#x4EFB;&#x52A1;&#x6240;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#x5EA6;&#x91CF;,&#x6362;&#x53E5;&#x8BDD;&#x8BF4;,&#x6027;&#x80FD;&#x5373;&#x76F8;&#x5E94;&#x65F6;&#x95F4;. </li>
<li>&#x6570;&#x636E;&#x5E93;&#x7684;&#x6027;&#x80FD;&#x7528;&#x67E5;&#x8BE2;&#x7684;&#x76F8;&#x5E94;&#x65F6;&#x95F4;&#x6765;&#x5EA6;&#x91CF;,&#x5355;&#x4F4D;&#x662F;&#x6BCF;&#x4E2A;&#x67E5;&#x8BE2;&#x82B1;&#x8D39;&#x7684;&#x65F6;&#x95F4;.</li>
<li><ul>
<li>&#x67E5;&#x8BE2;&#x7684;&#x76F8;&#x5E94;&#x65F6;&#x95F4;&#x66F4;&#x80FD;&#x4F53;&#x73B0;&#x6570;&#x636E;&#x5E93;&#x7248;&#x672C;&#x5347;&#x7EA7;&#x540E;&#x7684;&#x6027;&#x80FD;&#x662F;&#x4E0D;&#x662F;&#x53D8;&#x5F97;&#x66F4;&#x597D;.</li>
</ul>
</li>
<li>&#x5982;&#x679C;&#x628A;&#x6027;&#x80FD;&#x4EC5;&#x4EC5;&#x770B;&#x6210;&#x662F;&#x63D0;&#x5347;&#x6BCF;&#x79D2;&#x67E5;&#x8BE2;&#x91CF;,&#x8FD9;&#x5176;&#x5B9E;&#x53EA;&#x662F;&#x541E;&#x5410;&#x91CF;&#x4F18;&#x5316;.&#x541E;&#x5410;&#x91CF;&#x7684;&#x63D0;&#x5347;&#x53EF;&#x4EE5;&#x770B;&#x505A;&#x6027;&#x80FD;&#x4F18;&#x5316;&#x7684;&#x526F;&#x4EA7;&#x54C1;.</li>
<li>&#x6D4B;&#x91CF;&#x6027;&#x80FD;&#x66F4;&#x9700;&#x8981;&#x5408;&#x9002;&#x7684;&#x6D4B;&#x91CF;&#x8303;&#x56F4;. &#x6709;&#x4E24;&#x79CD;&#x6BD4;&#x8F83;&#x5E38;&#x89C1;&#x7684;&#x60C5;&#x51B5;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0D;&#x9002;&#x5408;&#x7684;&#x6D4B;&#x91CF;:</li>
<li><ul>
<li>&#x5728;&#x9519;&#x8BEF;&#x7684;&#x65F6;&#x95F4;&#x542F;&#x52A8;&#x548C;&#x505C;&#x6B62;&#x6D4B;&#x91CF;.</li>
</ul>
</li>
<li><ul>
<li>&#x6D4B;&#x91CF;&#x7684;&#x662F;&#x805A;&#x5408;&#x540E;&#x7684;&#x4FE1;&#x606F;,&#x800C;&#x4E0D;&#x662F;&#x76EE;&#x6807;&#x6D3B;&#x52A8;&#x672C;&#x8EAB;.</li>
</ul>
</li>
</ul>
<h3 id="3-1-1-&#x901A;&#x8FC7;&#x6027;&#x80FD;&#x5256;&#x6790;&#x8FDB;&#x884C;&#x4F18;&#x5316;">3.1.1. 3.1.1 &#x901A;&#x8FC7;&#x6027;&#x80FD;&#x5256;&#x6790;&#x8FDB;&#x884C;&#x4F18;&#x5316;</h3><blockquote>
<p>&#x6027;&#x80FD;&#x5256;&#x6790;&#x662F;&#x6D4B;&#x91CF;&#x548C;&#x5206;&#x6790;&#x65F6;&#x95F4;&#x82B1;&#x8D39;&#x5728;&#x54EA;&#x91CC;&#x7684;&#x4E3B;&#x8981;&#x65B9;&#x6CD5;.&#x6027;&#x80FD;&#x5256;&#x6790;&#x4E00;&#x822C;&#x6709;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;:&#x6D4B;&#x91CF;&#x4EFB;&#x52A1;&#x6240;&#x82B1;&#x8D39;&#x7684;&#x65F6;&#x95F4;,&#x7136;&#x540E;&#x5BF9;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x7EDF;&#x8BA1;&#x548C;&#x6392;&#x5E8F;,&#x5C06;&#x91CD;&#x8981;&#x7684;&#x4EFB;&#x52A1;&#x6392;&#x5230;&#x524D;&#x9762;.</p>
</blockquote>
<h3 id="3-1-2-&#x7406;&#x89E3;&#x6027;&#x80FD;&#x5256;&#x6790;">3.1.2. 3.1.2 &#x7406;&#x89E3;&#x6027;&#x80FD;&#x5256;&#x6790;</h3><ul>
<li>&#x503C;&#x5F97;&#x4F18;&#x5316;&#x7684;&#x67E5;&#x8BE2;</li>
<li><ul>
<li>&#x4E00;&#x4E9B;&#x53EA;&#x5360;&#x603B;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x6BD4;&#x91CD;&#x5F88;&#x5C0F;&#x7684;&#x67E5;&#x8BE2;&#x662F;&#x4E0D;&#x503C;&#x5F97;&#x4F18;&#x5316;&#x7684;.</li>
</ul>
</li>
<li><ul>
<li>&#x5982;&#x679C;&#x82B1;&#x8D39;&#x4E86;1000$&#x53BB;&#x4F18;&#x5316;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;,&#x4F46;&#x4E1A;&#x52A1;&#x7684;&#x6536;&#x5165;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x589E;&#x52A0;,&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x8BF4;&#x53CD;&#x800C;&#x5BFC;&#x81F4;&#x4E1A;&#x52A1;&#x88AB;&#x9006;&#x5316;&#x4E86;1000$. &#x5982;&#x679C;&#x4F18;&#x5316;&#x6210;&#x672C;&#x5927;&#x4E8E;&#x6536;&#x76CA;,&#x5C31;&#x5E94;&#x5F53;&#x505C;&#x6B62;&#x4F18;&#x5316;.</li>
</ul>
</li>
<li>&#x5F02;&#x5E38;&#x60C5;&#x51B5;</li>
<li><ul>
<li>&#x67D0;&#x4E9B;&#x4EFB;&#x52A1;&#x5373;&#x4F7F;&#x6CA1;&#x6709;&#x51FA;&#x73B0;&#x5728;&#x6027;&#x80FD;&#x5256;&#x6790;&#x8F93;&#x51FA;&#x7684;&#x524D;&#x9762;&#x4E5F;&#x9700;&#x8981;&#x4F18;&#x5316;.&#x6BD4;&#x5982;&#x67D0;&#x4E9B;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x6B21;&#x6570;&#x5F88;&#x5C11;,&#x4F46;&#x6BCF;&#x6B21;&#x6267;&#x884C;&#x90FD;&#x975E;&#x5E38;&#x6162;,&#x4E25;&#x91CD;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x4F53;&#x9A8C;.&#x56E0;&#x4E3A;&#x5176;&#x6267;&#x884C;&#x9891;&#x7387;&#x4F4E;,&#x6240;&#x4EE5;&#x603B;&#x7684;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x5360;&#x6BD4;&#x5E76;&#x4E0D;&#x51B2;&#x7A81;</li>
</ul>
</li>
<li>&#x672A;&#x77E5;&#x7684;&#x672A;&#x77E5;</li>
<li><ul>
<li>&#x4E00;&#x6B3E;&#x597D;&#x7684;&#x6027;&#x80FD;&#x5256;&#x6790;&#x5DE5;&#x5177;&#x4F1A;&#x663E;&#x793A;&#x53EF;&#x80FD;&#x7684;&#x201D;&#x4E22;&#x5931;&#x7684;&#x65F6;&#x95F4;&#x201D;. &#x4E22;&#x5931;&#x7684;&#x65F6;&#x95F4;&#x6307;&#x7684;&#x662F;&#x4EFB;&#x52A1;&#x7684;&#x603B;&#x65F6;&#x95F4;&#x548C;&#x5B9E;&#x9645;&#x6D4B;&#x91CF;&#x5230;&#x7684;&#x65F6;&#x95F4;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;. &#x4F8B;&#x5982;,&#x5982;&#x679C;&#x5904;&#x7406;&#x5668;&#x7684;CPU&#x65F6;&#x95F4;&#x662F;10&#x79D2;,&#x800C;&#x5256;&#x6790;&#x5230;&#x7684;&#x4EFB;&#x52A1;&#x603B;&#x65F6;&#x95F4;&#x662F;9.7&#x79D2;,&#x90A3;&#x4E48;&#x5C31;&#x6709;300&#x597D;&#x7720;&#x7684;&#x4E22;&#x5931;&#x65F6;&#x95F4;.&#x8FD9;&#x53EF;&#x80FD;&#x662F;&#x6709;&#x4E9B;&#x4EFB;&#x52A1;&#x6CA1;&#x6709;&#x6D4B;&#x91CF;&#x5230;,&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x4E8E;&#x6D4B;&#x91CF;&#x7684;&#x8BEF;&#x5DEE;&#x548C;&#x7CBE;&#x786E;&#x5EA6;&#x95EE;&#x9898;&#x7684;&#x7F18;&#x6545;.&#x5982;&#x679C;&#x5DE5;&#x5177;&#x53D1;&#x73B0;&#x4E86;&#x8FD9;&#x7C7B;&#x95EE;&#x9898;,&#x5219;&#x8981;&#x5F15;&#x8D77;&#x91CD;&#x89C6;,&#x56E0;&#x4E3A;&#x6709;&#x53EF;&#x80FD;&#x9519;&#x8FC7;&#x4E86;&#x67D0;&#x4E9B;&#x91CD;&#x8981;&#x7684;&#x4E8B;&#x60C5;. &#x5373;&#x4F7F;&#x6027;&#x80FD;&#x5256;&#x6790;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x4E22;&#x5931;&#x65F6;&#x95F4;,&#x4E5F;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x8003;&#x8651;&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#x5B58;&#x5728;&#x7684;&#x53EF;&#x80FD;&#x6027;,&#x8FD9;&#x6837;&#x624D;&#x4E0D;&#x4F1A;&#x9519;&#x8FC7;&#x91CD;&#x8981;&#x7684;&#x4FE1;&#x606F;.</li>
</ul>
</li>
<li>&#x88AB;&#x63A9;&#x85CF;&#x7684;&#x7EC6;&#x8282;</li>
<li><ul>
<li>&#x6027;&#x80FD;&#x5256;&#x6790;&#x65E0;&#x6CD5;&#x663E;&#x793A;&#x6240;&#x6709;&#x76F8;&#x5E94;&#x65F6;&#x95F4;&#x7684;&#x5206;&#x5E03;.&#x53EA;&#x76F8;&#x4FE1;&#x5E73;&#x5747;&#x503C;&#x662F;&#x975E;&#x5E38;&#x5371;&#x9669;&#x7684;,&#x5B83;&#x4F1A;&#x9690;&#x85CF;&#x5F88;&#x591A;&#x4FE1;&#x606F;,&#x800C;&#x4E14;&#x65E0;&#x6CD5;&#x8868;&#x8FBE;&#x5168;&#x90E8;&#x60C5;&#x51B5;.</li>
</ul>
</li>
</ul>
<h1 id="&#x7B2C;&#x56DB;&#x7AE0;-Schema&#x4E0E;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4F18;&#x5316;">4. &#x7B2C;&#x56DB;&#x7AE0; Schema&#x4E0E;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4F18;&#x5316;</h1><h2 id="4-1-&#x9009;&#x62E9;&#x4F18;&#x5316;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;">4.1. 4.1 &#x9009;&#x62E9;&#x4F18;&#x5316;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;</h2><ul>
<li><strong>&#x66F4;&#x5C0F;&#x7684;&#x901A;&#x5E38;&#x66F4;&#x597D;</strong></li>
<li><ul>
<li>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;,&#x5E94;&#x8BE5;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x53EF;&#x4EE5;&#x6B63;&#x786E;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;&#x6700;&#x5C0F;&#x6570;&#x636E;&#x7C7B;&#x578B;. &#x66F4;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5E38;&#x66F4;&#x5FEB;,&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5360;&#x7528;&#x66F4;&#x5C11;&#x7684;&#x78C1;&#x76D8;.&#x5185;&#x5B58;&#x548C;CPU&#x7F13;&#x5B58;,&#x5E76;&#x4E14;&#x5904;&#x7406;&#x65F6;&#x9700;&#x8981;&#x7684;CPU&#x5468;&#x671F;&#x4E5F;&#x66F4;&#x5C11;.</li>
</ul>
</li>
<li><ul>
<li>&#x4F46;&#x662F;&#x8981;&#x786E;&#x4FDD;&#x6CA1;&#x6709;&#x4F4E;&#x4F30;&#x9700;&#x8981;&#x5B58;&#x50A8;&#x7684;&#x503C;&#x7684;&#x8303;&#x56F4;.&#x56E0;&#x4E3A;&#x5728;schema&#x4E2D;&#x7684;&#x591A;&#x4E2A;&#x5730;&#x65B9;&#x589E;&#x52A0;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x8303;&#x56F4;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x8017;&#x65F6;&#x548C;&#x75DB;&#x82E6;&#x7684;&#x64CD;&#x4F5C;.</li>
</ul>
</li>
<li><strong>&#x7B80;&#x5355;&#x5C31;&#x597D;</strong></li>
<li><ul>
<li>&#x7B80;&#x5355;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x64CD;&#x4F5C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x66F4;&#x5C11;&#x7684;CPU&#x5468;&#x671F;. &#x4F8B;&#x5982;, &#x6574;&#x5F62;&#x6BD4;&#x5B57;&#x7B26;&#x64CD;&#x4F5C;&#x4EE3;&#x4EF7;&#x66F4;&#x4F4E;,&#x56E0;&#x4E3A;&#x5B57;&#x7B26;&#x96C6;&#x548C;&#x6821;&#x5BF9;&#x67DC;&#x5B50;(&#x6392;&#x5E8F;&#x89C4;&#x5219;)&#x4F7F;&#x5B57;&#x7B26;&#x6BD4;&#x8F83;&#x6BD4;&#x6574;&#x5F62;&#x6BD4;&#x8F83;&#x66F4;&#x52A0;&#x590D;&#x6742;.&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;:</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>&#x5E94;&#x8BE5;&#x4F7F;&#x7528;MySQL&#x5185;&#x5EFA;&#x7684;&#x7C7B;&#x578B;&#x800C;&#x4E0D;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x6765;&#x5B58;&#x50A8;&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;.</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>&#x5E94;&#x8BE5;&#x7528;&#x6574;&#x5F62;&#x5B58;&#x50A8;IP&#x5730;&#x5740;.</li>
</ul>
</li>
</ul>
</li>
<li>&#x5C3D;&#x91CF;&#x907F;&#x514D;NULL</li>
<li><ul>
<li>&#x5F88;&#x591A;&#x8868;&#x90FD;&#x5305;&#x542B;&#x53EF;&#x8C13;NULL&#x7684;&#x5217;,&#x5373;&#x4F7F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x4FDD;&#x5B58;NULL&#x4E5F;&#x662F;&#x5982;&#x6B64;,&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x53EF;&#x8C13;NULL&#x662F;&#x5217;&#x7684;&#x9ED8;&#x8BA4;&#x5C5E;&#x6027;. &#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x6700;&#x597D;&#x6307;&#x5B9A;&#x5217;&#x4E3A;NOT NULL,&#x9664;&#x975E;&#x771F;&#x7684;&#x9700;&#x8981;&#x5B58;&#x50A8;NULL&#x503C;.</li>
</ul>
</li>
<li><ul>
<li>&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x4E2D;&#x5305;&#x542B;&#x53EF;&#x8C13;NULL&#x7684;&#x5217;,&#x5BF9;MySQL&#x6765;&#x8BF4;&#x66F4;&#x96BE;&#x4F18;&#x5316;,&#x56E0;&#x4E3A;&#x53EF;&#x4E3A;NULL&#x7684;&#x5217;&#x4F7F;&#x5F97;&#x7D22;&#x5F15;.&#x7D22;&#x5F15;&#x7EDF;&#x8BA1;&#x548C;&#x503C;&#x6BD4;&#x8F83;&#x90FD;&#x66F4;&#x590D;&#x6742;.&#x53EF;&#x4E3A;NULL&#x7684;&#x5217;&#x4F1A;&#x4F7F;&#x7528;&#x66F4;&#x591A;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;,&#x5728;MySQL&#x91CC;&#x4E5F;&#x9700;&#x8981;&#x7279;&#x6B8A;&#x5904;&#x7406;. &#x5F53;&#x53EF;&#x4E3A;NULL&#x7684;&#x5217;&#x88AB;&#x7D22;&#x5F15;&#x65F6;,&#x6BCF;&#x4E2A;&#x7D22;&#x5F15;&#x8BB0;&#x5F55;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x5B57;&#x8282;,&#x5728;MyISAM&#x91CC;&#x751A;&#x81F3;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x7D22;&#x5F15;(&#x4F8B;&#x5982;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x5217;&#x7684;&#x7D22;&#x5F15;)&#x7F16;&#x7A0B;&#x53EF;&#x53D8;&#x5927;&#x5C0F;&#x7684;&#x7D22;&#x5F15;.</li>
</ul>
</li>
<li><ul>
<li>&#x901A;&#x5E38;&#x628A;&#x53EF;&#x4E3A;NULL&#x7684;&#x5217;&#x6539;&#x4E3A;NOT NULL&#x5E26;&#x6765;&#x7684;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x6BD4;&#x8F83;&#x5C0F;,&#x6240;&#x4EE5;(&#x8C03;&#x4F18;&#x65F6;)&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x9996;&#x5148;&#x5728;&#x73B0;&#x6709;schema&#x4E2D;&#x67E5;&#x627E;&#x5E76;&#x4FEE;&#x6539;&#x6389;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;,&#x9664;&#x975E;&#x786E;&#x5B9A;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x95EE;&#x9898;.&#x4F46;&#x662F;,&#x5982;&#x679C;&#x8BA1;&#x5212;&#x5728;&#x5217;&#x4E0A;&#x5EFA;&#x7D22;&#x5F15;,&#x5C31;&#x5E94;&#x8BE5;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x8BBE;&#x8BA1;&#x6210;&#x53EF;&#x4E3A;NULL&#x7684;&#x5217;.</li>
</ul>
</li>
<li>-&#x5F53;&#x7136;&#x4E5F;&#x6709;&#x4F8B;&#x5916;,&#x4F8B;&#x5982;InnoDB&#x4F7F;&#x7528;&#x5355;&#x72EC;&#x7684;&#x4E3A;(bit)&#x5B58;&#x50A8;NULL&#x503C;,&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x7A00;&#x758F;&#x6570;&#x636E;&#x6709;&#x5F88;&#x597D;&#x7684;&#x7A7A;&#x95F4;&#x6548;&#x7387;.&#x4F46;&#x8FD9;&#x4E00;&#x70B9;&#x4E0D;&#x662F;&#x54DF;&#x7528;&#x4E8E;MyISAM.</li>
<li><ul>
<li><ul>
<li>&#x7A00;&#x758F;&#x6570;&#x636E;: &#x5F88;&#x591A;&#x503C;&#x4E3A;NULL,&#x53EA;&#x6709;&#x5C11;&#x6570;&#x884C;&#x7684;&#x5217;&#x6709;&#x975E;NULL&#x503C;.</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>DATETIME&#x548C;TIMESAMP&#x5217;&#x90FD;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x76F8;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;:&#x65F6;&#x95F4;&#x548C;&#x65E5;&#x671F;,&#x7CBE;&#x786E;&#x5230;&#x79D2;. &#x7136;&#x800C;TIMESTAMP&#x53EA;&#x4F7F;&#x7528;DATETIME&#x4E00;&#x534A;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;,&#x5E76;&#x4E14;&#x4F1A;&#x6839;&#x636E;&#x65F6;&#x533A;&#x53D8;&#x5316;,&#x5177;&#x6709;&#x7279;&#x6B8A;&#x7684;&#x81EA;&#x52A8;&#x66F4;&#x65B0;&#x80FD;&#x529B;.&#x53E6;&#x4E00;&#x65B9;&#x9762;,TIMESTAMP&#x5141;&#x8BB8;&#x7684;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#x8981;&#x5C0F;&#x5F97;&#x591A;,&#x6709;&#x65F6;&#x5019;&#x5B83;&#x7684;&#x7279;&#x6B8A;&#x80FD;&#x529B;&#x4F1A;&#x6210;&#x4E3A;&#x969C;&#x788D;.</p>
</blockquote>
<h3 id="4-1-1-&#x6574;&#x6570;&#x7C7B;&#x578B;">4.1.1. 4.1.1 &#x6574;&#x6570;&#x7C7B;&#x578B;</h3><blockquote>
<p>&#x6709;&#x4E24;&#x79CD;&#x70C8;&#x6027;&#x7684;&#x6570;&#x5B57;: &#x6574;&#x6570;(whole number)&#x548C;&#x5B9E;&#x6570;(real number). &#x5982;&#x679C;&#x5B58;&#x50A8;&#x6574;&#x6570;,&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x51E0;&#x79CD;&#x6574;&#x6570;&#x7C7B;&#x578B;: tinyint, smallint, mediumint, int, bigint. &#x5206;&#x522B;&#x4F7F;&#x7528;8,16,24,32,64&#x4F4D;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;. &#x4ED6;&#x4EEC;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x7684;&#x503C;&#x7684;&#x8303;&#x56F4;&#x4ECE;-2(n-1)&#x5230;2(n-1),&#x5176;&#x4E2D;n&#x662F;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x7684;&#x4F4D;&#x6570;.</p>
</blockquote>
<ul>
<li>&#x6574;&#x6570;&#x7C7B;&#x578B;&#x6709;&#x53EF;&#x9009;&#x7684;UNSIGNED&#x5C5E;&#x6027;,&#x8868;&#x793A;&#x4E0D;&#x5141;&#x8BB8;&#x8D1F;&#x503C;,&#x8FD9;&#x5927;&#x81F4;&#x53EF;&#x4EE5;&#x4F7F;&#x6B63;&#x6570;&#x7684;&#x4E0A;&#x7EBF;&#x63D0;&#x9AD8;&#x4E00;&#x500D;.&#x4F8B;&#x5982; TINYINT.UNSIGNED &#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x7684;&#x8303;&#x56F4;&#x662F;0<del>255,&#x800C;TINYINT&#x7684;&#x5B58;&#x50A8;&#x8303;&#x56F4;&#x662F;-128</del>127.</li>
<li>&#x6709;&#x7B26;&#x53F7;&#x548C;&#x65E0;&#x7B26;&#x53F7;&#x7C7B;&#x578B;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;,&#x5E76;&#x5177;&#x6709;&#x76F8;&#x540C;&#x7684;&#x6027;&#x80FD;,&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x7C7B;&#x578B;.</li>
<li>&#x7C7B;&#x578B;&#x7684;&#x9009;&#x62E9;&#x662F;&#x51B3;&#x5B9A;MySQL&#x662F;&#x600E;&#x4E48;&#x5728;&#x5185;&#x5B58;&#x548C;&#x78C1;&#x76D8;&#x4E2D;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x7684;. &#x7136;&#x800C;,&#x6574;&#x6570;&#x8BA1;&#x7B97;&#x4E00;&#x822C;&#x4F7F;&#x7528;64&#x4F4D;&#x7684;BIGINT&#x6574;&#x6570;,&#x5373;&#x4F7F;&#x5728;32&#x4F4D;&#x73AF;&#x5883;&#x4E5F;&#x662F;&#x5982;&#x6B64;.(&#x4E00;&#x4E9B;&#x805A;&#x5408;&#x51FD;&#x6570;&#x662F;&#x4F8B;&#x5916;,&#x5B83;&#x4EEC;&#x4F7F;&#x7528;DECIMAL&#x6216;DOUBLE&#x8FDB;&#x884C;&#x8BA1;&#x7B97;).</li>
<li>MySQL&#x53EF;&#x4EE5;&#x4E3A;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x6307;&#x5B9A;&#x5BBD;&#x5EA6;,&#x4F8B;&#x5982;INT(11).&#x5BF9;&#x5927;&#x591A;&#x6570;&#x5E94;&#x7528;&#x8FD9;&#x662F;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x7684;: &#x4ED6;&#x4E0D;&#x4F1A;&#x9650;&#x5236;&#x503C;&#x7684;&#x5408;&#x6CD5;&#x8303;&#x56F4;,&#x53EA;&#x662F;&#x89C4;&#x5B9A;MySQL&#x7684;&#x4E00;&#x4E9B;&#x4EA4;&#x4E92;&#x5DE5;&#x5177;(&#x4F8B;&#x5982;MySQL&#x547D;&#x4EE4;&#x884C;&#x5BA2;&#x6237;&#x7AEF;)&#x7528;&#x6765;&#x663E;&#x793A;&#x5B57;&#x7B26;&#x7684;&#x4E2A;&#x6570;. &#x5BF9;&#x4E8E;&#x5B58;&#x50A8;&#x548C;&#x8BA1;&#x7B97;&#x6765;&#x8BF4;,INT(1)&#x548C;INT(20)&#x662F;&#x76F8;&#x540C;&#x7684;.</li>
</ul>
<h3 id="4-1-2-&#x5B9E;&#x6570;&#x7C7B;&#x578B;">4.1.2. 4.1.2 &#x5B9E;&#x6570;&#x7C7B;&#x578B;</h3><blockquote>
<p>&#x5B9E;&#x6570;&#x662F;&#x5E26;&#x6709;&#x5C0F;&#x6570;&#x90E8;&#x5206;&#x7684;&#x6570;&#x5B57;. &#x7136;&#x800C;,&#x5B83;&#x4EEC;&#x4E0D;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x5B58;&#x50A8;&#x5C0F;&#x6570;&#x90E8;&#x5206;;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;DECIMAL&#x5B58;&#x50A8;&#x6BD4;BIGIT&#x8FD8;&#x5927;&#x7684;&#x6574;&#x6570;.MySQL&#x5373;&#x652F;&#x6301;&#x7CBE;&#x786E;&#x7C7B;&#x578B;,&#x4E5F;&#x652F;&#x6301;&#x4E0D;&#x7CBE;&#x786E;&#x7C7B;&#x578B;.</p>
</blockquote>
<p><strong>&#x5728;MySQL 5.0&#x4EE5;&#x53CA;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x4E2D;,MySQL&#x670D;&#x52A1;&#x5668;&#x81EA;&#x8EAB;&#x5B9E;&#x73B0;&#x4E86;DECIMAL&#x7684;&#x9AD8;&#x7CBE;&#x5EA6;&#x8BA1;&#x7B97;.</strong>&#x76F8;&#x5BF9;&#x800C;&#x8A00;CPU&#x76F4;&#x63A5;&#x652F;&#x6301;&#x539F;&#x751F;&#x6D6E;&#x70B9;&#x8BA1;&#x7B97;,&#x6240;&#x4EE5;&#x6D6E;&#x70B9;&#x8FD0;&#x7B97;&#x660E;&#x663E;&#x66F4;&#x5FEB;.</p>
<h3 id="4-1-3-&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;">4.1.3. 4.1.3 &#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;</h3><p><strong>VARCHAR</strong></p>
<ul>
<li>VARCHAR&#x7C7B;&#x578B;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x53EF;&#x53D8;&#x957F;&#x7684;&#x5B57;&#x7B26;&#x521B;,&#x662F;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x6570;&#x636E;&#x7C7B;&#x578B;.&#x5B83;&#x6BD4;&#x5B9A;&#x957F;&#x7C7B;&#x578B;&#x66F4;&#x8282;&#x7701;&#x7A7A;&#x95F4;,&#x56E0;&#x4E3A;&#x5B83;&#x4EC5;&#x4F7F;&#x7528;&#x5FC5;&#x8981;&#x7684;&#x7A7A;&#x95F4;.&#x6709;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x4F8B;&#x5916;,&#x5982;&#x679C;MySQL&#x8868;&#x4F7F;&#x7528;TOW_FORMAT=FIXED&#x521B;&#x5EFA;&#x7684;&#x8BDD;,&#x6BCF;&#x4E00;&#x884C;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;&#x5B9A;&#x957F;&#x5B58;&#x50A8;,&#x8FD9;&#x4F1A;&#x6D6A;&#x8D39;&#x7A7A;&#x95F4;.</li>
<li>VARCHAR&#x9700;&#x8981;&#x4F7F;&#x7528;1&#x6216;2&#x4E2A;&#x4E8C;&#x5916;&#x5B57;&#x8282;&#x8BB0;&#x5F55;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x957F;&#x5EA6;: &#x5982;&#x679C;&#x5217;&#x7684;&#x6700;&#x5927;&#x957F;&#x5EA6;&#x7CFB;&#x54E6;&#x554A;&#x4E0E;&#x6216;&#x7B49;&#x4E8E;255&#x5B57;&#x8282;,&#x5219;&#x53EA;&#x4F7F;&#x7528;1&#x4E2A;&#x5B57;&#x8282;&#x8868;&#x793A;,&#x5426;&#x5219;&#x4F7F;&#x7528;2&#x4E2A;&#x5B57;&#x8282;. &#x5047;&#x8BBE;&#x91C7;&#x7528;latinl&#x5B57;&#x7B26;&#x96C6;,&#x4E00;&#x4E2A;VARCHAR(10)&#x7684;&#x5217;&#x9700;&#x8981;11&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;.VARCHAR(1000)&#x7684;&#x5217;&#x5219;&#x9700;&#x8981;1002&#x4E2A;&#x5B57;&#x8282;,&#x56E0;&#x4E3A;&#x9700;&#x8981;2&#x4E2A;&#x5B57;&#x8282;&#x5B58;&#x50A8;&#x957F;&#x5EA6;&#x4FE1;&#x606F;.</li>
<li>VARCHAR&#x8282;&#x7701;&#x4E86;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;,&#x6240;&#x4EE5;&#x5BF9;&#x6027;&#x80FD;&#x4E5F;&#x6709;&#x5E2E;&#x52A9;. &#x4F46;&#x662F;, &#x7531;&#x4E8E;&#x884C;&#x662F;&#x53D8;&#x957F;&#x7684;,&#x5728;UPDATE&#x65F6;&#x53EF;&#x80FD;&#x4F7F;&#x884C;&#x53D8;&#x5F97;&#x6BD4;&#x539F;&#x6765;&#x66F4;&#x957F;,&#x8FD9;&#x5C31;&#x5BFC;&#x81F4;&#x9700;&#x8981;&#x505A;&#x989D;&#x5916;&#x7684;&#x5DE5;&#x4F5C;. &#x5982;&#x679C;&#x4E00;&#x884C;&#x5360;&#x7528;&#x7684;&#x7A7A;&#x95F4;&#x589E;&#x957F;,&#x5E76;&#x4E14;&#x5728;&#x9875;&#x5185;&#x6CA1;&#x6709;&#x66F4;&#x591A;&#x7684;&#x7A7A;&#x95F4;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;,&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;,&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;. &#x4F8B;&#x5982;MyISAM&#x4F1A;&#x5C06;&#x884C;&#x62C6;&#x6210;&#x4E0D;&#x540C;&#x7684;&#x7247;&#x6BB5;&#x5B58;&#x50A8;,InnoDB&#x5219;&#x9700;&#x8981;&#x5206;&#x88C2;&#x9875;&#x6765;&#x4F7F;&#x884C;&#x53EF;&#x4EE5;&#x653E;&#x8FDB;&#x4E1A;&#x5185;.&#x5176;&#x4ED6;&#x4E00;&#x4E9B;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E5F;&#x8BB8;&#x4ECE;&#x4E0D;&#x5728;&#x5143;&#x6570;&#x636E;&#x4F4D;&#x7F6E;&#x66F4;&#x65B0;&#x6570;&#x636E;.&#x590F;&#x660E;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x9002;&#x5408;VARCHAR</li>
<li><ul>
<li>&#x5728;&#x5B57;&#x7B26;&#x4E32;&#x5217;&#x7684;&#x6700;&#x5927;&#x957F;&#x5EA6;&#x6BD4;&#x5E73;&#x5747;&#x957F;&#x5EA6;&#x5927;&#x5F88;&#x591A;; </li>
</ul>
</li>
<li><ul>
<li>&#x5217;&#x7684;&#x66F4;&#x65B0;&#x5F88;&#x5C11;,&#x6240;&#x4EE5;&#x788E;&#x7247;&#x4E0D;&#x662F;&#x95EE;&#x9898;;</li>
</ul>
</li>
<li><ul>
<li>&#x4F7F;&#x7528;&#x4E86;&#x50CF;UTF-8&#x8FD9;&#x6837;&#x590D;&#x6742;&#x7684;&#x5B57;&#x7B26;&#x96C6;,&#x6BCF;&#x4E2A;&#x5B57;&#x7B26;&#x90FD;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x5B57;&#x8282;&#x6570;&#x8FDB;&#x884C;&#x5B58;&#x50A8;.</li>
</ul>
</li>
</ul>
<p><strong>CAHR</strong></p>
<ul>
<li>CAHR&#x7C7B;&#x578B;&#x662F;&#x5B9A;&#x573A;&#x5730;: MySQL&#x603B;&#x662F;&#x6839;&#x636E;&#x5B9A;&#x4E49;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x957F;&#x5EA6;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x7684;&#x7A7A;&#x95F4;. &#x5F53;&#x5B58;&#x50A8;CAHR&#x503C;&#x65F6;,MySQL&#x4F1A;&#x5220;&#x9664;&#x6240;&#x6709;&#x7684;&#x672B;&#x5C3E;&#x7A7A;&#x683C;.CAHR&#x503C;&#x4F1A;&#x6839;&#x636E;&#x9700;&#x8981;&#x91C7;&#x7528;&#x7A7A;&#x683C;&#x8FDB;&#x884C;&#x586B;&#x5145;&#x65B9;&#x4FBF;&#x6BD4;&#x8F83;.</li>
<li>CAHR&#x9002;&#x5408;&#x5B58;&#x50A8;&#x5F88;&#x77ED;&#x7684;&#x5B57;&#x7B26;&#x4E32;,&#x6216;&#x8005;&#x6240;&#x6709;&#x7684;&#x503C;&#x90FD;&#x63A5;&#x8FD1;&#x540C;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;.&#x4F8B;&#x5982;,CAHR&#x975E;&#x5E38;&#x9002;&#x5408;&#x5B58;&#x50A8;&#x5BC6;&#x7801;&#x7684;MD5&#x503C;,&#x56E0;&#x4E3A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5B9A;&#x957F;&#x7684;&#x503C;. &#x5BF9;&#x4E8E;&#x7ECF;&#x5E38;&#x53D8;&#x66F4;&#x7684;&#x6570;&#x636E;,CAHR&#x4E5F;&#x6BD4;VARCHAR&#x66F4;&#x597D;,&#x56E0;&#x4E3A;&#x5B9A;&#x957F;&#x7684;CAHR&#x7C7B;&#x578B;&#x4E0D;&#x5BB9;&#x6613;&#x4EA7;&#x751F;&#x788E;&#x7247;. &#x5BF9;&#x4E8E;&#x975E;&#x5E38;&#x77ED;&#x7684;&#x5217;,CAHR&#x6BD4;VARCHAR&#x5728;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x4E0A;&#x4E5F;&#x66F4;&#x6709;&#x6548;&#x7387;. &#x4F8B;&#x5982;&#x7528;CAHR(1)&#x6765;&#x5B58;&#x50A8;&#x53EA;&#x6709;Y&#x548C;N&#x7684;&#x503C;, &#x5982;&#x679C;&#x91C7;&#x7528;&#x5355;&#x5B57;&#x8282;&#x5B57;&#x7B26;&#x96C6;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5B57;&#x8282;,&#x4F46;&#x662F;VARCHAR(1)&#x7F3A;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x5B57;&#x8282;,&#x56E0;&#x4E3A;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x8BB0;&#x5F55;&#x957F;&#x5EA6;&#x7684;&#x989D;&#x5916;&#x5B57;&#x8282;.</li>
<li>&#x4E0E;CHAR&#x548C;VARCHAR&#x7D2F;&#x6B21;&#x7684;&#x7C7B;&#x578B;&#x8FD8;&#x6709;BINARY&#x548C;VARBINARY,&#x5B83;&#x4EEC;&#x7A9C;&#x51FA;&#x7684;&#x662F;&#x4E8C;&#x8FDB;&#x5236;&#x5B57;&#x7B26;&#x4E32;.&#x4E8C;&#x8FDB;&#x5236;&#x5B57;&#x7B26;&#x4E32;&#x8DDF;&#x5E38;&#x89C4;&#x5B57;&#x7B26;&#x4E32;&#x975E;&#x5E38;&#x76F8;&#x4F3C;,&#x4F46;&#x662F;&#x4E8C;&#x8FDB;&#x5236;&#x5B57;&#x7B26;&#x4E32;&#x5B58;&#x50A8;&#x7684;&#x662F;&#x5B57;&#x8282;&#x7801;&#x800C;&#x4E0D;&#x662F;&#x5B57;&#x7B26;. &#x586B;&#x5145;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;:MySQL&#x586B;&#x5145;BINARY&#x91C7;&#x7528;&#x7684;&#x662F;\0(&#x96F6;&#x5B57;&#x8282;)&#x800C;&#x4E0D;&#x662F;&#x7A7A;&#x683C;,&#x5728;&#x68C0;&#x7D22;&#x65F6;&#x4E5F;&#x4E0D;&#x4F1A;&#x53BB;&#x6389;&#x586B;&#x5145;&#x503C;.</li>
<li><strong>&#x6177;&#x6168;&#x662F;&#x4E0D;&#x660E;&#x667A;&#x7684;</strong></li>
<li><ul>
<li>&#x4F7F;&#x7528;VARCHART(5)&#x548C;VARCHAR(200)&#x5B58;&#x50A8;&#x2019;hello&#x2019;&#x7684;&#x7A7A;&#x95F4;&#x5F00;&#x9500;&#x662F;&#x4E00;&#x6837;&#x7684;.&#x4F46;&#x66F4;&#x957F;&#x7684;&#x5217;&#x4F1A;&#x6D88;&#x8017;&#x66F4;&#x591A;&#x7684;&#x5185;&#x5B58;,&#x56E0;&#x4E3A;MySQL&#x901A;&#x5E38;&#x4F1A;&#x5206;&#x914D;&#x82E6;&#x4E01;&#x5927;&#x5C0F;&#x7684;&#x5185;&#x5B58;&#x5757;&#x6765;&#x4FDD;&#x5B58;&#x5185;&#x90E8;&#x503C;. &#x5C24;&#x5176;&#x662F;&#x4F7F;&#x7528;&#x5185;&#x5B58;&#x4E34;&#x65F6;&#x8868;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x6216;&#x8005;&#x64CD;&#x4F5C;&#x65F6;&#x4F1A;&#x7279;&#x522B;&#x7CDF;&#x7CD5;. &#x5728;&#x5229;&#x7528;&#x78C1;&#x76D8;&#x4E34;&#x65F6;&#x8868;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x65F6;&#x4E5F;&#x540C;&#x6837;&#x7CDF;&#x7CD5;. &#x6240;&#x4EE5;&#x6700;&#x597D;&#x7684;&#x7B56;&#x7565;&#x662F;&#x53EA;&#x5206;&#x914D;&#x771F;&#x6B63;&#x9700;&#x8981;&#x7684;&#x7A7A;&#x95F4;.</li>
</ul>
</li>
</ul>
<p><strong>BLOB&#x548C;TEXT&#x7C7B;&#x578B;</strong></p>
<blockquote>
<p>BLOB&#x548C;TEXT&#x90FD;&#x662F;&#x4E3A;&#x5B58;&#x50A8;&#x5F88;&#x5927;&#x7684;&#x6570;&#x636E;&#x800C;&#x8BBE;&#x8BA1;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x6570;&#x636E;&#x7C7B;&#x578B;,&#x5206;&#x8D1D;&#x91C7;&#x7528;&#x4E8C;&#x8FDB;&#x5236;&#x548C;&#x5B57;&#x7B26;&#x65B9;&#x5F0F;&#x5B58;&#x50A8;.</p>
</blockquote>
<ul>
<li>&#x5B57;&#x7B26;&#x7C7B;&#x578B;&#x662F;TINYTEXT, SMALLTEXT, TEXT, MEDIUMTEXT, LONGTEXT;&#x5BF9;&#x5E94;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x7C7B;&#x578B;&#x662F;TINYBLOB, SMALLBLOB, BLOB, MEDIUMBLOB, LONGBLOB.</li>
<li>&#x4E0E;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x4E0D;&#x540C;,MySQL&#x5427;&#x6BCF;&#x4E2A;BLOB&#x548C;TEXT&#x503C;&#x5F53;&#x4F5C;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x5BF9;&#x8C61;&#x5904;&#x7406;. &#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5728;&#x5B58;&#x50A8;&#x662F;&#x901A;&#x5E38;&#x4F1A;&#x505A;&#x7279;&#x6B8A;&#x5904;&#x7406;. &#x5F53;BLOB&#x548C;TEXT&#x503C;&#x592A;&#x5927;&#x65F6;, InnoBD&#x4F1A;&#x4F7F;&#x7528;&#x4E13;&#x95E8;&#x7684;&#x201D;&#x5916;&#x90E8;&#x201D;&#x5B58;&#x50A8;&#x533A;&#x57DF;&#x6765;&#x8FDB;&#x884C;&#x5B58;&#x50A8;,&#x6B64;&#x65F6;&#x6BCF;&#x4E2A;&#x503C;&#x5728;&#x884C;&#x5185;&#x9700;&#x8981;1~4&#x4E2A;&#x5B57;&#x8282;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x6307;&#x9488;,&#x7136;&#x540E;&#x5728;&#x5916;&#x90E8;&#x5B58;&#x50A8;&#x533A;&#x57DF;&#x5B58;&#x50A8;&#x5B9E;&#x9645;&#x7684;&#x503C;.</li>
<li>BLOB&#x548C;TEXT&#x5BB6;&#x65CF;&#x4E4B;&#x95F4;&#x4EC5;&#x6709;&#x7684;&#x4E0D;&#x540C;&#x662F;BLOB&#x7C7B;&#x578B;&#x5B58;&#x50A8;&#x7684;&#x662F;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;,&#x6CA1;&#x6709;&#x6392;&#x5E8F;&#x89C4;&#x5219;&#x6216;&#x5B57;&#x7B26;&#x96C6;,&#x800C;TEXT&#x7C7B;&#x578B;&#x6709;&#x5B57;&#x7B26;&#x96C6;&#x548C;&#x6392;&#x5E8F;&#x89C4;&#x5219;.</li>
</ul>
<p><strong>&#x4F7F;&#x7528;&#x679A;&#x4E3E;(ENUM)&#x4EE3;&#x66FF;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;</strong></p>
<blockquote>
<p>&#x6709;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x679A;&#x4E3E;&#x5217;&#x4EE3;&#x66FF;&#x5E38;&#x7528;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;. &#x679A;&#x4E3E;&#x5217;&#x53EF;&#x4EE5;&#x5427;&#x4E00;&#x4E9B;&#x4E0D;&#x5BB9;&#x526F;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5B58;&#x50A8;&#x6210;&#x4E00;&#x4E2A;&#x9884;&#x5B9A;&#x4E49;&#x7684;&#x96C6;&#x5408;. MySQL&#x5728;&#x5B58;&#x50A8;&#x679A;&#x4E3E;&#x65F6;&#x975E;&#x5E38;&#x7D27;&#x51D1;,&#x4F1A;&#x6839;&#x636E;&#x5217;&#x8868;&#x503C;&#x7684;&#x6570;&#x91CF;&#x538B;&#x7F29;&#x5230;&#x4E00;&#x4E2A;&#x6216;&#x4E24;&#x4E2A;&#x5B57;&#x8282;&#x4E2D;. MySQL&#x5728;&#x5185;&#x90E8;&#x4F1A;&#x5C06;&#x6BCF;&#x4E2A;&#x503C;&#x5728;&#x5217;&#x8868;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x4FDD;&#x5B58;&#x4E3A;&#x6574;&#x6570;,&#x5E76;&#x4E14;&#x5728;&#x8868;&#x7684;.frm&#x6587;&#x4EF6;&#x4E2D;&#x4FDD;&#x5B58;&#x201D;&#x6570;&#x5B57;-&#x5B57;&#x7B26;&#x4E32;&#x201D;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x7684;&#x201D;&#x67E5;&#x627E;&#x8868;&#x201D;.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> enum_test(</span><br><span class="line">	e ENUM(<span class="string">&apos;fish&apos;</span>, <span class="string">&apos;apple&apos;</span>, <span class="string">&apos;dog&apos;</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e+<span class="number">0</span> <span class="keyword">FROM</span> enum_test;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-4-&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x7C7B;&#x578B;">4.1.4. 4.1.4 &#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x7C7B;&#x578B;</h3><blockquote>
<p>MySQL&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BB8;&#x591A;&#x7C7B;&#x578B;&#x6765;&#x4FDD;&#x5B58;&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x503C;,&#x4F8B;&#x5982;YEAR&#x548C;DATE.MySQL&#x80FD;&#x5550;&#x51FA;&#x6700;&#x5C0F;&#x65F6;&#x95F4;&#x529B;&#x5EA6;&#x4E3A;&#x79D2;.&#x4F46;&#x662F;MySQL&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5FAE;&#x5999;&#x7EA7;&#x7C92;&#x5EA6;&#x8FDB;&#x884C;&#x4E34;&#x65F6;&#x8FD0;&#x7B97;.</p>
</blockquote>
<ul>
<li>DATETIME</li>
<li><ul>
<li>&#x8FD9;&#x4E2A;&#x7C7B;&#x578B;&#x80FD;&#x4FDD;&#x5B58;&#x5927;&#x8303;&#x56F4;&#x7684;&#x503C;,&#x4ECE;1001&#x5E74;&#x5230;9999&#x5E74;,&#x7CBE;&#x5EA6;&#x4E3A;&#x79D2;. &#x5B83;&#x5427;&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x5C01;&#x88C5;&#x5230;&#x53EF;&#x662F;&#x4E3A;YYYYMMDDHHMMSS&#x7684;&#x6574;&#x6570;&#x4E2D;,&#x4E0E;&#x65F6;&#x533A;&#x65E0;&#x5173;. &#x4F7F;&#x7528;8&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;.</li>
</ul>
</li>
<li><ul>
<li>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;,MySQL&#x4EE5;&#x4E00;&#x79CD;&#x53EF;&#x6392;&#x5E8F;&#x7684;.&#x65E0;&#x6B67;&#x4E49;&#x7684;&#x683C;&#x5F0F;&#x663E;&#x793A;DATETIME&#x503C;,&#x4F8B;&#x5982;&#x201D;2008-01-16 22:37:08&#x201D;. &#x8FD9;&#x662F;ANSI&#x6807;&#x51C6;&#x5B9A;&#x4E49;&#x7684;&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x8868;&#x793A;&#x65B9;&#x6CD5;.</li>
</ul>
</li>
<li>TIMESTAMP</li>
<li><ul>
<li>TIMESTAMP&#x7C7B;&#x578B;&#x4FDD;&#x5B58;&#x4E86;&#x4ECE;1970&#x5E74;1&#x6708;1&#x65E5;&#x5348;&#x591C;&#x4F9D;&#x8D56;&#x7684;&#x79D2;&#x6570;,&#x5B83;&#x548C;UNIX&#x65F6;&#x95F4;&#x6233;&#x76F8;&#x540C;. TIMESTAMP&#x53EA;&#x4F7F;&#x7528;4&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;,&#x56E0;&#x6B64;&#x5B83;&#x7684;&#x8303;&#x56F4;&#x6BD4;DATETIME&#x5C0F;&#x5F97;&#x591A;:&#x53EA;&#x80FD;&#x8868;&#x793A;&#x4ECE;1997&#x5E74;&#x5230;2038&#x5E74;.</li>
</ul>
</li>
<li><ul>
<li>TIMESTAMP&#x663E;&#x793A;&#x7684;&#x503C;&#x4F9D;&#x8D56;&#x4E8E;&#x65F6;&#x533A;. MySQL&#x670D;&#x52A1;&#x5668;.&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;,&#x4EE5;&#x53CA;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x90FD;&#x6709;&#x65F6;&#x533A;&#x8BBE;&#x7F6E;.</li>
</ul>
</li>
<li>&#x9664;&#x4E86;&#x7279;&#x6B8A;&#x884C;&#x4E3A;&#x4E4B;&#x5916;,&#x901A;&#x5E38;&#x4E5F;&#x5E94;&#x8BE5;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;TIMESTAMP,&#x56E0;&#x4E3A;&#x5B83;&#x6BD4;DATETIME&#x7A7A;&#x95F4;&#x6548;&#x7387;&#x66F4;&#x9AD8;.&#x6709;&#x65F6;&#x5019;&#x4EBA;&#x4EEC;&#x4F1A;&#x5C06;Unix&#x65F6;&#x95F4;&#x6233;&#x5B58;&#x50A8;&#x4E3A;&#x6574;&#x6570;&#x503C;,&#x4F46;&#x8FD9;&#x4E0D;&#x4F1A;&#x5E26;&#x6765;&#x4EFB;&#x4F55;&#x6536;&#x76CA;. &#x7528;&#x6574;&#x6570;&#x4FDD;&#x5B58;&#x65F6;&#x95F4;&#x6233;&#x7684;&#x683C;&#x5F0F;&#x901A;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#x5904;&#x7406;,&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4E0D;&#x63A8;&#x8350;&#x8FD9;&#x6837;&#x505A;.</li>
</ul>
<h3 id="4-1-5-&#x4F4D;&#x6570;&#x636E;&#x7C7B;&#x578B;">4.1.5. 4.1.5 &#x4F4D;&#x6570;&#x636E;&#x7C7B;&#x578B;</h3><blockquote>
<p>MySQL&#x6709;&#x5C11;&#x6570;&#x51E0;&#x79CD;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x4F7F;&#x7528;&#x7D27;&#x51D1;&#x7684;&#x4F4D;&#x5B58;&#x50A8;&#x6570;&#x636E;.&#x6240;&#x6709;&#x7684;&#x8FD9;&#x4E9B;&#x4F4D;&#x7C7B;&#x578B;,&#x4E0D;&#x5173;&#x5E95;&#x5C42;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x548C;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x5982;&#x4F55;,&#x4ECE;&#x6280;&#x672F;&#x4E0A;&#x6765;&#x8BF4;&#x90FD;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;.</p>
</blockquote>
<ul>
<li>BIT</li>
<li>SET</li>
<li>&#x5728;&#x6574;&#x6570;&#x5217;&#x4E0A;&#x8FDB;&#x884C;&#x6309;&#x4F4D;&#x64CD;&#x4F5C;</li>
</ul>
<h3 id="4-1-6-&#x9009;&#x62E9;&#x6807;&#x8BC6;&#x7B26;-identifier">4.1.6. 4.1.6 &#x9009;&#x62E9;&#x6807;&#x8BC6;&#x7B26;(identifier)</h3><blockquote>
<p>&#x4E3A;&#x6807;&#x8BC6;&#x5217;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x975E;&#x5E38;&#x91CD;&#x8981;. &#x5F53;&#x9009;&#x62E9;&#x6807;&#x8BC6;&#x5217;&#x7684;&#x7C7B;&#x578B;&#x65F6;,&#x4E0D;&#x4EC5;&#x4EC5;&#x9700;&#x8981;&#x8003;&#x8651;&#x5B58;&#x50A8;&#x7C7B;&#x578B;,&#x8FD8;&#x9700;&#x8981;&#x8003;&#x8651;MySQL&#x5BF9;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x600E;&#x4E48;&#x6267;&#x884C;&#x51E0;&#x6240;&#x548C;&#x6BD4;&#x8F83;. &#x4F8B;&#x5982;MySQL&#x5728;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x6574;&#x6570;&#x5B58;&#x50A8;ENUM&#x548C;SET&#x7C7B;&#x578B;,&#x7136;&#x540E;&#x5728;&#x505A;&#x6BD4;&#x8F83;&#x64CD;&#x4F5C;&#x65F6;&#x8F6C;&#x6362;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;.</p>
</blockquote>
<ul>
<li>&#x6574;&#x6570;&#x7C7B;&#x578B;</li>
<li><ul>
<li>&#x6574;&#x6570;&#x901A;&#x5E38;&#x662F;&#x6807;&#x8BC6;&#x5217;&#x6700;&#x597D;&#x7684;&#x9009;&#x62E9;,&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x5F88;&#x5FEB;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;AUTO_INCREMENT.</li>
</ul>
</li>
<li>ENUM&#x548C;SET&#x7C7B;&#x578B;</li>
<li><ul>
<li>&#x5BF9;&#x4E8E;&#x6807;&#x8BC6;&#x5217;&#x6765;&#x8BF4;,EMUM&#x548C;SET&#x7C7B;&#x578B;&#x901A;&#x5E38;&#x662F;&#x4E00;&#x4E2A;&#x7CDF;&#x7CD5;&#x7684;&#x9009;&#x62E9;,&#x5C3D;&#x7BA1;&#x5BF9;&#x67D0;&#x4E9B;&#x53EA;&#x5305;&#x542B;&#x56FA;&#x5B9A;&#x72B6;&#x6001;&#x6216;&#x8005;&#x7C7B;&#x578B;&#x7684;&#x9759;&#x6001;&#x201D;&#x5B9A;&#x4E49;&#x8868;&#x201D;&#x6765;&#x8BF4;&#x53EF;&#x80FD;&#x662F;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x7684;. ENUM&#x548C;SET&#x5217;&#x9002;&#x5408;&#x5B58;&#x50A8;&#x56FA;&#x5B9A;&#x7684;&#x4FE1;&#x606F;,&#x4F8B;&#x5982;&#x6709;&#x5E8F;&#x7684;&#x72B6;&#x6001;.&#x4EA7;&#x54C1;&#x7C7B;&#x578B;.&#x4EBA;&#x7684;&#x6027;&#x522B;.</li>
</ul>
</li>
<li>&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;</li>
<li><ul>
<li>&#x5982;&#x679C;&#x53EF;&#x80FD;,&#x5E94;&#x8BE5;&#x907F;&#x514D;&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#x4F5C;&#x4E3A;&#x6807;&#x8BC6;&#x5217;,&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5F88;&#x6D88;&#x8017;&#x7A7A;&#x95F4;,&#x5E76;&#x4E14;&#x901A;&#x5E38;&#x6BD4;&#x6570;&#x5B57;&#x7C7B;&#x578B;&#x6162;.</li>
</ul>
</li>
<li><ul>
<li>&#x5982;&#x679C;&#x5B58;&#x50A8;UUID&#x503C;,&#x5219;&#x5E94;&#x8BE5;&#x4E00;&#x5904;&#x201D;-&#x201C;&#x7B26;&#x53F7;;&#x6216;&#x8005;&#x66F4;&#x597D;&#x7684;&#x505A;&#x6CD5;&#x662F;,&#x7528;UNHEX()&#x51FD;&#x6570;&#x8F6C;&#x6362;UUID&#x503C;&#x4E3A;16&#x5B57;&#x8282;&#x7684;&#x6570;&#x5B57;,&#x5E76;&#x4E14;&#x5B58;&#x50A8;&#x5728;&#x4E00;&#x4E2A;BINARY(16)&#x5217;&#x4E2D;.&#x68C0;&#x7D22;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;HEX()&#x51FD;&#x6570;&#x6765;&#x683C;&#x5F0F;&#x5316;&#x4E3A;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x683C;&#x5F0F;.</li>
</ul>
</li>
<li>&#x5F53;&#x5FC3;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;schema</li>
</ul>
<h3 id="4-1-7-&#x7279;&#x6B8A;&#x7C7B;&#x578B;&#x6570;&#x636E;">4.1.7. 4.1.7 &#x7279;&#x6B8A;&#x7C7B;&#x578B;&#x6570;&#x636E;</h3><ul>
<li>IPv4&#x5730;&#x5740;.&#x4EBA;&#x4EEC;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;VARCHAR(15)&#x5217;&#x6765;&#x5B58;&#x50A8;IP&#x5730;&#x5740;. &#x7136;&#x800C;,&#x5B83;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x662F;32&#x4F4D;&#x65E0;&#x7B26;&#x53F7;&#x6574;&#x6570;,&#x4E0D;&#x662F;&#x5B57;&#x7B26;&#x4E32;. &#x7528;&#x5C0F;&#x6570;&#x70B9;&#x5C06;&#x5730;&#x5740;&#x5206;&#x6210;&#x56DB;&#x6BB5;&#x7684;&#x8868;&#x793A;&#x65B9;&#x6CD5;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x8BA9;&#x4EBA;&#x4EEC;&#x5BB9;&#x6613;&#x9605;&#x8BFB;.&#x6240;&#x4EE5;&#x5E94;&#x8BE5;&#x7528;&#x65E0;&#x7B26;&#x53F7;&#x6574;&#x6570;&#x5B58;&#x50A8;IP&#x5730;&#x5740;. MySQL&#x63D0;&#x4F9B;INET_ATON()&#x548C;INET_NTOA()&#x51FD;&#x6570;&#x5728;&#x8FD9;&#x4E24;&#x79CD;&#x8868;&#x793A;&#x65B9;&#x6CD5;&#x4E4B;&#x95F4;&#x5207;&#x6362;.</li>
</ul>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">SELECT</span> <span class="function"><span class="title">INET_ATON</span>(<span class="string">&apos;192.168.1.1&apos;</span>)</span></span><br><span class="line"><span class="variable">SELECT</span> <span class="function"><span class="title">INET_NTOA</span>(<span class="string">&apos;3232235777&apos;</span>)</span></span><br></pre></td></tr></table></figure>

<h2 id="4-2-MySQL-schema&#x8BBE;&#x8BA1;&#x4E2D;&#x7684;&#x9677;&#x9631;">4.2. 4.2 MySQL schema&#x8BBE;&#x8BA1;&#x4E2D;&#x7684;&#x9677;&#x9631;</h2><p><strong>&#x592A;&#x591A;&#x7684;&#x5217;</strong></p>
<ul>
<li>MySQL&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;API&#x5DE5;&#x4F5C;&#x65F6;&#x9700;&#x8981;&#x5728;&#x670D;&#x52A1;&#x5668;&#x5C42;&#x548C;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x5C42;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x884C;&#x7F13;&#x51B2;&#x683C;&#x5F0F;&#x62F7;&#x8D1D;&#x6570;&#x636E;,&#x7136;&#x540E;&#x5728;&#x670D;&#x52A1;&#x5668;&#x5C42;&#x5C06;&#x7F13;&#x51B2;&#x5185;&#x5BB9;&#x89E3;&#x7801;&#x6210;&#x5404;&#x4E2A;&#x5217;. &#x4ECE;&#x884C;&#x7F13;&#x51B2;&#x4E2D;&#x5C06;&#x6591;&#x9A6C;&#x8FC7;&#x591A;&#x7684;&#x5217;&#x8F6C;&#x6362;&#x6210;&#x884C;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x64CD;&#x4F5C;&#x4EE3;&#x4EF7;&#x662F;&#x975E;&#x5E38;&#x9AD8;&#x7684;. &#x4E0A;&#x5343;&#x5B57;&#x6BB5;</li>
</ul>
<p><strong>&#x592A;&#x591A;&#x7684;&#x5173;&#x8054;</strong></p>
<ul>
<li>&#x6240;&#x8C13;&#x7684;&#x201D;&#x5B9E;&#x4F53;-&#x5C5E;&#x6027;-&#x503C;&#x201D;(EAV)&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x7CDF;&#x7CD5;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;,&#x5C24;&#x5176;&#x662F;&#x5728;MySQL&#x4E0B;&#x4E0D;&#x80FD;&#x9760;&#x8C31;&#x5730;&#x5DE5;&#x4F5C;. MySQL&#x9650;&#x5236;&#x4E86;&#x6BCF;&#x4E2A;&#x5173;&#x8054;&#x64CD;&#x4F5C;&#x6700;&#x591A;&#x53EA;&#x80FD;&#x6709;61&#x5F20;&#x8868;,&#x4F46;&#x662F;EAV&#x6570;&#x636E;&#x5E93;&#x9700;&#x8981;&#x8BB8;&#x591A;&#x81EA;&#x5173;&#x8054;.&#x4E8B;&#x5B9E;&#x4E0A;&#x5728;&#x8BB8;&#x591A;&#x5173;&#x8054;&#x5C11;&#x4E8E;61&#x5F20;&#x8868;&#x7684;&#x60C5;&#x51B5;&#x4E0B;,&#x89E3;&#x6790;&#x548C;&#x4F18;&#x5316;&#x67E5;&#x8BE2;&#x7684;&#x4EE3;&#x4EF7;&#x4E5F;&#x4F1A;&#x6210;&#x4E3A;MySQL&#x7684;&#x95EE;&#x9898;.<strong>&#x5982;&#x679C;&#x5E0C;&#x671B;&#x67E5;&#x8BE2;&#x6267;&#x884C;&#x5F97;&#x5FEB;&#x901F;&#x4E14;&#x5E76;&#x53D1;&#x6027;&#x597D;,&#x803D;&#x6401;&#x67E5;&#x8BE2;&#x6700;&#x597D;&#x5728;12&#x4E2A;&#x8868;&#x4EE5;&#x5185;&#x505A;&#x5173;&#x8054;.</strong></li>
</ul>
<p><strong>&#x5168;&#x80FD;&#x7684;&#x679A;&#x4E3E;</strong></p>
<blockquote>
<p>&#x6CE8;&#x610F;&#x9632;&#x6B62;&#x8FC7;&#x5EA6;&#x4F7F;&#x7528;&#x679A;&#x4E3E;.</p>
</blockquote>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">CREATE TABLE ...(</span><br><span class="line">    country <span class="class"><span class="keyword">enum</span>(&apos;&apos;, &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, ..., &apos;31&apos;)</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x7684;schema&#x8BBE;&#x8BA1;&#x975E;&#x5E38;&#x51CC;&#x4E71;. &#x6298;&#x78E8;&#x4F7F;&#x7528;&#x679A;&#x4E3E;&#x7C7B;&#x578B;&#x4E5F;&#x8BB8;&#x5728;&#x4EFB;&#x4F55;&#x652F;&#x6301;&#x679A;&#x4E3E;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x5E93;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x95EE;&#x9898;&#x7684;&#x8BBE;&#x8BA1;&#x65B9;&#x6848;,&#x8FD9;&#x91CC;&#x5E94;&#x8BE5;&#x7528;&#x6574;&#x6570;&#x4F5C;&#x4E3A;&#x5916;&#x952E;&#x5173;&#x8054;&#x5230;&#x5B57;&#x5178;&#x8868;&#x6216;&#x8005;&#x67E5;&#x627E;&#x8868;&#x6765;&#x67E5;&#x627E;&#x5177;&#x4F53;&#x503C;.</li>
</ul>
<p><strong>&#x53D8;&#x76F8;&#x7684;&#x679A;&#x4E3E;</strong></p>
<blockquote>
<p>&#x679A;&#x4E3E;&#x5217;&#x5141;&#x8BB8;&#x5728;&#x5217;&#x4E2D;&#x5B58;&#x50A8;&#x4E00;&#x7EC4;&#x5B9A;&#x4E49;&#x503C;&#x4E2D;&#x7684;&#x5355;&#x4E2A;&#x503C;,&#x96C6;&#x5408;(SET)&#x5217;&#x5219;&#x5141;&#x8BB8;&#x5728;&#x5217;&#x4E2D;&#x5B58;&#x50A8;&#x4E00;&#x7EC4;&#x5B9A;&#x4E49;&#x503C;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x503C;.&#x6709;&#x65F6;&#x5019;&#x8FD9;&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x5BFC;&#x81F4;&#x6DF7;&#x4E71;</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">CREATE TABLE <span class="built_in">..</span>. (</span><br><span class="line">    is_default <span class="builtin-name">set</span>(<span class="string">&apos;Y&apos;</span>, <span class="string">&apos;N&apos;</span>)<span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> default </span><span class="string">&apos;N&apos;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x5982;&#x679C;&#x8FD9;&#x91CC;&#x548C;&#x771F;&#x5047;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x4E0D;&#x4F1A;&#x540C;&#x65F6;&#x51FA;&#x73B0;,&#x90A3;&#x4E48;&#x6BEB;&#x65E0;&#x7591;&#x95EE;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x679A;&#x4E3E;&#x5217;&#x4EE3;&#x66FF;&#x96C6;&#x5408;&#x5217;</li>
</ul>
<p><strong>&#x975E;&#x6B64;&#x53D1;&#x660E;(Not Invent Here)&#x7684;NULL</strong></p>
<blockquote>
<p>&#x6211;&#x4EEC;&#x5728;&#x4E4B;&#x524D;&#x8BF4;&#x907F;&#x514D;&#x4F7F;&#x7528;NULL&#x7684;&#x597D;&#x5904;,&#x5E76;&#x4E14;&#x5EFA;&#x8BAE;&#x5C3D;&#x53EF;&#x80FD;&#x8003;&#x8651;&#x66FF;&#x4EE3;&#x65B9;&#x6848;. &#x5373;&#x4F7F;&#x9700;&#x8981;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x4E8B;&#x5B9E;&#x4E0A;&#x7684;&#x201D;&#x7A7A;&#x503C;&#x201D;&#x5230;&#x8868;&#x4E2D;&#x65F6;,&#x4E5F;&#x4E0D;&#x4E00;&#x5B9A;&#x975E;&#x5F97;&#x4F7F;&#x7528;NULL. &#x4E5F;&#x8BB8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;0&#x6216;&#x8005;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;&#x4F5C;&#x4E3A;&#x4EE3;&#x66FF;.&#x4F46;&#x662F;&#x4E0D;&#x8981;&#x8D70;&#x6781;&#x7AEF;. &#x5F53;&#x786E;&#x5B9E;&#x9700;&#x8981;&#x8868;&#x793A;&#x672A;&#x77E5;&#x503C;&#x65F6;&#x4E5F;&#x4E0D;&#x8981;&#x5BB3;&#x6015;&#x4F7F;&#x7528;NULL.</p>
</blockquote>
<h2 id="4-3&#x8303;&#x5F0F;&#x548C;&#x53CD;&#x8303;&#x5F0F;">4.3. 4.3&#x8303;&#x5F0F;&#x548C;&#x53CD;&#x8303;&#x5F0F;</h2><blockquote>
<p>&#x5BF9;&#x4E8E;&#x4EFB;&#x4F55;&#x7ED9;&#x5B9A;&#x7684;&#x6570;&#x636E;&#x901A;&#x5E38;&#x90FD;&#x6709;&#x5F88;&#x591A;&#x8868;&#x793A;&#x65B9;&#x6CD5;,&#x4ECE;&#x5B8C;&#x5168;&#x7684;&#x8303;&#x5F0F;&#x5316;&#x5230;&#x5B8C;&#x5168;&#x7684;&#x53CD;&#x8303;&#x5F0F;&#x5316;.</p>
</blockquote>
<p><strong>&#x96C7;&#x5458;,&#x90E8;&#x95E8;,&#x90E8;&#x95E8;&#x9886;&#x5BFC;</strong></p>
<table>
<thead>
<tr>
<th>EMPLOYEE</th>
<th>DEPARTMENT</th>
<th>HEAD</th>
</tr>
</thead>
<tbody><tr>
<td>Jones</td>
<td>Accounting</td>
<td>Jones</td>
</tr>
<tr>
<td>Smith</td>
<td>Engineering</td>
<td>Smith</td>
</tr>
<tr>
<td>Brown</td>
<td>Accounting</td>
<td>Jones</td>
</tr>
<tr>
<td>Green</td>
<td>Accounting</td>
<td>Smith</td>
</tr>
</tbody></table>
<ul>
<li>&#x8FD9;&#x4E2A;schema&#x7684;&#x95EE;&#x9898;&#x662F;&#x4FEE;&#x6539;&#x6570;&#x636E;&#x65F6;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x4E0D;&#x4E00;&#x81F4;.&#x5047;&#x5982;Say Brown&#x63A5;&#x4EFB;Accounting&#x90E8;&#x95E8;&#x7684;&#x9886;&#x5BFC;,&#x9700;&#x8981;&#x4FEE;&#x6539;&#x591A;&#x884C;&#x6570;&#x636E;&#x6765;&#x53CD;&#x6620;&#x8FD9;&#x4E2A;&#x53D8;&#x5316;,&#x8FD9;&#x5F88;&#x75DB;&#x82E6;.</li>
<li>&#x8FD9;&#x4E2A;&#x8BBE;&#x8BA1;&#x5728;&#x6CA1;&#x6709;&#x96C7;&#x5458;&#x4FE1;&#x606F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C31;&#x65E0;&#x6CD5;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x90E8;&#x95E8;&#x2014;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5220;&#x9664;&#x4E86;&#x6240;&#x6709;&#x7684;Accounting&#x90E8;&#x95E8;&#x96C7;&#x5458;,&#x6211;&#x4EEC;&#x5C31;&#x4E8B;&#x60C5;&#x4E86;&#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x90E8;&#x95E8;&#x672C;&#x8EAB;&#x7684;&#x6240;&#x6709;&#x8BB0;&#x5F55;</li>
<li>&#x8981;&#x907F;&#x514D;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;,&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5BF9;&#x8FD9;&#x4E2A;&#x8868;&#x8FDB;&#x884C;&#x8303;&#x4E16;&#x534E;,&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x62C6;&#x5206;&#x96C7;&#x5458;&#x548C;&#x90E8;&#x95E8;&#x9879;.</li>
</ul>
<p><strong>&#x96C7;&#x5458;&#x8868;</strong></p>
<table>
<thead>
<tr>
<th>EMPLOYEE</th>
<th>DEPARTMENT</th>
</tr>
</thead>
<tbody><tr>
<td>Jones</td>
<td>Accounting</td>
</tr>
<tr>
<td>Smith</td>
<td>Engineering</td>
</tr>
<tr>
<td>Brown</td>
<td>Accounting</td>
</tr>
<tr>
<td>Green</td>
<td>Accounting</td>
</tr>
</tbody></table>
<p><strong>&#x90E8;&#x95E8;&#x8868;</strong></p>
<table>
<thead>
<tr>
<th>DEPARTMENT</th>
<th>HEAD</th>
</tr>
</thead>
<tbody><tr>
<td>Accounting</td>
<td>Jones</td>
</tr>
<tr>
<td>Engineering</td>
<td>Smith</td>
</tr>
</tbody></table>
<h3 id="4-3-1-&#x8303;&#x5F0F;&#x7684;&#x4F18;&#x70B9;&#x548C;&#x7F3A;&#x70B9;">4.3.1. 4.3.1 &#x8303;&#x5F0F;&#x7684;&#x4F18;&#x70B9;&#x548C;&#x7F3A;&#x70B9;</h3><blockquote>
<p>&#x4E3A;&#x4E86;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x800C;&#x5BFB;&#x6C42;&#x5E2E;&#x52A9;&#x65F6;,&#x7ECF;&#x5E38;&#x4F1A;&#x88AB;&#x5EFA;&#x8BAE;&#x5BF9;schema&#x8FDB;&#x884C;&#x8303;&#x5F0F;&#x5316;&#x8BBE;&#x8BA1;,&#x5C24;&#x5176;&#x662F;&#x5199;&#x5BC6;&#x96C6;&#x7684;&#x573A;&#x666F;.</p>
</blockquote>
<ul>
<li>&#x8303;&#x5F0F;&#x5316;&#x7684;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x901A;&#x5E38;&#x6BD4;&#x53CD;&#x8303;&#x5F0F;&#x5316;&#x8981;&#x5FEB;.</li>
<li>&#x5F53;&#x6570;&#x636E;&#x8F83;&#x597D;&#x5730;&#x8303;&#x5F0F;&#x5316;&#x65F6;,&#x5C31;&#x53EA;&#x6709;&#x5F88;&#x5C11;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x91CD;&#x590D;&#x6570;&#x636E;,&#x6240;&#x4EE5;&#x53EA;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x66F4;&#x5C11;&#x7684;&#x6570;&#x636E;.</li>
<li>&#x8303;&#x5F0F;&#x5316;&#x7684;&#x8868;&#x901A;&#x5E38;&#x66F4;&#x5C0F;,&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x653E;&#x5728;&#x5185;&#x5B58;&#x91CC;,&#x6240;&#x4EE5;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#x4F1A;&#x66F4;&#x5FEB;.</li>
<li>&#x5F88;&#x5C11;&#x6709;&#x591A;&#x4F59;&#x7684;&#x6570;&#x636E;&#x610F;&#x5473;&#x7740;&#x68C0;&#x7D22;&#x5217;&#x8868;&#x6570;&#x636E;&#x65F6;&#x66F4;&#x5C11;&#x9700;&#x8981;DISTINCT&#x6216;&#x8005;GROUP BY&#x8BED;&#x53E5;.</li>
<li><ul>
<li>&#x5728;&#x975E;&#x8303;&#x5F0F;&#x5316;&#x7684;&#x7ED3;&#x6784;&#x4E2D;&#x5FC5;&#x987B;&#x4F7F;&#x7528;DISTINCT&#x6216;&#x8005;GROUP BY&#x624D;&#x80FD;&#x83B7;&#x5F97;&#x4E00;&#x4EFD;&#x552F;&#x4E00;&#x7684;&#x90E8;&#x95E8;&#x5217;&#x8868;,&#x4F46;&#x662F;&#x5982;&#x679C;&#x90E8;&#x95E8;&#x662F;&#x4E00;&#x5F20;&#x5355;&#x72EC;&#x7684;&#x8868;,&#x5219;&#x53EA;&#x9700;&#x8981;&#x7B80;&#x5355;&#x7684;&#x67E5;&#x8BE2;&#x8FD9;&#x5F20;&#x8868;&#x5C31;&#x884C;&#x4E86;.</li>
</ul>
</li>
</ul>
<blockquote>
<p>&#x8303;&#x5F0F;&#x5316;&#x8BBE;&#x8BA1;&#x7684;schema&#x7684;&#x7F3A;&#x70B9;&#x662F;&#x901A;&#x5E38;&#x9700;&#x8981;&#x5173;&#x8054;. &#x7A0D;&#x5FAE;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x5728;&#x7B26;&#x5408;&#x8303;&#x5F0F;&#x7684;schema&#x4E0A;&#x90FD;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x81F3;&#x5C11;&#x4E00;&#x6B21;&#x5173;&#x8054;,&#x4E5F;&#x8BB8;&#x66F4;&#x591A;. &#x8FD9;&#x4E0D;&#x4F46;&#x4EE3;&#x4EF7;&#x6602;&#x8D35;,&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x4E00;&#x4E9B;&#x7D22;&#x5F15;&#x7B56;&#x7565;&#x65E0;&#x6548;. &#x4F8B;&#x5982;,&#x8303;&#x5F0F;&#x5316;&#x53EF;&#x80FD;&#x952E;&#x5217;&#x5B58;&#x653E;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x8868;&#x4E2D;,&#x800C;&#x8FD9;&#x4E9B;&#x5217;&#x5982;&#x679C;&#x5728;&#x4E00;&#x4E2A;&#x8868;&#x4E2D;&#x5954;&#x53EF;&#x4EE5;&#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;.</p>
</blockquote>
<h3 id="4-3-2-&#x53CD;&#x8303;&#x5F0F;&#x7684;&#x4F18;&#x70B9;&#x548C;&#x7F3A;&#x70B9;">4.3.2. 4.3.2 &#x53CD;&#x8303;&#x5F0F;&#x7684;&#x4F18;&#x70B9;&#x548C;&#x7F3A;&#x70B9;</h3><blockquote>
<p>&#x53CD;&#x8303;&#x5F0F;&#x5316;&#x7684;schema&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x6570;&#x636E;&#x90FD;&#x5728;&#x4E00;&#x5F20;&#x8868;,&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x907F;&#x514D;&#x5173;&#x8054;.&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x5173;&#x8054;&#x8868;,&#x5219;&#x5BF9;&#x5927;&#x90E8;&#x5206;&#x67E5;&#x8BE2;&#x6700;&#x5DEE;&#x7684;&#x60C5;&#x51B5;&#x2014;&#x53CA;&#x65F6;&#x8868;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x2014;&#x65F6;&#x6743;&#x6807;&#x626B;&#x63CF;. &#x5F53;&#x6570;&#x636E;&#x6BD4;&#x5185;&#x5B58;&#x5927;&#x65F6;&#x8FD9;&#x53EF;&#x80FD;&#x6BD4;&#x5173;&#x8054;&#x8981;&#x5FEB;&#x7684;&#x591A;,&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x907F;&#x514D;&#x4E86;&#x968F;&#x673A;I/O.</p>
</blockquote>
<h3 id="4-3-3-&#x6DF7;&#x7528;&#x8303;&#x5F0F;&#x5316;&#x548C;&#x53CD;&#x8303;&#x5F0F;&#x5316;">4.3.3. 4.3.3 &#x6DF7;&#x7528;&#x8303;&#x5F0F;&#x5316;&#x548C;&#x53CD;&#x8303;&#x5F0F;&#x5316;</h3><blockquote>
<p>&#x5B8C;&#x5168;&#x7684;&#x8303;&#x5F0F;&#x5316;&#x548C;&#x5B8C;&#x5168;&#x7684;&#x53CD;&#x8303;&#x5F0F;&#x5316;schema&#x90FD;&#x662F;&#x5B9E;&#x9A8C;&#x5BA4;&#x91CC;&#x624D;&#x6709;&#x7684;&#x4E1C;&#x897F;: &#x5728;&#x771F;&#x5B9E;&#x4E16;&#x754C;&#x4E2D;&#x5F88;&#x5C11;&#x4F1A;&#x8FD9;&#x4E48;&#x6781;&#x7AEF;&#x5730;&#x4F7F;&#x7528;. &#x5728;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x4E2D;&#x7ECF;&#x5E38;&#x9700;&#x8981;&#x6DF7;&#x7528;,&#x53EF;&#x80FD;&#x4F7F;&#x7528;&#x90E8;&#x5206;&#x8303;&#x5F0F;&#x5316;&#x7684;schema.&#x7F13;&#x5B58;&#x8868;,&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x6280;&#x5DE7;.</p>
</blockquote>
<h2 id="4-4-&#x7F13;&#x5B58;&#x8868;&#x548C;&#x6C47;&#x603B;&#x8868;">4.4. 4.4 &#x7F13;&#x5B58;&#x8868;&#x548C;&#x6C47;&#x603B;&#x8868;</h2><blockquote>
<p>&#x6709;&#x65F6;&#x63D0;&#x5347;&#x6027;&#x80FD;&#x6700;&#x597D;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x540C;&#x4E00;&#x5F20;&#x8868;&#x4E2D;&#x4FDD;&#x5B58;&#x884D;&#x751F;&#x7684;&#x5197;&#x4F59;&#x6570;&#x636E;. &#x7136;&#x800C;,&#x6709;&#x65F6;&#x4E5F;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x5F20;&#x5B8C;&#x5168;&#x72EC;&#x7ACB;&#x7684;&#x6C47;&#x603B;&#x8868;&#x6216;&#x7F13;&#x5B58;&#x8868;.</p>
</blockquote>
<ul>
<li>&#x7F13;&#x5B58;&#x8868;</li>
<li><ul>
<li>&#x8868;&#x793A;&#x5B58;&#x50A8;&#x90A3;&#x4E9B;&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x5730;&#x4ECE;schema&#x5176;&#x4ED6;&#x8868;&#x83B7;&#x53D6;(&#x4F46;&#x662F;&#x6BCF;&#x6B21;&#x83B7;&#x53D6;&#x7684;&#x901F;&#x5EA6;&#x6BD4;&#x8F83;&#x6162;)&#x6570;&#x636E;&#x7684;&#x8868;</li>
</ul>
</li>
<li>&#x6C47;&#x603B;&#x8868;</li>
<li><ul>
<li>&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x4F7F;&#x7528;GROUP BY&#x8BED;&#x53E5;&#x805A;&#x5408;&#x6570;&#x636E;&#x7684;&#x8868;,&#x4E5F;&#x6709;&#x4EBA;&#x4F7F;&#x7528;&#x672F;&#x8BED;&#x201D;&#x7D2F;&#x8BA1;&#x8868;&#x201D;.</li>
</ul>
</li>
<li>&#x4EE5;&#x7F51;&#x7AD9;&#x4E3A;&#x4F8B;,&#x5047;&#x8BBE;&#x9700;&#x8981;&#x673A;&#x9009;24&#x5C0F;&#x65F6;&#x5185;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x6570;. &#x5728;&#x4E00;&#x4E2A;&#x5F88;&#x7E41;&#x5FD9;&#x7684;&#x7F51;&#x7AD9;&#x4E0D;&#x53EF;&#x80FD;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x5B9E;&#x65F6;&#x7CBE;&#x786E;&#x7684;&#x8BA1;&#x6570;&#x5668;. &#x4F5C;&#x4E3A;&#x66FF;&#x4EE3;&#x65B9;&#x6848;,&#x4E5F;&#x5DF2;&#x6BCF;&#x5C0F;&#x65F6;&#x751F;&#x6210;&#x4E00;&#x5F20;&#x6C47;&#x603B;&#x8868;. &#x8FD9;&#x6837;&#x4E5F;&#x8BB8;&#x4E00;&#x6761;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x67E5;&#x8BE2;&#x5C31;&#x53EF;&#x4EE5;&#x505A;&#x5230;,&#x5E76;&#x4E14;&#x6BD4;&#x5B9E;&#x65F6;&#x7EF4;&#x62A4;&#x8BA1;&#x6570;&#x5668;&#x8981;&#x9AD8;&#x6548;&#x5F97;&#x591A;.&#x7F3A;&#x70B9;&#x662F;&#x8BA1;&#x6570;&#x5668;&#x5E76;&#x4E0D;&#x662F;100%&#x7684;&#x7CBE;&#x786E;.</li>
<li>&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x9009;&#x62E9;&#x662F;: &#x4EE5;&#x6BCF;&#x5C0F;&#x65F6;&#x6C47;&#x603B;&#x8868;&#x4E3A;&#x57FA;&#x7840;,&#x628A;&#x524D;23&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x5C0F;&#x65F6;&#x7684;&#x7EDF;&#x8BA1;&#x8868;&#x7684;&#x8BA1;&#x6570;&#x5168;&#x90E8;&#x52A0;&#x8D77;&#x6765;,&#x6700;&#x540E;&#x518D;&#x52A0;&#x4E0A;&#x5F00;&#x59CB;&#x9636;&#x6BB5;&#x548C;&#x7ED3;&#x675F;&#x9636;&#x6BB5;&#x4E0D;&#x5B8C;&#x6574;&#x7684;&#x5C0F;&#x65F6;&#x5185;&#x7684;&#x6280;&#x672F;.&#x5047;&#x8BBE;&#x7EDF;&#x8BA1;&#x8868;&#x4E3A;msg_per_hr</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> msg_per_hr(</span><br><span class="line">    hr DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    cnt <span class="type">INT</span> UNSIGEND <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span>(hr)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5427;&#x4E0B;&#x9762;&#x7684;&#x4E09;&#x4E2A;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x679C;&#x52A0;&#x8D77;&#x6765;,&#x5F97;&#x5230;&#x8FC7;&#x53BB;24&#x5C0F;&#x65F6;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7684;&#x603B;&#x6570;.&#x6211;&#x4EEC;&#x4F7F;&#x7528;LEFT(NOW(),14)&#x6765;&#x83B7;&#x5F97;&#x5F53;&#x524D;&#x7684;&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x6700;&#x63A5;&#x8FD1;&#x7684;&#x5C0F;&#x65F6;:</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">&#x73B0;&#x5728;<span class="number">1</span>:<span class="number">30</span></span><br><span class="line">&#x6628;&#x5929;<span class="number">2</span>&#x70B9;&#x5230;&#x4ECA;&#x5929;<span class="number">0</span>&#x70B9;&#x603B;&#x6B21;&#x6570;</span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> SUM(cnt) <span class="keyword">FROM</span> msg_per_hr <span class="keyword">WHERE</span> hr <span class="keyword">BETWEEN</span>      </span><br><span class="line">    CONCAT(LEFT(NOW(), <span class="number">14</span>),<span class="string">&apos;00:00&apos;</span>) - <span class="type">INTERVAL</span> <span class="number">23</span> HOUR </span><br><span class="line">    <span class="keyword">AND</span> CONCAT(LEFT(NOW(), <span class="number">14</span>),<span class="string">&apos;00:00&apos;</span>) - <span class="type">INTERVAL</span> <span class="number">1</span> HOUR;</span><br><span class="line">&#x6628;&#x5929;<span class="number">1</span>:<span class="number">30</span>&#x5230;&#x51CC;&#x6668;<span class="number">2</span>&#x70B9;</span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> COUNT(*) <span class="keyword">FROM</span> message</span><br><span class="line">    <span class="keyword">WHERE</span> posted &gt;= NOW() - <span class="type">INTERVAL</span> <span class="number">24</span> HOUR</span><br><span class="line">    <span class="keyword">AND</span> posted &lt; CONCAT(LEFT(NOW(), <span class="number">14</span>),<span class="string">&apos;00:00&apos;</span>) - <span class="type">INTERVAL</span> <span class="number">23</span> HOUR;</span><br><span class="line">&#x4ECA;&#x5929;<span class="number">1</span>&#x70B9;&#x5230;&#x73B0;&#x5728;</span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> COUNT(*) <span class="keyword">FROM</span> message</span><br><span class="line">    <span class="keyword">WHERE</span> posted &gt;= CONCAT(LEFT(NOW(), <span class="number">14</span>),<span class="string">&apos;00:00&apos;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x4E0D;&#x7BA1;&#x662F;&#x54EA;&#x79CD;&#x65B9;&#x6CD5;&#x2014;&#x4E0D;&#x4E25;&#x683C;&#x7684;&#x6280;&#x672F;&#x6216;&#x8005;&#x901A;&#x8FC7;&#x5C0F;&#x8303;&#x56F4;&#x67E5;&#x8BE2;&#x586B;&#x6EE1;&#x7B80;&#x5199;&#x7684;&#x4E25;&#x683C;&#x6280;&#x672F;&#x90FD;&#x6BD4;&#x76F4;&#x63A5;&#x8BA1;&#x7B97;message&#x8868;&#x6240;&#x6709;&#x884C;&#x8981;&#x6709;&#x6548;&#x7684;&#x591A;.&#x8FD9;&#x662F;&#x5EFA;&#x7ACB;&#x6C47;&#x603B;&#x8868;&#x7684;&#x5173;&#x952E;&#x539F;&#x56E0;.</li>
<li>&#x7F13;&#x5B58;&#x8868;&#x6B63;&#x597D;&#x76F8;&#x53CD;,&#x5176;&#x5BF9;&#x4F18;&#x5316;&#x641C;&#x7D22;&#x548C;&#x68C0;&#x7D22;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x5F88;&#x6709;&#x6548;.</li>
<li>&#x7F13;&#x5B58;&#x8868;&#x53EF;&#x80FD;&#x4F1A;&#x9700;&#x8981;&#x5F88;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x7D22;&#x5F15;&#x7EC4;&#x5408;&#x6765;&#x52A0;&#x901F;&#x5404;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x67E5;&#x8BE2;. &#x8FD9;&#x4E9B;&#x77DB;&#x76FE;&#x7684;&#x9700;&#x6C42;&#x6709;&#x65F6;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x5F20;&#x53EA;&#x5305;&#x542B;&#x4E3B;&#x8868;&#x4E2D;&#x90E8;&#x5206;&#x5217;&#x7684;&#x7F13;&#x5B58;&#x8868;. &#x4E00;&#x4E2A;&#x6709;&#x7528;&#x7684;&#x6280;&#x5DE7;&#x662F;&#x5BF9;&#x7F13;&#x5B58;&#x8868;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x5F15;&#x64CE;.</li>
<li><ul>
<li>&#x5982;&#x679C;&#x4E3B;&#x8868;&#x4F7F;&#x7528;InnoDB,&#x7528;MyISAM&#x4F5C;&#x4E3A;&#x7F13;&#x5B58;&#x8868;&#x7684;&#x5F15;&#x64CE;&#x5C06;&#x4F1A;&#x5F97;&#x5230;&#x66F4;&#x5C0F;&#x7684;&#x7D22;&#x5F15;&#x5360;&#x7528;&#x7A7A;&#x95F4;,&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x505A;&#x5168;&#x6587;&#x641C;&#x7D22;. </li>
</ul>
</li>
<li><ul>
<li>&#x6709;&#x65F6;&#x751A;&#x81F3;&#x60F3;&#x628A;&#x6574;&#x4E2A;&#x8868;&#x5BFC;&#x51FA;MySQL,&#x63D2;&#x5165;&#x5230;&#x4E13;&#x95E8;&#x7684;&#x641C;&#x7D22;&#x7CFB;&#x7EDF;&#x4E2D;&#x83B7;&#x5F97;&#x66F4;&#x9AD8;&#x7684;&#x641C;&#x7D22;&#x6548;&#x7387;,&#x4F8B;&#x5982;LUCENE&#x6216;&#x8005;Sphinx&#x641C;&#x7D22;&#x5F15;&#x64CE;.</li>
</ul>
</li>
<li>&#x5F53;&#x91CD;&#x5EFA;&#x6C47;&#x603B;&#x8868;&#x548C;&#x7F13;&#x5B58;&#x8868;&#x65F6;,&#x901A;&#x5E38;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x5728;&#x64CD;&#x4F5C;&#x65F6;&#x4F9D;&#x7136;&#x53EF;&#x7528;. &#x8FD9;&#x5C31;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x201D;&#x5F71;&#x5B50;&#x8868;&#x201D;&#x6765;&#x5B9E;&#x73B0;,&#x201D;&#x5F71;&#x5B50;&#x8868;&#x201D;&#x6307;&#x7684;&#x662F;&#x4E00;&#x5F20;&#x771F;&#x5B9E;&#x8868;&#x201D;&#x80CC;&#x540E;&#x201D;&#x521B;&#x5EFA;&#x7684;&#x8868;. &#x5F53;&#x5B8C;&#x6210;&#x5EFA;&#x8868;&#x64CD;&#x4F5C;&#x540E;,&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x539F;&#x5B50;&#x7684;&#x91CD;&#x547D;&#x540D;&#x64CD;&#x4F5C;&#x5207;&#x6362;&#x5F71;&#x5B50;&#x8868;&#x548C;&#x539F;&#x8868;. </li>
<li><ul>
<li>&#x4F8B;&#x5982;&#x5982;&#x679C;&#x9700;&#x8981;&#x91CD;&#x5EFA;my_summary,&#x5219;&#x53EF;&#x4EE5;&#x5148;&#x521B;&#x5EFA;my_summary_new, &#x7136;&#x540E;&#x586B;&#x5145;&#x597D;&#x6570;&#x636E;,&#x6700;&#x540E;&#x548C;&#x771F;&#x5B9E;&#x8868;&#x5750;&#x5207;&#x6362;;</li>
</ul>
</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> my_summary_new, my_summary_old;</span><br><span class="line">mysql&gt; <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> my_summary_new <span class="keyword">LIKE</span> my_summary;</span><br><span class="line">mysql&gt; <span class="keyword">RENAME</span> <span class="keyword">TABLE</span> my_summary <span class="keyword">TO</span> my_summary_old, my_summary_new <span class="keyword">TO</span> my_summary;</span><br></pre></td></tr></table></figure>
<h3 id="4-4-1-&#x7269;&#x5316;&#x89C6;&#x56FE;">4.4.1. 4.4.1 &#x7269;&#x5316;&#x89C6;&#x56FE;</h3><blockquote>
<p>&#x7269;&#x5316;&#x89C6;&#x56FE;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x9884;&#x5148;&#x8BA1;&#x7B97;&#x5E76;&#x4E14;&#x5B58;&#x50A8;&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x7684;&#x8868;,&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x7B56;&#x7565;&#x5237;&#x65B0;&#x548C;&#x66F4;&#x65B0;. MySQL&#x5E76;&#x4E0D;&#x539F;&#x751F;&#x652F;&#x6301;&#x7269;&#x5316;&#x89C6;&#x56FE;. &#x7136;&#x800C;,&#x4F7F;&#x7528;Justin Swanhart&#x7684;&#x5F00;&#x6E90;&#x5DE5;&#x5177;Flexviews,&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7269;&#x5316;&#x89C6;&#x56FE;. Flexviews&#x6BD4;&#x5B8C;&#x5168;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x8981;&#x7CBE;&#x7EC6;,&#x5E76;&#x4E14;&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;&#x4E0D;&#x9519;&#x7684;&#x529F;&#x80FD;&#x4F7F;&#x5F97;&#x53EF;&#x4EE5;&#x66F4;&#x7B80;&#x5355;&#x5730;&#x521B;&#x5EFA;&#x548C;&#x7EF4;&#x62A4;&#x7269;&#x5316;&#x89C6;&#x56FE;. &#x5B83;&#x7531;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;&#x90E8;&#x5206;&#x7EC4;&#x6210;: </p>
</blockquote>
<ul>
<li>&#x53D8;&#x66F4;&#x6570;&#x636E;&#x6293;&#x53D6;(Change Date Capture CDC)&#x529F;&#x80FD;,&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;&#x800C;&#x4E14;&#x89E3;&#x6790;&#x76F8;&#x5173;&#x884C;&#x7684;&#x53D8;&#x66F4;.</li>
<li>&#x4E00;&#x7CFB;&#x5217;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x521B;&#x5EFA;&#x548C;&#x7BA1;&#x7406;&#x89C6;&#x56FE;&#x7684;&#x5B9A;&#x4E49;&#x7684;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;.</li>
<li>&#x4E00;&#x4E9B;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x53D8;&#x66F4;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x7269;&#x5316;&#x89C6;&#x56FE;&#x7684;&#x5DE5;&#x5177;.</li>
</ul>
<h3 id="4-4-2-&#x8BA1;&#x6570;&#x5668;&#x8868;">4.4.2. 4.4.2 &#x8BA1;&#x6570;&#x5668;&#x8868;</h3><blockquote>
<p>&#x5982;&#x679C;&#x5E94;&#x7528;&#x5728;&#x8868;&#x4E2D;&#x4FDD;&#x5B58;&#x8BA1;&#x6570;&#x5668;,&#x5219;&#x5728;&#x66F4;&#x65B0;&#x8BA1;&#x6570;&#x5668;&#x65F6;&#x53EF;&#x80FD;&#x78B0;&#x5230;&#x5E76;&#x53D1;&#x95EE;&#x9898;. &#x8BA1;&#x6570;&#x5668;&#x8868;&#x5728;Web&#x5E94;&#x7528;&#x4E2D;&#x5F88;&#x5E38;&#x89C1;. &#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x79CD;&#x8868;&#x7F13;&#x5B58;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x670B;&#x53CB;&#x6570;.&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;&#x6B21;&#x6570;&#x7B49;. &#x521B;&#x5EFA;&#x4E00;&#x5F20;&#x72EC;&#x7ACB;&#x7684;&#x8868;&#x5B58;&#x50A8;&#x8BA1;&#x6570;&#x5668;&#x53EF;&#x4EE5;&#x4F7F;&#x8BA1;&#x6570;&#x5668;&#x8868;&#x5C0F;&#x4E14;&#x5FEB;. &#x4F7F;&#x7528;&#x72EC;&#x7ACB;&#x7684;&#x8868;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x907F;&#x514D;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x5931;&#x8D25;,&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E9B;&#x9AD8;&#x7EA7;&#x6280;&#x5DE7;.</p>
</blockquote>
<ul>
<li>&#x8BA1;&#x6570;&#x5668;&#x8868;<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> hit_counter(</span><br><span class="line">    cnt <span class="built_in">int</span> <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> </span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure></li>
<li>&#x7F51;&#x7AD9;&#x7684;&#x6BCF;&#x6B21;&#x70B9;&#x51FB;&#x90FD;&#x4F1A;&#x5BFC;&#x81F4;&#x5BF9;&#x8BA1;&#x6570;&#x5668;&#x8FDB;&#x884C;&#x66F4;&#x65B0;:</li>
</ul>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">UPDATE hit_counter <span class="keyword">SET</span> cnt <span class="comment">= cnt + 1</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x95EE;&#x9898;&#x5728;&#x4E8E;,&#x5BF9;&#x4E8E;&#x4EFB;&#x4F55;&#x60F3;&#x8981;&#x66F4;&#x65B0;&#x8FD9;&#x4E00;&#x884C;&#x7684;&#x4E8B;&#x52A1;&#x6765;&#x8BF4;,&#x8FD9;&#x6761;&#x8BB0;&#x5F55;&#x4E0A;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x7684;&#x4E92;&#x65A5;&#x9501;(mutex). &#x8FD9;&#x4F1A;&#x4F7F;&#x5F97;&#x8FD9;&#x4E9B;&#x4E8B;&#x52A1;&#x53EA;&#x80FD;&#x4E32;&#x884C;&#x6267;&#x884C;. &#x8981;&#x6D3B;&#x7684;&#x66F4;&#x9AD8;&#x7684;&#x5E76;&#x53D1;&#x66F4;&#x65B0;&#x6027;&#x80FD;,&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x8BA1;&#x6570;&#x5668;&#x4FDD;&#x5B58;&#x5728;&#x591A;&#x884C;&#x4E2D;,&#x6BCF;&#x6B21;&#x968F;&#x673A;&#x9009;&#x62E9;&#x4E00;&#x884C;&#x8FDB;&#x884C;&#x66F4;&#x65B0;. &#x8FD9;&#x6837;&#x9700;&#x8981;&#x5BF9;&#x8BA1;&#x6570;&#x5668;&#x8868;&#x8FDB;&#x884C;&#x5982;&#x4E0B;&#x4FEE;&#x6539;;</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> hit_counter(</span><br><span class="line">    slot <span class="built_in">tinyint</span> <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span>,</span><br><span class="line">    cnt <span class="built_in">int</span> <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> </span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x5728;&#x8FD9;&#x5F20;&#x8868;&#x589E;&#x52A0;100&#x884C;&#x6570;&#x636E;. &#x73B0;&#x5728;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x7684;&#x69FD;(slot)&#x8FDB;&#x884C;&#x66F4;&#x65B0;:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> hit_counter <span class="keyword">SET</span> cnt = cnt + <span class="number">1</span> <span class="keyword">WHERE</span> slot = <span class="keyword">RAND</span>() * <span class="number">100</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x8981;&#x6D3B;&#x7684;&#x7EDF;&#x8BA1;&#x7ED3;&#x679C;,&#x9700;&#x8981;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x805A;&#x5408;&#x67E5;&#x8BE2;:</li>
</ul>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(cnt) <span class="keyword">FROM</span> hit_counter;</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x9700;&#x6C42;&#x662F;&#x6BCF;&#x9694;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5F00;&#x59CB;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8BA1;&#x6570;&#x5668;(&#x4F8B;&#x5982;,&#x6BCF;&#x5929;&#x4E00;&#x4E2A;). &#x5982;&#x679C;&#x9700;&#x8981;&#x8FD9;&#x4E48;&#x505A;,&#x5219;&#x53EF;&#x4EE5;&#x518D;&#x7B80;&#x5355;&#x5730;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#x8868;&#x8BBE;&#x8BA1;:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> daily_hit_counter(</span><br><span class="line">    <span class="keyword">day</span> <span class="built_in">date</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    slot <span class="built_in">tinyint</span> <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    cnt <span class="built_in">int</span> <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> ,</span><br><span class="line">    primary <span class="keyword">key</span>(<span class="keyword">day</span>, slot)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x5728;&#x8FD9;&#x4E2A;&#x573A;&#x666F;&#x4E2D;,&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x50CF;&#x524D;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x90A3;&#x6837;&#x9884;&#x5148;&#x751F;&#x6210;&#x884C;,&#x800C;&#x7528;ON DUPLICATE KEY UPDATE&#x4EE3;&#x66FF;:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> daily_hit_counter(<span class="keyword">day</span>, slot, cnt)</span><br><span class="line">    <span class="keyword">VALUES</span>(<span class="keyword">CURRENT_DATE</span>, <span class="keyword">RAND</span>()*<span class="number">100</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> cnt = cnt + <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x5982;&#x679C;&#x5E0C;&#x671B;&#x51CF;&#x5C11;&#x8868;&#x7684;&#x884C;&#x6570;,&#x4EE5;&#x907F;&#x514D;&#x8868;&#x53D8;&#x5F97;&#x592A;&#x5927;,&#x53EF;&#x4EE5;&#x5199;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;,&#x5408;&#x5E76;&#x6240;&#x6709;&#x7ED3;&#x679C;&#x5230;0&#x53F7;&#x69FD;,&#x5E76;&#x4E14;&#x5220;&#x9664;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x69FD;:</li>
</ul>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"><span class="meta">x</span>&#x8868;&#x4E2D;day&#x88AB;<span class="meta">group</span> <span class="meta">by</span>&#x4E86;&#x6240;&#x4EE5;&#x6BCF;&#x5929;&#x7684;&#x4E1C;&#x897F;&#x88AB;&#x6C47;&#x603B;,&#x6BD4;&#x5982;&#x4ECA;&#x5929;&#x5C31;&#x53EA;&#x6709;&#x4E00;&#x6761;&#x6570;&#x636E;,&#x4EE5;&#x4ECA;&#x5929;&#x4E3A;&#x4F8B;&#x548C;c&#x8868;&#x8FDB;&#x884C;&#x5173;&#x8054;&#x540E;,&#x5173;&#x8054;&#x8BED;&#x53E5;&#x4E3A;day&#x76F8;&#x540C;,&#x90A3;&#x4E48;<span class="meta">x</span>&#x8868;&#x7684;&#x4ECA;&#x5929;&#x7684;&#x6570;&#x636E;&#x4F1A;&#x548C;c&#x8868;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x4ECA;&#x5929;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x5408;&#x6210;&#x4E00;&#x6761;&#x65B0;&#x7684;&#x6570;&#x636E;. </span><br><span class="line">&#x7136;&#x540E;<span class="meta">set</span> , &#x5982;&#x679C;&#x69FD;&#x4F4D;&#x76F8;&#x540C;&#x4E5F;&#x5C31;&#x662F;0; &#x90A3;&#x4E48;c&#x8868;&#x4E2D;&#x7684;cnt&#x4F1A;&#x53D8;&#x4E3A;<span class="meta">x</span>&#x8868;&#x7684;cnt,&#x540C;&#x65F6;slot&#x4F1A;&#x53D8;&#x4E3A;0,         &#x5426;&#x5219;cnt&#x53D8;&#x4E3A;0,&#x69FD;&#x4F4D;&#x8FD8;&#x662F;&#x539F;&#x6765;&#x7684;&#x69FD;&#x4F4D;.</span><br><span class="line">&#x6709;&#x4E24;&#x6761;<span class="meta">set</span>&#x5E76;&#x4E14;&#x90FD;&#x6709;<span class="meta">if</span>&#x662F;&#x56E0;&#x4E3A;&#x6015;&#x8868;&#x4E2D;&#x6CA1;&#x6709;slot=0,&#x90A3;&#x4E48;&#x4E45;&#x5C06;&#x6700;&#x5C0F;&#x7684;&#x90A3;&#x4E2A;slot&#x8D4B;&#x503C;&#x4E3A;0</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">UPDATE</span> daily_hit_counter ad c</span><br><span class="line">    INNER JO<span class="meta">IN(</span></span><br><span class="line">        <span class="meta">SELECT</span> day,<span class="meta"> SUM(</span>cnt) <span class="meta">AS</span> cnt,<span class="meta"> MIN(</span>slot) <span class="meta">AS</span> mslot</span><br><span class="line">        <span class="meta">FROM</span> daily_hit_counter</span><br><span class="line">        <span class="meta">GROUP</span> <span class="meta">BY</span> day</span><br><span class="line">    ) <span class="meta">AS</span> <span class="meta">x</span> USING(day)</span><br><span class="line"><span class="meta">SET</span> c.cnt = <span class="meta">IF</span>(c.slot = <span class="meta">x</span>.mslot, <span class="meta">x</span>.cnt, 0),</span><br><span class="line">    c.slot = <span class="meta">IF</span>(c.slot = <span class="meta">x</span>.mslot, 0, c.slot);</span><br><span class="line">    </span><br><span class="line"><span class="meta">DELETE</span> <span class="meta">FROM</span> daily_hit_counter <span class="meta">WHERE</span> slot &lt;&gt; 0 <span class="meta">AND</span> cnt = 0;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>&#x66F4;&#x5FEB;&#x5730;&#x8BFB;,&#x66F4;&#x6162;&#x5730;&#x5199;</strong> &#x4E3A;&#x4E86;&#x63D0;&#x5347;&#x67E5;&#x8BE2;&#x7684;&#x901F;&#x5EA6;,&#x7ECF;&#x5E38;&#x4F1A;&#x9700;&#x8981;&#x5EFA;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7D22;&#x5F15;,&#x589E;&#x52A0;&#x5197;&#x4F59;&#x5217;,&#x751A;&#x81F3;&#x662F;&#x521B;&#x5EFA;&#x7F13;&#x5B58;&#x8868;&#x548C;&#x6C47;&#x603B;&#x8868;. &#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x4F1A;&#x589E;&#x52A0;&#x5199;&#x67E5;&#x8BE2;&#x7684;&#x8D1F;&#x62C5;,&#x4E5F;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x7EF4;&#x62A4;&#x4EFB;&#x52A1;,&#x4F46;&#x5728;&#x8BBE;&#x8BA1;&#x9AD8;&#x6027;&#x80FD;&#x6570;&#x636E;&#x5E93;&#x65F6;,&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x5E38;&#x89C1;&#x7684;&#x6280;&#x5DE7;: &#x867D;&#x7136;&#x5199;&#x64CD;&#x4F5C;&#x53D8;&#x5F97;&#x66F4;&#x6162;&#x4E86;,&#x4F46;&#x66F4;&#x663E;&#x8457;&#x5730;&#x63D0;&#x9AD8;&#x4E86;&#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x6027;&#x80FD;.<br>&#x7136;&#x800C;,&#x5199;&#x64CD;&#x4F5C;&#x53D8;&#x6162;&#x5E76;&#x4E0D;&#x662F;&#x8BFB;&#x64CD;&#x4F5C;&#x53D8;&#x5F97;&#x66F4;&#x5FEB;&#x6240;&#x4ED8;&#x51FA;&#x7684;&#x552F;&#x4E00;&#x4EE3;&#x4EF7;,&#x8FD8;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x589E;&#x52A0;&#x4E86;&#x8BFB;&#x64CD;&#x4F5C;&#x548C;&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x5F00;&#x53D1;&#x96BE;&#x5EA6;.</p>
</blockquote>
<h2 id="4-5-&#x52A0;&#x5FEB;ALTER-TABLE&#x64CD;&#x4F5C;&#x7684;&#x901F;&#x5EA6;">4.5. 4.5 &#x52A0;&#x5FEB;ALTER TABLE&#x64CD;&#x4F5C;&#x7684;&#x901F;&#x5EA6;</h2><blockquote>
<p>MySQL&#x6267;&#x884C;&#x5927;&#x90E8;&#x5206;&#x4FEE;&#x6539;&#x8868;&#x7ED3;&#x6784;&#x64CD;&#x4F5C;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x7528;&#x65B0;&#x7684;&#x7ED3;&#x6784;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7A7A;&#x8868;,&#x4ECE;&#x65E7;&#x8868;&#x4E2D;&#x67E5;&#x51FA;&#x6240;&#x6709;&#x6570;&#x636E;&#x63D2;&#x5165;&#x65B0;&#x8868;,&#x7136;&#x540E;&#x5220;&#x9664;&#x65E7;&#x8868;.</p>
<blockquote>
<p>MySQL 5.1 &#x4EE5;&#x53CA;&#x66F4;&#x65B0;&#x7248;&#x672C;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x7C7B;&#x578B;&#x7684;&#x201D;&#x5728;&#x7EBF;&#x201D;&#x64CD;&#x4F5C;&#x7684;&#x652F;&#x6301;,&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x6574;&#x4E2A;&#x64CD;&#x4F5C;&#x8FC7;&#x7A0B;&#x4E2D;&#x9501;&#x8868;.&#x6700;&#x8FD1;&#x7248;&#x672C;&#x7684;InnoDB&#x4E5F;&#x652F;&#x6301;&#x901A;&#x8FC7;&#x6392;&#x5E8F;&#x6765;&#x521B;&#x5EFA;&#x7D22;&#x5F15;,&#x8FD9;&#x4F7F;&#x5F97;&#x5EFA;&#x7D22;&#x5F15;&#x66F4;&#x5FEB;&#x5E76;&#x4E14;&#x6709;&#x4E00;&#x4E2A;&#x7D27;&#x51D1;&#x7684;&#x7D22;&#x5F15;&#x5E03;&#x5C40;.</p>
</blockquote>
</blockquote>
<ul>
<li>&#x4FEE;&#x6539;&#x8868;&#x7ED3;&#x6784;</li>
<li><ul>
<li>&#x73B0;&#x5728;&#x4E00;&#x53F0;&#x4E0D;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x673A;&#x5668;&#x4E0A;&#x6267;&#x884C;ALTER TABLE&#x64CD;&#x4F5C;,&#x7136;&#x540E;&#x548C;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x4E3B;&#x5E93;&#x8FDB;&#x884C;&#x5207;&#x6362;</li>
</ul>
</li>
<li><ul>
<li>&#x5F71;&#x5B50;&#x62F7;&#x8D1D;&#x2014;&#x7528;&#x8981;&#x6C42;&#x7684;&#x8868;&#x7ED3;&#x6784;&#x521B;&#x5EFA;&#x4E00;&#x5F20;&#x548C;&#x6E90;&#x8868;&#x65E0;&#x5173;&#x7684;&#x65B0;&#x8868;,&#x7136;&#x540E;&#x901A;&#x8FC7;&#x91CD;&#x547D;&#x540D;&#x548C;&#x5220;&#x8868;&#x64CD;&#x4F5C;&#x4EA4;&#x6362;&#x4E24;&#x5F20;&#x8868;.&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5B8C;&#x6210;&#x5F71;&#x5B50;&#x62F7;&#x8D1D;&#x5DE5;&#x4F5C;:Facebook&#x6570;&#x636E;&#x5E93;&#x8FD0;&#x7EF4;&#x56E2;&#x961F;&#x7684;&#x201D;online schema change&#x201D;&#x5DE5;&#x5177;.</li>
</ul>
</li>
<li>&#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684;ALTER TABLE &#x64CD;&#x4F5C;&#x90FD;&#x4F1A;&#x5F15;&#x8D77;&#x8868;&#x91CD;&#x5EFA;. &#x4F8B;&#x5982;,&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x6216;&#x8005;&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x5217;&#x7684;&#x9ED8;&#x8BA4;&#x503C;</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># &#x6162;&#x7684;&#x65B9;&#x5F0F;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> sakila.film </span><br><span class="line"><span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> rental_duration <span class="built_in">TINYINT</span>(<span class="number">3</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">//<span class="keyword">SHOW</span> <span class="keyword">STATUS</span>&#x663E;&#x793A;&#x8FD9;&#x4E2A;&#x8BED;&#x53E5;&#x505A;&#x4E86;<span class="number">1000</span>&#x6B64;&#x8BFB;&#x548C;<span class="number">1000</span>&#x6B64;&#x63D2;&#x5165;&#x64CD;&#x4F5C;. </span><br><span class="line">//&#x6362;&#x53E5;&#x8BDD;&#x8BF4;,&#x5B83;&#x62F7;&#x8D1D;&#x4E86;&#x6574;&#x5F20;&#x8868;&#x5230;&#x4E00;&#x5F20;&#x65B0;&#x7684;&#x8868;,&#x751A;&#x81F3;&#x5217;&#x7684;&#x64CD;&#x4F5C;.&#x5927;&#x5C0F;&#x548C;&#x53EF;&#x5426;&#x4E3A;<span class="literal">NULL</span>&#x5C5E;&#x6027;&#x90FD;&#x6CA1;&#x6539;&#x53D8;.</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x7406;&#x8BBA;&#x4E0A;,MySQL&#x53EF;&#x4EE5;&#x8DF3;&#x8FC7;&#x521B;&#x5EFA;&#x65B0;&#x8868;&#x7684;&#x6B65;&#x9AA4;. &#x5217;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x5B9E;&#x9645;&#x4E0A;&#x5B58;&#x5728;&#x8868;&#x7684;.frm&#x6587;&#x4EF6;&#x4E2D;,&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x6539;&#x52A8;&#x8868;&#x672C;&#x8EAB;.</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment"># &#x8FD9;&#x4E2A;&#x8BED;&#x53E5;&#x4F1A;&#x76F4;&#x63A5;&#x4FEE;&#x6539;.frm&#x6587;&#x4EF6;&#x800C;&#x4E0D;&#x8BBE;&#x8BA1;&#x8868;&#x6570;&#x636E;. &#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x662F;&#x975E;&#x5E38;&#x5FEB;&#x7684;</span></span><br><span class="line">ALTER TABLE sakila.film </span><br><span class="line">MODIFY COLUMN rental_duration <span class="builtin-name">SET</span><span class="built_in"> DEFAULT </span>5;</span><br></pre></td></tr></table></figure>
<h2 id="4-6-&#x603B;&#x7ED3;">4.6. 4.6 &#x603B;&#x7ED3;</h2><ul>
<li>&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x8FC7;&#x5EA6;&#x8BBE;&#x8BA1;,&#x4F8B;&#x5982;&#x4F1A;&#x5BFC;&#x81F4;&#x673A;&#x5668;&#x590D;&#x6742;&#x67E5;&#x8BE2;&#x7684;schema&#x8BBE;&#x8BA1;,&#x6216;&#x8005;&#x6709;&#x5F88;&#x591A;&#x5217;&#x7684;&#x8868;&#x8BBE;&#x8BA1;</li>
<li>&#x4F7F;&#x7528;&#x5C0F;&#x800C;&#x7B80;&#x5355;&#x7684;&#x5408;&#x9002;&#x6570;&#x636E;&#x7C7B;&#x578B;,&#x9664;&#x975E;&#x771F;&#x5B9E;&#x6570;&#x636E;&#x6A21;&#x578B;&#x4E2D;&#x6709;&#x786E;&#x5207;&#x7684;&#x9700;&#x8981;,&#x5426;&#x5219;&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x5730;&#x907F;&#x514D;&#x4F7F;&#x7528;NULL&#x503C;.</li>
<li>&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5B58;&#x50A8;&#x76F8;&#x4F3C;&#x6216;&#x76F8;&#x5173;&#x7684;&#x503C;,&#x5C24;&#x5176;&#x662F;&#x8981;&#x5728;&#x5173;&#x8054;&#x6761;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x5217;.</li>
<li>&#x6CE8;&#x610F;&#x53EF;&#x53D8;&#x957F;&#x5B57;&#x7B26;&#x4E32;,&#x5176;&#x5728;&#x4E34;&#x65F6;&#x8868;&#x548C;&#x6392;&#x5E8F;&#x65F6;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x60B2;&#x89C2;&#x7684;&#x6309;&#x6700;&#x5927;&#x957F;&#x5EA6;&#x5206;&#x914D;&#x5185;&#x5B58;.</li>
<li>&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x6574;&#x5F62;&#x5B9A;&#x4E49;&#x6807;&#x8BC6;&#x5217;.</li>
<li>&#x907F;&#x514D;&#x4F7F;&#x7528;MySQL&#x5DF2;&#x7ECF;&#x4E00;&#x8D77;&#x7684;&#x7279;&#x6027;,&#x4F8B;&#x5982;&#x6307;&#x5B9A;&#x6D6E;&#x70B9;&#x6570;&#x7684;&#x7CBE;&#x5EA6;,&#x6216;&#x8005;&#x6574;&#x6570;&#x7684;&#x663E;&#x793A;&#x5BBD;&#x5EA6;.</li>
<li>&#x5C0F;&#x5FC3;&#x4F7F;&#x7528;ENUM&#x548C;SET.&#x867D;&#x7136;&#x5B83;&#x4EEC;&#x7528;&#x8D77;&#x6765;&#x5F88;&#x65B9;&#x4FBF;,&#x4F46;&#x662F;&#x4E0D;&#x8981;&#x6EE5;&#x7528;,&#x5426;&#x5219;&#x6709;&#x65F6;&#x5019;&#x4F1A;&#x7F16;&#x7A0B;&#x9677;&#x9631;.&#x6700;&#x597D;&#x907F;&#x514D;&#x4F7F;&#x7528;BIT.</li>
</ul>
<blockquote>
<p>&#x8303;&#x5F0F;&#x662F;&#x597D;&#x7684;,&#x4F46;&#x662F;&#x53CD;&#x8303;&#x5F0F;&#x6709;&#x65F6;&#x4E5F;&#x662F;&#x5FC5;&#x9700;&#x7684;,&#x5E76;&#x4E14;&#x80FD;&#x5E26;&#x6765;&#x597D;&#x5904;.</p>
</blockquote>
<h1 id="&#x7B2C;&#x4E94;&#x7AE0;-&#x521B;&#x5EFA;&#x9AD8;&#x6027;&#x80FD;&#x7684;&#x7D22;&#x5F15;">5. &#x7B2C;&#x4E94;&#x7AE0; &#x521B;&#x5EFA;&#x9AD8;&#x6027;&#x80FD;&#x7684;&#x7D22;&#x5F15;</h1><blockquote>
<p>&#x7D22;&#x5F15;&#x65F6;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7528;&#x4E8E;&#x5FEB;&#x8BFB;&#x627E;&#x5230;&#x8BB0;&#x5F55;&#x7684;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x7ED3;&#x6784;.&#x7D22;&#x5F15;&#x5BF9;&#x4E8E;&#x826F;&#x597D;&#x7684;&#x6027;&#x80FD;&#x975E;&#x5E38;&#x5173;&#x952E;.&#x5C24;&#x5176;&#x662F;&#x5F53;&#x8868;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x91CF;&#x8D8A;&#x6765;&#x8D8A;&#x5927;&#x65F6;,&#x7D22;&#x5F15;&#x5BF9;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;&#x8BED;&#x6CD5;&#x91CD;&#x8981;.&#x5728;&#x6570;&#x636E;&#x91CF;&#x8F83;&#x5C0F;&#x4E14;&#x8D1F;&#x8F7D;&#x8F83;&#x4F4E;&#x65F6;,&#x4E0D;&#x6070;&#x5F53;&#x7684;&#x7D22;&#x5F15;&#x5BF9;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;&#x53EF;&#x80FD;&#x8FD8;&#x4E0D;&#x660E;&#x663E;,&#x4F46;&#x5F53;&#x6570;&#x636E;&#x91CF;&#x9010;&#x6E10;&#x589E;&#x5927;&#x65F6;,&#x6027;&#x80FD;&#x5219;&#x4F1A;&#x6025;&#x5267;&#x4E0B;&#x964D;.</p>
</blockquote>
<h2 id="5-1-&#x7D22;&#x5F15;&#x57FA;&#x7840;">5.1. 5.1 &#x7D22;&#x5F15;&#x57FA;&#x7840;</h2><blockquote>
<p>&#x5728;MySQL&#x4E2D;,&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x7528;&#x5148;&#x5728;&#x7D22;&#x5F15;&#x4E2D;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x503C;,&#x7136;&#x540E;&#x6839;&#x636E;&#x5339;&#x914D;&#x7684;&#x7D22;&#x5F15;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#x884C;. &#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5217;&#x7684;&#x503C;. &#x5982;&#x679C;&#x7D22;&#x5F15;&#x5305;&#x542B;&#x591A;&#x4E2A;&#x5217;,&#x90A3;&#x4E48;&#x5217;&#x7684;&#x4E66;&#x5E8F;&#x4E5F;&#x5341;&#x5206;&#x91CD;&#x8981;,&#x56E0;&#x4E3A;MySQL&#x53EA;&#x80FD;&#x9AD8;&#x6548;&#x5730;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x7684;&#x6700;&#x5DE6;&#x524D;&#x7F00;&#x5217;. &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x4E24;&#x4E2A;&#x5217;&#x7684;&#x7D22;&#x5F15;,&#x548C;&#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x53EA;&#x5305;&#x542B;&#x4E00;&#x5217;&#x7684;&#x7D22;&#x5F15;&#x662F;&#x5927;&#x4E0D;&#x76F8;&#x540C;&#x7684;.</p>
</blockquote>
<h2 id="5-1-1-&#x7D22;&#x5F15;&#x7684;&#x7C7B;&#x578B;">5.2. 5.1.1 &#x7D22;&#x5F15;&#x7684;&#x7C7B;&#x578B;</h2><p><strong>B-Tree&#x7D22;&#x5F15;</strong></p>
<blockquote>
<p>&#x5F53;&#x4EBA;&#x4EEC;&#x8C08;&#x8BBA;&#x7D22;&#x5F15;&#x7684;&#x65F6;&#x5019;,&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7279;&#x522B;&#x6307;&#x660E;&#x7C7B;&#x578B;,&#x90A3;&#x591A;&#x534A;&#x8BF4;&#x7684;&#x662F;B-Tree&#x7D22;&#x5F15;,&#x5B83;&#x4F7F;&#x7528;B-Tree&#x6570;&#x636E;&#x7ED3;&#x6784;&#x6765;&#x5B58;&#x50A8;&#x6570;&#x636E;.&#x5927;&#x591A;&#x6570;MySQL&#x5F15;&#x64CE;&#x90FD;&#x652F;&#x6301;&#x8FD9;&#x79CD;&#x7D22;&#x5F15;.</p>
</blockquote>
<ul>
<li>B-Tree&#x540C;&#x521B;&#x610F;&#x5473;&#x7740;&#x6240;&#x6709;&#x7684;&#x503C;&#x90FD;&#x662F;&#x6309;&#x987A;&#x5E8F;&#x5B58;&#x50A8;&#x7684;,&#x5E76;&#x4E14;&#x6BCF;&#x4E00;&#x4E2A;&#x6930;&#x5B50;&#x9875;&#x5230;&#x6839;&#x7684;&#x8DDD;&#x79BB;&#x76F8;&#x540C;.B-Tree&#x7D22;&#x5F15;&#x80FD;&#x591F;&#x52A0;&#x5FEB;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x7684;&#x901F;&#x5EA6;,&#x56E0;&#x4E3A;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x5168;&#x8868;&#x626B;&#x63CF;&#x6765;&#x83B7;&#x53D6;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;,&#x53D6;&#x800C;&#x4EE3;&#x4E4B;&#x662F;&#x4ECE;&#x7D22;&#x5F15;&#x7684;&#x6839;&#x8282;&#x70B9;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x641C;&#x7D22;. &#x6839;&#x8282;&#x70B9;&#x7684;&#x8349;&#x79CD;&#x5B58;&#x653E;&#x4E86;&#x53EA;&#x60F3;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x6307;&#x9488;,&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x6839;&#x636E;&#x8FD9;&#x4E9B;&#x6307;&#x9488;&#x5411;&#x4E0B;&#x5C42;&#x67E5;&#x627E;. &#x901A;&#x8FC7;&#x6BD4;&#x8F83;&#x8282;&#x70B9;&#x9875;&#x7684;&#x503C;&#x548C;&#x8981;&#x67E5;&#x627E;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x5408;&#x9002;&#x7684;&#x6307;&#x9488;&#x8FDB;&#x5165;&#x4E0B;&#x5C42;&#x5B50;&#x51E0;&#x70B9;,&#x8FD9;&#x4E9B;&#x6307;&#x9488;&#x5B9E;&#x9645;&#x4E0A;&#x5B9A;&#x4E49;&#x4E86;&#x5B50;&#x8282;&#x70B9;&#x9875;&#x4E2D;&#x503C;&#x7684;&#x4E0A;&#x9650;&#x548C;&#x4E0B;&#x9650;. &#x6700;&#x7EC8;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x8981;&#x4E48;&#x662F;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x503C;,&#x8981;&#x4E48;&#x8BE5;&#x8BB0;&#x5F55;&#x4E0D;&#x5B58;&#x5728;.</li>
<li>B-Tree&#x5BF9;&#x7D22;&#x5F15;&#x5217;&#x662F;&#x987A;&#x5E8F;&#x7EC4;&#x7EC7;&#x5B58;&#x50A8;&#x7684;,&#x6240;&#x4EE5;&#x5F88;&#x5408;&#x9002;&#x67E5;&#x627E;&#x8303;&#x56F4;&#x6570;&#x636E;. &#x4F8B;&#x5982;,&#x5728;&#x4E00;&#x4E2A;&#x673A;&#x9047;&#x6587;&#x672C;&#x57DF;&#x7684;&#x7D22;&#x5F15;&#x6811;&#x4E0A;,&#x6309;&#x5B57;&#x6BCD;&#x6570;&#x636E;&#x4F20;&#x9012;&#x8FDE;&#x7EED;&#x7684;&#x503C;&#x8FDB;&#x884C;&#x67E5;&#x627E;&#x662F;&#x975E;&#x5E38;&#x5408;&#x9002;&#x7684;,&#x6240;&#x4EE5;&#x50CF;&#x201D;&#x627E;&#x51FA;&#x6240;&#x6709;&#x4EE5;I&#x5230;K&#x5F00;&#x5934;&#x7684;&#x540D;&#x5B57;&#x201D;&#x8FD9;&#x6837;&#x7684;&#x67E5;&#x627E;&#x6548;&#x7387;&#x975E;&#x5E38;&#x9AD8;.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> People(</span><br><span class="line">    last_name  <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    first_name <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    dob        <span class="built_in">date</span>        <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    gender  enum(<span class="string">&apos;m&apos;</span>, <span class="string">&apos;f&apos;</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">key</span>(last_name, first_name, dob)</span><br><span class="line">);</span><br><span class="line"><span class="comment"># &#x7D22;&#x5F15;&#x5BF9;&#x591A;&#x4E2A;&#x503C;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x7684;&#x4F9D;&#x636E;&#x662F;CREATE TABLE&#x8BED;&#x53E5;&#x4E2D;&#x5B9A;&#x4E49;&#x7D22;&#x5F15;&#x65F6;&#x5217;&#x7684;&#x987A;&#x5E8F;.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>&#x5168;&#x503C;&#x5339;&#x914D;</li>
<li><ul>
<li>&#x5168;&#x503C;&#x5339;&#x914D;&#x503C;&#x5F97;&#x662F;&#x548C;&#x7D22;&#x5F15;&#x4E2D;&#x6240;&#x6709;&#x5217;&#x8FDB;&#x884C;&#x5339;&#x914D;,&#x4F8B;&#x5982;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;&#x7D22;&#x5F15;&#x53EF;&#x7528;&#x4E8E;&#x67E5;&#x627E;&#x90A2;&#x660E;&#x4F1F;Cuba Allen.&#x51FA;&#x751F;&#x4E8E;1960-01-01&#x7684;&#x4EBA;.</li>
</ul>
</li>
<li>&#x5339;&#x914D;&#x6700;&#x5DE6;&#x524D;&#x7F00;</li>
<li><ul>
<li>&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;&#x7D22;&#x5F15;&#x53EF;&#x7528;&#x4E8E;&#x67E5;&#x627E;&#x6240;&#x6709;&#x59D3;&#x4E3A;Allen&#x7684;&#x4EBA;,&#x5373;&#x53EA;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x7684;&#x7B2C;&#x4E00;&#x5217;.</li>
</ul>
</li>
<li>&#x5339;&#x914D;&#x5217;&#x524D;&#x7F00;</li>
<li><ul>
<li>&#x4E5F;&#x53EF;&#x4EE5;&#x53EA;&#x5339;&#x914D;&#x67D0;&#x4E00;&#x5217;&#x7684;&#x503C;&#x7684;&#x5F00;&#x5934;&#x90E8;&#x5206;. &#x4F8B;&#x5982;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;&#x7D22;&#x5F15;&#x53EF;&#x7528;&#x4E8E;&#x67E5;&#x627E;&#x6240;&#x6709;&#x4EE5;J&#x5F00;&#x5934;&#x7684;&#x59D3;&#x7684;&#x4EBA;.&#x8FD9;&#x91CC;&#x4E5F;&#x53EA;&#x4F7F;&#x7528;&#x4E86;&#x7D22;&#x5F15;&#x7684;&#x7B2C;&#x4E00;&#x5217;.</li>
</ul>
</li>
<li>&#x5339;&#x914D;&#x8303;&#x56F4;&#x503C;</li>
<li><ul>
<li>&#x7D22;&#x5F15;&#x53EF;&#x7528;&#x4E8E;&#x67E5;&#x627E;&#x59D3;&#x5728;AllenHE Barrymore&#x4E4B;&#x95F4;&#x7684;&#x4EBA;.&#x8FD9;&#x91CC;&#x4E5F;&#x53EA;&#x4F7F;&#x7528;&#x4E86;&#x7D22;&#x5F15;&#x7684;&#x7B2C;&#x4E00;&#x5217;.</li>
</ul>
</li>
<li>&#x7CBE;&#x786E;&#x5339;&#x914D;&#x67D0;&#x4E00;&#x5217;&#x5E76;&#x8303;&#x56F4;&#x5339;&#x914D;&#x53E6;&#x5916;&#x4E00;&#x5217;</li>
<li><ul>
<li>&#x7D22;&#x5F15;&#x4E5F;&#x53EF;&#x7528;&#x4E8E;&#x67E5;&#x627E;&#x6240;&#x6709;&#x59D3;&#x4E3A;Allen,&#x5E76;&#x4E14;&#x540D;&#x5B57;&#x662F;&#x5B57;&#x6BCD;K&#x5F00;&#x5934;&#x7684;&#x4EBA;. &#x5373;&#x7B2C;&#x4E00;&#x5217;last_name&#x5168;&#x5339;&#x914D;.&#x7B2C;&#x4E8C;&#x5217;first _name&#x8303;&#x56F4;&#x5339;&#x914D;.</li>
</ul>
</li>
<li>&#x53EA;&#x8BBF;&#x95EE;&#x7D22;&#x5F15;&#x7684;&#x67E5;&#x8BE2;</li>
<li><ul>
<li>B-Tree&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x201D;&#x53EA;&#x8BBF;&#x95EE;&#x7D22;&#x5F15;&#x7684;&#x67E5;&#x8BE2;&#x201D;,&#x5373;&#x67E5;&#x8BE2;&#x53EA;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x7D22;&#x5F15;,&#x800C;&#x65E0;&#x9700;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x884C;.</li>
</ul>
</li>
<li><strong>&#x4E00;&#x4E9B;&#x5173;&#x4E8E;B-Tree&#x7D22;&#x5F15;&#x7684;&#x9650;&#x5236;:</strong></li>
<li>&#x5982;&#x679C;&#x4E0D;&#x662F;&#x6309;&#x7167;&#x7D22;&#x5F15;&#x7684;&#x6700;&#x5DE6;&#x5217;&#x5F00;&#x59CB;&#x67E5;&#x627E;,&#x5219;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x7D22;&#x5F15;. &#x4F8B;&#x5982;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#x7D22;&#x5F15;&#x65E0;&#x6CD5;&#x7528;&#x4E8E;&#x67E5;&#x627E;&#x540D;&#x5B57;&#x4E3A;Bill&#x7684;&#x4EBA;,&#x4E5F;&#x65E0;&#x6CD5;&#x67E5;&#x627E;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x751F;&#x65E5;&#x7684;&#x4EBA;,&#x56E0;&#x4E3A;&#x8FD9;&#x4E24;&#x5217;&#x90FD;&#x4E0D;&#x662F;&#x6700;&#x5DE6;&#x6570;&#x636E;&#x5217;. &#x7C7B;&#x4F3C;&#x5730;,&#x4E5F;&#x65E0;&#x6CD5;&#x67E5;&#x627E;&#x5F62;&#x5F0F;&#x4EE5;&#x67D0;&#x4E2A;&#x5B57;&#x6BCD;&#x7ED3;&#x5C3E;&#x7684;&#x4EBA;.</li>
<li>&#x4E0D;&#x80FD;&#x8DF3;&#x8FC7;&#x7D22;&#x5F15;&#x4E2D;&#x7684;&#x5217;. &#x4E5F;&#x5C31;&#x662F;&#x8BF4;,&#x524D;&#x9762;&#x6240;&#x8FF0;&#x7684;&#x7D22;&#x5F15;&#x65E0;&#x6CD5;&#x7528;&#x4E8E;&#x67E5;&#x627E;&#x59D3;&#x4E3A;Smith&#x5E76;&#x4E14;&#x5728;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x65E5;&#x671F;&#x51FA;&#x751F;&#x7684;&#x4EBA;. &#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A;&#x540D;(first_name),&#x5219;MySQL&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x7684;&#x7B2C;&#x4E00;&#x5217;.</li>
<li>&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x4E2D;&#x6709;&#x67D0;&#x4E2A;&#x5217;&#x7684;&#x8303;&#x56F4;&#x67E5;&#x8BE2;,&#x5219;&#x5176;&#x53F3;&#x8FB9;&#x6240;&#x6709;&#x5217;&#x90FD;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x4F18;&#x5316;&#x67E5;&#x627E;. &#x4F8B;&#x5982;</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">WHERE</span> last_name=<span class="string">&apos;Smith&apos;</span> <span class="keyword">AND</span> first_name <span class="keyword">LIKE</span> <span class="string">&apos;J%&apos;</span> <span class="keyword">AND</span> job = <span class="string">&apos;1976-12-23&apos;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x7684;&#x524D;&#x4E24;&#x5217;,&#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x7684;LIKE&#x662F;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#x6761;&#x4EF6;. &#x5982;&#x679C;&#x8303;&#x56F4;&#x67E5;&#x8BE2;&#x5217;&#x503C;&#x7684;&#x6570;&#x91CF;&#x6709;&#x9650;,&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x591A;&#x4E2A;&#x7B49;&#x4E8E;&#x6761;&#x4EF6;&#x6765;&#x4EE3;&#x66FF;&#x8303;&#x56F4;&#x6761;&#x4EF6;.</li>
</ul>
<h2 id="5-2-&#x7D22;&#x5F15;&#x7684;&#x4F18;&#x70B9;">5.3. 5.2 &#x7D22;&#x5F15;&#x7684;&#x4F18;&#x70B9;</h2><blockquote>
<p>&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x8BA9;&#x670D;&#x52A1;&#x5668;&#x5FEB;&#x901F;&#x5730;&#x5B9A;&#x4F4D;&#x5230;&#x8868;&#x7684;&#x5236;&#x5B9A;&#x4F4D;&#x7F6E;. B-Tree&#x7D22;&#x5F15;&#x6309;&#x7167;&#x987A;&#x5E8F;&#x5B58;&#x50A8;&#x6570;&#x636E;,&#x6240;&#x4EE5;MySQL&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x505A;ORDER BY &#x548C; GROUP BY  &#x64CD;&#x4F5C;. &#x56E0;&#x4E3A;&#x6570;&#x636E;&#x65F6;&#x6709;&#x5E8F;&#x7684;,&#x6240;&#x4EE5;B-Tree&#x4E5F;&#x5C31;&#x4F1A;&#x5C06;&#x76F8;&#x5173;&#x7684;&#x5217;&#x503C;&#x90FD;&#x5B58;&#x50A8;&#x5728;&#x4E00;&#x8D77;. &#x6700;&#x540E;,&#x56E0;&#x4E3A;&#x7D22;&#x5F15;&#x4E2D;&#x5B58;&#x50A8;&#x4E86;&#x5B9E;&#x9645;&#x7684;&#x5217;&#x503C;,&#x6240;&#x4EE5;&#x67D0;&#x4E9B;&#x67E5;&#x8BE2;&#x53EA;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x5C31;&#x80FD;&#x5B8C;&#x6210;&#x5168;&#x90E8;&#x67E5;&#x8BE2;.</p>
</blockquote>
<ul>
<li>&#x7D22;&#x5F15;&#x5927;&#x5927;&#x51CF;&#x5C11;&#x4E86;&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;&#x626B;&#x63CF;&#x7684;&#x6570;&#x636E;&#x91CF;</li>
<li>&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x670D;&#x52A1;&#x5668;&#x907F;&#x514D;&#x6392;&#x5E8F;&#x548C;&#x4E34;&#x65F6;&#x8868;.</li>
<li>&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x5C06;&#x968F;&#x673A;I/O&#x53D8;&#x4E3A;&#x987A;&#x5E8F;I/O.</li>
</ul>
<h2 id="5-3-&#x9AD8;&#x6027;&#x80FD;&#x5462;&#x56FA;&#x5B9A;&#x7D22;&#x5F15;&#x7B56;&#x7565;">5.4. 5.3 &#x9AD8;&#x6027;&#x80FD;&#x5462;&#x56FA;&#x5B9A;&#x7D22;&#x5F15;&#x7B56;&#x7565;</h2><h3 id="5-3-1-&#x72EC;&#x7ACB;&#x7684;&#x5217;">5.4.1. 5.3.1 &#x72EC;&#x7ACB;&#x7684;&#x5217;</h3><blockquote>
<p>&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x4F1A;&#x770B;&#x5230;&#x4E00;&#x4E9B;&#x67E5;&#x8BE2;&#x4E0D;&#x5F53;&#x5730;&#x4F7F;&#x7528;&#x7D22;&#x5F15;,&#x6216;&#x8005;&#x4F7F;&#x5F97;MySQL&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x5DF2;&#x6709;&#x7684;&#x7D22;&#x5F15;. &#x5982;&#x679C;&#x67E5;&#x8BE2;&#x7684;&#x5217;&#x4E0D;&#x662F;&#x72EC;&#x7ACB;&#x7684;,&#x5219;MySQL&#x5C31;&#x4E0D;&#x4F1A;&#x4F7F;&#x7528;&#x7D22;&#x5F15;. &#x201C;&#x72EC;&#x7ACB;&#x7684;&#x5217;&#x201D;&#x662F;&#x6307;&#x7D22;&#x5F15;&#x5217;&#x4E0D;&#x80FD;&#x662F;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x4E00;&#x90E8;&#x5206;,&#x4E5F;&#x4E0D;&#x80FD;&#x662F;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># &#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;actorid&#x5217;&#x7684;&#x7D22;&#x5F15;:</span></span><br><span class="line"><span class="keyword">SELECT</span> actor_id <span class="keyword">FROM</span> sakila.actor <span class="keyword">WHERE</span> actor_id + <span class="number">1</span> = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x5F88;&#x5BB9;&#x6613;&#x53EF;&#x4EE5;&#x770B;&#x51FA;WHERE&#x4E2D;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x5176;&#x5B9E;&#x7B49;&#x4EF7;&#x4E8E;actor_id = 4,&#x4F46;&#x662F;MySQL&#x65E0;&#x6CD5;&#x81EA;&#x52A8;&#x89E3;&#x6790;&#x8FD9;&#x4E2A;&#x65B9;&#x7A0B;&#x5F0F;. &#x8FD9;&#x5B8C;&#x5168;&#x662F;&#x7528;&#x6237;&#x884C;&#x4E3A;. &#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x517B;&#x6210;&#x7B80;&#x5316;WHAERE&#x6761;&#x4EF6;&#x7684;&#x4E60;&#x60EF;,&#x59CB;&#x7EC8;&#x5C06;&#x7D22;&#x5F15;&#x5217;&#x5355;&#x72EC;&#x653E;&#x5728;&#x6BD4;&#x8F83;&#x7B26;&#x53F7;&#x7684;&#x4E00;&#x6B21;.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># &#x4E0B;&#x9762;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x9519;&#x8BEF;: &#x5176;&#x4E2D;date_col&#x662F;&#x7D22;&#x5F15;</span></span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">WHERE</span> <span class="keyword">TO_DAYS</span>(<span class="keyword">CURRENT_DATE</span>) - <span class="keyword">TO_DAYS</span>(date_col) &lt;= <span class="number">10</span>;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>读书笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS-卸载</title>
    <url>/2019/CentOS-uninstall/</url>
    <content><![CDATA[<h1 id="&#x5378;&#x8F7D;">1. &#x5378;&#x8F7D;</h1><ol>
<li><p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x5B89;&#x88C5;mysql&#x60C5;&#x51B5;</p>
<a id="more"></a>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">rpm -<span class="keyword">qa</span>|<span class="keyword">grep</span> -i mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x505C;&#x6B62;mysql&#x670D;&#x52A1;&#x3001;&#x5220;&#x9664;&#x4E4B;&#x524D;&#x5B89;&#x88C5;&#x7684;mysql</p>
</li>
</ol>
<p>&#x5220;&#x9664;&#x547D;&#x4EE4;&#xFF1A;rpm -e &#x2013;nodeps &#x5305;&#x540D;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">rpm -ev MySQL-client<span class="number">-5.5</span><span class="number">.25</span>a<span class="number">-1.</span>rhel5  </span><br><span class="line">rpm -ev MySQL-server<span class="number">-5.5</span><span class="number">.25</span>a<span class="number">-1.</span>rhel5</span><br></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x63D0;&#x793A;&#x4F9D;&#x8D56;&#x5305;&#x9519;&#x8BEF;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x5C1D;&#x8BD5;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">rpm -ev MySQL-client<span class="number">-5.5</span><span class="number">.25</span>a<span class="number">-1.</span>rhel5 --nodeps</span><br></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x63D0;&#x793A;&#x9519;&#x8BEF;&#xFF1A;<br>error: %preun(xxxxxx) scriptlet failed, exit status 1</p>
<p>&#x5219;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x5C1D;&#x8BD5;&#xFF1A;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">rpm -e --noscripts MySQL-client<span class="number">-5.5</span><span class="number">.25</span>a<span class="number">-1.</span>rhel5</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>&#x67E5;&#x627E;&#x4E4B;&#x524D;&#x8001;&#x7248;&#x672C;mysql&#x7684;&#x76EE;&#x5F55;&#x3001;&#x5E76;&#x4E14;&#x5220;&#x9664;&#x8001;&#x7248;&#x672C;mysql&#x7684;&#x6587;&#x4EF6;&#x548C;&#x5E93;</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">find</span> / -name mysql</span><br></pre></td></tr></table></figure>
<ul>
<li>/var/lib/mysql</li>
<li>/var/lib/mysql/mysql</li>
<li>/usr/lib64/mysql</li>
<li><ul>
<li>&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x7684;mysql&#x76EE;&#x5F55;</li>
</ul>
</li>
<li>rm -rf /var/lib/mysql</li>
<li>rm -rf /var/lib/mysql</li>
<li>rm -rf /usr/lib64/mysql</li>
<li><ul>
<li>&#x67E5;&#x627E;&#x76EE;&#x5F55;&#x5E76;&#x5220;&#x9664;</li>
</ul>
</li>
</ul>
<p><strong>&#x5378;&#x8F7D;&#x540E;/etc/my.cnf&#x4E0D;&#x4F1A;&#x5220;&#x9664;&#xFF0C;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x624B;&#x5DE5;&#x5220;&#x9664;</strong></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">rm -rf /etc/<span class="keyword">my</span>.cnf</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>&#x518D;&#x6B21;&#x67E5;&#x627E;&#x673A;&#x5668;&#x662F;&#x5426;&#x5B89;&#x88C5;mysql</li>
</ol>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">rpm -<span class="keyword">qa</span>|<span class="keyword">grep</span> -i mysql</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux安装</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS-安装</title>
    <url>/2019/CentOS-install/</url>
    <content><![CDATA[<h1 id="&#x5B89;&#x88C5;">1. &#x5B89;&#x88C5;</h1><p>[toc]</p>
<p>&#x963F;&#x91CC;&#x4E91;ECS&#x670D;&#x52A1;&#x5668;CentOS7&#x4E0A;&#x5B89;&#x88C5;MySql&#x670D;&#x52A1;</p>
<p><strong>&#x4F7F;&#x7528;root&#x767B;&#x5F55;</strong></p>
<a id="more"></a>
<h2 id="1-&#x786E;&#x4FDD;&#x670D;&#x52A1;&#x5668;&#x7CFB;&#x7EDF;&#x5904;&#x4E8E;&#x6700;&#x65B0;&#x72B6;&#x6001;">1.1. 1. &#x786E;&#x4FDD;&#x670D;&#x52A1;&#x5668;&#x7CFB;&#x7EDF;&#x5904;&#x4E8E;&#x6700;&#x65B0;&#x72B6;&#x6001;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># yum -y update</span></span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x663E;&#x793A;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x8BF4;&#x660E;&#x5DF2;&#x7ECF;&#x66F4;&#x65B0;&#x5B8C;&#x6210;</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Replaced:</span><br><span class="line">  grub2.x86_64 <span class="number">1</span>:<span class="number">2.02</span><span class="number">-0.64</span>.el7.centos   grub2-tools.x86_64 <span class="number">1</span>:<span class="number">2.02</span><span class="number">-0.64</span>.el7.centos</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>


<h2 id="2-&#x91CD;&#x542F;&#x670D;&#x52A1;&#x5668;">1.2. 2. &#x91CD;&#x542F;&#x670D;&#x52A1;&#x5668;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># reboot</span></span><br></pre></td></tr></table></figure>


<h2 id="3-&#x9996;&#x5148;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x5148;&#x5220;&#x9664;&#x4EE5;&#x524D;&#x7248;&#x672C;&#xFF0C;&#x4EE5;&#x514D;&#x5B89;&#x88C5;&#x4E0D;&#x6210;&#x529F;">1.3. 3. &#x9996;&#x5148;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x5148;&#x5220;&#x9664;&#x4EE5;&#x524D;&#x7248;&#x672C;&#xFF0C;&#x4EE5;&#x514D;&#x5B89;&#x88C5;&#x4E0D;&#x6210;&#x529F;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># php -v</span></span><br><span class="line">&#x6216;</span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># rpm -qa | gerp mysql</span></span><br><span class="line">&#x6216;</span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># yum list installed | grep mysql</span></span><br></pre></td></tr></table></figure>


<p>&#x5982;&#x679C;&#x663E;&#x793A;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x8BF4;&#x660E;&#x6CA1;&#x6709;&#x5B89;&#x88C5;&#x670D;&#x52A1;</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">-<span class="string">bash:</span> <span class="string">gerp:</span> command not found</span><br></pre></td></tr></table></figure>


<h2 id="4-&#x4E0B;&#x8F7D;MySql&#x5B89;&#x88C5;&#x5305;">1.4. 4. &#x4E0B;&#x8F7D;MySql&#x5B89;&#x88C5;&#x5305;</h2><figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="symbol">~]# rpm -ivh http</span>:<span class="comment">//dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm</span></span><br><span class="line">&#x6216;</span><br><span class="line">[root@localhost <span class="symbol">~]# rpm -ivh http</span>:<span class="comment">//dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</span></span><br></pre></td></tr></table></figure>


<h2 id="5-&#x5B89;&#x88C5;MySql">1.5. 5. &#x5B89;&#x88C5;MySql</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># yum install -y mysql-server</span></span><br><span class="line">&#x6216;</span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># yum install mysql-community-server</span></span><br><span class="line">&#x5982;&#x679C;&#x663E;&#x793A;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x8BF4;&#x660E;&#x5B89;&#x88C5;&#x6210;&#x529F;</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>


<h2 id="6-&#x8BBE;&#x7F6E;&#x5F00;&#x673A;&#x542F;&#x52A8;Mysql">1.6. 6. &#x8BBE;&#x7F6E;&#x5F00;&#x673A;&#x542F;&#x52A8;Mysql</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl enable mysqld.service</span></span><br></pre></td></tr></table></figure>

<h2 id="7-&#x68C0;&#x67E5;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x4E86;&#x5F00;&#x673A;&#x81EA;&#x52A8;&#x542F;&#x52A8;">1.7. 7. &#x68C0;&#x67E5;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x4E86;&#x5F00;&#x673A;&#x81EA;&#x52A8;&#x542F;&#x52A8;</h2><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># systemctl list-unit-files | grep mysqld</span></span><br><span class="line"><span class="comment">// &#x5982;&#x679C;&#x663E;&#x793A;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x8BF4;&#x660E;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x81EA;&#x52A8;&#x542F;&#x52A8;&#x5B89;&#x88C5;</span></span><br><span class="line">mysqld.service                                enabled</span><br></pre></td></tr></table></figure>

<h2 id="8-&#x8BBE;&#x7F6E;&#x5F00;&#x542F;&#x670D;&#x52A1;">1.8. 8. &#x8BBE;&#x7F6E;&#x5F00;&#x542F;&#x670D;&#x52A1;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl start mysqld.service</span></span><br></pre></td></tr></table></figure>


<h2 id="9-&#x67E5;&#x770B;MySql&#x9ED8;&#x8BA4;&#x5BC6;&#x7801;">1.9. 9. &#x67E5;&#x770B;MySql&#x9ED8;&#x8BA4;&#x5BC6;&#x7801;</h2><figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# grep <span class="string">&apos;temporary password&apos;</span> /var/<span class="keyword">log</span>/mysqld.<span class="keyword">log</span></span><br></pre></td></tr></table></figure>

<h2 id="10-&#x767B;&#x9646;MySql&#xFF0C;&#x8F93;&#x5165;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;">1.10. 10. &#x767B;&#x9646;MySql&#xFF0C;&#x8F93;&#x5165;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># mysql -uroot -p</span></span><br></pre></td></tr></table></figure>

<h2 id="11-&#x4FEE;&#x6539;&#x5F53;&#x524D;&#x7528;&#x6237;&#x5BC6;&#x7801;">1.11. 11. &#x4FEE;&#x6539;&#x5F53;&#x524D;&#x7528;&#x6237;&#x5BC6;&#x7801;</h2><figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">SET</span> PASSWORD <span class="comment">= PASSWORD(</span><span class="comment">&apos;Abc123!_&apos;</span><span class="comment">)</span>;</span><br></pre></td></tr></table></figure>

<h2 id="12-&#x5F00;&#x542F;&#x8FDC;&#x7A0B;&#x767B;&#x5F55;&#xFF0C;&#x6388;&#x6743;root&#x8FDC;&#x7A0B;&#x767B;&#x5F55;">1.12. 12. &#x5F00;&#x542F;&#x8FDC;&#x7A0B;&#x767B;&#x5F55;&#xFF0C;&#x6388;&#x6743;root&#x8FDC;&#x7A0B;&#x767B;&#x5F55;</h2><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">&apos;root&apos;</span>@<span class="string">&apos;%&apos;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&apos;a123456!&apos;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>;</span><br></pre></td></tr></table></figure>

<h2 id="13-&#x547D;&#x4EE4;&#x7ACB;&#x5373;&#x6267;&#x884C;&#x751F;&#x6548;">1.13. 13. &#x547D;&#x4EE4;&#x7ACB;&#x5373;&#x6267;&#x884C;&#x751F;&#x6548;</h2><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">mysql&gt;flush privileges<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="&#x5176;&#x4ED6;&#x529F;&#x80FD;">2. &#x5176;&#x4ED6;&#x529F;&#x80FD;:</h1><h2 id="&#x68C0;&#x67E5;&#x5E76;&#x4E14;&#x663E;&#x793A;Apache&#x76F8;&#x5173;&#x5B89;&#x88C5;&#x5305;">2.1. &#x68C0;&#x67E5;&#x5E76;&#x4E14;&#x663E;&#x793A;Apache&#x76F8;&#x5173;&#x5B89;&#x88C5;&#x5305;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># rpm -qa | grep mysql</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x5220;&#x9664;MySql">2.2. &#x5220;&#x9664;MySql</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">yum</span> <span class="selector-tag">remove</span> <span class="selector-tag">-y</span> <span class="selector-tag">mysql</span> <span class="selector-tag">mysql</span> <span class="selector-tag">mysql-server</span> <span class="selector-tag">mysql-libs</span> <span class="selector-tag">compat-mysql51</span></span><br><span class="line">&#x6216;</span><br><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">rpm</span> <span class="selector-tag">-e</span> <span class="selector-tag">mysql-community-libs-5</span><span class="selector-class">.7</span><span class="selector-class">.20-1</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span> <span class="selector-tag">--nodeps</span></span><br><span class="line">&#x6216;</span><br><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">yum</span> <span class="selector-tag">-y</span> <span class="selector-tag">remove</span> <span class="selector-tag">mysql-community-libs-5</span><span class="selector-class">.7</span><span class="selector-class">.20-1</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br></pre></td></tr></table></figure>


<h2 id="&#x67E5;&#x770B;MySql&#x76F8;&#x5173;&#x6587;&#x4EF6;">2.3. &#x67E5;&#x770B;MySql&#x76F8;&#x5173;&#x6587;&#x4EF6;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># find / -name mysql</span></span><br></pre></td></tr></table></figure>


<h2 id="&#x91CD;&#x542F;MySql&#x670D;&#x52A1;">2.4. &#x91CD;&#x542F;MySql&#x670D;&#x52A1;</h2><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]#<span class="built_in"> service </span>mysqld restart</span><br></pre></td></tr></table></figure>

<h2 id="&#x67E5;&#x770B;MySql&#x7248;&#x672C;">2.5. &#x67E5;&#x770B;MySql&#x7248;&#x672C;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># yum repolist all | grep mysql</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x67E5;&#x770B;&#x5F53;&#x524D;&#x7684;&#x542F;&#x52A8;&#x7684;-MySQL-&#x7248;&#x672C;">2.6. &#x67E5;&#x770B;&#x5F53;&#x524D;&#x7684;&#x542F;&#x52A8;&#x7684; MySQL &#x7248;&#x672C;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># yum repolist enabled | grep mysql</span></span><br></pre></td></tr></table></figure>


<h2 id="&#x901A;&#x8FC7;Yum&#x6765;&#x5B89;&#x88C5;MySQL-&#x4F1A;&#x81EA;&#x52A8;&#x5904;&#x7406;MySQL&#x4E0E;&#x5176;&#x4ED6;&#x7EC4;&#x4EF6;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;">2.7. &#x901A;&#x8FC7;Yum&#x6765;&#x5B89;&#x88C5;MySQL,&#x4F1A;&#x81EA;&#x52A8;&#x5904;&#x7406;MySQL&#x4E0E;&#x5176;&#x4ED6;&#x7EC4;&#x4EF6;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># yum install mysql-community-server</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x67E5;&#x770B;MySQL&#x5B89;&#x88C5;&#x76EE;&#x5F55;">2.8. &#x67E5;&#x770B;MySQL&#x5B89;&#x88C5;&#x76EE;&#x5F55;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># whereis mysql</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x542F;&#x52A8;MySQL&#x670D;&#x52A1;">2.9. &#x542F;&#x52A8;MySQL&#x670D;&#x52A1;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl start mysqld</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x67E5;&#x770B;MySQL&#x670D;&#x52A1;&#x72B6;&#x6001;">2.10. &#x67E5;&#x770B;MySQL&#x670D;&#x52A1;&#x72B6;&#x6001;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl status mysqld</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x5173;&#x95ED;MySQL&#x670D;&#x52A1;">2.11. &#x5173;&#x95ED;MySQL&#x670D;&#x52A1;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl stop mysqld</span></span><br></pre></td></tr></table></figure>


<h2 id="&#x6D4B;&#x8BD5;MySQL&#x662F;&#x5426;&#x5B89;&#x88C5;&#x6210;&#x529F;">2.12. &#x6D4B;&#x8BD5;MySQL&#x662F;&#x5426;&#x5B89;&#x88C5;&#x6210;&#x529F;</h2><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># mysql</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x67E5;&#x770B;MySql&#x9ED8;&#x8BA4;&#x5BC6;&#x7801;">2.13. &#x67E5;&#x770B;MySql&#x9ED8;&#x8BA4;&#x5BC6;&#x7801;</h2><figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# grep <span class="string">&apos;temporary password&apos;</span> /var/<span class="keyword">log</span>/mysqld.<span class="keyword">log</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x67E5;&#x770B;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;">2.14. &#x67E5;&#x770B;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;</h2><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">mysql&gt;show databases<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x9000;&#x51FA;&#x767B;&#x5F55;&#x6570;&#x636E;&#x5E93;">2.15. &#x9000;&#x51FA;&#x767B;&#x5F55;&#x6570;&#x636E;&#x5E93;</h2><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">exit</span>;</span><br></pre></td></tr></table></figure>


<h2 id="&#x67E5;&#x770B;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;&#x7528;&#x6237;">2.16. &#x67E5;&#x770B;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;&#x7528;&#x6237;</h2><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> CONCAT(<span class="string">&apos;User: &apos;&apos;&apos;</span>,<span class="keyword">user</span>,<span class="string">&apos;&apos;&apos;@&apos;&apos;&apos;</span>,host,<span class="string">&apos;&apos;&apos;;&apos;</span>) <span class="keyword">AS</span> query <span class="keyword">FROM</span> mysql.<span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux安装</tag>
      </tags>
  </entry>
  <entry>
    <title>文件上传</title>
    <url>/2018/wen-jian-shang-chuan/</url>
    <content><![CDATA[<h1 id="&#x7B2C;&#x4E00;&#x79CD;&#x65B9;&#x6848;">1. &#x7B2C;&#x4E00;&#x79CD;&#x65B9;&#x6848;</h1><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@<span class="constructor">RequestMapping(<span class="params">value</span> = <span class="string">&quot;/contact&quot;</span>, <span class="params">method</span> = RequestMethod.POST)</span></span><br><span class="line">public void contact( HttpServletRequest request) {</span><br><span class="line">    MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request;</span><br><span class="line">    MultipartFile partFile = multipartRequest.get<span class="constructor">File(<span class="string">&quot;partFile&quot;</span>)</span>;</span><br><span class="line">     String savePath = get<span class="constructor">SavePath()</span>;</span><br><span class="line">    <span class="comment">//&#x4E0B;&#x8F7D;&#x6587;&#x4EF6;</span></span><br><span class="line">    String pictureName = <span class="module-access"><span class="module"><span class="identifier">UUID</span>.</span></span>random<span class="constructor">UUID()</span>.<span class="keyword">to</span><span class="constructor">String()</span> + <span class="string">&quot;.&quot;</span> + lastName;</span><br><span class="line">    file = <span class="keyword">new</span> <span class="constructor">File(<span class="params">savePath</span> + File.<span class="params">separator</span> + <span class="params">pictureName</span>)</span>;</span><br><span class="line">    partFile.transfer<span class="constructor">To(<span class="params">file</span>)</span>;</span><br><span class="line">}</span><br><span class="line">``` </span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line"># &#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x6848;(spring3.<span class="number">0</span>&#x4EE5;&#x4E0A;)</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">@<span class="constructor">RequestMapping(<span class="params">value</span> = <span class="string">&quot;/contact&quot;</span>, <span class="params">method</span> = RequestMethod.POST)</span></span><br><span class="line">public void contact( @RequestPart (<span class="string">&quot;filename&quot;</span>) Part file) {</span><br><span class="line">    file.write(<span class="string">&quot;&quot;</span>);<span class="comment">//&#x53C2;&#x6570;&#x4E3A;&#x6587;&#x4EF6;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x8DEF;&#x5F84;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Part&#x65B9;&#x6CD5;&#x7684;&#x540D;&#x79F0;&#x4E0E;MultipartFile&#x65B9;&#x6CD5;&#x7684;&#x540D;&#x79F0;&#x662F;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;.&#x6709;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x7C7B;&#x4F3C;,&#x4F46;&#x662F;&#x7A0D;&#x6709;&#x5DEE;&#x5F02;,&#x6BD4;&#x5982;getSubmittedFileName()&#x5BF9;&#x5E94;&#x4E8E;getOriginalFilename.&#x7C7B;&#x4F3C;&#x7684;write()&#x5BF9;&#x5E94;&#x4E8E;transferTo(),&#x501F;&#x52A9;&#x8BE5;&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</p>
<blockquote>
<p>&#x503C;&#x5F97;&#x4E00;&#x63D0;&#x7684;&#x662F;,&#x5982;&#x679C;&#x5728;&#x7F16;&#x5199;&#x63A7;&#x5236;&#x5668;&#x65B9;&#x6CD5;&#x7684;&#x65F6;&#x5019;,&#x901A;&#x8FC7;Part&#x53C2;&#x6570;&#x7684;&#x5F62;&#x5F0F;&#x63A5;&#x53D7;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;,&#x90A3;&#x4E48;&#x4E45;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x914D;&#x7F6E;MultipartResolver&#x4E86;.&#x53EA;&#x6709;&#x4F7F;&#x7528;MultipartFile&#x7684;&#x65F6;&#x5019;,&#x6211;&#x4EEC;&#x624D;&#x9700;&#x8981;MultipartResolver.</p>
</blockquote>
<hr>
<h1 id="File-separator">2. File.separator</h1><p>&#x5728;Windows&#x4E0B;&#x7684;&#x8DEF;&#x5F84;&#x5206;&#x9694;&#x7B26;&#x548C;Linux&#x4E0B;&#x7684;&#x8DEF;&#x5F84;&#x5206;&#x9694;&#x7B26;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x5F53;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x65F6;&#xFF0C;&#x8DE8;&#x5E73;&#x53F0;&#x4F1A;&#x66B4;&#x51FA;&#x201C;No such file or diretory&#x201D;&#x7684;&#x5F02;&#x5E38;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x8BF4;&#x8981;&#x5728;temp&#x76EE;&#x5F55;&#x4E0B;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;test.txt&#x6587;&#x4EF6;&#xFF0C;&#x5728;Windows&#x4E0B;&#x5E94;&#x8BE5;&#x8FD9;&#x4E48;&#x5199;&#xFF1A;</p>
<pre><code>File file1 = new File (&quot;C:\tmp\test.txt&quot;); </code></pre><p>&#x5728;Linux&#x4E0B;&#x5219;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<pre><code>File file2 = new File (&quot;/tmp/test.txt&quot;);</code></pre><p>&#x5982;&#x679C;&#x8981;&#x8003;&#x8651;&#x8DE8;&#x5E73;&#x53F0;&#xFF0C;&#x5219;&#x6700;&#x597D;&#x662F;&#x8FD9;&#x4E48;&#x5199;&#xFF1A;</p>
<pre><code>File myFile = new File(&quot;C:&quot; + File.separator + &quot;tmp&quot; + File.separator, &quot;test.txt&quot;);</code></pre><p>File&#x7C7B;&#x6709;&#x51E0;&#x4E2A;&#x7C7B;&#x4F3C;separator&#x7684;&#x9759;&#x6001;&#x5B57;&#x6BB5;&#xFF0C;&#x90FD;&#x662F;&#x4E0E;&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x7684;&#xFF0C;&#x5728;&#x7F16;&#x7A0B;&#x65F6;&#x5E94;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x3002;</p>
<ol>
<li>separatorChar<pre><code>public static final char separatorChar</code></pre>&#x4E0E;&#x7CFB;&#x7EDF;&#x6709;&#x5173;&#x7684;&#x9ED8;&#x8BA4;&#x540D;&#x79F0;&#x5206;&#x9694;&#x7B26;&#x3002;&#x6B64;&#x5B57;&#x6BB5;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x5305;&#x542B;&#x7CFB;&#x7EDF;&#x5C5E;&#x6027; file.separator &#x503C;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x3002;&#x5728; UNIX &#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x6B64;&#x5B57;&#x6BB5;&#x7684;&#x503C;&#x4E3A; &#x2018;/&#x2018;&#xFF1B;&#x5728; Microsoft Windows &#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x5B83;&#x4E3A; &#x2018;&apos;&#x3002;</li>
<li>separator<pre><code>public static final String separator</code></pre>&#x4E0E;&#x7CFB;&#x7EDF;&#x6709;&#x5173;&#x7684;&#x9ED8;&#x8BA4;&#x540D;&#x79F0;&#x5206;&#x9694;&#x7B26;&#xFF0C;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#xFF0C;&#x5B83;&#x88AB;&#x8868;&#x793A;&#x4E3A;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x6B64;&#x5B57;&#x7B26;&#x4E32;&#x53EA;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#xFF0C;&#x5373; separatorChar&#x3002;</li>
<li>pathSeparatorChar<pre><code>public static final char pathSeparatorChar</code></pre>&#x4E0E;&#x7CFB;&#x7EDF;&#x6709;&#x5173;&#x7684;&#x8DEF;&#x5F84;&#x5206;&#x9694;&#x7B26;&#x3002;&#x6B64;&#x5B57;&#x6BB5;&#x88AB;&#x521D;&#x59CB;&#x4E3A;&#x5305;&#x542B;&#x7CFB;&#x7EDF;&#x5C5E;&#x6027; path.separator &#x503C;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x3002;&#x6B64;&#x5B57;&#x7B26;&#x7528;&#x4E8E;&#x5206;&#x9694;&#x4EE5;&#x8DEF;&#x5F84;&#x5217;&#x8868; &#x5F62;&#x5F0F;&#x7ED9;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002;&#x5728; UNIX &#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x6B64;&#x5B57;&#x6BB5;&#x4E3A; &#x2018;:&#x2019;&#xFF1B;&#x5728; Microsoft Windows &#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x5B83;&#x4E3A; &#x2018;;&#x2019;&#x3002;</li>
<li>pathSeparator<pre><code>public static final String pathSeparator</code></pre>&#x4E0E;&#x7CFB;&#x7EDF;&#x6709;&#x5173;&#x7684;&#x8DEF;&#x5F84;&#x5206;&#x9694;&#x7B26;&#xFF0C;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#xFF0C;&#x5B83;&#x88AB;&#x8868;&#x793A;&#x4E3A;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x6B64;&#x5B57;&#x7B26;&#x4E32;&#x53EA;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#xFF0C;&#x5373; pathSeparatorChar&#x3002;</li>
</ol>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
  </entry>
  <entry>
    <title>ConcurrentHashMap</title>
    <url>/2018/concurrent-hash-map/</url>
    <content><![CDATA[<h1 id="ConcurrentHashMap">1. ConcurrentHashMap</h1><h2 id="&#x4F18;&#x52BF;">1.1. &#x4F18;&#x52BF;</h2><p><strong>HashMap</strong></p>
<p>&#x5728;&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x56E0;&#x4E3A;&#x63D2;&#x5165;&#x8FC7;&#x7A0B;&#x4E0D;&#x662F;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#xFF0C;&#x6BCF;&#x4E2A;HashEntry&#x662F;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x8282;&#x70B9;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x5728;&#x63D2;&#x5165;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5DF2;&#x7ECF;&#x8BBE;&#x7F6E;&#x4E86;&#x540E;&#x8282;&#x70B9;&#xFF0C;&#x5B9E;&#x9645;&#x8FD8;&#x672A;&#x63D2;&#x5165;&#xFF0C;&#x6700;&#x7EC8;&#x53CD;&#x800C;&#x63D2;&#x5165;&#x5728;&#x540E;&#x8282;&#x70B9;&#x4E4B;&#x540E;&#xFF0C;&#x9020;&#x6210;&#x94FE;&#x4E2D;&#x51FA;&#x73B0;&#x73AF;&#xFF0C;&#x7834;&#x574F;&#x4E86;&#x94FE;&#x8868;&#x7684;&#x6027;&#x8D28;&#xFF0C;&#x5931;&#x53BB;&#x4E86;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x51FA;&#x73B0;&#x6B7B;&#x5FAA;&#x73AF;&#x3002;</p>
<a id="more"></a>

<p><strong>HashTable</strong></p>
<p>&#x5185;&#x90E8;&#x662F;&#x91C7;&#x7528;synchronized&#x6765;&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x4F46;&#x5728;&#x7EBF;&#x7A0B;&#x7ADE;&#x4E89;&#x6FC0;&#x70C8;&#x7684;&#x60C5;&#x51B5;&#x4E0B;HashTable&#x7684;&#x6548;&#x7387;&#x4E0B;&#x964D;&#x5F97;&#x5F88;&#x5FEB;&#x56E0;&#x4E3A;synchronized&#x5173;&#x952E;&#x5B57;&#x4F1A;&#x9020;&#x6210;&#x4EE3;&#x7801;&#x5757;&#x6216;&#x65B9;&#x6CD5;&#x6210;&#x4E3A;&#x4E3A;&#x4E34;&#x754C;&#x533A;(&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x52A0;&#x4E92;&#x65A5;&#x9501;)&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x8BBF;&#x95EE;&#x4E34;&#x754C;&#x533A;&#x7684;&#x4EE3;&#x7801;&#x65F6;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4E5F;&#x8BBF;&#x95EE;&#x540C;&#x4E00;&#x4E34;&#x754C;&#x533A;&#x65F6;&#xFF0C;&#x4F1A;&#x8FDB;&#x5165;&#x963B;&#x585E;&#x6216;&#x8F6E;&#x8BE2;&#x72B6;&#x6001;&#x3002;&#x7A76;&#x5176;&#x539F;&#x56E0;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x6709;&#x83B7;&#x53D6;&#x9501;&#x610F;&#x5411;&#x7684;&#x7EBF;&#x7A0B;&#x7684;&#x6570;&#x76EE;&#x589E;&#x52A0;&#xFF0C;&#x4F46;&#x662F;&#x9501;&#x8FD8;&#x662F;&#x53EA;&#x6709;&#x5355;&#x4E2A;&#xFF0C;&#x5BFC;&#x81F4;&#x5927;&#x91CF;&#x7684;&#x7EBF;&#x7A0B;&#x5904;&#x4E8E;&#x8F6E;&#x8BE2;&#x6216;&#x963B;&#x585E;&#xFF0C;&#x5BFC;&#x81F4;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x6BB5;&#x6709;&#x6548;&#x6267;&#x884C;&#x7684;&#x7EBF;&#x7A0B;&#x7684;&#x589E;&#x91CF;&#x8FDC;&#x4E0D;&#x53CA;&#x7EBF;&#x7A0B;&#x603B;&#x4F53;&#x589E;&#x91CF;&#x3002; </p>
<blockquote>
<p>&#x5728;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;&#x5C24;&#x5176;&#x80FD;&#x591F;&#x4F53;&#x73B0;&#x51FA;ConcurrentHashMap&#x5728;&#x6548;&#x7387;&#x4E0A;&#x7684;&#x4F18;&#x52BF;&#xFF0C;HashTable&#x4F7F;&#x7528;Sychronized&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x540C;&#x65F6;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x5728;&#x6267;&#x884C;&#xFF0C;&#x800C;Cocurrent&#x5219;&#x4E0D;&#x91C7;&#x53D6;&#x52A0;&#x9501;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x662F;&#x91C7;&#x7528;volatile&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x867D;&#x7136;&#x4E5F;&#x4F1A;&#x727A;&#x7272;&#x6548;&#x7387;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;Sychronized&#xFF0C;&#x4E8E;&#x8BE5;&#x6587;&#x672B;&#x5C3E;&#x7EE7;&#x7EED;&#x8BA8;&#x8BBA;&#x3002;</p>
</blockquote>
<p><strong>ConcurrentHashMap</strong></p>
<p>&#x5229;&#x7528;&#x9501;&#x5206;&#x6BB5;&#x6280;&#x672F;&#x589E;&#x52A0;&#x4E86;&#x9501;&#x7684;&#x6570;&#x76EE;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x4E89;&#x593A;&#x540C;&#x4E00;&#x628A;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x7684;&#x6570;&#x76EE;&#x5F97;&#x5230;&#x63A7;&#x5236;&#x3002; </p>
<blockquote>
<p>&#x9501;&#x5206;&#x6BB5;&#x6280;&#x672F;&#x5C31;&#x662F;&#x5BF9;&#x6570;&#x636E;&#x96C6;&#x8FDB;&#x884C;&#x5206;&#x6BB5;&#xFF0C;&#x6BCF;&#x6BB5;&#x7ADE;&#x4E89;&#x4E00;&#x628A;&#x9501;&#xFF0C;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x6BB5;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x5B58;&#x5728;&#x9501;&#x7ADE;&#x4E89;&#xFF0C;&#x4ECE;&#x800C;&#x6709;&#x6548;&#x63D0;&#x9AD8; &#x9AD8;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x6548;&#x7387;&#x3002;</p>
</blockquote>
<p>ConcurrentHashMap&#x5728;get&#x65B9;&#x6CD5;&#x662F;&#x65E0;&#x9700;&#x52A0;&#x9501;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x7528;&#x5230;&#x7684;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x90FD;&#x91C7;&#x7528;volatile&#x5173;&#x952E;&#x5B57;&#x4FEE;&#x9970;&#xFF0C;&#x5DF4;&#x8BC1;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x5728;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x53EF;&#x89C1;&#x6027;(&#x6BCF;&#x6B21;&#x8BFB;&#x53D6;&#x90FD;&#x5148;&#x540C;&#x6B65;&#x7F13;&#x5B58;&#x548C;&#x5185;&#x5B58;&#xFF0C;&#x76F4;&#x63A5;&#x4ECE;&#x5185;&#x5B58;&#x4E2D;&#x83B7;&#x53D6;&#x503C;&#xFF0C;&#x867D;&#x7136;&#x4E0D;&#x662F;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x6839;&#x636E;JAVA&#x5185;&#x5B58;&#x6A21;&#x578B;&#x7684;happen before&#x539F;&#x5219;&#xFF0C;&#x5BF9;volatile&#x5B57;&#x6BB5;&#x7684;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#x5148;&#x4E8E;&#x8BFB;&#x64CD;&#x4F5C;&#xFF0C;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x4E0D;&#x4F1A;&#x810F;&#x8BFB;),volatile&#x4E3A;&#x4E86;&#x8BA9;&#x53D8;&#x91CF;&#x63D0;&#x4F9B;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x5185;&#x5B58;&#x53EF;&#x89C1;&#x6027;&#xFF0C;&#x4F1A;&#x7981;&#x6B62;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x7684;&#x91CD;&#x6392;&#x5E8F;&#xFF08;&#x5BFC;&#x81F4;&#x7F13;&#x5B58;&#x4F18;&#x5316;&#x7684;&#x6548;&#x679C;&#x964D;&#x4F4E;&#xFF09;</p>
<h2 id="&#x7ED3;&#x6784;">1.2. &#x7ED3;&#x6784;</h2><ul>
<li>ConcurrentHashMap&#x662F;&#x7531;Segment&#x6570;&#x7EC4;&#x548C;HashEntry&#x6570;&#x7EC4;&#x7EC4;&#x6210;&#x3002;</li>
<li>Segment&#x662F;&#x91CD;&#x5165;&#x9501;(ReentrantLock),&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x6BB5;&#x7ADE;&#x4E89;&#x9501;&#xFF0C;&#x6BCF;&#x4E2A;HashEntry&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x7ED3;&#x6784;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x5229;&#x7528;Hash&#x7B97;&#x6CD5;&#x5F97;&#x5230;&#x7D22;&#x5F15;&#x786E;&#x5B9A;&#x5F52;&#x5C5E;&#x7684;&#x6570;&#x636E;&#x6BB5;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5BF9;&#x5E94;&#x5230;&#x5728;&#x4FEE;&#x6539;&#x65F6;&#x9700;&#x8981;&#x7ADE;&#x4E89;&#x83B7;&#x53D6;&#x7684;&#x9501;&#x3002;</li>
</ul>
]]></content>
      <categories>
        <category>concurrent</category>
      </categories>
      <tags>
        <tag>JDK</tag>
      </tags>
  </entry>
  <entry>
    <title>shell脚本</title>
    <url>/2018/shell-jiao-ben/</url>
    <content><![CDATA[<h2 id="&#x53D8;&#x91CF;">0.1. &#x53D8;&#x91CF;</h2><p><strong>&#x53D8;&#x91CF;&#x4F7F;&#x7528;</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">your_name=<span class="string">&quot;yuyu&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$your_name</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">${your_name}</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<blockquote>
<p>&#x7B49;&#x53F7;&#x5DE6;&#x53F3;&#x4E0D;&#x53EF;&#x6709;&#x7A7A;&#x683C;</p>
</blockquote>
<p><strong>for&#x5FAA;&#x73AF;</strong></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> skill <span class="keyword">in</span> Ada Coffe Action Java; <span class="keyword">do</span></span><br><span class="line">    echo <span class="string">&quot;I am good at ${skill}Script&quot;</span></span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="comment">-- &#x7ED3;&#x679C;</span></span><br><span class="line">I am good <span class="keyword">at</span> AdaScript</span><br><span class="line">I am good <span class="keyword">at</span> CoffeScript</span><br><span class="line">I am good <span class="keyword">at</span> ActionScript</span><br><span class="line">I am good <span class="keyword">at</span> JavaScript</span><br></pre></td></tr></table></figure>
<blockquote>
<p>in&#x540E;&#x65B9;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;,&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x95F4;&#x4F7F;&#x7528;&#x7A7A;&#x683C;&#x5206;&#x5F00;,&#x6253;&#x5370;&#x5B8C;&#x6BD5;&#x540E;&#x9700;done</p>
</blockquote>
<p><strong>&#x53EA;&#x8BFB;&#x53D8;&#x91CF;</strong></p>
<p>&#x4F7F;&#x7528; readonly &#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x5C06;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x4E3A;&#x53EA;&#x8BFB;&#x53D8;&#x91CF;&#xFF0C;&#x53EA;&#x8BFB;&#x53D8;&#x91CF;&#x7684;&#x503C;&#x4E0D;&#x80FD;&#x88AB;&#x6539;&#x53D8;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x5C1D;&#x8BD5;&#x66F4;&#x6539;&#x53EA;&#x8BFB;&#x53D8;&#x91CF;&#xFF0C;&#x7ED3;&#x679C;&#x62A5;&#x9519;&#xFF1A;</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">myUrl=<span class="string">&quot;http://www.google.com&quot;</span></span><br><span class="line">readonly myUrl</span><br><span class="line">myUrl=<span class="string">&quot;http://www.runoob.com&quot;</span></span><br><span class="line"></span><br><span class="line">-- &#x7ED3;&#x679C;</span><br><span class="line"><span class="section">/bin/sh: NAME: This variable is read only.</span></span><br></pre></td></tr></table></figure>

<p><strong>&#x5220;&#x9664;&#x53D8;&#x91CF;</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">unset</span> variable_name</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="&#x53D8;&#x91CF;&#x7C7B;&#x578B;">0.2. &#x53D8;&#x91CF;&#x7C7B;&#x578B;</h2><p>1) &#x5C40;&#x90E8;&#x53D8;&#x91CF; &#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x5728;&#x811A;&#x672C;&#x6216;&#x547D;&#x4EE4;&#x4E2D;&#x5B9A;&#x4E49;&#xFF0C;&#x4EC5;&#x5728;&#x5F53;&#x524D;shell&#x5B9E;&#x4F8B;&#x4E2D;&#x6709;&#x6548;&#xFF0C;&#x5176;&#x4ED6;shell&#x542F;&#x52A8;&#x7684;&#x7A0B;&#x5E8F;&#x4E0D;&#x80FD;&#x8BBF;&#x95EE;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x3002;<br>2) &#x73AF;&#x5883;&#x53D8;&#x91CF; &#x6240;&#x6709;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x5305;&#x62EC;shell&#x542F;&#x52A8;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x90FD;&#x80FD;&#x8BBF;&#x95EE;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x6709;&#x4E9B;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x6765;&#x4FDD;&#x8BC1;&#x5176;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x3002;&#x5FC5;&#x8981;&#x7684;&#x65F6;&#x5019;shell&#x811A;&#x672C;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x3002;<br>3) shell&#x53D8;&#x91CF; shell&#x53D8;&#x91CF;&#x662F;&#x7531;shell&#x7A0B;&#x5E8F;&#x8BBE;&#x7F6E;&#x7684;&#x7279;&#x6B8A;&#x53D8;&#x91CF;&#x3002;shell&#x53D8;&#x91CF;&#x4E2D;&#x6709;&#x4E00;&#x90E8;&#x5206;&#x662F;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x6709;&#x4E00;&#x90E8;&#x5206;&#x662F;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x4FDD;&#x8BC1;&#x4E86;shell&#x7684;&#x6B63;&#x5E38;&#x8FD0;&#x884C;</p>
<hr>
<h2 id="shell&#x5B57;&#x7B26;&#x4E32;">0.3. shell&#x5B57;&#x7B26;&#x4E32;</h2><p>&#x5B57;&#x7B26;&#x4E32;&#x662F;shell&#x7F16;&#x7A0B;&#x4E2D;&#x6700;&#x5E38;&#x7528;&#x6700;&#x6709;&#x7528;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF08;&#x9664;&#x4E86;&#x6570;&#x5B57;&#x548C;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4E5F;&#x6CA1;&#x5565;&#x5176;&#x5B83;&#x7C7B;&#x578B;&#x597D;&#x7528;&#x4E86;&#xFF09;&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#x53EF;&#x4EE5;&#x7528;&#x5355;&#x5F15;&#x53F7;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x53CC;&#x5F15;&#x53F7;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x5F15;&#x53F7;&#x3002;&#x5355;&#x53CC;&#x5F15;&#x53F7;&#x7684;&#x533A;&#x522B;&#x8DDF;PHP&#x7C7B;&#x4F3C;&#x3002;</p>
<p><strong>&#x5355;&#x5F15;&#x53F7;</strong></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">str</span>=<span class="string">&apos;this is a string&apos;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>&#x5355;&#x5F15;&#x53F7;&#x91CC;&#x7684;&#x4EFB;&#x4F55;&#x5B57;&#x7B26;&#x90FD;&#x4F1A;&#x539F;&#x6837;&#x8F93;&#x51FA;&#xFF0C;&#x5355;&#x5F15;&#x53F7;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#x662F;&#x65E0;&#x6548;&#x7684;&#xFF1B;</li>
<li>&#x5355;&#x5F15;&#x53F7;&#x5B57;&#x4E32;&#x4E2D;&#x4E0D;&#x80FD;&#x51FA;&#x73B0;&#x5355;&#x72EC;&#x4E00;&#x4E2A;&#x7684;&#x5355;&#x5F15;&#x53F7;&#xFF08;&#x5BF9;&#x5355;&#x5F15;&#x53F7;&#x4F7F;&#x7528;&#x8F6C;&#x4E49;&#x7B26;&#x540E;&#x4E5F;&#x4E0D;&#x884C;&#xFF09;&#xFF0C;&#x4F46;&#x53EF;&#x6210;&#x5BF9;&#x51FA;&#x73B0;&#xFF0C;&#x4F5C;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#x62FC;&#x63A5;&#x4F7F;&#x7528;&#x3002;</li>
<li></li>
</ul>
<p><strong>&#x53CC;&#x5F15;&#x53F7;</strong></p>
<figure class="highlight smalltalk"><table><tr><td class="code"><pre><span class="line">your_name=<span class="string">&apos;runoob&apos;</span></span><br><span class="line">str=<span class="comment">&quot;Hello, I know you are \&quot;</span><span class="string">$y</span>our_name\<span class="comment">&quot;! \n&quot;</span></span><br><span class="line">echo <span class="string">$s</span>tr</span><br><span class="line"></span><br><span class="line">-- &#x8F93;&#x51FA;</span><br><span class="line"><span class="type">Hello</span>, <span class="type">I</span> know you are <span class="comment">&quot;runoob&quot;</span>!</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x53CC;&#x5F15;&#x53F7;&#x91CC;&#x53EF;&#x4EE5;&#x6709;&#x53D8;&#x91CF;</li>
<li>&#x53CC;&#x5F15;&#x53F7;&#x91CC;&#x53EF;&#x4EE5;&#x51FA;&#x73B0;&#x8F6C;&#x4E49;&#x5B57;&#x7B26;</li>
</ul>
<p><strong>&#x62FC;&#x63A5;&#x5B57;&#x7B26;&#x4E32;</strong></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="attribute">your_name</span>=<span class="string">&quot;runoob&quot;</span></span><br><span class="line"><span class="comment"># &#x4F7F;&#x7528;&#x53CC;&#x5F15;&#x53F7;&#x62FC;&#x63A5;</span></span><br><span class="line"><span class="attribute">greeting</span>=<span class="string">&quot;hello, &quot;</span><span class="variable">$your_name</span><span class="string">&quot; !&quot;</span></span><br><span class="line"><span class="attribute">greeting_1</span>=<span class="string">&quot;hello, <span class="variable">${your_name}</span> !&quot;</span></span><br><span class="line">echo <span class="variable">$greeting</span>  <span class="variable">$greeting_1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x4F7F;&#x7528;&#x5355;&#x5F15;&#x53F7;&#x62FC;&#x63A5;</span></span><br><span class="line"><span class="attribute">greeting_2</span>=<span class="string">&apos;hello, &apos;</span><span class="variable">$your_name</span><span class="string">&apos; !&apos;</span></span><br><span class="line"><span class="attribute">greeting_3</span>=<span class="string">&apos;hello, ${your_name} !&apos;</span></span><br><span class="line">echo <span class="variable">$greeting_2</span>  <span class="variable">$greeting_3</span></span><br><span class="line"></span><br><span class="line">-- &#x7ED3;&#x679C;</span><br><span class="line">hello, runoob ! hello, runoob !</span><br><span class="line">hello, runoob ! hello, <span class="variable">${your_name}</span> !</span><br></pre></td></tr></table></figure>

<p><strong>&#x83B7;&#x53D6;&#x5B57;&#x7B26;&#x4E32;&#x957F;&#x5EA6;</strong></p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">string=<span class="string">&quot;abcd&quot;</span></span><br><span class="line">echo ${<span class="comment">#string} </span></span><br><span class="line"><span class="comment"># &#x8F93;&#x51FA; 4</span></span><br></pre></td></tr></table></figure>
<p><strong>&#x63D0;&#x53D6;&#x5B50;&#x5B57;&#x7B26;&#x4E32;</strong></p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span>=<span class="string">&quot;runoob is a great site&quot;</span></span><br><span class="line">echo ${<span class="keyword">string</span>:<span class="number">1</span>:<span class="number">4</span>}</span><br><span class="line"><span class="meta"># &#x8F93;&#x51FA; unoo</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>maven查看依赖</title>
    <url>/2018/maven-cha-kan-yi-lai/</url>
    <content><![CDATA[<h2 id="&#x67E5;&#x770B;&#x9879;&#x76EE;&#x7ED3;&#x6784;-tree">0.1. &#x67E5;&#x770B;&#x9879;&#x76EE;&#x7ED3;&#x6784;,tree</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">mvn</span> <span class="selector-tag">dependency</span><span class="selector-pseudo">:tree</span> &gt;<span class="selector-tag">a</span><span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>idea&#x4E2D;&#x4E0B;&#x8F7D;maven-helper&#x4E5F;&#x53EF;&#x8FBE;&#x5230;&#x6548;&#x679C;</p>
]]></content>
      <categories>
        <category>util</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>maven</title>
    <url>/2018/maven/</url>
    <content><![CDATA[<blockquote>
<p>&#x6B64;&#x8D44;&#x6599;&#x4ECE;&#x5B98;&#x7F51;&#x6458;&#x53D6;</p>
</blockquote>
<a id="more"></a>
<h2 id="&#x6A21;&#x677F;">0.1. &#x6A21;&#x677F;</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="tag"><span class="string">                      http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">&#xA0;</span><br><span class="line">  <span class="comment">&lt;!-- The Basics --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>...<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>...<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>...<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>...<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>...<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span>...<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span>...<span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modules</span>&gt;</span>...<span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span>...<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">&#xA0;</span><br><span class="line">  <span class="comment">&lt;!-- Build Settings --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span>...<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">reporting</span>&gt;</span>...<span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line">&#xA0;</span><br><span class="line">  <span class="comment">&lt;!-- More Project Information --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>...<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>...<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>...<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">inceptionYear</span>&gt;</span>...<span class="tag">&lt;/<span class="name">inceptionYear</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">licenses</span>&gt;</span>...<span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">organization</span>&gt;</span>...<span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">developers</span>&gt;</span>...<span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">contributors</span>&gt;</span>...<span class="tag">&lt;/<span class="name">contributors</span>&gt;</span></span><br><span class="line">&#xA0;</span><br><span class="line">  <span class="comment">&lt;!-- Environment Settings --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">issueManagement</span>&gt;</span>...<span class="tag">&lt;/<span class="name">issueManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ciManagement</span>&gt;</span>...<span class="tag">&lt;/<span class="name">ciManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mailingLists</span>&gt;</span>...<span class="tag">&lt;/<span class="name">mailingLists</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scm</span>&gt;</span>...<span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">prerequisites</span>&gt;</span>...<span class="tag">&lt;/<span class="name">prerequisites</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>...<span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span>...<span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span>...<span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span>...<span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><span data-type="color" style="color:rgb(0, 0, 0)"> </span></p>
<h3 id="&#x57FA;&#x672C;&#x914D;&#x7F6E;">0.1.1. &#x57FA;&#x672C;&#x914D;&#x7F6E;</h3><div class="bi-table">
  <table>
    <colgroup>
      <col width="114px">
      <col width="636px">
    </colgroup>
    <tbody>
      <tr>
        <td rowspan="1" colspan="1">
          <div data-type="p">modelVersion</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">Maven&#x6A21;&#x5757;&#x7248;&#x672C;&#xFF0C;&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x90FD;&#x53D6;&#x503C;4.0.0</div>
        </td>
      </tr>
      <tr>
        <td rowspan="1" colspan="1">
          <div data-type="p">groupId</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x5206;&#x7EC4;&#x540D;&#x79F0;,&#x4E00;&#x822C;&#x57DF;&#x540D;&#x5012;&#x53D9;&#x3002;</div>
        </td>
      </tr>
      <tr>
        <td rowspan="1" colspan="1">
          <div data-type="p">artifactId</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x9879;&#x76EE;&#x540D;&#x79F0;&#x6216;&#x5B50;&#x6A21;&#x5757;&#x540D;&#x79F0;&#x3002;</div>
        </td>
      </tr>
      <tr height="34px">
        <td rowspan="1" colspan="1">
          <div data-type="p">version</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x7248;&#x672C;&#x53F7;</div>
          <ul data-type="unordered-list">
            <li data-type="list-item" data-list-type="unordered-list">
              <div data-type="p"><strong>*-SNAPSHOT </strong>&#x4E0D;&#x7A33;&#x5B9A;&#x7248;&#x672C;</div>
              <ul data-type="unordered-list">
                <li data-type="list-item" data-list-type="unordered-list">
                  <div data-type="p">&#x5B58;&#x653E;&#x5728;&#x5FEB;&#x7167;&#x4ED3;&#x5E93;,&#x6784;&#x5EFA;&#x65F6;&#x8FDC;&#x7A0B;&#x6293;&#x53D6;</div>
                </li>
              </ul>
            </li>
            <li data-type="list-item" data-list-type="unordered-list">
              <div data-type="p"><strong>*-RELEASE</strong> &#x7A33;&#x5B9A;&#x7248;&#x672C;</div>
              <ul data-type="unordered-list">
                <li data-type="list-item" data-list-type="unordered-list">
                  <div data-type="p">&#x5B58;&#x653E;&#x5728;&#x6B63;&#x5F0F;&#x4ED3;&#x5E93;,&#x6784;&#x5EFA;&#x7684;&#x65F6;&#x4F1A;&#x5148;&#x5728;&#x672C;&#x6B21;&#x4ED3;&#x5E93;&#x4E2D;&#x67E5;&#x627E;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x4F9D;&#x8D56;&#x5E93;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#x624D;&#x4F1A;&#x53BB;&#x8FDC;&#x7A0B;&#x4ED3;&#x5E93;&#x4E2D;&#x53BB;&#x62C9;&#x53D6;</div>
                </li>
              </ul>
            </li>
          </ul>
        </td>
      </tr>
      <tr height="34px">
        <td rowspan="1" colspan="1">
          <div data-type="p">name</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x9879;&#x76EE;&#x540D;&#x79F0;</div>
        </td>
      </tr>
      <tr height="34px">
        <td rowspan="1" colspan="1">
          <div data-type="p">description</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x9879;&#x76EE;&#x63CF;&#x8FF0;</div>
        </td>
      </tr>
      <tr>
        <td rowspan="1" colspan="1">
          <div data-type="p">packaging</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x6253;&#x5305;&#x7C7B;&#x578B;&#xFF0C;&#x53EF;&#x53D6;&#x503C;&#xFF1A;jar,war,maven-plugin&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x7528;&#x4E8E;package&#x7684;phase&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x89C1;package&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#x542F;&#x52A8;&#x7684;plugin&#xFF0C;</div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<h4 id="parent">0.1.1.1. parent</h4><p>&#x7EE7;&#x627F;&#x7236;&#x7C7B;</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.yuyu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>yuyu-nexus-parent-pom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="modules">0.1.1.2. modules</h4><p>&#x58F0;&#x660E;&#x5B50;&#x6A21;&#x5757;</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">module</span>&gt;</span>sales-mall<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">module</span>&gt;</span>sales-middle<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Dependencies">0.1.1.3. Dependencies</h4><p>&#x9879;&#x76EE;&#x6240;&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#x5305;</p>
<div class="bi-table">
  <table>
    <colgroup>
      <col width="113px">
      <col width="637px">
    </colgroup>
    <tbody>
      <tr>
        <td rowspan="1" colspan="1">
          <div data-type="p">groupId</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x4F9D;&#x8D56;&#x9879;&#x7684;groupId</div>
        </td>
      </tr>
      <tr>
        <td rowspan="1" colspan="1">
          <div data-type="p">artifactId</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x4F9D;&#x8D56;&#x9879;&#x7684;artifactId</div>
        </td>
      </tr>
      <tr>
        <td rowspan="1" colspan="1">
          <div data-type="p">version</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x4F9D;&#x8D56;&#x9879;&#x7684;&#x7248;&#x672C;</div>
        </td>
      </tr>
      <tr>
        <td rowspan="1" colspan="1">
          <div data-type="p">scope</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x4F9D;&#x8D56;&#x9879;&#x7684;&#x9002;&#x7528;&#x8303;&#x56F4;&#xFF1A;</div>
          <ul data-type="unordered-list">
            <li data-type="list-item" data-list-type="unordered-list">
              <div data-type="p">compile&#xFF0C;&#x7F3A;&#x7701;&#x503C;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x9636;&#x6BB5;&#xFF0C;&#x4F1A;&#x968F;&#x7740;&#x9879;&#x76EE;&#x4E00;&#x8D77;&#x53D1;&#x5E03;&#x3002;</div>
            </li>
            <li data-type="list-item" data-list-type="unordered-list">
              <div data-type="p">provided&#xFF0C;&#x7C7B;&#x4F3C;compile&#xFF0C;&#x671F;&#x671B;JDK&#x3001;&#x5BB9;&#x5668;&#x6216;&#x4F7F;&#x7528;&#x8005;&#x4F1A;&#x63D0;&#x4F9B;&#x8FD9;&#x4E2A;&#x4F9D;&#x8D56;&#x3002;&#x5982;servlet.jar&#x3002;</div>
            </li>
            <li data-type="list-item" data-list-type="unordered-list">
              <div data-type="p">runtime&#xFF0C;&#x53EA;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x4F7F;&#x7528;&#xFF0C;&#x5982;JDBC&#x9A71;&#x52A8;&#xFF0C;&#x9002;&#x7528;&#x8FD0;&#x884C;&#x548C;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#x3002;</div>
            </li>
            <li data-type="list-item" data-list-type="unordered-list">
              <div data-type="p">test&#xFF0C;&#x53EA;&#x5728;&#x6D4B;&#x8BD5;&#x65F6;&#x4F7F;&#x7528;&#xFF0C;&#x7528;&#x4E8E;&#x7F16;&#x8BD1;&#x548C;&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x3002;&#x4E0D;&#x4F1A;&#x968F;&#x9879;&#x76EE;&#x53D1;&#x5E03;&#x3002;</div>
            </li>
            <li data-type="list-item" data-list-type="unordered-list">
              <div data-type="p">system&#xFF0C;&#x7C7B;&#x4F3C;provided&#xFF0C;&#x9700;&#x8981;&#x663E;&#x5F0F;&#x63D0;&#x4F9B;&#x5305;&#x542B;&#x4F9D;&#x8D56;&#x7684;jar&#xFF0C;Maven&#x4E0D;&#x4F1A;&#x5728;Repository&#x4E2D;&#x67E5;&#x627E;&#x5B83;&#x3002;&#x4E4B;&#x524D;&#x4F8B;&#x5B50;&#x91CC;&#x7684;junit&#x5C31;&#x53EA;&#x7528;&#x5728;&#x4E86;test&#x4E2D;&#x3002;</div>
            </li>
          </ul>
        </td>
      </tr>
      <tr>
        <td rowspan="1" colspan="1">
          <div data-type="p">exclusions</div>
        </td>
        <td rowspan="1" colspan="1">
          <div data-type="p">&#x6392;&#x9664;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x4F9D;&#x8D56;&#x51B2;&#x7A81;&#x65F6;&#x4F7F;&#x7528;&#x3002;</div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<h5 id="exclusions">0.1.1.3.1. exclusions</h5><ol>
<li>&#x6392;&#x9664;&#x544A;&#x8BC9;Maven&#x4E0D;&#x8981;&#x5305;&#x62EC;&#x6307;&#x5B9A;&#x7684;&#x9879;&#x76EE;&#x4F9D;&#x8D56;&#x7684;&#x8FD9;&#x79CD;&#x4F9D;&#x8D56;&#x6027;(&#x6362;&#x53E5;&#x8BDD;&#x8BF4;,&#x5B83;&#x7684;&#x4F20;&#x9012;&#x4F9D;&#x8D56;)&#x3002;&#x4F8B;&#x5982;,maven-embedder&#x9700;&#x8981;maven-core,&#x6211;&#x4EEC;&#x4E0D;&#x5E0C;&#x671B;&#x4F7F;&#x7528;&#x5B83;&#x6216;&#x5176;&#x4F9D;&#x8D56;&#x9879;,&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5C06;&#x5B83;&#x6392;&#x9664;&#x3002;<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-embedder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>&#x5B83;&#x6709;&#x65F6;&#x4E5F;&#x6709;&#x7528;&#x7247;&#x6BB5;&#x4F9D;&#x8D56;&#x7684;&#x4F20;&#x9012;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x3002;&#x4F9D;&#x8D56;&#x53EF;&#x80FD;&#x9519;&#x8BEF;&#x5730;&#x6307;&#x5B9A;&#x7684;&#x8303;&#x56F4;,&#x4E0E;&#x5176;&#x4ED6;&#x4F9D;&#x8D56;&#x6216;&#x4F9D;&#x8D56;&#x9879;&#x51B2;&#x7A81;&#x5728;&#x60A8;&#x7684;&#x9879;&#x76EE;&#x3002;&#x4F7F;&#x7528;&#x901A;&#x914D;&#x7B26;&#x4E0D;&#x4FBF;&#x4E8E;&#x6392;&#x9664;&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x4F20;&#x9012;&#x4F9D;&#x8D56;&#x9879;&#x3002;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x4F7F;&#x7528;maven-embedder&#x548C;&#x4F60;&#x60F3;&#x7BA1;&#x7406;&#x4F9D;&#x8D56;&#x4F60;&#x81EA;&#x5DF1;&#x4F7F;&#x7528;,&#x6240;&#x4EE5;&#x4F60;&#x526A;&#x8F91;&#x4F20;&#x9012;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;:<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-embedder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>*<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>*<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="build">0.1.1.4. build</h4>&#x6784;&#x5EFA;<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>sales-middle-service<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>${project.basedir}/src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>${project.basedir}/src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<table>
<thead>
<tr>
<th align="left">finalName</th>
<th align="left">&#x9879;&#x76EE;&#x6253;&#x5305;&#x540E;&#x7684;&#x540D;&#x5B57;</th>
</tr>
</thead>
<tbody><tr>
<td align="left">resources</td>
<td align="left">&#x914D;&#x7F6E;&#x6587;&#x4EF6;</td>
</tr>
<tr>
<td align="left">filter</td>
<td align="left">&#x53EF;&#x4EE5;&#x628A;&#x5C5E;&#x6027;&#x5199;&#x5230;&#x6587;&#x4EF6;&#x91CC;,&#x7528;&#x5C5E;&#x6027;&#x6587;&#x4EF6;&#x91CC;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#x505A;&#x66FF;&#x6362;</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>util</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>io流</title>
    <url>/2018/io-stream/</url>
    <content><![CDATA[<h1 id="&#x5206;&#x7C7B;&#x4E00;&#xFF1A;&#x6309;&#x64CD;&#x4F5C;&#x65B9;&#x5F0F;&#xFF08;&#x7C7B;&#x7ED3;&#x6784;&#xFF09;">1. &#x5206;&#x7C7B;&#x4E00;&#xFF1A;&#x6309;&#x64CD;&#x4F5C;&#x65B9;&#x5F0F;&#xFF08;&#x7C7B;&#x7ED3;&#x6784;&#xFF09;</h1><p><strong>&#x5B57;&#x8282;&#x6D41;&#x548C;&#x5B57;&#x7B26;&#x6D41;&#xFF1A;</strong></p>
<ul>
<li>&#x5B57;&#x8282;&#x6D41;&#xFF1A;&#x4EE5;&#x5B57;&#x8282;&#x4E3A;&#x5355;&#x4F4D;&#xFF0C;&#x6BCF;&#x6B21;&#x6B21;&#x8BFB;&#x5165;&#x6216;&#x8BFB;&#x51FA;&#x662F;8&#x4F4D;&#x6570;&#x636E;&#x3002;&#x53EF;&#x4EE5;&#x8BFB;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x6570;&#x636E;&#x3002;</li>
<li>&#x5B57;&#x7B26;&#x6D41;&#xFF1A;&#x4EE5;&#x5B57;&#x7B26;&#x4E3A;&#x5355;&#x4F4D;&#xFF0C;&#x6BCF;&#x6B21;&#x6B21;&#x8BFB;&#x5165;&#x6216;&#x8BFB;&#x51FA;&#x662F;16&#x4F4D;&#x6570;&#x636E;&#x3002;&#x5176;&#x53EA;&#x80FD;&#x8BFB;&#x53D6;&#x5B57;&#x7B26;&#x7C7B;&#x578B;&#x6570;&#x636E;&#x3002;</li>
</ul>
<a id="more"></a>

<p><strong>&#x8F93;&#x51FA;&#x6D41;&#x548C;&#x8F93;&#x5165;&#x6D41;&#xFF1A;</strong></p>
<ul>
<li>&#x8F93;&#x51FA;&#x6D41;&#xFF1A;&#x4ECE;&#x5185;&#x5B58;&#x8BFB;&#x51FA;&#x5230;&#x6587;&#x4EF6;&#x3002;&#x53EA;&#x80FD;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;&#x3002;</li>
<li>&#x8F93;&#x5165;&#x6D41;&#xFF1A;&#x4ECE;&#x6587;&#x4EF6;&#x8BFB;&#x5165;&#x5230;&#x5185;&#x5B58;&#x3002;&#x53EA;&#x80FD;&#x8FDB;&#x884C;&#x8BFB;&#x64CD;&#x4F5C;&#x3002;</li>
</ul>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong> &#x8FD9;&#x91CC;&#x7684;&#x51FA;&#x548C;&#x5165;&#xFF0C;&#x90FD;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;&#x7CFB;&#x7EDF;&#x5185;&#x5B58;&#x800C;&#x8A00;&#x7684;&#x3002;</p>
<p><strong>&#x8282;&#x70B9;&#x6D41;&#x548C;&#x5904;&#x7406;&#x6D41;&#xFF1A;</strong></p>
<ul>
<li>&#x8282;&#x70B9;&#x6D41;&#xFF1A;&#x76F4;&#x63A5;&#x4E0E;&#x6570;&#x636E;&#x6E90;&#x76F8;&#x8FDE;&#xFF0C;&#x8BFB;&#x5165;&#x6216;&#x8BFB;&#x51FA;&#x3002;</li>
<li>&#x5904;&#x7406;&#x6D41;&#xFF1A;&#x4E0E;&#x8282;&#x70B9;&#x6D41;&#x4E00;&#x5757;&#x4F7F;&#x7528;&#xFF0C;&#x5728;&#x8282;&#x70B9;&#x6D41;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#xFF0C;&#x518D;&#x5957;&#x63A5;&#x4E00;&#x5C42;&#xFF0C;&#x5957;&#x63A5;&#x5728;&#x8282;&#x70B9;&#x6D41;&#x4E0A;&#x7684;&#x5C31;&#x662F;&#x5904;&#x7406;&#x6D41;&#x3002;</li>
</ul>
<p><strong>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;&#x5904;&#x7406;&#x6D41;&#xFF1F;</strong></p>
<p>&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x8282;&#x70B9;&#x6D41;&#xFF0C;&#x8BFB;&#x5199;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x4E3A;&#x4E86;&#x66F4;&#x5FEB;&#x7684;&#x8BFB;&#x5199;&#x6587;&#x4EF6;&#xFF0C;&#x624D;&#x6709;&#x4E86;&#x5904;&#x7406;&#x6D41;&#x3002;</p>
<h2 id="&#x5206;&#x7C7B;&#x8BF4;&#x660E;&#xFF1A;">1.1. &#x5206;&#x7C7B;&#x8BF4;&#x660E;&#xFF1A;</h2><p><strong>1. &#x8F93;&#x5165;&#x5B57;&#x8282;&#x6D41;InputStream&#xFF1A;</strong></p>
<ul>
<li><p><strong>ByteArrayInputStream&#x3001;StringBufferInputStream&#x3001;FileInputStream</strong> &#x662F;&#x4E09;&#x79CD;&#x57FA;&#x672C;&#x7684;&#x4ECB;&#x8D28;&#x6D41;&#xFF0C;&#x5B83;&#x4EEC;&#x5206;&#x522B;&#x4ECE;Byte &#x6570;&#x7EC4;&#x3001;StringBuffer&#x3001;&#x548C;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x3002;</p>
</li>
<li><p><strong>PipedInputStream</strong> &#x662F;&#x4ECE;&#x4E0E;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x5171;&#x7528;&#x7684;&#x7BA1;&#x9053;&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x3002;PipedInputStream&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x8981;&#x548C;PipedOutputStream&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x5171;&#x540C;&#x4F7F;&#x7528;&#xFF0C;&#x5171;&#x540C;&#x5B8C;&#x6210;&#x7BA1;&#x9053;&#x7684;&#x8BFB;&#x53D6;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#x3002;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;&#x3002;</p>
</li>
<li><p><strong>DataInputStream&#xFF1A;</strong> &#x5C06;&#x57FA;&#x7840;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x8BFB;&#x53D6;&#x51FA;&#x6765;</p>
</li>
<li><p><strong>ObjectInputStream</strong> &#x548C;&#x6240;&#x6709; FilterInputStream &#x7684;&#x5B50;&#x7C7B;&#x90FD;&#x662F;&#x88C5;&#x9970;&#x6D41;&#xFF08;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#x7684;&#x4E3B;&#x89D2;&#xFF09;&#x3002;</p>
</li>
</ul>
<p><strong>2. &#x8F93;&#x51FA;&#x5B57;&#x8282;&#x6D41;OutputStream&#xFF1A;</strong></p>
<ul>
<li><p><strong>ByteArrayOutputStream&#x3001;FileOutputStream&#xFF1A;</strong> &#x662F;&#x4E24;&#x79CD;&#x57FA;&#x672C;&#x7684;&#x4ECB;&#x8D28;&#x6D41;&#xFF0C;&#x5B83;&#x4EEC;&#x5206;&#x522B;&#x5411;- Byte &#x6570;&#x7EC4;&#x3001;&#x548C;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;&#x3002;</p>
</li>
<li><p><strong>PipedOutputStream</strong> &#x662F;&#x5411;&#x4E0E;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x5171;&#x7528;&#x7684;&#x7BA1;&#x9053;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;&#x3002;</p>
</li>
<li><p><strong>DataOutputStream</strong> &#x5C06;&#x57FA;&#x7840;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5199;&#x5165;&#x5230;&#x6587;&#x4EF6;&#x4E2D;</p>
</li>
<li><p><strong>ObjectOutputStream</strong> &#x548C;&#x6240;&#x6709; FilterOutputStream &#x7684;&#x5B50;&#x7C7B;&#x90FD;&#x662F;&#x88C5;&#x9970;&#x6D41;&#x3002;</p>
</li>
</ul>
<p><strong>3. &#x5B57;&#x7B26;&#x8F93;&#x5165;&#x6D41;Reader:</strong></p>
<ul>
<li><p><strong>FileReader&#x3001;CharReader&#x3001;StringReader</strong> &#x662F;&#x4E09;&#x79CD;&#x57FA;&#x672C;&#x7684;&#x4ECB;&#x8D28;&#x6D41;&#xFF0C;&#x5B83;&#x4EEC;&#x5206;&#x5728;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x3001;Char &#x6570;&#x7EC4;&#x3001;String&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x3002;</p>
</li>
<li><p><strong>PipedReader&#xFF1A;</strong> &#x662F;&#x4ECE;&#x4E0E;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x5171;&#x7528;&#x7684;&#x7BA1;&#x9053;&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;</p>
</li>
<li><p><strong>BufferedReader &#xFF1A;</strong> &#x52A0;&#x7F13;&#x51B2;&#x529F;&#x80FD;&#xFF0C;&#x907F;&#x514D;&#x9891;&#x7E41;&#x8BFB;&#x5199;&#x786C;&#x76D8;</p>
</li>
<li><p><strong>InputStreamReader&#xFF1A;</strong> &#x662F;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5B57;&#x8282;&#x6D41;&#x548C;&#x5B57;&#x7B26;&#x6D41;&#x7684;&#x6865;&#x6881;&#xFF0C;&#x5B83;&#x5C06;&#x5B57;&#x8282;&#x6D41;&#x8F6C;&#x53D8;&#x4E3A;&#x5B57;&#x7B26;&#x6D41;&#x3002;</p>
</li>
</ul>
<p><strong>4. &#x5B57;&#x7B26;&#x8F93;&#x51FA;&#x6D41;Writer&#xFF1A;</strong></p>
<ul>
<li><p><strong>StringWriter:</strong> &#x5411;String &#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;&#x3002;</p>
</li>
<li><p><strong>CharArrayWriter&#xFF1A;</strong> &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x53EF;&#x7528;&#x4F5C;&#x5B57;&#x7B26;&#x8F93;&#x5165;&#x6D41;&#x7684;&#x5B57;&#x7B26;&#x7F13;&#x51B2;&#x533A;</p>
</li>
<li><p><strong>PipedWriter:</strong> &#x662F;&#x5411;&#x4E0E;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x5171;&#x7528;&#x7684;&#x7BA1;&#x9053;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;</p>
</li>
<li><p><strong>BufferedWriter &#xFF1A;</strong> &#x589E;&#x52A0;&#x7F13;&#x51B2;&#x529F;&#x80FD;&#xFF0C;&#x907F;&#x514D;&#x9891;&#x7E41;&#x8BFB;&#x5199;&#x786C;&#x76D8;&#x3002;</p>
</li>
<li></li>
<li><p><strong>PrintWriter &#x548C;PrintStream</strong> &#x5C06;&#x5BF9;&#x8C61;&#x7684;&#x683C;&#x5F0F;&#x8868;&#x793A;&#x6253;&#x5370;&#x5230;&#x6587;&#x672C;&#x8F93;&#x51FA;&#x6D41;&#x3002; &#x6781;&#x5176;&#x7C7B;&#x4F3C;&#xFF0C;&#x529F;&#x80FD;&#x548C;&#x4F7F;&#x7528;&#x4E5F;&#x975E;&#x5E38;&#x76F8;&#x4F3C;</p>
</li>
<li><p><strong>OutputStreamWriter&#xFF1A;</strong> &#x662F;OutputStream &#x5230;Writer &#x8F6C;&#x6362;&#x7684;&#x6865;&#x6881;&#xFF0C;&#x5B83;&#x7684;&#x5B50;&#x7C7B;FileWriter &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x6B64;&#x529F;&#x80FD;&#x7684;&#x5177;&#x4F53;&#x7C7B;&#xFF08;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x7814;&#x7A76;&#x4E00;SourceCode&#xFF09;&#x3002;&#x529F;&#x80FD;&#x548C;&#x4F7F;&#x7528;&#x548C;OutputStream &#x6781;&#x5176;&#x7C7B;&#x4F3C;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x6709;&#x5B83;&#x4EEC;&#x7684;&#x5BF9;&#x5E94;&#x56FE;&#x3002;</p>
</li>
</ul>
<h2 id="&#x5206;&#x7C7B;&#x8BF4;&#x660E;&#xFF1A;-1">1.2. &#x5206;&#x7C7B;&#x8BF4;&#x660E;&#xFF1A;</h2><p><strong>&#x5BF9;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF08;&#x8282;&#x70B9;&#x6D41;&#xFF09;&#xFF1A;</strong></p>
<ul>
<li><p>FileInputStream&#xFF08;&#x5B57;&#x8282;&#x8F93;&#x5165;&#x6D41;&#xFF09;&#xFF0C;</p>
</li>
<li><p>FileOutputStream&#xFF08;&#x5B57;&#x8282;&#x8F93;&#x51FA;&#x6D41;&#xFF09;&#xFF0C;</p>
</li>
<li><p>FileReader&#xFF08;&#x5B57;&#x7B26;&#x8F93;&#x5165;&#x6D41;&#xFF09;&#xFF0C;</p>
</li>
<li><p>FileWriter&#xFF08;&#x5B57;&#x7B26;&#x8F93;&#x51FA;&#x6D41;&#xFF09;</p>
</li>
</ul>
<p><strong>&#x5BF9;&#x7BA1;&#x9053;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF08;&#x8282;&#x70B9;&#x6D41;&#xFF09;&#xFF1A;</strong></p>
<ul>
<li><p>PipedInputStream&#xFF08;&#x5B57;&#x8282;&#x8F93;&#x5165;&#x6D41;&#xFF09;,</p>
</li>
<li><p>PipedOutStream&#xFF08;&#x5B57;&#x8282;&#x8F93;&#x51FA;&#x6D41;&#xFF09;&#xFF0C;</p>
</li>
<li><p>PipedReader&#xFF08;&#x5B57;&#x7B26;&#x8F93;&#x5165;&#x6D41;&#xFF09;&#xFF0C;</p>
</li>
<li><p>PipedWriter&#xFF08;&#x5B57;&#x7B26;&#x8F93;&#x51FA;&#x6D41;&#xFF09;&#x3002;</p>
</li>
<li><p>PipedInputStream&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x8981;&#x548C;PipedOutputStream&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x5171;&#x540C;&#x4F7F;&#x7528;&#xFF0C;&#x5171;&#x540C;&#x5B8C;&#x6210;&#x7BA1;&#x9053;&#x7684;&#x8BFB;&#x53D6;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#x3002;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;&#x3002;</p>
</li>
</ul>
<p><strong>&#x5B57;&#x8282;/&#x5B57;&#x7B26;&#x6570;&#x7EC4;&#x6D41;&#xFF08;&#x8282;&#x70B9;&#x6D41;&#xFF09;&#xFF1A;</strong></p>
<ul>
<li><p>ByteArrayInputStream&#xFF0C;</p>
</li>
<li><p>ByteArrayOutputStream&#xFF0C;</p>
</li>
<li><p>CharArrayReader&#xFF0C;</p>
</li>
<li><p>CharArrayWriter&#xFF1B;</p>
</li>
</ul>
<p><strong>&#x9664;&#x4E86;&#x4E0A;&#x8FF0;&#x4E09;&#x79CD;&#x662F;&#x8282;&#x70B9;&#x6D41;&#xFF0C;&#x5176;&#x4ED6;&#x90FD;&#x662F;&#x5904;&#x7406;&#x6D41;&#xFF0C;&#x9700;&#x8981;&#x8DDF;&#x8282;&#x70B9;&#x6D41;&#x914D;&#x5408;&#x4F7F;&#x7528;&#x3002;</strong></p>
<p><strong>Buffered&#x7F13;&#x51B2;&#x6D41;&#xFF08;&#x5904;&#x7406;&#x6D41;&#xFF09;</strong>&#xFF1A;&#x5E26;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5904;&#x7406;&#x6D41;&#xFF0C;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x4F5C;&#x7528;&#x7684;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x662F;&#xFF1A;&#x907F;&#x514D;&#x6BCF;&#x6B21;&#x548C;&#x786C;&#x76D8;&#x6253;&#x4EA4;&#x9053;&#xFF0C;&#x63D0;&#x9AD8;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x7684;&#x6548;&#x7387;&#x3002;</p>
<ul>
<li><p>BufferedInputStream&#xFF0C;</p>
</li>
<li><p>BufferedOutputStream&#xFF0C;</p>
</li>
<li><p>BufferedReader,</p>
</li>
<li><p>BufferedWriter,</p>
</li>
</ul>
<p><strong>&#x8F6C;&#x5316;&#x6D41;&#xFF08;&#x5904;&#x7406;&#x6D41;&#xFF09;&#xFF1A;</strong></p>
<ul>
<li><p>InputStreamReader&#xFF1A;&#x628A;&#x5B57;&#x8282;&#x8F6C;&#x5316;&#x6210;&#x5B57;&#x7B26;&#xFF1B;</p>
</li>
<li><p>OutputStreamWriter&#xFF1A;&#x628A;&#x5B57;&#x8282;&#x8F6C;&#x5316;&#x6210;&#x5B57;&#x7B26;&#x3002;</p>
</li>
</ul>
<p><strong>&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x6570;&#x636E;&#x6D41;&#xFF08;&#x5904;&#x7406;&#x6D41;&#xFF09;&#xFF1A;&#x7528;&#x4E8E;&#x64CD;&#x4F5C;&#x57FA;&#x672C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x503C;&#x3002;</strong></p>
<p>&#x56E0;&#x4E3A;&#x5E73;&#x65F6;&#x82E5;&#x662F;&#x6211;&#x4EEC;&#x8F93;&#x51FA;&#x4E00;&#x4E2A;8&#x4E2A;&#x5B57;&#x8282;&#x7684;long&#x7C7B;&#x578B;&#x6216;4&#x4E2A;&#x5B57;&#x8282;&#x7684;float&#x7C7B;&#x578B;&#xFF0C;&#x90A3;&#x600E;&#x4E48;&#x529E;&#x5462;&#xFF1F;&#x53EF;&#x4EE5;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#x8F93;&#x51FA;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x628A;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x7B26;&#x4E32;&#x8F93;&#x51FA;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x8F6C;&#x6362;&#x8D39;&#x65F6;&#x95F4;&#xFF0C;&#x82E5;&#x662F;&#x76F4;&#x63A5;&#x8F93;&#x51FA;&#x8BE5;&#x591A;&#x597D;&#x554A;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x6D41;&#x5C31;&#x89E3;&#x51B3;&#x4E86;&#x6211;&#x4EEC;&#x8F93;&#x51FA;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x56F0;&#x96BE;&#x3002;&#x6570;&#x636E;&#x6D41;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8F93;&#x51FA;float&#x7C7B;&#x578B;&#x6216;long&#x7C7B;&#x578B;&#xFF0C;&#x63D0;&#x9AD8;&#x4E86;&#x6570;&#x636E;&#x8BFB;&#x5199;&#x7684;&#x6548;&#x7387;&#x3002;</p>
<ul>
<li><p>DataInputStream&#xFF0C;</p>
</li>
<li><p>DataOutputStream&#x3002;</p>
</li>
</ul>
<p><strong>&#x6253;&#x5370;&#x6D41;&#xFF08;&#x5904;&#x7406;&#x6D41;&#xFF09;&#xFF1A;</strong></p>
<p>&#x4E00;&#x822C;&#x662F;&#x6253;&#x5370;&#x5230;&#x63A7;&#x5236;&#x53F0;&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#x6253;&#x5370;&#x7684;&#x5730;&#x65B9;&#x3002;</p>
<ul>
<li><p>PrintStream&#xFF0C;</p>
</li>
<li><p>PrintWriter&#xFF0C;</p>
</li>
</ul>
<p><strong>&#x5BF9;&#x8C61;&#x6D41;&#xFF08;&#x5904;&#x7406;&#x6D41;&#xFF09;&#xFF1A;</strong></p>
<p>&#x628A;&#x5C01;&#x88C5;&#x7684;&#x5BF9;&#x8C61;&#x76F4;&#x63A5;&#x8F93;&#x51FA;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x5728;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x7B26;&#x4E32;&#x518D;&#x8F93;&#x51FA;&#x3002;</p>
<ul>
<li><p>ObjectInputStream&#xFF0C;&#x5BF9;&#x8C61;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#xFF1B;</p>
</li>
<li><p>ObjectOutputStream&#xFF0C;&#x5BF9;&#x8C61;&#x5E8F;&#x5217;&#x5316;&#xFF1B;</p>
</li>
</ul>
<p><strong>&#x5408;&#x5E76;&#x6D41;&#xFF08;&#x5904;&#x7406;&#x6D41;&#xFF09;&#xFF1A;</strong></p>
<ul>
<li>SequenceInputStream&#xFF1A;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#x7C7B;&#xFF0C;&#x5C06;&#x4E24;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x8F93;&#x5165;&#x6D41;&#x5F53;&#x6210;&#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x6D41;&#x4F9D;&#x6B21;&#x8BFB;&#x53D6;&#x3002;</li>
</ul>
<p><strong>&#x5176;&#x4ED6;&#x7C7B;&#xFF1A;File&#xFF08;&#x5DF2;&#x7ECF;&#x88AB;Java7&#x7684;Path&#x53D6;&#x4EE3;&#xFF09;</strong></p>
<p>File&#x7C7B;&#x662F;&#x5BF9;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E2D;&#x6587;&#x4EF6;&#x4EE5;&#x53CA;&#x6587;&#x4EF6;&#x5939;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BF9;&#x8C61;&#x7684;&#x601D;&#x60F3;&#x6765;&#x64CD;&#x4F5C;&#x6587;&#x4EF6;&#x548C;&#x6587;&#x4EF6;&#x5939;&#x3002; File&#x7C7B;&#x4FDD;&#x5B58;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x7684;&#x5404;&#x79CD;&#x5143;&#x6570;&#x636E;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#x6587;&#x4EF6;&#x540D;&#x3001;&#x6587;&#x4EF6;&#x957F;&#x5EA6;&#x3001;&#x6700;&#x540E;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#x3001;&#x662F;&#x5426;&#x53EF;&#x8BFB;&#x3001;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x5F84;&#x540D;&#xFF0C;&#x5224;&#x65AD;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;&#x3001;&#x83B7;&#x5F97;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x5217;&#x8868;&#xFF0C;&#x521B;&#x5EFA;&#x3001;&#x5220;&#x9664;&#x6587;&#x4EF6;&#x548C;&#x76EE;&#x5F55;&#x7B49;&#x65B9;&#x6CD5;&#x3002;</p>
<p><strong>&#x5176;&#x4ED6;&#x7C7B;&#xFF1A;RandomAccessFile</strong></p>
<p>&#x8BE5;&#x5BF9;&#x8C61;&#x5E76;&#x4E0D;&#x662F;&#x6D41;&#x4F53;&#x7CFB;&#x4E2D;&#x7684;&#x4E00;&#x5458;&#xFF0C;&#x5176;&#x5C01;&#x88C5;&#x4E86;&#x5B57;&#x8282;&#x6D41;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x5C01;&#x88C5;&#x4E86;&#x4E00;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#xFF08;&#x5B57;&#x7B26;&#x6570;&#x7EC4;&#xFF09;&#xFF0C;&#x901A;&#x8FC7;&#x5185;&#x90E8;&#x7684;&#x6307;&#x9488;&#x6765;&#x64CD;&#x4F5C;&#x5B57;&#x7B26;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x3002; &#x8BE5;&#x5BF9;&#x8C61;&#x7279;&#x70B9;&#xFF1A;</p>
<ul>
<li><p>&#x8BE5;&#x5BF9;&#x8C61;&#x53EA;&#x80FD;&#x64CD;&#x4F5C;&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x6784;&#x9020;&#x51FD;&#x6570;&#x63A5;&#x6536;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#xFF1A;a.&#x5B57;&#x7B26;&#x4E32;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1B;b.File&#x5BF9;&#x8C61;&#x3002;</p>
</li>
<li><p>&#x8BE5;&#x5BF9;&#x8C61;&#x65E2;&#x53EF;&#x4EE5;&#x5BF9;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x8BFB;&#x64CD;&#x4F5C;&#xFF0C;&#x4E5F;&#x80FD;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x5728;&#x8FDB;&#x884C;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x5316;&#x65F6;&#x53EF;&#x6307;&#x5B9A;&#x64CD;&#x4F5C;&#x6A21;&#x5F0F;(r,rw)&#x3002;</p>
</li>
</ul>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong></p>
<p>IO&#x4E2D;&#x7684;&#x5F88;&#x591A;&#x5185;&#x5BB9;&#x90FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;NIO&#x5B8C;&#x6210;&#xFF0C;&#x8FD9;&#x4E9B;&#x77E5;&#x8BC6;&#x70B9;&#x5927;&#x5BB6;&#x77E5;&#x9053;&#x5C31;&#x597D;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#x8FD8;&#x662F;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;NIO/AIO&#x3002;</p>
]]></content>
      <categories>
        <category>io</category>
      </categories>
  </entry>
</search>
